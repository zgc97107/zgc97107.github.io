

<!DOCTYPE html>
<html lang="zh-CN" data-default-color-scheme=&#34;auto&#34;>



<head>
  <meta charset="UTF-8">
  <link rel="apple-touch-icon" sizes="76x76" href="/blog/img/favicon.png">
  <link rel="icon" type="image/png" href="/blog/img/favicon.png">
  <meta name="viewport"
        content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no, shrink-to-fit=no">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  
  <meta name="theme-color" content="#2f4154">
  <meta name="description" content="">
  <meta name="author" content="">
  <meta name="keywords" content="">
  <title>å¸¸è§ç®—æ³•ä¸åº”ç”¨ - ğŸğŸŠ&#39;s blog</title>

  <link  rel="stylesheet" href="https://cdn.staticfile.org/twitter-bootstrap/4.5.3/css/bootstrap.min.css" />


  <link  rel="stylesheet" href="https://cdn.staticfile.org/github-markdown-css/4.0.0/github-markdown.min.css" />
  <link  rel="stylesheet" href="/blog/lib/hint/hint.min.css" />

  
    
    
      
      <link  rel="stylesheet" href="https://cdn.staticfile.org/highlight.js/10.1.2/styles/github-gist.min.css" />
    
  

  
    <link  rel="stylesheet" href="https://cdn.staticfile.org/fancybox/3.5.7/jquery.fancybox.min.css" />
  



<!-- ä¸»é¢˜ä¾èµ–çš„å›¾æ ‡åº“ï¼Œä¸è¦è‡ªè¡Œä¿®æ”¹ -->

<link rel="stylesheet" href="//at.alicdn.com/t/font_1749284_ba1fz6golrf.css">



<link rel="stylesheet" href="//at.alicdn.com/t/font_1736178_kmeydafke9r.css">


<link  rel="stylesheet" href="/blog/css/main.css" />

<!-- è‡ªå®šä¹‰æ ·å¼ä¿æŒåœ¨æœ€åº•éƒ¨ -->


  <script id="fluid-configs">
    var Fluid = window.Fluid || {};
    var CONFIG = {"hostname":"zhaoguocheng.gitee.io","root":"/blog/","version":"1.8.5","typing":{"enable":true,"typeSpeed":70,"cursorChar":"_","loop":false},"toc":{"enable":true,"headingSelector":"h1,h2,h3,h4,h5,h6","collapseDepth":0},"anchorjs":{"enable":true,"element":"h1,h2,h3,h4,h5,h6","placement":"right","visible":"hover","icon":""},"copy_btn":true,"image_zoom":{"enable":true},"lazyload":{"enable":true,"onlypost":false},"web_analytics":{"enable":false,"baidu":null,"google":null,"gtag":null,"tencent":{"sid":null,"cid":null},"woyaola":null,"cnzz":null,"leancloud":{"app_id":null,"app_key":null,"server_url":null}}};
  </script>
  <script  src="/blog/js/utils.js" ></script>
  <script  src="/blog/js/color-schema.js" ></script>
<meta name="generator" content="Hexo 5.2.0"></head>


<body>
  <header style="height: 70vh;">
    <nav id="navbar" class="navbar fixed-top  navbar-expand-lg navbar-dark scrolling-navbar">
  <div class="container">
    <a class="navbar-brand"
       href="/blog/">&nbsp;<strong>Fluid</strong>&nbsp;</a>

    <button id="navbar-toggler-btn" class="navbar-toggler" type="button" data-toggle="collapse"
            data-target="#navbarSupportedContent"
            aria-controls="navbarSupportedContent" aria-expanded="false" aria-label="Toggle navigation">
      <div class="animated-icon"><span></span><span></span><span></span></div>
    </button>

    <!-- Collapsible content -->
    <div class="collapse navbar-collapse" id="navbarSupportedContent">
      <ul class="navbar-nav ml-auto text-center">
        
          
          
          
          
            <li class="nav-item">
              <a class="nav-link" href="/blog/">
                <i class="iconfont icon-home-fill"></i>
                ä¸»é¡µ
              </a>
            </li>
          
        
          
          
          
          
            <li class="nav-item">
              <a class="nav-link" href="/blog/archives/">
                <i class="iconfont icon-archive-fill"></i>
                å½’æ¡£
              </a>
            </li>
          
        
          
          
          
          
            <li class="nav-item">
              <a class="nav-link" href="/blog/categories/">
                <i class="iconfont icon-category-fill"></i>
                åˆ†ç±»
              </a>
            </li>
          
        
          
          
          
          
            <li class="nav-item">
              <a class="nav-link" href="/blog/tags/">
                <i class="iconfont icon-tags-fill"></i>
                æ ‡ç­¾
              </a>
            </li>
          
        
          
          
          
          
            <li class="nav-item">
              <a class="nav-link" href="/blog/about/">
                <i class="iconfont icon-user-fill"></i>
                å…³äº
              </a>
            </li>
          
        
        
          <li class="nav-item" id="search-btn">
            <a class="nav-link" data-toggle="modal" data-target="#modalSearch">&nbsp;<i
                class="iconfont icon-search"></i>&nbsp;</a>
          </li>
        
        
          <li class="nav-item" id="color-toggle-btn">
            <a class="nav-link" href="javascript:">&nbsp;<i
                class="iconfont icon-dark" id="color-toggle-icon"></i>&nbsp;</a>
          </li>
        
      </ul>
    </div>
  </div>
</nav>

    <div class="banner intro-2" id="background" parallax=true
         style="background: url('/blog/img/default.png') no-repeat center center;
           background-size: cover;">
      <div class="full-bg-img">
        <div class="mask flex-center" style="background-color: rgba(0, 0, 0, 0.3)">
          <div class="page-header text-center fade-in-up">
            <span class="h2" id="subtitle" title="å¸¸è§ç®—æ³•ä¸åº”ç”¨">
              
            </span>

            
              <div class="mt-3">
  
  
    <span class="post-meta">
      <i class="iconfont icon-date-fill" aria-hidden="true"></i>
      <time datetime="2020-08-16 18:10" pubdate>
        2020å¹´8æœˆ16æ—¥ æ™šä¸Š
      </time>
    </span>
  
</div>

<div class="mt-1">
  
    
    <span class="post-meta mr-2">
      <i class="iconfont icon-chart"></i>
      20.2k å­—
    </span>
  

  
    
    <span class="post-meta mr-2">
      <i class="iconfont icon-clock-fill"></i>
      
      
      283
       åˆ†é’Ÿ
    </span>
  

  
  
</div>

            
          </div>

          
        </div>
      </div>
    </div>
  </header>

  <main>
    
      

<div class="container-fluid">
  <div class="row">
    <div class="d-none d-lg-block col-lg-2"></div>
    <div class="col-lg-8 nopadding-md">
      <div class="container nopadding-md" id="board-ctn">
        <div class="py-5" id="board">
          <article class="post-content mx-auto">
            <!-- SEO header -->
            <h1 style="display: none">å¸¸è§ç®—æ³•ä¸åº”ç”¨</h1>
            
            <div class="markdown-body">
              <h3 id="å¤±æ•ˆç®—æ³•ä¸åº”ç”¨"><a href="#å¤±æ•ˆç®—æ³•ä¸åº”ç”¨" class="headerlink" title="å¤±æ•ˆç®—æ³•ä¸åº”ç”¨"></a>å¤±æ•ˆç®—æ³•ä¸åº”ç”¨</h3><p>å¤±æ•ˆç®—æ³•å¸¸è§äºç¼“å­˜ç³»ç»Ÿä¸­ã€‚å› ä¸ºç¼“å­˜å¾€å¾€å æ®å¤§é‡å†…å­˜ï¼Œè€Œå†…å­˜ç©ºé—´æ˜¯ç›¸å¯¹æ˜‚è´µï¼Œä¸”ç©ºé—´æœ‰é™çš„ï¼Œé‚£ä¹ˆé’ˆå¯¹ä¸€éƒ¨åˆ†å€¼ï¼Œå°±è¦ä¾æ®ç›¸åº”çš„ç®—æ³•è¿›è¡Œå¤±æ•ˆæˆ–ç§»é™¤æ“ä½œã€‚ </p>
<h4 id="å…ˆæ¥å…ˆæ·˜æ±°ï¼ˆFIFOï¼‰"><a href="#å…ˆæ¥å…ˆæ·˜æ±°ï¼ˆFIFOï¼‰" class="headerlink" title="å…ˆæ¥å…ˆæ·˜æ±°ï¼ˆFIFOï¼‰"></a>å…ˆæ¥å…ˆæ·˜æ±°ï¼ˆFIFOï¼‰</h4><h5 id="æ¦‚è¿°"><a href="#æ¦‚è¿°" class="headerlink" title="æ¦‚è¿°"></a>æ¦‚è¿°</h5><p>First In First Outï¼Œå…ˆæ¥å…ˆæ·˜æ±°ã€‚è¿™ç§ç®—æ³•åœ¨æ¯ä¸€æ¬¡æ–°æ•°æ®æ’å…¥æ—¶ï¼Œå¦‚æœé˜Ÿåˆ—å·²æ»¡ï¼Œåˆ™å°†æœ€æ—©æ’å…¥çš„æ•°æ®ç§»é™¤ã€‚ </p>
<h5 id="å®ç°"><a href="#å®ç°" class="headerlink" title="å®ç°"></a>å®ç°</h5><p>å¯ä»¥æ–¹ä¾¿çš„å€ŸåŠ©LinkedListæ¥å®ç°</p>
<pre><code class="hljs java"><span class="hljs-keyword">package</span> com.test;

<span class="hljs-keyword">import</span> java.util.Iterator;
<span class="hljs-keyword">import</span> java.util.LinkedList;

<span class="hljs-keyword">public</span> <span class="hljs-class"><span class="hljs-keyword">class</span> <span class="hljs-title">FIFO</span> </span>&#123;
    LinkedList&lt;Integer&gt; fifo = <span class="hljs-keyword">new</span> LinkedList&lt;Integer&gt;();
    <span class="hljs-keyword">int</span> size = <span class="hljs-number">3</span>;

    <span class="hljs-comment">//æ·»åŠ å…ƒç´ </span>
    <span class="hljs-function"><span class="hljs-keyword">public</span> <span class="hljs-keyword">void</span> <span class="hljs-title">add</span><span class="hljs-params">(<span class="hljs-keyword">int</span> i)</span> </span>&#123;
        fifo.addFirst(i);
        <span class="hljs-keyword">if</span> (fifo.size() &gt; size) &#123;
            fifo.removeLast();
        &#125;
        print();
    &#125;

    <span class="hljs-comment">//ç¼“å­˜å‘½ä¸­</span>
    <span class="hljs-function"><span class="hljs-keyword">public</span> <span class="hljs-keyword">void</span> <span class="hljs-title">read</span><span class="hljs-params">(<span class="hljs-keyword">int</span> i)</span> </span>&#123;
        Iterator&lt;Integer&gt; iterator = fifo.iterator();
        <span class="hljs-keyword">while</span> (iterator.hasNext()) &#123;
            <span class="hljs-keyword">int</span> j = iterator.next();
            <span class="hljs-keyword">if</span> (i == j) &#123;
                System.out.println(<span class="hljs-string">&quot;find it!&quot;</span>);
                print();
                <span class="hljs-keyword">return</span>;
            &#125;
        &#125;
        System.out.println(<span class="hljs-string">&quot;not found!&quot;</span>);
        print();
    &#125;

    <span class="hljs-comment">//æ‰“å°ç¼“å­˜</span>
    <span class="hljs-function"><span class="hljs-keyword">public</span> <span class="hljs-keyword">void</span> <span class="hljs-title">print</span><span class="hljs-params">()</span> </span>&#123;
        System.out.println(<span class="hljs-keyword">this</span>.fifo);
    &#125;

    <span class="hljs-comment">//æµ‹è¯•</span>
    <span class="hljs-function"><span class="hljs-keyword">public</span> <span class="hljs-keyword">static</span> <span class="hljs-keyword">void</span> <span class="hljs-title">main</span><span class="hljs-params">(String[] args)</span> </span>&#123;
        FIFO fifo = <span class="hljs-keyword">new</span> FIFO();
        System.out.println(<span class="hljs-string">&quot;add 1â€3:&quot;</span>);
        fifo.add(<span class="hljs-number">1</span>);
        fifo.add(<span class="hljs-number">2</span>);
        fifo.add(<span class="hljs-number">3</span>);
        System.out.println(<span class="hljs-string">&quot;add 4:&quot;</span>);
        fifo.add(<span class="hljs-number">4</span>);
        System.out.println(<span class="hljs-string">&quot;read 2:&quot;</span>);
        fifo.read(<span class="hljs-number">2</span>);
        System.out.println(<span class="hljs-string">&quot;read 100:&quot;</span>);
        fifo.read(<span class="hljs-number">100</span>);
        System.out.println(<span class="hljs-string">&quot;add 5:&quot;</span>);
        fifo.add(<span class="hljs-number">5</span>);
    &#125;
&#125;</code></pre>

<h5 id="ç»“æœåˆ†æ"><a href="#ç»“æœåˆ†æ" class="headerlink" title="ç»“æœåˆ†æ"></a>ç»“æœåˆ†æ</h5><pre><code class="hljs"><span class="hljs-attribute">add</span> <span class="hljs-number">1</span>â€<span class="hljs-number">3</span>:
[1]
[2, 1]
[3, 2, 1]
<span class="hljs-attribute">add</span> <span class="hljs-number">4</span>:
[4, 3, 2]
<span class="hljs-attribute">read</span> <span class="hljs-number">2</span>:
<span class="hljs-attribute">find</span> it!
[4, 3, 2]
<span class="hljs-attribute">read</span> <span class="hljs-number">100</span>:
<span class="hljs-attribute">not</span> found!
[4, 3, 2]
<span class="hljs-attribute">add</span> <span class="hljs-number">5</span>:
[5, 4, 3]</code></pre>

<ul>
<li><p>1-3æŒ‰é¡ºåºæ”¾å…¥ï¼Œæ²¡æœ‰é—®é¢˜ </p>
</li>
<li><p>4æ”¾å…¥ï¼Œé‚£ä¹ˆ1æœ€æ—©æ”¾å…¥ï¼Œè¢«æŒ¤æ‰ </p>
</li>
<li><p>è¯»å–2ï¼Œè¯»åˆ°ï¼Œä½†æ˜¯ä¸ä¼šå½±å“é˜Ÿåˆ—é¡ºåºï¼ˆ2ä¾ç„¶æ˜¯æ—¶é—´æœ€è€çš„ï¼‰ </p>
</li>
<li><p>è¯»å–100ï¼Œè¯»ä¸åˆ°ï¼Œä¹Ÿä¸ä¼šäº§ç”Ÿä»»ä½•å½±å“ </p>
</li>
<li><p>5åŠ å…¥ï¼Œè¸¢æ‰äº†2ï¼Œè€Œä¸ç®¡2ä¹‹å‰æœ‰æ²¡æœ‰è¢«ä½¿ç”¨ï¼ˆä¸å¤Ÿç†æ€§ï¼‰ </p>
</li>
</ul>
<h5 id="ä¼˜ç¼ºç‚¹"><a href="#ä¼˜ç¼ºç‚¹" class="headerlink" title="ä¼˜ç¼ºç‚¹"></a>ä¼˜ç¼ºç‚¹</h5><ul>
<li>å®ç°éå¸¸ç®€å•</li>
<li>ä¸ç®¡å…ƒç´ çš„ä½¿ç”¨æƒ…å†µï¼Œå“ªæ€•æœ‰äº›æ•°æ®ä¼šè¢«é¢‘ç¹ç”¨åˆ°ï¼Œæ—¶é—´æœ€ä¹…ä¹Ÿä¼šè¢«è¸¢æ‰</li>
</ul>
<h4 id="æœ€ä¹…æœªç”¨æ·˜æ±°ï¼ˆLRUï¼‰"><a href="#æœ€ä¹…æœªç”¨æ·˜æ±°ï¼ˆLRUï¼‰" class="headerlink" title="æœ€ä¹…æœªç”¨æ·˜æ±°ï¼ˆLRUï¼‰"></a>æœ€ä¹…æœªç”¨æ·˜æ±°ï¼ˆ<strong>LRU</strong>ï¼‰</h4><h5 id="æ¦‚è¿°-1"><a href="#æ¦‚è¿°-1" class="headerlink" title="æ¦‚è¿°"></a>æ¦‚è¿°</h5><p>LRUå…¨ç§°æ˜¯Least Recently Usedï¼Œå³æ·˜æ±°æœ€åä¸€æ¬¡ä½¿ç”¨æ—¶é—´æœ€ä¹…è¿œçš„æ•°å€¼ã€‚FIFOéå¸¸çš„ç²—æš´ï¼Œä¸ç®¡æœ‰æ²¡æœ‰ç”¨åˆ°ï¼Œç›´æ¥è¸¢æ‰æ—¶é—´ä¹…çš„å…ƒç´ ã€‚è€ŒLRUè®¤ä¸ºï¼Œæœ€è¿‘é¢‘ç¹ä½¿ç”¨è¿‡çš„æ•°æ®ï¼Œå°†æ¥ä¹Ÿå¾ˆå¤§ç¨‹åº¦ä¸Šä¼šè¢«é¢‘ç¹ç”¨åˆ°ï¼Œæ•…è€Œæ·˜æ±°é‚£äº›æ‡’æƒ°çš„æ•°æ®ã€‚LinkedHashMapï¼Œæ•°ç»„ï¼Œé“¾è¡¨å‡å¯å®ç°LRUï¼Œä¸‹é¢ä»ç„¶ä»¥é“¾è¡¨ä¸ºä¾‹ï¼šæ–°åŠ å…¥çš„æ•°æ®æ”¾åœ¨å¤´éƒ¨ï¼Œæœ€è¿‘è®¿é—®çš„ï¼Œä¹Ÿç§»åˆ°å¤´éƒ¨ï¼Œç©ºé—´æ»¡æ—¶ï¼Œå°†å°¾éƒ¨å…ƒç´ åˆ é™¤ã€‚ </p>
<h5 id="å®ç°-1"><a href="#å®ç°-1" class="headerlink" title="å®ç°"></a>å®ç°</h5><pre><code class="hljs java"><span class="hljs-keyword">package</span> com.itheima.release;

<span class="hljs-keyword">import</span> java.util.Iterator;
<span class="hljs-keyword">import</span> java.util.LinkedList;

<span class="hljs-keyword">public</span> <span class="hljs-class"><span class="hljs-keyword">class</span> <span class="hljs-title">LRU</span> </span>&#123;
    LinkedList&lt;Integer&gt; lru = <span class="hljs-keyword">new</span> LinkedList&lt;Integer&gt;();
    <span class="hljs-keyword">int</span> size = <span class="hljs-number">3</span>;

    <span class="hljs-comment">//æ·»åŠ å…ƒç´  </span>
    <span class="hljs-function"><span class="hljs-keyword">public</span> <span class="hljs-keyword">void</span> <span class="hljs-title">add</span><span class="hljs-params">(<span class="hljs-keyword">int</span> i)</span> </span>&#123;
        lru.addFirst(i);
        <span class="hljs-keyword">if</span> (lru.size() &gt; size) &#123;
            lru.removeLast();
        &#125;
        print();
    &#125;

    <span class="hljs-comment">//ç¼“å­˜å‘½ä¸­ </span>
    <span class="hljs-function"><span class="hljs-keyword">public</span> <span class="hljs-keyword">void</span> <span class="hljs-title">read</span><span class="hljs-params">(<span class="hljs-keyword">int</span> i)</span> </span>&#123;
        Iterator&lt;Integer&gt; iterator = lru.iterator();
        <span class="hljs-keyword">int</span> index = <span class="hljs-number">0</span>;
        <span class="hljs-keyword">while</span> (iterator.hasNext()) &#123;
            <span class="hljs-keyword">int</span> j = iterator.next();
            <span class="hljs-keyword">if</span> (i == j) &#123;
                System.out.println(<span class="hljs-string">&quot;find it!&quot;</span>);
                lru.remove(index);
                lru.addFirst(j);
                print();
                <span class="hljs-keyword">return</span>;
            &#125;
            index++;
        &#125;
        System.out.println(<span class="hljs-string">&quot;not found!&quot;</span>);
        print();
    &#125;

    <span class="hljs-comment">//æ‰“å°ç¼“å­˜ </span>
    <span class="hljs-function"><span class="hljs-keyword">public</span> <span class="hljs-keyword">void</span> <span class="hljs-title">print</span><span class="hljs-params">()</span> </span>&#123;
        System.out.println(<span class="hljs-keyword">this</span>.lru);
    &#125;

    <span class="hljs-comment">//æµ‹è¯• </span>
    <span class="hljs-function"><span class="hljs-keyword">public</span> <span class="hljs-keyword">static</span> <span class="hljs-keyword">void</span> <span class="hljs-title">main</span><span class="hljs-params">(String[] args)</span> </span>&#123;
        LRU lru = <span class="hljs-keyword">new</span> LRU();
        System.out.println(<span class="hljs-string">&quot;add 1â€3:&quot;</span>);
        lru.add(<span class="hljs-number">1</span>);
        lru.add(<span class="hljs-number">2</span>);
        lru.add(<span class="hljs-number">3</span>);
        System.out.println(<span class="hljs-string">&quot;add 4:&quot;</span>);
        lru.add(<span class="hljs-number">4</span>);
        System.out.println(<span class="hljs-string">&quot;read 2:&quot;</span>);
        lru.read(<span class="hljs-number">2</span>);
        System.out.println(<span class="hljs-string">&quot;read 100:&quot;</span>);
        lru.read(<span class="hljs-number">100</span>);
        System.out.println(<span class="hljs-string">&quot;add 5:&quot;</span>);
        lru.add(<span class="hljs-number">5</span>);
    &#125;
&#125;</code></pre>

<h5 id="ç»“æœåˆ†æ-1"><a href="#ç»“æœåˆ†æ-1" class="headerlink" title="ç»“æœåˆ†æ"></a>ç»“æœåˆ†æ</h5><pre><code class="hljs"><span class="hljs-attribute">add</span> <span class="hljs-number">1</span>â€<span class="hljs-number">3</span>:
[1]
[2, 1]
[3, 2, 1]
<span class="hljs-attribute">add</span> <span class="hljs-number">4</span>:
[4, 3, 2]
<span class="hljs-attribute">read</span> <span class="hljs-number">2</span>:
<span class="hljs-attribute">find</span> it!
[2, 4, 3]
<span class="hljs-attribute">read</span> <span class="hljs-number">100</span>:
<span class="hljs-attribute">not</span> found!
[2, 4, 3]
<span class="hljs-attribute">add</span> <span class="hljs-number">5</span>:
[5, 2, 4]</code></pre>

<ul>
<li><p>1-3åŠ å…¥ï¼Œæ²¡æœ‰é—®é¢˜ </p>
</li>
<li><p>4åŠ å…¥ï¼Œè¸¢æ‰1ï¼Œæ²¡é—®é¢˜ </p>
</li>
<li><p>è¯»å–2ï¼Œè¯»åˆ°ï¼Œæ³¨æ„ï¼Œ2è¢«ç§»åˆ°äº†é˜Ÿé¦–ï¼ </p>
</li>
<li><p>è¯»å–100ï¼Œè¯»ä¸åˆ°ï¼Œæ²¡å½±å“ </p>
</li>
<li><p>5åŠ å…¥ï¼Œå› ä¸º2ä¹‹å‰è¢«ç”¨åˆ°ï¼Œä¸ä¼šè¢«å‰”é™¤ï¼Œ3å’Œ4éƒ½æ²¡äººç”¨ï¼Œä½†æ˜¯3æ›´ä¹…ï¼Œè¢«å‰”é™¤</p>
</li>
</ul>
<h4 id="æœ€è¿‘æœ€å°‘ä½¿ç”¨ï¼ˆLFUï¼‰"><a href="#æœ€è¿‘æœ€å°‘ä½¿ç”¨ï¼ˆLFUï¼‰" class="headerlink" title="æœ€è¿‘æœ€å°‘ä½¿ç”¨ï¼ˆLFUï¼‰"></a>æœ€è¿‘æœ€å°‘ä½¿ç”¨ï¼ˆ<strong>LFU</strong>ï¼‰</h4><h5 id="æ¦‚è¿°-2"><a href="#æ¦‚è¿°-2" class="headerlink" title="æ¦‚è¿°"></a>æ¦‚è¿°</h5><p>Least Frequently Usedï¼Œå³æœ€è¿‘æœ€å°‘ä½¿ç”¨ã€‚å®ƒè¦æ·˜æ±°çš„æ˜¯æœ€è¿‘ä¸€æ®µæ—¶é—´å†…ï¼Œä½¿ç”¨æ¬¡æ•°æœ€å°‘çš„å€¼ã€‚å¯ä»¥è®¤ä¸ºæ¯”LRUå¤šäº†ä¸€é‡åˆ¤æ–­ã€‚LFUéœ€è¦æ—¶é—´å’Œæ¬¡æ•°ä¸¤ä¸ªç»´åº¦çš„å‚è€ƒæŒ‡æ ‡ã€‚éœ€è¦æ³¨æ„çš„æ˜¯ï¼Œä¸¤ä¸ªç»´åº¦å°±å¯èƒ½æ¶‰åŠåˆ°åŒä¸€æ—¶é—´æ®µå†…ï¼Œè®¿é—®æ¬¡æ•°ç›¸åŒçš„æƒ…å†µï¼Œå°±å¿…é¡»å†…ç½®ä¸€ä¸ªè®¡æ•°å™¨å’Œä¸€ä¸ªé˜Ÿåˆ—ï¼Œè®¡æ•°å™¨ç®—æ•°ï¼Œé˜Ÿåˆ—æ”¾ç½®ç›¸åŒè®¡æ•°æ—¶çš„è®¿é—®æ—¶é—´ã€‚ </p>
<h5 id="å®ç°-2"><a href="#å®ç°-2" class="headerlink" title="å®ç°"></a>å®ç°</h5><pre><code class="hljs java"><span class="hljs-keyword">package</span> com.itheima.release;

<span class="hljs-keyword">public</span> <span class="hljs-class"><span class="hljs-keyword">class</span> <span class="hljs-title">Dto</span> <span class="hljs-keyword">implements</span> <span class="hljs-title">Comparable</span>&lt;<span class="hljs-title">Dto</span>&gt; </span>&#123;
    <span class="hljs-keyword">private</span> Integer key;
    <span class="hljs-keyword">private</span> <span class="hljs-keyword">int</span> count;
    <span class="hljs-keyword">private</span> <span class="hljs-keyword">long</span> lastTime;

    <span class="hljs-function"><span class="hljs-keyword">public</span> <span class="hljs-title">Dto</span><span class="hljs-params">(Integer key, <span class="hljs-keyword">int</span> count, <span class="hljs-keyword">long</span> lastTime)</span> </span>&#123;
        <span class="hljs-keyword">this</span>.key = key;
        <span class="hljs-keyword">this</span>.count = count;
        <span class="hljs-keyword">this</span>.lastTime = lastTime;
    &#125;

    <span class="hljs-meta">@Override</span>
    <span class="hljs-function"><span class="hljs-keyword">public</span> <span class="hljs-keyword">int</span> <span class="hljs-title">compareTo</span><span class="hljs-params">(Dto o)</span> </span>&#123;
        <span class="hljs-keyword">int</span> compare = Integer.compare(<span class="hljs-keyword">this</span>.count, o.count);
        <span class="hljs-keyword">return</span> compare == <span class="hljs-number">0</span> ? Long.compare(<span class="hljs-keyword">this</span>.lastTime, o.lastTime) : compare;
    &#125;

    <span class="hljs-meta">@Override</span>
    <span class="hljs-function"><span class="hljs-keyword">public</span> String <span class="hljs-title">toString</span><span class="hljs-params">()</span> </span>&#123;
        <span class="hljs-keyword">return</span> String.format(<span class="hljs-string">&quot;[key=%s,count=%s,lastTime=%s]&quot;</span>, key, count, lastTime);
    &#125;

    <span class="hljs-function"><span class="hljs-keyword">public</span> Integer <span class="hljs-title">getKey</span><span class="hljs-params">()</span> </span>&#123;
        <span class="hljs-keyword">return</span> key;
    &#125;

    <span class="hljs-function"><span class="hljs-keyword">public</span> <span class="hljs-keyword">void</span> <span class="hljs-title">setKey</span><span class="hljs-params">(Integer key)</span> </span>&#123;
        <span class="hljs-keyword">this</span>.key = key;
    &#125;

    <span class="hljs-function"><span class="hljs-keyword">public</span> <span class="hljs-keyword">int</span> <span class="hljs-title">getCount</span><span class="hljs-params">()</span> </span>&#123;
        <span class="hljs-keyword">return</span> count;
    &#125;

    <span class="hljs-function"><span class="hljs-keyword">public</span> <span class="hljs-keyword">void</span> <span class="hljs-title">setCount</span><span class="hljs-params">(<span class="hljs-keyword">int</span> count)</span> </span>&#123;
        <span class="hljs-keyword">this</span>.count = count;
    &#125;

    <span class="hljs-function"><span class="hljs-keyword">public</span> <span class="hljs-keyword">long</span> <span class="hljs-title">getLastTime</span><span class="hljs-params">()</span> </span>&#123;
        <span class="hljs-keyword">return</span> lastTime;
    &#125;

    <span class="hljs-function"><span class="hljs-keyword">public</span> <span class="hljs-keyword">void</span> <span class="hljs-title">setLastTime</span><span class="hljs-params">(<span class="hljs-keyword">long</span> lastTime)</span> </span>&#123;
        <span class="hljs-keyword">this</span>.lastTime = lastTime;
    &#125;
&#125;</code></pre>

<pre><code class="hljs java"><span class="hljs-keyword">package</span> com.itheima.release;

<span class="hljs-keyword">import</span> java.util.Collections;
<span class="hljs-keyword">import</span> java.util.HashMap;
<span class="hljs-keyword">import</span> java.util.Map;

<span class="hljs-keyword">public</span> <span class="hljs-class"><span class="hljs-keyword">class</span> <span class="hljs-title">LFU</span> </span>&#123;
    <span class="hljs-keyword">private</span> <span class="hljs-keyword">final</span> <span class="hljs-keyword">int</span> size = <span class="hljs-number">3</span>;
    <span class="hljs-keyword">private</span> Map&lt;Integer, Integer&gt; cache = <span class="hljs-keyword">new</span> HashMap&lt;&gt;();
    <span class="hljs-keyword">private</span> Map&lt;Integer, Dto&gt; count = <span class="hljs-keyword">new</span> HashMap&lt;&gt;();

    <span class="hljs-comment">//æŠ•æ”¾</span>
    <span class="hljs-function"><span class="hljs-keyword">public</span> <span class="hljs-keyword">void</span> <span class="hljs-title">put</span><span class="hljs-params">(Integer key, Integer value)</span> </span>&#123;
        Integer v = cache.get(key);
        <span class="hljs-keyword">if</span> (v == <span class="hljs-keyword">null</span>) &#123;
            <span class="hljs-keyword">if</span> (cache.size() == size) &#123;
                removeElement();
            &#125;
            count.put(key, <span class="hljs-keyword">new</span> Dto(key, <span class="hljs-number">1</span>, System.currentTimeMillis()));
        &#125; <span class="hljs-keyword">else</span> &#123;
            addCount(key);
        &#125;
        cache.put(key, value);
    &#125;

    <span class="hljs-comment">//è¯»å–</span>
    <span class="hljs-function"><span class="hljs-keyword">public</span> Integer <span class="hljs-title">get</span><span class="hljs-params">(Integer key)</span> </span>&#123;
        Integer value = cache.get(key);
        <span class="hljs-keyword">if</span> (value != <span class="hljs-keyword">null</span>) &#123;
            addCount(key);
            <span class="hljs-keyword">return</span> value;
        &#125;
        <span class="hljs-keyword">return</span> <span class="hljs-keyword">null</span>;
    &#125;

    <span class="hljs-comment">//æ·˜æ±°å…ƒç´ </span>
    <span class="hljs-function"><span class="hljs-keyword">private</span> <span class="hljs-keyword">void</span> <span class="hljs-title">removeElement</span><span class="hljs-params">()</span> </span>&#123;
        Dto dto = Collections.min(count.values());
        cache.remove(dto.getKey());
        count.remove(dto.getKey());
    &#125;

    <span class="hljs-comment">//æ›´æ–°è®¡æ•°å™¨</span>
    <span class="hljs-function"><span class="hljs-keyword">private</span> <span class="hljs-keyword">void</span> <span class="hljs-title">addCount</span><span class="hljs-params">(Integer key)</span> </span>&#123;
        Dto Dto = count.get(key);
        Dto.setCount(Dto.getCount() + <span class="hljs-number">1</span>);
        Dto.setLastTime(System.currentTimeMillis());
    &#125;

    <span class="hljs-comment">//æ‰“å°ç¼“å­˜ç»“æ„å’Œè®¡æ•°å™¨ç»“æ„</span>
    <span class="hljs-function"><span class="hljs-keyword">private</span> <span class="hljs-keyword">void</span> <span class="hljs-title">print</span><span class="hljs-params">()</span> </span>&#123;
        System.out.println(<span class="hljs-string">&quot;cache=&quot;</span> + cache);
        System.out.println(<span class="hljs-string">&quot;count=&quot;</span> + count);
    &#125;

    <span class="hljs-function"><span class="hljs-keyword">public</span> <span class="hljs-keyword">static</span> <span class="hljs-keyword">void</span> <span class="hljs-title">main</span><span class="hljs-params">(String[] args)</span> </span>&#123;
        LFU lfu = <span class="hljs-keyword">new</span> LFU();
        <span class="hljs-comment">//å‰3ä¸ªå®¹é‡æ²¡æ»¡ï¼Œ1,2,3å‡åŠ å…¥ </span>
        System.out.println(<span class="hljs-string">&quot;add 1â€3:&quot;</span>);
        lfu.put(<span class="hljs-number">1</span>, <span class="hljs-number">1</span>);
        lfu.put(<span class="hljs-number">2</span>, <span class="hljs-number">2</span>);
        lfu.put(<span class="hljs-number">3</span>, <span class="hljs-number">3</span>);
        lfu.print();
        <span class="hljs-comment">//1,2æœ‰è®¿é—®ï¼Œ3æ²¡æœ‰ï¼ŒåŠ å…¥4ï¼Œæ·˜æ±°3 </span>
        System.out.println(<span class="hljs-string">&quot;read 1,2&quot;</span>);
        lfu.get(<span class="hljs-number">1</span>);
        lfu.get(<span class="hljs-number">2</span>);
        lfu.print();
        System.out.println(<span class="hljs-string">&quot;add 4:&quot;</span>);
        lfu.put(<span class="hljs-number">4</span>, <span class="hljs-number">4</span>);
        lfu.print();
        <span class="hljs-comment">//2=3æ¬¡ï¼Œ1,4=2æ¬¡ï¼Œä½†æ˜¯4åŠ å…¥è¾ƒæ™šï¼Œå†åŠ å…¥5æ—¶æ·˜æ±°1 </span>
        System.out.println(<span class="hljs-string">&quot;read 2,4&quot;</span>);
        lfu.get(<span class="hljs-number">2</span>);
        lfu.get(<span class="hljs-number">4</span>);
        lfu.print();
        System.out.println(<span class="hljs-string">&quot;add 5:&quot;</span>);
        lfu.put(<span class="hljs-number">5</span>, <span class="hljs-number">5</span>);
        lfu.print();
    &#125;
&#125;</code></pre>

<h5 id="ç»“æœåˆ†æ-2"><a href="#ç»“æœåˆ†æ-2" class="headerlink" title="ç»“æœåˆ†æ"></a>ç»“æœåˆ†æ</h5><pre><code class="hljs apache"><span class="hljs-attribute">add</span> <span class="hljs-number">1</span>â€<span class="hljs-number">3</span>:
<span class="hljs-attribute">cache</span>=&#123;<span class="hljs-number">1</span>=<span class="hljs-number">1</span>, <span class="hljs-number">2</span>=<span class="hljs-number">2</span>, <span class="hljs-number">3</span>=<span class="hljs-number">3</span>&#125;
<span class="hljs-attribute">count</span>=&#123;<span class="hljs-number">1</span>=[key=<span class="hljs-number">1</span>,count=<span class="hljs-number">1</span>,lastTime=<span class="hljs-number">1598000803514</span>], <span class="hljs-number">2</span>=[key=<span class="hljs-number">2</span>,count=<span class="hljs-number">1</span>,lastTime=<span class="hljs-number">1598000803514</span>], <span class="hljs-number">3</span>=[key=<span class="hljs-number">3</span>,count=<span class="hljs-number">1</span>,lastTime=<span class="hljs-number">1598000803514</span>]&#125;
<span class="hljs-attribute">read</span> <span class="hljs-number">1</span>,<span class="hljs-number">2</span>
<span class="hljs-attribute">cache</span>=&#123;<span class="hljs-number">1</span>=<span class="hljs-number">1</span>, <span class="hljs-number">2</span>=<span class="hljs-number">2</span>, <span class="hljs-number">3</span>=<span class="hljs-number">3</span>&#125;
<span class="hljs-attribute">count</span>=&#123;<span class="hljs-number">1</span>=[key=<span class="hljs-number">1</span>,count=<span class="hljs-number">2</span>,lastTime=<span class="hljs-number">1598000803535</span>], <span class="hljs-number">2</span>=[key=<span class="hljs-number">2</span>,count=<span class="hljs-number">2</span>,lastTime=<span class="hljs-number">1598000803535</span>], <span class="hljs-number">3</span>=[key=<span class="hljs-number">3</span>,count=<span class="hljs-number">1</span>,lastTime=<span class="hljs-number">1598000803514</span>]&#125;
<span class="hljs-attribute">add</span> <span class="hljs-number">4</span>:
<span class="hljs-attribute">cache</span>=&#123;<span class="hljs-number">1</span>=<span class="hljs-number">1</span>, <span class="hljs-number">2</span>=<span class="hljs-number">2</span>, <span class="hljs-number">4</span>=<span class="hljs-number">4</span>&#125;
<span class="hljs-attribute">count</span>=&#123;<span class="hljs-number">1</span>=[key=<span class="hljs-number">1</span>,count=<span class="hljs-number">2</span>,lastTime=<span class="hljs-number">1598000803535</span>], <span class="hljs-number">2</span>=[key=<span class="hljs-number">2</span>,count=<span class="hljs-number">2</span>,lastTime=<span class="hljs-number">1598000803535</span>], <span class="hljs-number">4</span>=[key=<span class="hljs-number">4</span>,count=<span class="hljs-number">1</span>,lastTime=<span class="hljs-number">1598000803535</span>]&#125;
<span class="hljs-attribute">read</span> <span class="hljs-number">2</span>,<span class="hljs-number">4</span>
<span class="hljs-attribute">cache</span>=&#123;<span class="hljs-number">1</span>=<span class="hljs-number">1</span>, <span class="hljs-number">2</span>=<span class="hljs-number">2</span>, <span class="hljs-number">4</span>=<span class="hljs-number">4</span>&#125;
<span class="hljs-attribute">count</span>=&#123;<span class="hljs-number">1</span>=[key=<span class="hljs-number">1</span>,count=<span class="hljs-number">2</span>,lastTime=<span class="hljs-number">1598000803535</span>], <span class="hljs-number">2</span>=[key=<span class="hljs-number">2</span>,count=<span class="hljs-number">3</span>,lastTime=<span class="hljs-number">1598000803536</span>], <span class="hljs-number">4</span>=[key=<span class="hljs-number">4</span>,count=<span class="hljs-number">2</span>,lastTime=<span class="hljs-number">1598000803536</span>]&#125;
<span class="hljs-attribute">add</span> <span class="hljs-number">5</span>:
<span class="hljs-attribute">cache</span>=&#123;<span class="hljs-number">2</span>=<span class="hljs-number">2</span>, <span class="hljs-number">4</span>=<span class="hljs-number">4</span>, <span class="hljs-number">5</span>=<span class="hljs-number">5</span>&#125;
<span class="hljs-attribute">count</span>=&#123;<span class="hljs-number">2</span>=[key=<span class="hljs-number">2</span>,count=<span class="hljs-number">3</span>,lastTime=<span class="hljs-number">1598000803536</span>], <span class="hljs-number">4</span>=[key=<span class="hljs-number">4</span>,count=<span class="hljs-number">2</span>,lastTime=<span class="hljs-number">1598000803536</span>], <span class="hljs-number">5</span>=[key=<span class="hljs-number">5</span>,count=<span class="hljs-number">1</span>,lastTime=<span class="hljs-number">1598000803536</span>]&#125;</code></pre>

<ul>
<li><p>1-3åŠ å…¥ï¼Œæ²¡é—®é¢˜ï¼Œè®¡æ•°å™¨ä¸º1æ¬¡ </p>
</li>
<li><p>è®¿é—®1ï¼Œ2ï¼Œä½¿ç”¨æ¬¡æ•°è®¡æ•°å™¨ä¸Šå‡ä¸º2æ¬¡ï¼Œ3æ²¡æœ‰è®¿é—®ï¼Œä»ç„¶ä¸º1 </p>
</li>
<li><p>4åŠ å…¥ï¼Œ3çš„è®¿é—®æ¬¡æ•°æœ€å°‘ï¼ˆ1æ¬¡ï¼‰ï¼Œæ‰€ä»¥è¸¢æ‰3ï¼Œå‰©ä¸‹124</p>
</li>
<li><p>è®¿é—®2ï¼Œ4ï¼Œè®¡æ•°å™¨ä¸Šå‡ï¼Œ2=3æ¬¡ï¼Œ1ï¼Œ4=2æ¬¡ï¼Œä½†æ˜¯1æ—¶é—´ä¹… </p>
</li>
<li><p>5åŠ å…¥ï¼Œè¸¢æ‰1ï¼Œæœ€åå‰©ä¸‹2ï¼Œ4ï¼Œ5 </p>
</li>
</ul>
<h5 id="åº”ç”¨æ¡ˆä¾‹"><a href="#åº”ç”¨æ¡ˆä¾‹" class="headerlink" title="åº”ç”¨æ¡ˆä¾‹"></a>åº”ç”¨æ¡ˆä¾‹</h5><p>rediså±äºç¼“å­˜å¤±æ•ˆçš„å…¸å‹åº”ç”¨åœºæ™¯ï¼Œå¸¸è§ç­–ç•¥å¦‚ä¸‹ï¼š </p>
<ul>
<li><p>noeviction: ä¸åˆ é™¤ç­–ç•¥, è¾¾åˆ°æœ€å¤§å†…å­˜é™åˆ¶æ—¶, å¦‚æœéœ€è¦æ›´å¤šå†…å­˜, ç›´æ¥è¿”å›é”™è¯¯ä¿¡æ¯ï¼ˆ æ¯”è¾ƒå±é™©ï¼‰ã€‚ </p>
</li>
<li><p>allkeys-lruï¼šå¯¹æ‰€æœ‰keyï¼Œä¼˜å…ˆåˆ é™¤æœ€è¿‘æœ€å°‘ä½¿ç”¨çš„ key (LRU)ã€‚ </p>
</li>
<li><p>allkeys-randomï¼š å¯¹æ‰€æœ‰keyï¼Œ éšæœºåˆ é™¤ä¸€éƒ¨åˆ†ï¼ˆå¬èµ·æ¥æ¯«æ— é“ç†ï¼‰ã€‚ </p>
</li>
<li><p>volatile-lruï¼šåªé™äºè®¾ç½®äº† expire çš„keyï¼Œä¼˜å…ˆåˆ é™¤æœ€è¿‘æœ€å°‘ä½¿ç”¨çš„key (LRU)ã€‚ </p>
</li>
<li><p>volatile-randomï¼šåªé™äºè®¾ç½®äº† expire çš„keyï¼Œéšæœºåˆ é™¤ä¸€éƒ¨åˆ†ã€‚ </p>
</li>
<li><p>volatile-ttlï¼šåªé™äºè®¾ç½®äº† expire çš„keyï¼Œä¼˜å…ˆåˆ é™¤å‰©ä½™æ—¶é—´(TTL) çŸ­çš„keyã€‚</p>
</li>
</ul>
<h3 id="é™æµç®—æ³•ä¸åº”ç”¨"><a href="#é™æµç®—æ³•ä¸åº”ç”¨" class="headerlink" title="é™æµç®—æ³•ä¸åº”ç”¨"></a>é™æµç®—æ³•ä¸åº”ç”¨</h3><p>é™æµæ˜¯å¯¹ç³»ç»Ÿçš„ä¸€ç§ä¿æŠ¤æªæ–½ã€‚å³é™åˆ¶æµé‡è¯·æ±‚çš„é¢‘ç‡ï¼ˆæ¯ç§’å¤„ç†å¤šå°‘ä¸ªè¯·æ±‚ï¼‰ã€‚ä¸€èˆ¬æ¥è¯´ï¼Œå½“è¯·æ±‚æµé‡è¶…è¿‡ç³»ç»Ÿçš„ç“¶é¢ˆï¼Œåˆ™ä¸¢å¼ƒæ‰å¤šä½™çš„è¯·æ±‚æµé‡ï¼Œä¿è¯ç³»ç»Ÿçš„å¯ç”¨æ€§ã€‚å³è¦ä¹ˆä¸æ”¾è¿›æ¥ï¼Œæ”¾è¿›æ¥çš„å°±ä¿è¯æä¾›æœåŠ¡ã€‚</p>
<h4 id="è®¡æ•°å™¨"><a href="#è®¡æ•°å™¨" class="headerlink" title="è®¡æ•°å™¨"></a>è®¡æ•°å™¨</h4><h5 id="æ¦‚è¿°-3"><a href="#æ¦‚è¿°-3" class="headerlink" title="æ¦‚è¿°"></a>æ¦‚è¿°</h5><p>è®¡æ•°å™¨é‡‡ç”¨ç®€å•çš„è®¡æ•°æ“ä½œï¼Œåˆ°ä¸€æ®µæ—¶é—´èŠ‚ç‚¹åè‡ªåŠ¨æ¸…é›¶ </p>
<h5 id="å®ç°-3"><a href="#å®ç°-3" class="headerlink" title="å®ç°"></a>å®ç°</h5><pre><code class="hljs java"><span class="hljs-keyword">package</span> com.itheima.release;

<span class="hljs-keyword">import</span> java.util.concurrent.*;

<span class="hljs-keyword">public</span> <span class="hljs-class"><span class="hljs-keyword">class</span> <span class="hljs-title">Counter</span> </span>&#123;
    <span class="hljs-function"><span class="hljs-keyword">public</span> <span class="hljs-keyword">static</span> <span class="hljs-keyword">void</span> <span class="hljs-title">main</span><span class="hljs-params">(String[] args)</span> </span>&#123;
        <span class="hljs-comment">//è®¡æ•°å™¨ï¼Œè¿™é‡Œç”¨ä¿¡å·é‡å®ç° </span>
        <span class="hljs-keyword">final</span> Semaphore semaphore = <span class="hljs-keyword">new</span> Semaphore(<span class="hljs-number">3</span>);
        <span class="hljs-comment">//å®šæ—¶å™¨ï¼Œåˆ°ç‚¹æ¸…é›¶ </span>
        ScheduledExecutorService service = Executors.newScheduledThreadPool(<span class="hljs-number">1</span>);
        service.scheduleAtFixedRate(<span class="hljs-keyword">new</span> Runnable() &#123;
            <span class="hljs-meta">@Override</span>
            <span class="hljs-function"><span class="hljs-keyword">public</span> <span class="hljs-keyword">void</span> <span class="hljs-title">run</span><span class="hljs-params">()</span> </span>&#123;
                semaphore.release(<span class="hljs-number">3</span>);
            &#125;
        &#125;, <span class="hljs-number">3000</span>, <span class="hljs-number">3000</span>, TimeUnit.MILLISECONDS);
        <span class="hljs-comment">//æ¨¡æ‹Ÿæ— æ•°ä¸ªè¯·æ±‚ä»å¤©è€Œé™ </span>
        <span class="hljs-keyword">while</span> (<span class="hljs-keyword">true</span>) &#123;
            <span class="hljs-keyword">try</span> &#123;
                <span class="hljs-comment">//åˆ¤æ–­è®¡æ•°å™¨</span>
                semaphore.acquire();
            &#125; <span class="hljs-keyword">catch</span> (InterruptedException e) &#123;
                e.printStackTrace();
            &#125;
            <span class="hljs-comment">//å¦‚æœå‡†è®¸å“åº”ï¼Œæ‰“å°ä¸€ä¸ªok </span>
            System.out.println(<span class="hljs-string">&quot;ok&quot;</span>);
        &#125;
    &#125;
&#125;</code></pre>

<h5 id="ç»“æœåˆ†æ-3"><a href="#ç»“æœåˆ†æ-3" class="headerlink" title="ç»“æœåˆ†æ"></a>ç»“æœåˆ†æ</h5><p>3ä¸ªokä¸€ç»„å‘ˆç°ï¼Œåˆ°ä¸‹ä¸€ä¸ªè®¡æ•°å‘¨æœŸä¹‹å‰è¢«é˜»æ–­ </p>
<h5 id="ä¼˜ç¼ºç‚¹-1"><a href="#ä¼˜ç¼ºç‚¹-1" class="headerlink" title="ä¼˜ç¼ºç‚¹"></a>ä¼˜ç¼ºç‚¹</h5><p>å®ç°èµ·æ¥éå¸¸ç®€å•ã€‚ </p>
<p>æ§åˆ¶åŠ›åº¦å¤ªè¿‡äºç®€ç•¥ï¼Œå‡å¦‚1så†…é™åˆ¶3æ¬¡ï¼Œé‚£ä¹ˆå¦‚æœ3æ¬¡åœ¨å‰100mså†…å·²ç»ç”¨å®Œï¼Œåé¢çš„900mså°†åªèƒ½å¤„äºé˜»å¡çŠ¶æ€ï¼Œç™½ç™½æµªè´¹æ‰ã€‚ </p>
<h5 id="åº”ç”¨"><a href="#åº”ç”¨" class="headerlink" title="åº”ç”¨"></a>åº”ç”¨</h5><p>ä½¿ç”¨è®¡æ•°å™¨é™æµçš„åœºæ™¯è¾ƒå°‘ï¼Œå› ä¸ºå®ƒçš„å¤„ç†é€»è¾‘ä¸å¤Ÿçµæ´»ã€‚æœ€å¸¸è§çš„å¯èƒ½åœ¨webçš„ç™»å½•å¯†ç éªŒè¯ï¼Œè¾“å…¥é”™è¯¯æ¬¡æ•°å†»ç»“ä¸€æ®µæ—¶é—´çš„åœºæ™¯ã€‚å¦‚æœç½‘ç«™è¯·æ±‚ä½¿ç”¨è®¡æ•°å™¨ï¼Œé‚£ä¹ˆæ¶æ„æ”»å‡»è€…å‰100msåƒæ‰æµé‡è®¡æ•°ï¼Œä½¿å¾—åç»­æ­£å¸¸çš„è¯·æ±‚è¢«å…¨éƒ¨é˜»æ–­ï¼Œæ•´ä¸ªæœåŠ¡å¾ˆå®¹æ˜“è¢«æå®ã€‚ </p>
<h4 id="æ¼æ¡¶ç®—æ³•"><a href="#æ¼æ¡¶ç®—æ³•" class="headerlink" title="æ¼æ¡¶ç®—æ³•"></a>æ¼æ¡¶ç®—æ³•</h4><h5 id="æ¦‚è¿°-4"><a href="#æ¦‚è¿°-4" class="headerlink" title="æ¦‚è¿°"></a>æ¦‚è¿°</h5><p>æ¼æ¡¶ç®—æ³•å°†è¯·æ±‚ç¼“å­˜åœ¨æ¡¶ä¸­ï¼ŒæœåŠ¡æµç¨‹åŒ€é€Ÿå¤„ç†ã€‚è¶…å‡ºæ¡¶å®¹é‡çš„éƒ¨åˆ†ä¸¢å¼ƒã€‚æ¼æ¡¶ç®—æ³•ä¸»è¦ç”¨äºä¿æŠ¤å†…éƒ¨çš„å¤„ç†ä¸šåŠ¡ï¼Œä¿éšœå…¶ç¨³å®šæœ‰èŠ‚å¥çš„å¤„ç†è¯·æ±‚ï¼Œä½†æ˜¯æ— æ³•æ ¹æ®æµé‡çš„æ³¢åŠ¨å¼¹æ€§è°ƒæ•´å“åº”èƒ½åŠ›ã€‚ç°å®ä¸­ï¼Œç±»ä¼¼å®¹çº³äººæ•°æœ‰é™çš„æœåŠ¡å¤§å…å¼€å¯äº†å›ºå®šçš„æœåŠ¡çª—å£ã€‚</p>
<img src="/blog/2020/08/16/%E6%95%B0%E6%8D%AE%E7%BB%93%E6%9E%84-%E5%B8%B8%E8%A7%81%E7%AE%97%E6%B3%95%E4%B8%8E%E5%BA%94%E7%94%A8/pic1.png" srcset="/blog/img/loading.gif" class>

<h5 id="å®ç°-4"><a href="#å®ç°-4" class="headerlink" title="å®ç°"></a>å®ç°</h5><pre><code class="hljs java"><span class="hljs-keyword">package</span> com.itheima.release;

<span class="hljs-keyword">import</span> java.util.concurrent.*;

<span class="hljs-keyword">public</span> <span class="hljs-class"><span class="hljs-keyword">class</span> <span class="hljs-title">Barrel</span> </span>&#123;
    <span class="hljs-function"><span class="hljs-keyword">public</span> <span class="hljs-keyword">static</span> <span class="hljs-keyword">void</span> <span class="hljs-title">main</span><span class="hljs-params">(String[] args)</span> </span>&#123;
        <span class="hljs-comment">//æ¡¶ï¼Œç”¨é˜»å¡é˜Ÿåˆ—å®ç°ï¼Œå®¹é‡ä¸º3 </span>
        <span class="hljs-keyword">final</span> LinkedBlockingQueue&lt;Integer&gt; que = <span class="hljs-keyword">new</span> LinkedBlockingQueue(<span class="hljs-number">3</span>);
        <span class="hljs-comment">//å®šæ—¶å™¨ï¼Œç›¸å½“äºæœåŠ¡çš„çª—å£ï¼Œ2så¤„ç†ä¸€ä¸ª</span>
        ScheduledExecutorService service = Executors.newScheduledThreadPool(<span class="hljs-number">1</span>);
        service.scheduleAtFixedRate(<span class="hljs-keyword">new</span> Runnable() &#123;
            <span class="hljs-meta">@Override</span>
            <span class="hljs-function"><span class="hljs-keyword">public</span> <span class="hljs-keyword">void</span> <span class="hljs-title">run</span><span class="hljs-params">()</span> </span>&#123;
                <span class="hljs-keyword">int</span> v = que.poll();
                System.out.println(<span class="hljs-string">&quot;å¤„ç†ï¼š&quot;</span> + v);
            &#125;
        &#125;, <span class="hljs-number">2000</span>, <span class="hljs-number">2000</span>, TimeUnit.MILLISECONDS);
        <span class="hljs-comment">//æ— æ•°ä¸ªè¯·æ±‚ï¼Œi å¯ä»¥ç†è§£ä¸ºè¯·æ±‚çš„ç¼–å·</span>
        <span class="hljs-keyword">int</span> i = <span class="hljs-number">0</span>;
        <span class="hljs-keyword">while</span> (<span class="hljs-keyword">true</span>) &#123;
            i++;
            <span class="hljs-keyword">try</span> &#123;
                System.out.println(<span class="hljs-string">&quot;put:&quot;</span> + i);
                <span class="hljs-comment">//å¦‚æœæ˜¯putï¼Œä¼šä¸€ç›´ç­‰å¾…æ¡¶ä¸­æœ‰ç©ºé—²ä½ç½®ï¼Œä¸ä¼šä¸¢å¼ƒ </span>
                <span class="hljs-comment">//que.put(i);</span>
                <span class="hljs-comment">//ç­‰å¾…1så¦‚æœè¿›ä¸äº†æ¡¶ï¼Œå°±æº¢å‡ºä¸¢å¼ƒ </span>
                que.offer(i, <span class="hljs-number">1000</span>, TimeUnit.MILLISECONDS);
            &#125; <span class="hljs-keyword">catch</span> (Exception e) &#123;
                e.printStackTrace();
            &#125;
        &#125;
    &#125;
&#125;</code></pre>

<h5 id="ç»“æœåˆ†æ-4"><a href="#ç»“æœåˆ†æ-4" class="headerlink" title="ç»“æœåˆ†æ"></a>ç»“æœåˆ†æ</h5><pre><code class="hljs vim"><span class="hljs-keyword">pu</span><span class="hljs-variable">t:1</span>
<span class="hljs-keyword">pu</span><span class="hljs-variable">t:2</span>
<span class="hljs-keyword">pu</span><span class="hljs-variable">t:3</span>
<span class="hljs-keyword">pu</span><span class="hljs-variable">t:4</span>
<span class="hljs-keyword">pu</span><span class="hljs-variable">t:5</span>
å¤„ç†ï¼š<span class="hljs-number">1</span>
<span class="hljs-keyword">pu</span><span class="hljs-variable">t:6</span>
<span class="hljs-keyword">pu</span><span class="hljs-variable">t:7</span>
å¤„ç†ï¼š<span class="hljs-number">2</span>
<span class="hljs-keyword">pu</span><span class="hljs-variable">t:8</span></code></pre>

<p>putä»»åŠ¡å·æŒ‰ç…§é¡ºåºå…¥æ¡¶ </p>
<p>æ‰§è¡Œä»»åŠ¡åŒ€é€Ÿçš„1sä¸€ä¸ªè¢«å¤„ç† </p>
<p>å› ä¸ºæ¡¶çš„å®¹é‡åªæœ‰3ï¼Œæ‰€ä»¥1-3å®Œç¾æ‰§è¡Œï¼Œ4è¢«æº¢å‡ºä¸¢å¼ƒï¼Œ5æ­£å¸¸æ‰§è¡Œ </p>
<h5 id="ä¼˜ç¼ºç‚¹-2"><a href="#ä¼˜ç¼ºç‚¹-2" class="headerlink" title="ä¼˜ç¼ºç‚¹"></a>ä¼˜ç¼ºç‚¹</h5><p>æœ‰æ•ˆçš„æŒ¡ä½äº†å¤–éƒ¨çš„è¯·æ±‚ï¼Œä¿æŠ¤äº†å†…éƒ¨çš„æœåŠ¡ä¸ä¼šè¿‡è½½ </p>
<p>å†…éƒ¨æœåŠ¡åŒ€é€Ÿæ‰§è¡Œï¼Œæ— æ³•åº”å¯¹æµé‡æ´ªå³°ï¼Œæ— æ³•åšåˆ°å¼¹æ€§å¤„ç†çªå‘ä»»åŠ¡</p>
<p>ä»»åŠ¡è¶…æ—¶æº¢å‡ºæ—¶è¢«ä¸¢å¼ƒã€‚ç°å®ä¸­å¯èƒ½éœ€è¦ç¼“å­˜é˜Ÿåˆ—è¾…åŠ©ä¿æŒä¸€æ®µæ—¶é—´ </p>
<h5 id="åº”ç”¨-1"><a href="#åº”ç”¨-1" class="headerlink" title="åº”ç”¨"></a>åº”ç”¨</h5><p>nginxä¸­çš„é™æµæ˜¯æ¼æ¡¶ç®—æ³•çš„å…¸å‹åº”ç”¨ï¼Œé…ç½®æ¡ˆä¾‹å¦‚ä¸‹ï¼š </p>
<pre><code class="hljs yaml"><span class="hljs-string">http</span> &#123;
	<span class="hljs-comment">#$binary_remote_addr è¡¨ç¤ºé€šè¿‡remote_addrè¿™ä¸ªæ ‡è¯†æ¥åškeyï¼Œä¹Ÿå°±æ˜¯é™åˆ¶åŒä¸€å®¢æˆ·ç«¯ipåœ°å€ã€‚</span>
  <span class="hljs-comment">#zone=one:10m è¡¨ç¤ºç”Ÿæˆä¸€ä¸ªå¤§å°ä¸º10Mï¼Œåå­—ä¸ºoneçš„å†…å­˜åŒºåŸŸï¼Œç”¨æ¥å­˜å‚¨è®¿é—®çš„é¢‘æ¬¡ä¿¡æ¯ã€‚ </span>
  <span class="hljs-comment">#rate=1r/s è¡¨ç¤ºå…è®¸ç›¸åŒæ ‡è¯†çš„å®¢æˆ·ç«¯æ¯ç§’1æ¬¡è®¿é—®</span>
  <span class="hljs-string">limit_req_zone</span> <span class="hljs-string">$binary_remote_addr</span> <span class="hljs-string">zone=one:10m</span> <span class="hljs-string">rate=1r/s;</span>
  <span class="hljs-string">server</span> &#123; 
  	<span class="hljs-string">location</span> <span class="hljs-string">/limited/</span> &#123; 
  	<span class="hljs-comment">#zone=one ä¸ä¸Šé¢limit_req_zone é‡Œçš„nameå¯¹åº”ã€‚ </span>
  	<span class="hljs-comment">#burst=5 ç¼“å†²åŒºï¼Œè¶…è¿‡äº†è®¿é—®é¢‘æ¬¡é™åˆ¶çš„è¯·æ±‚å¯ä»¥å…ˆæ”¾åˆ°è¿™ä¸ªç¼“å†²åŒºå†…ï¼Œç±»ä¼¼ä»£ç ä¸­çš„é˜Ÿåˆ—é•¿åº¦ã€‚</span>
    <span class="hljs-comment">#nodelay å¦‚æœè®¾ç½®ï¼Œè¶…è¿‡è®¿é—®é¢‘æ¬¡è€Œä¸”ç¼“å†²åŒºä¹Ÿæ»¡äº†çš„æ—¶å€™å°±ä¼šç›´æ¥è¿”å›503ï¼Œå¦‚æœæ²¡æœ‰è®¾ç½®ï¼Œåˆ™æ‰€æœ‰è¯·æ±‚ ä¼šç­‰å¾…æ’é˜Ÿï¼Œç±»ä¼¼ä»£ç ä¸­çš„putè¿˜æ˜¯offerã€‚</span>
    <span class="hljs-string">limit_req</span> <span class="hljs-string">zone=one</span> <span class="hljs-string">burst=5</span> <span class="hljs-string">nodelay;</span>
  &#125; 
&#125;</code></pre>

<h4 id="ä»¤ç‰Œæ¡¶"><a href="#ä»¤ç‰Œæ¡¶" class="headerlink" title="ä»¤ç‰Œæ¡¶"></a>ä»¤ç‰Œæ¡¶</h4><h5 id="æ¦‚è¿°-5"><a href="#æ¦‚è¿°-5" class="headerlink" title="æ¦‚è¿°"></a>æ¦‚è¿°</h5><p>ä»¤ç‰Œæ¡¶ç®—æ³•å¯ä»¥è®¤ä¸ºæ˜¯æ¼æ¡¶ç®—æ³•çš„ä¸€ç§å‡çº§ï¼Œå®ƒä¸ä½†å¯ä»¥å°†æµé‡åšä¸€æ­¥é™åˆ¶ï¼Œè¿˜å¯ä»¥è§£å†³æ¼æ¡¶ä¸­æ— æ³•å¼¹æ€§ä¼¸ç¼©å¤„ç†è¯·æ±‚çš„é—®é¢˜ã€‚ä½“ç°åœ¨ç°å®ä¸­ï¼Œç±»ä¼¼æœåŠ¡å¤§å…çš„é—¨å£è®¾ç½®é—¨ç¦å¡å‘æ”¾ã€‚å‘æ”¾æ˜¯åŒ€é€Ÿçš„ï¼Œè¯·æ±‚è¾ƒå°‘æ—¶ï¼Œä»¤ç‰Œå¯ä»¥ç¼“å­˜èµ·æ¥ï¼Œä¾›æµé‡çˆ†å‘æ—¶ä¸€æ¬¡æ€§æ‰¹é‡è·å–ä½¿ç”¨ã€‚è€Œå†…éƒ¨æœåŠ¡çª—å£ä¸è®¾é™ã€‚ </p>
<img src="/blog/2020/08/16/%E6%95%B0%E6%8D%AE%E7%BB%93%E6%9E%84-%E5%B8%B8%E8%A7%81%E7%AE%97%E6%B3%95%E4%B8%8E%E5%BA%94%E7%94%A8/pic2.png" srcset="/blog/img/loading.gif" class>

<h5 id="å®ç°-5"><a href="#å®ç°-5" class="headerlink" title="å®ç°"></a>å®ç°</h5><pre><code class="hljs java"><span class="hljs-keyword">package</span> com.itheima.release;

<span class="hljs-keyword">import</span> java.util.concurrent.*;

<span class="hljs-keyword">public</span> <span class="hljs-class"><span class="hljs-keyword">class</span> <span class="hljs-title">Token</span> </span>&#123;
    <span class="hljs-function"><span class="hljs-keyword">public</span> <span class="hljs-keyword">static</span> <span class="hljs-keyword">void</span> <span class="hljs-title">main</span><span class="hljs-params">(String[] args)</span> <span class="hljs-keyword">throws</span> InterruptedException </span>&#123;
        <span class="hljs-comment">//ä»¤ç‰Œæ¡¶ï¼Œä¿¡å·é‡å®ç°ï¼Œå®¹é‡ä¸º3</span>
        <span class="hljs-keyword">final</span> Semaphore semaphore = <span class="hljs-keyword">new</span> Semaphore(<span class="hljs-number">3</span>);
        <span class="hljs-comment">//å®šæ—¶å™¨ï¼Œ1sä¸€ä¸ªï¼ŒåŒ€é€Ÿé¢å‘ä»¤ç‰Œ</span>
        ScheduledExecutorService service = Executors.newScheduledThreadPool(<span class="hljs-number">1</span>);
        service.scheduleAtFixedRate(<span class="hljs-keyword">new</span> Runnable() &#123;
            <span class="hljs-meta">@Override</span>
            <span class="hljs-function"><span class="hljs-keyword">public</span> <span class="hljs-keyword">void</span> <span class="hljs-title">run</span><span class="hljs-params">()</span> </span>&#123;
                <span class="hljs-keyword">if</span> (semaphore.availablePermits() &lt; <span class="hljs-number">3</span>) &#123;
                    semaphore.release();
                &#125;
                <span class="hljs-comment">// System.out.println(&quot;ä»¤ç‰Œæ•°ï¼š&quot;+semaphore.availablePermits());</span>
            &#125;
        &#125;, <span class="hljs-number">1000</span>, <span class="hljs-number">1000</span>, TimeUnit.MILLISECONDS);
        <span class="hljs-comment">//ç­‰å¾…ï¼Œç­‰å€™ä»¤ç‰Œæ¡¶å‚¨å­˜</span>
        Thread.sleep(<span class="hljs-number">5</span>);
        <span class="hljs-comment">//æ¨¡æ‹Ÿæ´ªå³°5ä¸ªè¯·æ±‚ï¼Œå‰3ä¸ªè¿…é€Ÿå“åº”ï¼Œåä¸¤ä¸ªæ’é˜Ÿ </span>
        <span class="hljs-keyword">for</span> (<span class="hljs-keyword">int</span> i = <span class="hljs-number">0</span>; i &lt; <span class="hljs-number">5</span>; i++) &#123;
            semaphore.acquire();
            System.out.println(<span class="hljs-string">&quot;æ´ªå³°ï¼š&quot;</span> + i);
        &#125;
        <span class="hljs-comment">//æ¨¡æ‹Ÿæ—¥å¸¸è¯·æ±‚ï¼Œ2sä¸€ä¸ª </span>
        <span class="hljs-keyword">for</span> (<span class="hljs-keyword">int</span> i = <span class="hljs-number">0</span>; i &lt; <span class="hljs-number">3</span>; i++) &#123;
            Thread.sleep(<span class="hljs-number">1000</span>);
            semaphore.acquire();
            System.out.println(<span class="hljs-string">&quot;æ—¥å¸¸ï¼š&quot;</span> + i);
            Thread.sleep(<span class="hljs-number">1000</span>);
        &#125;
        <span class="hljs-comment">//å†æ¬¡æ´ªå³°</span>
        <span class="hljs-keyword">for</span> (<span class="hljs-keyword">int</span> i = <span class="hljs-number">0</span>; i &lt; <span class="hljs-number">5</span>; i++) &#123;
            semaphore.acquire();
            System.out.println(<span class="hljs-string">&quot;æ´ªå³°ï¼š&quot;</span> + i);
        &#125;
        <span class="hljs-comment">//æ£€æŸ¥ä»¤ç‰Œæ¡¶çš„æ•°é‡</span>
        <span class="hljs-keyword">for</span> (<span class="hljs-keyword">int</span> i = <span class="hljs-number">0</span>; i &lt; <span class="hljs-number">5</span>; i++) &#123;
            Thread.sleep(<span class="hljs-number">2000</span>);
            System.out.println(<span class="hljs-string">&quot;ä»¤ç‰Œå‰©ä½™ï¼š&quot;</span> + semaphore.availablePermits());
        &#125;
    &#125;
&#125;</code></pre>

<h5 id="ç»“æœåˆ†æ-5"><a href="#ç»“æœåˆ†æ-5" class="headerlink" title="ç»“æœåˆ†æ"></a>ç»“æœåˆ†æ</h5><pre><code class="hljs plain">æ´ªå³°ï¼š0
æ´ªå³°ï¼š1
æ´ªå³°ï¼š2
æ´ªå³°ï¼š3
æ´ªå³°ï¼š4
æ—¥å¸¸ï¼š0
æ—¥å¸¸ï¼š1
æ—¥å¸¸ï¼š2
æ´ªå³°ï¼š0
æ´ªå³°ï¼š1
æ´ªå³°ï¼š2
æ´ªå³°ï¼š3
æ´ªå³°ï¼š4
ä»¤ç‰Œå‰©ä½™ï¼š2
ä»¤ç‰Œå‰©ä½™ï¼š3
ä»¤ç‰Œå‰©ä½™ï¼š3</code></pre>

<ul>
<li><p>æ´ªå³°0-2è¿…é€Ÿè¢«æ‰§è¡Œï¼Œè¯´æ˜æ¡¶ä¸­æš‚å­˜äº†3ä¸ªä»¤ç‰Œï¼Œæœ‰æ•ˆåº”å¯¹äº†æ´ªå³° </p>
</li>
<li><p>æ´ªå³°3ï¼Œ4è¢«é—´éš”æ€§æ‰§è¡Œï¼Œå¾—åˆ°äº†æœ‰æ•ˆçš„é™æµ </p>
</li>
<li><p>æ—¥å¸¸è¯·æ±‚è¢«åŒ€é€Ÿæ‰§è¡Œï¼Œé—´éš”å‡åŒ€ </p>
</li>
<li><p>ç¬¬äºŒæ³¢æ´ªå³°æ¥ä¸´ï¼Œå’Œç¬¬ä¸€æ¬¡ä¸€æ · </p>
</li>
<li><p>è¯·æ±‚è¿‡å»åï¼Œä»¤ç‰Œæœ€ç»ˆè¢«å‡åŒ€é¢å‘ï¼Œç§¯ç´¯åˆ°3ä¸ªåä¸å†ä¸Šå‡ </p>
</li>
</ul>
<h5 id="åº”ç”¨-2"><a href="#åº”ç”¨-2" class="headerlink" title="åº”ç”¨"></a>åº”ç”¨</h5><p>springcloudä¸­gatewayå¯ä»¥é…ç½®ä»¤ç‰Œæ¡¶å®ç°é™æµæ§åˆ¶ï¼Œæ¡ˆä¾‹å¦‚ä¸‹ï¼š </p>
<pre><code class="hljs yml"><span class="hljs-attr">cloud:</span> 
	<span class="hljs-attr">gateway:</span> 
		<span class="hljs-attr">routes:</span> 
			<span class="hljs-attr">id:</span> <span class="hljs-string">limit_route</span> 
			<span class="hljs-attr">uri:</span> <span class="hljs-string">http://localhost:8080/test</span> 
			<span class="hljs-attr">filters:</span> 
				<span class="hljs-attr">name:</span> <span class="hljs-string">RequestRateLimiter</span> 
				<span class="hljs-attr">args:</span> <span class="hljs-comment">#é™æµçš„keyï¼ŒipKeyResolverä¸ºspringä¸­æ‰˜ç®¡çš„Beanï¼Œéœ€è¦æ‰©å±•KeyResolveræ¥å£ </span>
				<span class="hljs-string">keyâ€resolver:</span> <span class="hljs-string">&#x27;#&#123;@ipResolver&#125;&#x27;</span> 
				<span class="hljs-comment">#ä»¤ç‰Œæ¡¶æ¯ç§’å¡«å……å¹³å‡é€Ÿç‡ï¼Œç›¸å½“äºä»£ç ä¸­çš„å‘æ”¾é¢‘ç‡ </span>
				<span class="hljs-string">redisâ€rateâ€limiter.replenishRate:</span> <span class="hljs-number">1</span> 
				<span class="hljs-comment">#ä»¤ç‰Œæ¡¶æ€»å®¹é‡ï¼Œç›¸å½“äºä»£ç ä¸­ï¼Œä¿¡å·é‡çš„å®¹é‡ </span>
				<span class="hljs-string">redisâ€rateâ€limiter.burstCapacity:</span> <span class="hljs-number">3</span></code></pre>

<h4 id="æ»‘åŠ¨çª—å£"><a href="#æ»‘åŠ¨çª—å£" class="headerlink" title="æ»‘åŠ¨çª—å£"></a>æ»‘åŠ¨çª—å£</h4><h5 id="æ¦‚è¿°-6"><a href="#æ¦‚è¿°-6" class="headerlink" title="æ¦‚è¿°"></a>æ¦‚è¿°</h5><p>æ»‘åŠ¨çª—å£å¯ä»¥ç†è§£ä¸ºç»†åˆ†ä¹‹åçš„è®¡æ•°å™¨ï¼Œè®¡æ•°å™¨ç²—æš´çš„é™å®š1åˆ†é’Ÿå†…çš„è®¿é—®æ¬¡æ•°ï¼Œè€Œæ»‘åŠ¨çª—å£é™æµå°†1åˆ†é’Ÿæ‹†ä¸ºå¤šä¸ªæ®µï¼Œä¸ä½†è¦æ±‚æ•´ä¸ª1åˆ†é’Ÿå†…è¯·æ±‚æ•°å°äºä¸Šé™ï¼Œè€Œä¸”è¦æ±‚æ¯ä¸ªç‰‡æ®µè¯·æ±‚æ•°ä¹Ÿè¦å°äºä¸Šé™ã€‚ç›¸å½“äºå°†åŸæ¥çš„è®¡æ•°å‘¨æœŸåšäº†å¤šä¸ªç‰‡æ®µæ‹†åˆ†ã€‚æ›´ä¸ºç²¾ç»†ã€‚ </p>
<img src="/blog/2020/08/16/%E6%95%B0%E6%8D%AE%E7%BB%93%E6%9E%84-%E5%B8%B8%E8%A7%81%E7%AE%97%E6%B3%95%E4%B8%8E%E5%BA%94%E7%94%A8/pic3.png" srcset="/blog/img/loading.gif" class>

<h5 id="å®ç°-6"><a href="#å®ç°-6" class="headerlink" title="å®ç°"></a>å®ç°</h5><img src="/blog/2020/08/16/%E6%95%B0%E6%8D%AE%E7%BB%93%E6%9E%84-%E5%B8%B8%E8%A7%81%E7%AE%97%E6%B3%95%E4%B8%8E%E5%BA%94%E7%94%A8/pic4.png" srcset="/blog/img/loading.gif" class>

<pre><code class="hljs java"><span class="hljs-keyword">package</span> com.itheima.release;

<span class="hljs-keyword">import</span> java.util.LinkedList;
<span class="hljs-keyword">import</span> java.util.Map;
<span class="hljs-keyword">import</span> java.util.TreeMap;
<span class="hljs-keyword">import</span> java.util.concurrent.Executors;
<span class="hljs-keyword">import</span> java.util.concurrent.ScheduledExecutorService;
<span class="hljs-keyword">import</span> java.util.concurrent.TimeUnit;
<span class="hljs-keyword">import</span> java.util.concurrent.atomic.AtomicInteger;

<span class="hljs-keyword">public</span> <span class="hljs-class"><span class="hljs-keyword">class</span> <span class="hljs-title">Window</span> </span>&#123;
    <span class="hljs-comment">//æ•´ä¸ªçª—å£çš„æµé‡ä¸Šé™ï¼Œè¶…å‡ºä¼šè¢«é™æµ </span>
    <span class="hljs-keyword">final</span> <span class="hljs-keyword">int</span> totalMax = <span class="hljs-number">5</span>;
    <span class="hljs-comment">//æ¯ç‰‡çš„æµé‡ä¸Šé™ï¼Œè¶…å‡ºåŒæ ·ä¼šè¢«æ‹’ç»ï¼Œå¯ä»¥è®¾ç½®ä¸åŒçš„å€¼ </span>
    <span class="hljs-keyword">final</span> <span class="hljs-keyword">int</span> sliceMax = <span class="hljs-number">5</span>;
    <span class="hljs-comment">//åˆ†å¤šå°‘ç‰‡ </span>
    <span class="hljs-keyword">final</span> <span class="hljs-keyword">int</span> slice = <span class="hljs-number">3</span>;
    <span class="hljs-comment">//çª—å£ï¼Œåˆ†3æ®µï¼Œæ¯æ®µ1sï¼Œä¹Ÿå°±æ˜¯æ€»é•¿åº¦3s </span>
    <span class="hljs-keyword">final</span> LinkedList&lt;Long&gt; linkedList = <span class="hljs-keyword">new</span> LinkedList&lt;&gt;();
    <span class="hljs-comment">//è®¡æ•°å™¨ï¼Œæ¯ç‰‡ä¸€ä¸ªkeyï¼Œå¯ä»¥ä½¿ç”¨HashMapï¼Œè¿™é‡Œä¸ºäº†æ§åˆ¶å°ä¿æŒæœ‰åºæ€§å’Œå¯è¯»æ€§ï¼Œé‡‡ç”¨TreeMap </span>
    Map&lt;Long, AtomicInteger&gt; map = <span class="hljs-keyword">new</span> TreeMap();
    <span class="hljs-comment">//å¿ƒè·³ï¼Œæ¯1sè·³åŠ¨1æ¬¡ï¼Œæ»‘åŠ¨çª—å£å‘å‰æ»‘åŠ¨ä¸€æ­¥ï¼Œå®é™…ä¸šåŠ¡ä¸­å¯èƒ½éœ€è¦æ‰‹åŠ¨æ§åˆ¶æ»‘åŠ¨çª—å£çš„æ—¶æœºã€‚</span>
    ScheduledExecutorService service = Executors.newScheduledThreadPool(<span class="hljs-number">1</span>);

    <span class="hljs-comment">//è·å–keyå€¼ï¼Œè¿™é‡Œå³æ˜¯æ—¶é—´æˆ³ï¼ˆç§’ï¼‰</span>
    <span class="hljs-function"><span class="hljs-keyword">private</span> Long <span class="hljs-title">getKey</span><span class="hljs-params">()</span> </span>&#123;
        <span class="hljs-keyword">return</span> System.currentTimeMillis() / <span class="hljs-number">1000</span>;
    &#125;

    <span class="hljs-function"><span class="hljs-keyword">public</span> <span class="hljs-title">Window</span><span class="hljs-params">()</span> </span>&#123;
        <span class="hljs-comment">//åˆå§‹åŒ–çª—å£ï¼Œå½“å‰æ—¶é—´æŒ‡å‘çš„æ˜¯æœ€æœ«ç«¯ï¼Œå‰ä¸¤ç‰‡å…¶å®æ˜¯è¿‡å»çš„2s </span>
        Long key = getKey();
        <span class="hljs-keyword">for</span> (<span class="hljs-keyword">int</span> i = <span class="hljs-number">0</span>; i &lt; slice; i++) &#123;
            linkedList.addFirst(key - i);
            map.put(key - i, <span class="hljs-keyword">new</span> AtomicInteger(<span class="hljs-number">0</span>));
        &#125;
        <span class="hljs-comment">//å¯åŠ¨å¿ƒè·³ä»»åŠ¡ï¼Œçª—å£æ ¹æ®æ—¶é—´ï¼Œè‡ªåŠ¨å‘å‰æ»‘åŠ¨ï¼Œæ¯ç§’1æ­¥ </span>
        service.scheduleAtFixedRate(<span class="hljs-keyword">new</span> Runnable() &#123;
            <span class="hljs-meta">@Override</span>
            <span class="hljs-function"><span class="hljs-keyword">public</span> <span class="hljs-keyword">void</span> <span class="hljs-title">run</span><span class="hljs-params">()</span> </span>&#123;
                Long key = getKey();
                <span class="hljs-comment">//é˜Ÿå°¾æ·»åŠ æœ€æ–°çš„ç‰‡</span>
                linkedList.addLast(key);
                map.put(key, <span class="hljs-keyword">new</span> AtomicInteger());
                <span class="hljs-comment">//å°†æœ€è€çš„ç‰‡ç§»é™¤</span>
                map.remove(linkedList.getFirst());
                linkedList.removeFirst();
                System.out.println(<span class="hljs-string">&quot;step:&quot;</span> + key + <span class="hljs-string">&quot;:&quot;</span> + map);
                ;
            &#125;
        &#125;, <span class="hljs-number">1000</span>, <span class="hljs-number">1000</span>, TimeUnit.MILLISECONDS);
    &#125;

    <span class="hljs-comment">//æ£€æŸ¥å½“å‰æ—¶é—´æ‰€åœ¨çš„ç‰‡æ˜¯å¦è¾¾åˆ°ä¸Šé™</span>
    <span class="hljs-function"><span class="hljs-keyword">public</span> <span class="hljs-keyword">boolean</span> <span class="hljs-title">checkCurrentSlice</span><span class="hljs-params">()</span> </span>&#123;
        <span class="hljs-keyword">long</span> key = getKey();
        AtomicInteger integer = map.get(key);
        <span class="hljs-keyword">if</span> (integer != <span class="hljs-keyword">null</span>) &#123;
            <span class="hljs-keyword">return</span> integer.get() &lt; sliceMax;
        &#125;
        <span class="hljs-comment">//é»˜è®¤å…è®¸è®¿é—® </span>
        <span class="hljs-keyword">return</span> <span class="hljs-keyword">true</span>;
    &#125;

    <span class="hljs-comment">//æ£€æŸ¥æ•´ä¸ªçª—å£æ‰€æœ‰ç‰‡çš„è®¡æ•°ä¹‹å’Œæ˜¯å¦è¾¾åˆ°ä¸Šé™</span>
    <span class="hljs-function"><span class="hljs-keyword">public</span> <span class="hljs-keyword">boolean</span> <span class="hljs-title">checkAllCount</span><span class="hljs-params">()</span> </span>&#123;
        <span class="hljs-keyword">return</span> map.values().stream().mapToInt(value -&gt; value.get()).sum() &lt; totalMax;
    &#125;

    <span class="hljs-comment">//è¯·æ±‚æ¥ä¸´.... </span>
    <span class="hljs-function"><span class="hljs-keyword">public</span> <span class="hljs-keyword">void</span> <span class="hljs-title">req</span><span class="hljs-params">()</span> </span>&#123;
        Long key = getKey();
        <span class="hljs-comment">//å¦‚æœæ—¶é—´çª—å£æœªåˆ°è¾¾å½“å‰æ—¶é—´ç‰‡ï¼Œç¨å¾®ç­‰å¾…ä¸€ä¸‹ </span>
        <span class="hljs-comment">// å…¶å®æ˜¯ä¸€ä¸ªä¿æŠ¤æªæ–½ï¼Œæ”¾ç½®å¿ƒè·³å¯¹æ»‘åŠ¨çª—å£çš„æ¨åŠ¨æ»åäºå½“å‰è¯·æ±‚</span>
        <span class="hljs-keyword">while</span> (linkedList.getLast() &lt; key) &#123;
            <span class="hljs-keyword">try</span> &#123;
                Thread.sleep(<span class="hljs-number">200</span>);
            &#125; <span class="hljs-keyword">catch</span> (InterruptedException e) &#123;
                e.printStackTrace();
            &#125;
        &#125;
        <span class="hljs-comment">//å¼€å§‹æ£€æŸ¥ï¼Œå¦‚æœæœªè¾¾åˆ°ä¸Šé™ï¼Œè¿”å›okï¼Œè®¡æ•°å™¨å¢åŠ 1 </span>
        <span class="hljs-comment">// å¦‚æœä»»æ„ä¸€é¡¹è¾¾åˆ°ä¸Šé™ï¼Œæ‹’ç»è¯·æ±‚ï¼Œè¾¾åˆ°é™æµçš„ç›®çš„ </span>
        <span class="hljs-comment">// è¿™é‡Œæ˜¯ç›´æ¥æ‹’ç»ã€‚ç°å®ä¸­å¯èƒ½ä¼šè®¾ç½®ç¼“å†²æ± ï¼Œå°†è¯·æ±‚æ”¾å…¥ç¼“å†²é˜Ÿåˆ—æš‚å­˜ </span>
        <span class="hljs-keyword">if</span> (checkCurrentSlice() &amp;&amp; checkAllCount()) &#123;
            map.get(key).incrementAndGet();
            System.out.println(key + <span class="hljs-string">&quot;=ok:&quot;</span> + map);
        &#125; <span class="hljs-keyword">else</span> &#123;
            System.out.println(key + <span class="hljs-string">&quot;=reject:&quot;</span> + map);
        &#125;
    &#125;

    <span class="hljs-function"><span class="hljs-keyword">public</span> <span class="hljs-keyword">static</span> <span class="hljs-keyword">void</span> <span class="hljs-title">main</span><span class="hljs-params">(String[] args)</span> <span class="hljs-keyword">throws</span> InterruptedException </span>&#123;
        Window window = <span class="hljs-keyword">new</span> Window();
        <span class="hljs-comment">//æ¨¡æ‹Ÿ10ä¸ªç¦»æ•£çš„è¯·æ±‚ï¼Œç›¸å¯¹ä¹‹é—´æœ‰200msé—´éš”ã€‚ä¼šé€ æˆæ€»æ•°è¾¾åˆ°ä¸Šé™è€Œè¢«é™æµ </span>
        <span class="hljs-keyword">for</span> (<span class="hljs-keyword">int</span> i = <span class="hljs-number">0</span>; i &lt; <span class="hljs-number">10</span>; i++) &#123;
            Thread.sleep(<span class="hljs-number">200</span>);
            window.req();
        &#125;
        <span class="hljs-comment">//ç­‰å¾…ä¸€ä¸‹çª—å£æ»‘åŠ¨ï¼Œè®©å„ä¸ªç‰‡çš„è®¡æ•°å™¨éƒ½ç½®é›¶</span>
        Thread.sleep(<span class="hljs-number">3000</span>);
        <span class="hljs-comment">//æ¨¡æ‹Ÿçªå‘è¯·æ±‚ï¼Œå•ä¸ªç‰‡çš„è®¡æ•°å™¨è¾¾åˆ°ä¸Šé™è€Œè¢«é™æµ</span>
        System.out.println(<span class="hljs-string">&quot;â€â€â€â€â€â€â€â€â€â€â€â€â€â€â€â€â€â€â€â€â€â€â€â€â€â€â€&quot;</span>);
        <span class="hljs-keyword">for</span> (<span class="hljs-keyword">int</span> i = <span class="hljs-number">0</span>; i &lt; <span class="hljs-number">10</span>; i++) &#123;
            window.req();
        &#125;
    &#125;
&#125;</code></pre>

<h5 id="ç»“æœåˆ†æ-6"><a href="#ç»“æœåˆ†æ-6" class="headerlink" title="ç»“æœåˆ†æ"></a>ç»“æœåˆ†æ</h5><pre><code class="hljs routeros"><span class="hljs-attribute">1598005699</span>=ok:&#123;<span class="hljs-attribute">1598005697</span>=0, <span class="hljs-attribute">1598005698</span>=0, <span class="hljs-attribute">1598005699</span>=1&#125;
<span class="hljs-attribute">1598005699</span>=ok:&#123;<span class="hljs-attribute">1598005697</span>=0, <span class="hljs-attribute">1598005698</span>=0, <span class="hljs-attribute">1598005699</span>=2&#125;
<span class="hljs-keyword">step</span>:1598005700:&#123;<span class="hljs-attribute">1598005698</span>=0, <span class="hljs-attribute">1598005699</span>=2, <span class="hljs-attribute">1598005700</span>=0&#125;
<span class="hljs-attribute">1598005700</span>=ok:&#123;<span class="hljs-attribute">1598005698</span>=0, <span class="hljs-attribute">1598005699</span>=2, <span class="hljs-attribute">1598005700</span>=1&#125;
<span class="hljs-attribute">1598005700</span>=ok:&#123;<span class="hljs-attribute">1598005698</span>=0, <span class="hljs-attribute">1598005699</span>=2, <span class="hljs-attribute">1598005700</span>=2&#125;
<span class="hljs-attribute">1598005700</span>=ok:&#123;<span class="hljs-attribute">1598005698</span>=0, <span class="hljs-attribute">1598005699</span>=2, <span class="hljs-attribute">1598005700</span>=3&#125;</code></pre>

<p>æ¨¡æ‹Ÿé›¶é›¶æ•£æ•£çš„è¯·æ±‚ï¼Œä¼šé€ æˆæ¯ä¸ªç‰‡é‡Œå‡æœ‰è®¡æ•°ï¼Œæ€»æ•°è¾¾åˆ°ä¸Šé™åï¼Œä¸å†å“åº”ï¼Œé™æµç”Ÿæ•ˆ</p>
<p>å†æ¨¡æ‹Ÿçªå‘çš„æµé‡è¯·æ±‚ï¼Œä¼šé€ æˆå•ç‰‡æµé‡è®¡æ•°è¾¾åˆ°ä¸Šé™ï¼Œä¸å†å“åº”è€Œè¢«é™æµ</p>
<pre><code class="hljs routeros"><span class="hljs-attribute">1598005705</span>=reject:&#123;<span class="hljs-attribute">1598005703</span>=0, <span class="hljs-attribute">1598005704</span>=0, <span class="hljs-attribute">1598005705</span>=5&#125;
<span class="hljs-attribute">1598005705</span>=reject:&#123;<span class="hljs-attribute">1598005703</span>=0, <span class="hljs-attribute">1598005704</span>=0, <span class="hljs-attribute">1598005705</span>=5&#125;
<span class="hljs-attribute">1598005705</span>=reject:&#123;<span class="hljs-attribute">1598005703</span>=0, <span class="hljs-attribute">1598005704</span>=0, <span class="hljs-attribute">1598005705</span>=5&#125;
<span class="hljs-attribute">1598005705</span>=reject:&#123;<span class="hljs-attribute">1598005703</span>=0, <span class="hljs-attribute">1598005704</span>=0, <span class="hljs-attribute">1598005705</span>=5&#125;
<span class="hljs-attribute">1598005705</span>=reject:&#123;<span class="hljs-attribute">1598005703</span>=0, <span class="hljs-attribute">1598005704</span>=0, <span class="hljs-attribute">1598005705</span>=5&#125;</code></pre>

<h5 id="åº”ç”¨-3"><a href="#åº”ç”¨-3" class="headerlink" title="åº”ç”¨"></a>åº”ç”¨</h5><p>æ»‘åŠ¨çª—å£ç®—æ³•ï¼Œåœ¨tcpåè®®å‘åŒ…è¿‡ç¨‹ä¸­è¢«ä½¿ç”¨ã€‚åœ¨webç°å®åœºæ™¯ä¸­ï¼Œå¯ä»¥å°†æµé‡æ§åˆ¶åšæ›´ç»†åŒ–å¤„ç†ï¼Œè§£å†³è®¡æ•°å™¨æ¨¡å‹æ§åˆ¶åŠ›åº¦å¤ªç²—æš´çš„é—®é¢˜ã€‚ </p>
<h3 id="è°ƒåº¦ç®—æ³•ä¸åº”ç”¨"><a href="#è°ƒåº¦ç®—æ³•ä¸åº”ç”¨" class="headerlink" title="è°ƒåº¦ç®—æ³•ä¸åº”ç”¨"></a>è°ƒåº¦ç®—æ³•ä¸åº”ç”¨</h3><p>è°ƒåº¦ç®—æ³•å¸¸è§äºæ“ä½œç³»ç»Ÿä¸­ï¼Œå› ä¸ºç³»ç»Ÿèµ„æºæœ‰é™ï¼Œå½“æœ‰å¤šä¸ªè¿›ç¨‹ï¼ˆæˆ–å¤šä¸ªè¿›ç¨‹å‘å‡ºçš„è¯·æ±‚ï¼‰è¦ä½¿ç”¨è¿™äº›èµ„æºæ—¶ï¼Œå°± å¿…é¡»æŒ‰ç…§ä¸€å®šçš„åŸåˆ™é€‰æ‹©è¿›ç¨‹ï¼ˆè¯·æ±‚ï¼‰æ¥å ç”¨èµ„æºã€‚è¿™å°±æ˜¯æ‰€è°“çš„è°ƒåº¦ã€‚åœ¨ç°å®ç”Ÿæ´»ä¸­ä¹Ÿæ˜¯ä¸€æ ·ï¼Œæ¯”å¦‚ä¼šè®®å®¤çš„å ç”¨ã€‚</p>
<h4 id="å…ˆæ¥å…ˆæœåŠ¡ï¼ˆFCFSï¼‰"><a href="#å…ˆæ¥å…ˆæœåŠ¡ï¼ˆFCFSï¼‰" class="headerlink" title="å…ˆæ¥å…ˆæœåŠ¡ï¼ˆFCFSï¼‰"></a>å…ˆæ¥å…ˆæœåŠ¡ï¼ˆFCFSï¼‰</h4><h5 id="æ¦‚å¿µ"><a href="#æ¦‚å¿µ" class="headerlink" title="æ¦‚å¿µ"></a>æ¦‚å¿µ</h5><p>å…ˆæ¥å…ˆæœåŠ¡ï¼Œå¾ˆå¥½ç†è§£ï¼Œå°±æ˜¯æŒ‰ç…§æœåŠ¡æäº¤ç”³è¯·çš„é¡ºåºï¼Œä¾æ¬¡æ‰§è¡Œã€‚è®²ç©¶å…ˆæ¥ååˆ°ã€‚ </p>
<h5 id="å®ç°-7"><a href="#å®ç°-7" class="headerlink" title="å®ç°"></a>å®ç°</h5><p>å®šä¹‰ä¸€ä¸ªTaskç±»ä½œä¸ºä»»åŠ¡å®ä¾‹ï¼ŒBlockingQueueä½œä¸ºæœåŠ¡é˜Ÿåˆ— </p>
<pre><code class="hljs java"><span class="hljs-keyword">package</span> com.itheima.schedule;

<span class="hljs-comment">/*** ä»»åŠ¡ç±» */</span>
<span class="hljs-keyword">public</span> <span class="hljs-class"><span class="hljs-keyword">class</span> <span class="hljs-title">Task</span> </span>&#123;
    <span class="hljs-comment">//ä»»åŠ¡åç§°</span>
    <span class="hljs-keyword">private</span> String name;
    <span class="hljs-comment">//ä»»åŠ¡æäº¤çš„æ—¶é—´ </span>
    <span class="hljs-keyword">private</span> Long addTime;
    <span class="hljs-comment">//ä»»åŠ¡çš„æ‰§è¡Œæ—¶é—´é•¿çŸ­ </span>
    <span class="hljs-keyword">private</span> <span class="hljs-keyword">int</span> servTime;

    <span class="hljs-function"><span class="hljs-keyword">public</span> <span class="hljs-title">Task</span><span class="hljs-params">(String name, <span class="hljs-keyword">int</span> servTime)</span> </span>&#123;
        <span class="hljs-keyword">this</span>.name = name;
        <span class="hljs-keyword">this</span>.servTime = servTime;
        <span class="hljs-keyword">this</span>.addTime = System.currentTimeMillis();
    &#125;

    <span class="hljs-function"><span class="hljs-keyword">public</span> <span class="hljs-keyword">void</span> <span class="hljs-title">execute</span><span class="hljs-params">()</span> </span>&#123;
        <span class="hljs-keyword">try</span> &#123;
            <span class="hljs-comment">// ï¼é‡ç‚¹ï¼šæ‰§è¡Œæ—¶ç¡çœ ï¼Œè¡¨ç¤ºè¯¥ä»»åŠ¡è€—æ—¶servTimeæ¯«ç§’</span>
            Thread.currentThread().sleep(servTime);
        &#125; <span class="hljs-keyword">catch</span> (InterruptedException e) &#123;
            e.printStackTrace();
        &#125;
        System.out.println(String.format(<span class="hljs-string">&quot;execute:name=%s,addTime=%s,servTime=%s&quot;</span>, name, addTime, servTime));
    &#125;
&#125;</code></pre>

<pre><code class="hljs java"><span class="hljs-keyword">package</span> com.itheima.schedule;

<span class="hljs-keyword">import</span> java.util.Random;
<span class="hljs-keyword">import</span> java.util.concurrent.LinkedBlockingQueue;

<span class="hljs-keyword">public</span> <span class="hljs-class"><span class="hljs-keyword">class</span> <span class="hljs-title">FCFS</span> </span>&#123;
    <span class="hljs-function"><span class="hljs-keyword">public</span> <span class="hljs-keyword">static</span> <span class="hljs-keyword">void</span> <span class="hljs-title">main</span><span class="hljs-params">(String[] args)</span> <span class="hljs-keyword">throws</span> InterruptedException </span>&#123;
        <span class="hljs-comment">//é˜»å¡é˜Ÿåˆ—ï¼ŒFCFSçš„åŸºç¡€ </span>
        <span class="hljs-keyword">final</span> LinkedBlockingQueue&lt;Task&gt; queue = <span class="hljs-keyword">new</span> LinkedBlockingQueue(<span class="hljs-number">5</span>);
        <span class="hljs-comment">//æœåŠ¡çº¿ç¨‹ï¼Œä»»åŠ¡ç”±è¯¥çº¿ç¨‹è·å–å’Œæ‰§è¡Œ </span>
        <span class="hljs-keyword">new</span> Thread(<span class="hljs-keyword">new</span> Runnable() &#123;
            <span class="hljs-meta">@Override</span>
            <span class="hljs-function"><span class="hljs-keyword">public</span> <span class="hljs-keyword">void</span> <span class="hljs-title">run</span><span class="hljs-params">()</span> </span>&#123;
                <span class="hljs-keyword">while</span> (<span class="hljs-keyword">true</span>) &#123;
                    <span class="hljs-keyword">try</span> &#123;
                        queue.take().execute();
                    &#125; <span class="hljs-keyword">catch</span> (Exception e) &#123;
                        e.printStackTrace();
                    &#125;
                &#125;
            &#125;
        &#125;).start();
        <span class="hljs-comment">//å‘é˜Ÿåˆ—ä¸­æ”¾å…¥ä¸€ä¸ªä»»åŠ¡ </span>
        <span class="hljs-keyword">for</span> (<span class="hljs-keyword">int</span> i = <span class="hljs-number">0</span>; i &lt; <span class="hljs-number">5</span>; i++) &#123;
            System.out.println(<span class="hljs-string">&quot;add task:&quot;</span> + i);
            queue.put(<span class="hljs-keyword">new</span> Task(<span class="hljs-string">&quot;task&quot;</span> + i, <span class="hljs-keyword">new</span> Random().nextInt(<span class="hljs-number">1000</span>)));
        &#125;
    &#125;
&#125;</code></pre>

<h5 id="ç»“æœåˆ†æ-7"><a href="#ç»“æœåˆ†æ-7" class="headerlink" title="ç»“æœåˆ†æ"></a>ç»“æœåˆ†æ</h5><pre><code class="hljs apache"><span class="hljs-attribute">add</span> task:<span class="hljs-number">0</span>
<span class="hljs-attribute">add</span> task:<span class="hljs-number">1</span>
<span class="hljs-attribute">add</span> task:<span class="hljs-number">2</span>
<span class="hljs-attribute">add</span> task:<span class="hljs-number">3</span>
<span class="hljs-attribute">add</span> task:<span class="hljs-number">4</span>
<span class="hljs-attribute">execute</span>:name=task<span class="hljs-number">0</span>,addTime=<span class="hljs-number">1598006103935</span>,servTime=<span class="hljs-number">690</span>
<span class="hljs-attribute">execute</span>:name=task<span class="hljs-number">1</span>,addTime=<span class="hljs-number">1598006103935</span>,servTime=<span class="hljs-number">951</span>
<span class="hljs-attribute">execute</span>:name=task<span class="hljs-number">2</span>,addTime=<span class="hljs-number">1598006103935</span>,servTime=<span class="hljs-number">437</span>
<span class="hljs-attribute">execute</span>:name=task<span class="hljs-number">3</span>,addTime=<span class="hljs-number">1598006103935</span>,servTime=<span class="hljs-number">692</span>
<span class="hljs-attribute">execute</span>:name=task<span class="hljs-number">4</span>,addTime=<span class="hljs-number">1598006103935</span>,servTime=<span class="hljs-number">446</span></code></pre>

<ul>
<li><p>addæŒ‰é¡ºåºæ”¾å…¥ï¼Œæ—¶é—´æœ‰åº </p>
</li>
<li><p>executeä¹ŸæŒ‰æ—¶é—´é¡ºåºæ‰§è¡Œï¼Œè€Œä¸ç®¡åé¢çš„servTimeï¼Œä¹Ÿå°±æ˜¯ä¸ç®¡æ‰§è¡Œä»»åŠ¡é•¿çŸ­ï¼Œå…ˆæ¥å…ˆæ‰§è¡Œ </p>
</li>
</ul>
<h5 id="ä¼˜ç¼ºç‚¹-3"><a href="#ä¼˜ç¼ºç‚¹-3" class="headerlink" title="ä¼˜ç¼ºç‚¹"></a>ä¼˜ç¼ºç‚¹</h5><ul>
<li><p>å¤šåº”ç”¨äºcpuå¯†é›†å‹ä»»åŠ¡åœºæ™¯ï¼Œå¯¹ioå¯†é›†å‹çš„ä¸åˆ©ã€‚ </p>
</li>
<li><p>æ—¶é—´ç›¸å¯¹å‡è¡¡çš„ä¸šåŠ¡å¯ä»¥æ’é˜Ÿå¤„ç†ï¼Œæ¯”å¦‚ç°å®ä¸­æ’é˜Ÿæ‰“å¡è¿›ç«™ã€‚ </p>
</li>
<li><p>å¦‚æœä¸šåŠ¡éœ€è¦ä¾èµ–å¤§é‡çš„å¤–éƒ¨å› ç´ ï¼Œæ‰§è¡Œæ—¶é—´ç‰‡é•¿çŸ­ä¸ä¸€ï¼ŒFCFSç®—æ³•ä¸åˆ©äºä»»åŠ¡çš„æ•´ä½“å¤„ç†è¿›åº¦ï¼Œå¯èƒ½ä¼šå› ä¸ºä¸€ä¸ªé•¿æ—¶é—´ä¸šåŠ¡çš„é˜»å¡è€Œé€ æˆå¤§é‡ç­‰å¾…ã€‚ </p>
</li>
</ul>
<h4 id="çŸ­ä½œä¸šä¼˜å…ˆï¼ˆSJFï¼‰"><a href="#çŸ­ä½œä¸šä¼˜å…ˆï¼ˆSJFï¼‰" class="headerlink" title="çŸ­ä½œä¸šä¼˜å…ˆï¼ˆSJFï¼‰"></a>çŸ­ä½œä¸šä¼˜å…ˆï¼ˆSJFï¼‰</h4><h5 id="æ¦‚å¿µ-1"><a href="#æ¦‚å¿µ-1" class="headerlink" title="æ¦‚å¿µ"></a>æ¦‚å¿µ</h5><p>æ‰§è¡Œæ—¶é—´çŸ­çš„ä¼˜å…ˆå¾—åˆ°èµ„æºã€‚å³æ‰§è¡Œå‰ç”³æŠ¥ä¸€ä¸ªæˆ‘éœ€è¦å æ®cpuçš„æ—¶é—´ï¼Œæ ¹æ®æ—¶é—´é•¿çŸ­ï¼ŒçŸ­çš„ä¼˜å…ˆè¢«è°ƒåº¦ã€‚æˆ‘ä¸å æ—¶é—´æ‰€ä»¥æˆ‘å…ˆæ¥ã€‚ </p>
<h5 id="å®ç°-8"><a href="#å®ç°-8" class="headerlink" title="å®ç°"></a>å®ç°</h5><p>ä½¿ç”¨TreeMapå¯ä»¥å®ç°ä¼˜å…ˆçº§çš„ä»»åŠ¡æ’åºã€‚</p>
<pre><code class="hljs java"><span class="hljs-keyword">package</span> com.itheima.schedule;

<span class="hljs-keyword">import</span> java.util.Map;
<span class="hljs-keyword">import</span> java.util.Random;
<span class="hljs-keyword">import</span> java.util.TreeMap;

<span class="hljs-keyword">public</span> <span class="hljs-class"><span class="hljs-keyword">class</span> <span class="hljs-title">SJF</span> </span>&#123;
    <span class="hljs-function"><span class="hljs-keyword">public</span> <span class="hljs-keyword">static</span> <span class="hljs-keyword">void</span> <span class="hljs-title">main</span><span class="hljs-params">(String[] args)</span> <span class="hljs-keyword">throws</span> InterruptedException </span>&#123;
        <span class="hljs-comment">//æœ‰åºMapï¼Œå°†æœåŠ¡æ—¶é—´ä½œä¸ºkeyæ’åº</span>
        <span class="hljs-keyword">final</span> TreeMap&lt;Integer, Task&gt; treeMap = <span class="hljs-keyword">new</span> TreeMap();
        <span class="hljs-comment">//å‘é˜Ÿåˆ—ä¸­æ”¾å…¥5ä¸ªä»»åŠ¡ </span>
        <span class="hljs-keyword">for</span> (<span class="hljs-keyword">int</span> i = <span class="hljs-number">0</span>; i &lt; <span class="hljs-number">5</span>; i++) &#123;
            System.out.println(<span class="hljs-string">&quot;add task:&quot;</span> + i);
            <span class="hljs-keyword">int</span> servTime = <span class="hljs-keyword">new</span> Random().nextInt(<span class="hljs-number">1000</span>);
            <span class="hljs-comment">//æ³¨æ„ï¼Œkeyæ˜¯servTimeï¼Œå³æ‰§è¡Œé¢„ä¼°æ—¶é—´</span>
            treeMap.put(servTime, <span class="hljs-keyword">new</span> Task(<span class="hljs-string">&quot;task&quot;</span> + i, servTime));
        &#125;
        <span class="hljs-comment">//æœåŠ¡çº¿ç¨‹ï¼Œä»»åŠ¡ç”±è¯¥çº¿ç¨‹è·å–å’Œæ‰§è¡Œ </span>
        <span class="hljs-keyword">new</span> Thread(<span class="hljs-keyword">new</span> Runnable() &#123;
            <span class="hljs-meta">@Override</span>
            <span class="hljs-function"><span class="hljs-keyword">public</span> <span class="hljs-keyword">void</span> <span class="hljs-title">run</span><span class="hljs-params">()</span> </span>&#123;
                <span class="hljs-keyword">while</span> (<span class="hljs-keyword">true</span>) &#123;
                    <span class="hljs-keyword">try</span> &#123;
                        <span class="hljs-comment">//æœ‰åºMapä¸­ï¼ŒæœåŠ¡æ—¶é—´çŸ­çš„ï¼Œç½®äºé¡¶éƒ¨ï¼Œé‚£ä¹ˆè‡ªç„¶å°±ä¼šä¼˜å…ˆè¢«å–å‡º </span>
                        Map.Entry&lt;Integer, Task&gt; entry = treeMap.pollFirstEntry();
                        <span class="hljs-keyword">if</span> (entry == <span class="hljs-keyword">null</span>) &#123;
                            Thread.currentThread().sleep(<span class="hljs-number">100</span>);
                        &#125; <span class="hljs-keyword">else</span> &#123;
                            entry.getValue().execute();
                        &#125;
                    &#125; <span class="hljs-keyword">catch</span> (Exception e) &#123;
                        e.printStackTrace();
                    &#125;
                &#125;
            &#125;
        &#125;).start();
    &#125;
&#125;</code></pre>

<h5 id="ç»“æœåˆ†æ-8"><a href="#ç»“æœåˆ†æ-8" class="headerlink" title="ç»“æœåˆ†æ"></a>ç»“æœåˆ†æ</h5><pre><code class="hljs apache"><span class="hljs-attribute">add</span> task:<span class="hljs-number">0</span>
<span class="hljs-attribute">add</span> task:<span class="hljs-number">1</span>
<span class="hljs-attribute">add</span> task:<span class="hljs-number">2</span>
<span class="hljs-attribute">add</span> task:<span class="hljs-number">3</span>
<span class="hljs-attribute">add</span> task:<span class="hljs-number">4</span>
<span class="hljs-attribute">execute</span>:name=task<span class="hljs-number">4</span>,addTime=<span class="hljs-number">1598006336903</span>,servTime=<span class="hljs-number">116</span>
<span class="hljs-attribute">execute</span>:name=task<span class="hljs-number">2</span>,addTime=<span class="hljs-number">1598006336902</span>,servTime=<span class="hljs-number">117</span>
<span class="hljs-attribute">execute</span>:name=task<span class="hljs-number">0</span>,addTime=<span class="hljs-number">1598006336902</span>,servTime=<span class="hljs-number">575</span>
<span class="hljs-attribute">execute</span>:name=task<span class="hljs-number">3</span>,addTime=<span class="hljs-number">1598006336902</span>,servTime=<span class="hljs-number">689</span>
<span class="hljs-attribute">execute</span>:name=task<span class="hljs-number">1</span>,addTime=<span class="hljs-number">1598006336902</span>,servTime=<span class="hljs-number">935</span></code></pre>

<p>addä»»åŠ¡æœ‰åºï¼Œç¡®å®æŒ‰ç…§ä»å‰å¾€åé¡ºåºæäº¤çš„ </p>
<p>executeä»»åŠ¡æ— åºï¼ŒæŒ‰servtimeæ’åºï¼Œè¯´æ˜æ‰§è¡Œæ—¶é—´æ®µçš„å¾—åˆ°äº†ä¼˜å…ˆæ‰§è¡Œ </p>
<h5 id="ä¼˜ç¼ºç‚¹-4"><a href="#ä¼˜ç¼ºç‚¹-4" class="headerlink" title="ä¼˜ç¼ºç‚¹"></a>ä¼˜ç¼ºç‚¹</h5><ul>
<li><p>é€‚ç”¨äºä»»åŠ¡æ—¶é—´å·®åˆ«è¾ƒå¤§çš„åœºæ™¯ï¼Œä»ç„¶ä»¥è¿›ç«™ä¸ºä¾‹ï¼Œæ‹¿å‡ºå…¬äº¤å¡çš„ä¼˜å…ˆåˆ·å¡ï¼Œè¿˜æ²¡åŠå¡çš„è®©ä¸€è®©ã€‚ </p>
</li>
<li><p>è§£å†³äº†FCFSæ•´ä½“å¤„ç†æ—¶é—´é•¿çš„é—®é¢˜ï¼Œé™ä½å¹³å‡ç­‰å¾…æ—¶é—´ï¼Œæé«˜äº†ç³»ç»Ÿååé‡ã€‚ </p>
</li>
<li><p>æœªè€ƒè™‘ä½œä¸šçš„ç´§è¿«ç¨‹åº¦ï¼Œå› è€Œä¸èƒ½ä¿è¯ç´§è¿«æ€§ä½œä¸šï¼ˆè¿›ç¨‹ï¼‰çš„åŠæ—¶å¤„ç† </p>
</li>
<li><p>å¯¹é•¿ä½œä¸šçš„ä¸åˆ©ï¼Œå¯èƒ½ç­‰å¾…å¾ˆä¹…è€Œå¾—ä¸åˆ°æ‰§è¡Œ </p>
</li>
<li><p>æ—¶é—´åŸºäºé¢„ä¼°å’Œç”³æŠ¥ï¼Œä¸»è§‚æ€§å› ç´ åœ¨å†…ï¼Œæ— æ³•åšåˆ°100%çš„ç²¾å‡†</p>
</li>
</ul>
<h4 id="æ—¶é—´ç‰‡è½®è½¬ï¼ˆRRï¼‰"><a href="#æ—¶é—´ç‰‡è½®è½¬ï¼ˆRRï¼‰" class="headerlink" title="æ—¶é—´ç‰‡è½®è½¬ï¼ˆRRï¼‰"></a>æ—¶é—´ç‰‡è½®è½¬ï¼ˆRRï¼‰</h4><h5 id="æ¦‚å¿µ-2"><a href="#æ¦‚å¿µ-2" class="headerlink" title="æ¦‚å¿µ"></a>æ¦‚å¿µ</h5><p>æ—¶é—´ç‰‡é€ä¸ªæ‰«æè½®è¯¢ï¼Œè½®åˆ°è°è°æ‰§è¡Œã€‚å¤§å®¶å…¬å¹³è£å†³æ¥è€…æœ‰ä»½ï¼Œè°ä¹Ÿåˆ«æ’é˜Ÿã€‚åƒæ˜¯æ£‹ç‰Œæ¸¸æˆä¸­çš„å‘ç‰Œæ“ä½œï¼Œåšåˆ°äº†æ—¶é—´å’Œæœºä¼šä¸Šçš„å¹³å‡æ€§ã€‚ </p>
<h5 id="å®ç°-9"><a href="#å®ç°-9" class="headerlink" title="å®ç°"></a>å®ç°</h5><p>åŸºäºæ•°ç»„åšä¸ºæ•°æ®æ’æ§½æ–¹å¼å®ç°ã€‚</p>
<pre><code class="hljs java"><span class="hljs-keyword">package</span> com.itheima.schedule;

<span class="hljs-keyword">import</span> java.util.Random;

<span class="hljs-keyword">public</span> <span class="hljs-class"><span class="hljs-keyword">class</span> <span class="hljs-title">RR</span> </span>&#123;
    <span class="hljs-comment">//å®šä¹‰æ•°ç»„ä½œä¸ºæ’æ§½ï¼Œæ¯ä¸ªæ’æ§½ä¸­å¯ä»¥æ”¾å…¥ä»»åŠ¡</span>
    Integer[] integers;

    <span class="hljs-comment">//lengthæ’æ§½çš„ä¸ªæ•° </span>
    <span class="hljs-function"><span class="hljs-keyword">public</span> <span class="hljs-title">RR</span><span class="hljs-params">(<span class="hljs-keyword">int</span> length)</span> </span>&#123;
        integers = <span class="hljs-keyword">new</span> Integer[length];
    &#125;

    <span class="hljs-comment">//å°†ä»»åŠ¡æ”¾å…¥æ’æ§½</span>
    <span class="hljs-function"><span class="hljs-keyword">public</span> <span class="hljs-keyword">void</span> <span class="hljs-title">addTask</span><span class="hljs-params">(<span class="hljs-keyword">int</span> value)</span> </span>&#123;
        <span class="hljs-keyword">int</span> slot = <span class="hljs-number">0</span>;
        <span class="hljs-comment">//ä¸åœæŸ¥æ‰¾ç©ºçš„æ’æ§½</span>
        <span class="hljs-keyword">while</span> (<span class="hljs-keyword">true</span>) &#123;
            <span class="hljs-comment">//å‘ç°ç©ºä½ï¼Œå°†å½“å‰ä»»åŠ¡æ”¾å…¥ </span>
            <span class="hljs-keyword">if</span> (integers[slot] == <span class="hljs-keyword">null</span>) &#123;
                integers[slot] = value;
                System.out.println(String.format(<span class="hljs-string">&quot;â€â€â€â€â€â€â€â€â€â€â€â€â€â€â€â€â€â€â€â€â€â€â€â€â€&gt;add task index=%s,value=%s&quot;</span>, slot, value));
                <span class="hljs-keyword">break</span>;
            &#125;
            <span class="hljs-comment">//å¦‚æœå½“å‰ä½ç½®æœ‰ä»»åŠ¡å ç”¨ï¼Œçœ‹ä¸‹ä¸€ä¸ªä½ç½®</span>
            slot++;
            <span class="hljs-comment">//å¦‚æœæ’æ§½éå†å®Œè¿˜æ˜¯æ²¡æœ‰ç©ºä½ç½®ï¼Œé‚£ä¹ˆä»å¤´å¼€å§‹å†æ‰¾ï¼Œç»§ç»­ä¸‹ä¸€ä¸ªè½®å›</span>
            <span class="hljs-keyword">if</span> (slot == integers.length) &#123;
                slot = <span class="hljs-number">0</span>;
            &#125;
        &#125;
    &#125;

    <span class="hljs-comment">//æ‰§è¡Œä»»åŠ¡ã€‚è½®è¯¢çš„ç­–ç•¥å°±åœ¨è¿™é‡Œ </span>
    <span class="hljs-function"><span class="hljs-keyword">public</span> <span class="hljs-keyword">void</span> <span class="hljs-title">execute</span><span class="hljs-params">()</span> </span>&#123;
        <span class="hljs-comment">//å¼€å¯ä¸€ä¸ªçº¿ç¨‹å¤„ç†ä»»åŠ¡ã€‚åœ¨ç°å®ä¸­å¯èƒ½æœ‰å¤šä¸ªæ¶ˆè´¹è€…æ¥å¤„ç† </span>
        <span class="hljs-keyword">new</span> Thread(<span class="hljs-keyword">new</span> Runnable() &#123;
            <span class="hljs-meta">@Override</span>
            <span class="hljs-function"><span class="hljs-keyword">public</span> <span class="hljs-keyword">void</span> <span class="hljs-title">run</span><span class="hljs-params">()</span> </span>&#123;
                <span class="hljs-keyword">int</span> index = <span class="hljs-number">0</span>;
                <span class="hljs-keyword">while</span> (<span class="hljs-keyword">true</span>) &#123;
                    <span class="hljs-comment">//æŒ‡é’ˆè½®è¯¢ï¼Œå¦‚æœåˆ°è¾¾å°¾éƒ¨ï¼Œä¸‹ä¸€æ­¥é‡æ–°è½¬å‘å¼€å¤´ </span>
                    <span class="hljs-comment">// æ•°æ®ç‰©ç†ç»“æ„æ˜¯ä¸€ä¸ªæ•°ç»„ï¼Œé€»è¾‘ä¸Šæ˜¯ä¸€ä¸ªç¯ </span>
                    <span class="hljs-keyword">if</span> (index == integers.length) &#123;
                        index = <span class="hljs-number">0</span>;
                    &#125;
                    <span class="hljs-comment">//å¦‚æœå½“å‰ä½ç½®æ²¡æœ‰ä»»åŠ¡ï¼Œè½®è¯¢åˆ°ä¸‹ä¸€ä¸ªæ’æ§½</span>
                    <span class="hljs-keyword">if</span> (integers[index] == <span class="hljs-keyword">null</span>) &#123;
                        index++;
                        <span class="hljs-keyword">continue</span>;
                    &#125; <span class="hljs-keyword">else</span> &#123;<span class="hljs-comment">//éšæœºç­‰å¾…ï¼Œè¡¨ç¤ºæ¨¡æ‹Ÿå½“å‰ä»»åŠ¡æœ‰ä¸€ä¸ªæ‰§è¡Œæ—¶é—´</span>
                        <span class="hljs-keyword">try</span> &#123;
                            Thread.currentThread().sleep(<span class="hljs-keyword">new</span> Random().nextInt(<span class="hljs-number">1000</span>));
                        &#125; <span class="hljs-keyword">catch</span> (
                                InterruptedException e) &#123;
                            e.printStackTrace();
                        &#125;<span class="hljs-comment">//æ¨¡æ‹Ÿä»»åŠ¡æ‰§è¡Œçš„å†…å®¹ï¼Œä¹Ÿå°±æ˜¯æ‰“å°ä¸€ä¸‹å½“å‰æ’æ§½å’Œé‡Œé¢çš„å€¼ </span>
                        System.out.println(String.format(<span class="hljs-string">&quot;execute index=%s,value=%s&quot;</span>, index, integers[index]));
                        <span class="hljs-comment">//æ‰§è¡Œå®Œï¼Œå°†å½“å‰æ’æ§½æ¸…ç©ºï¼Œè…¾å‡ºä½ç½®æ¥ç»™åç»­ä»»åŠ¡ä½¿ç”¨ </span>
                        integers[index] = <span class="hljs-keyword">null</span>;
                    &#125;
                &#125;
            &#125;
        &#125;).start();
    &#125;

    <span class="hljs-function"><span class="hljs-keyword">public</span> <span class="hljs-keyword">static</span> <span class="hljs-keyword">void</span> <span class="hljs-title">main</span><span class="hljs-params">(String[] args)</span> </span>&#123;
        <span class="hljs-comment">//æµ‹è¯•å¼€å§‹ï¼Œå®šä¹‰3ä¸ªæ’æ§½ </span>
        RR rr = <span class="hljs-keyword">new</span> RR(<span class="hljs-number">3</span>);
        <span class="hljs-comment">//å”¤èµ·æ‰§è¡Œè€…çº¿ç¨‹ï¼Œå¼€å§‹è½®è¯¢</span>
        rr.execute();
        <span class="hljs-comment">//æ”¾ç½®10ä¸ªä»»åŠ¡</span>
        <span class="hljs-keyword">for</span> (<span class="hljs-keyword">int</span> i = <span class="hljs-number">0</span>; i &lt; <span class="hljs-number">10</span>; i++) &#123;
            rr.addTask(i);
        &#125;
    &#125;
&#125;</code></pre>

<h5 id="ç»“æœåˆ†æ-9"><a href="#ç»“æœåˆ†æ-9" class="headerlink" title="ç»“æœåˆ†æ"></a>ç»“æœåˆ†æ</h5><pre><code class="hljs smali">â€â€â€â€â€â€â€â€â€â€â€â€â€â€â€â€â€â€â€â€â€â€â€â€â€&gt;add task index=0,value=0
â€â€â€â€â€â€â€â€â€â€â€â€â€â€â€â€â€â€â€â€â€â€â€â€â€&gt;add task index=1,value=1
â€â€â€â€â€â€â€â€â€â€â€â€â€â€â€â€â€â€â€â€â€â€â€â€â€&gt;add task index=2,value=2
execute index=0,value=0
â€â€â€â€â€â€â€â€â€â€â€â€â€â€â€â€â€â€â€â€â€â€â€â€â€&gt;add task index=0,value=3
execute index=1,value=1
â€â€â€â€â€â€â€â€â€â€â€â€â€â€â€â€â€â€â€â€â€â€â€â€â€&gt;add task index=1,value=4
execute index=2,value=2
â€â€â€â€â€â€â€â€â€â€â€â€â€â€â€â€â€â€â€â€â€â€â€â€â€&gt;add task index=2,value=5
execute index=0,value=3
execute index=1,value=4
â€â€â€â€â€â€â€â€â€â€â€â€â€â€â€â€â€â€â€â€â€â€â€â€â€&gt;add task index=1,value=6
â€â€â€â€â€â€â€â€â€â€â€â€â€â€â€â€â€â€â€â€â€â€â€â€â€&gt;add task index=0,value=7
execute index=2,value=5
â€â€â€â€â€â€â€â€â€â€â€â€â€â€â€â€â€â€â€â€â€â€â€â€â€&gt;add task index=2,value=8
execute index=0,value=7
execute index=1,value=6
â€â€â€â€â€â€â€â€â€â€â€â€â€â€â€â€â€â€â€â€â€â€â€â€â€&gt;add task index=1,value=9
execute index=2,value=8
execute index=1,value=9</code></pre>

<p>addä»»åŠ¡indexæ— åºï¼Œvalueæœ‰åºï¼Œè¯´æ˜æ˜¯æŒ‰é¡ºåºæäº¤çš„ï¼Œä½†æ˜¯æ’æ§½æ— åºï¼Œå“ªé‡Œæœ‰ç©ºæ”¾å“ªé‡Œ </p>
<p>executeæ‰§è¡Œindexæœ‰åºvalueæ— åºï¼Œè¯´æ˜ä»»åŠ¡æ˜¯è½®è¯¢æ‰§è¡Œçš„ï¼Œæ¯ä¸ªæ’æ§½é‡Œçš„ä»»åŠ¡ä¸ä¸€å®šæ˜¯è° </p>
<h5 id="ä¼˜ç¼ºç‚¹-5"><a href="#ä¼˜ç¼ºç‚¹-5" class="headerlink" title="ä¼˜ç¼ºç‚¹"></a>ä¼˜ç¼ºç‚¹</h5><p>åšåˆ°äº†æœºä¼šçš„ç›¸å¯¹å¹³å‡ï¼Œä¸ä¼šå› ä¸ºæŸä¸ªä»»åŠ¡æ‰§è¡Œæ—¶é—´è¶…é•¿è€Œæ°¸è¿œå¾—ä¸åˆ°æ‰§è¡Œ </p>
<p>ç¼ºä¹ä»»åŠ¡ä¸»æ¬¡çš„å¤„ç†ã€‚é‡è¦çš„ä»»åŠ¡æ— æ³•å¾—åˆ°ä¼˜å…ˆæ‰§è¡Œï¼Œå¿…é¡»ç­‰åˆ°æ—¶é—´ç‰‡è½®åˆ°è‡ªå·±ï¼Œç€æ€¥ä¹Ÿæ²¡ç”¨</p>
<h4 id="ä¼˜å…ˆçº§è°ƒåº¦ï¼ˆHPFï¼‰"><a href="#ä¼˜å…ˆçº§è°ƒåº¦ï¼ˆHPFï¼‰" class="headerlink" title="ä¼˜å…ˆçº§è°ƒåº¦ï¼ˆHPFï¼‰"></a>ä¼˜å…ˆçº§è°ƒåº¦ï¼ˆHPFï¼‰</h4><h5 id="æ¦‚è¿°-7"><a href="#æ¦‚è¿°-7" class="headerlink" title="æ¦‚è¿°"></a>æ¦‚è¿°</h5><p>è¿›ç¨‹è°ƒåº¦æ¯æ¬¡å°†å¤„ç†æœºåˆ†é…ç»™å…·æœ‰æœ€é«˜ä¼˜å…ˆçº§çš„å°±ç»ªè¿›ç¨‹ã€‚æœ€é«˜ä¼˜å…ˆçº§ç®—æ³•å¯ä¸ä¸åŒçš„CPUæ–¹å¼ç»“åˆå½¢æˆå¯æŠ¢å å¼æœ€é«˜ä¼˜å…ˆçº§ç®—æ³•å’Œä¸å¯æŠ¢å å¼æœ€é«˜ä¼˜å…ˆçº§ç®—æ³•ã€‚ </p>
<h5 id="å®ç°-10"><a href="#å®ç°-10" class="headerlink" title="å®ç°"></a>å®ç°</h5><p>åœ¨Taskç±»ä¸­æ–°å¢ä¸€ä¸ªå±æ€§levelä½œä¸ºä¼˜å…ˆçº§æ ‡è¯†</p>
<pre><code class="hljs java"><span class="hljs-keyword">package</span> com.itheima.schedule;

<span class="hljs-comment">/*** ä»»åŠ¡ç±» */</span>
<span class="hljs-keyword">public</span> <span class="hljs-class"><span class="hljs-keyword">class</span> <span class="hljs-title">Task</span> </span>&#123;
    <span class="hljs-comment">//ä»»åŠ¡åç§°</span>
    <span class="hljs-keyword">private</span> String name;
    <span class="hljs-comment">//ä»»åŠ¡æäº¤çš„æ—¶é—´</span>
    <span class="hljs-keyword">private</span> Long addTime;
    <span class="hljs-comment">//ä»»åŠ¡çš„æ‰§è¡Œæ—¶é—´é•¿çŸ­</span>
    <span class="hljs-keyword">private</span> <span class="hljs-keyword">int</span> servTime;
    <span class="hljs-comment">//ä»»åŠ¡ä¼˜å…ˆçº§</span>
     <span class="hljs-keyword">private</span> <span class="hljs-keyword">int</span> level;

    <span class="hljs-function"><span class="hljs-keyword">public</span> <span class="hljs-title">Task</span><span class="hljs-params">(String name, <span class="hljs-keyword">int</span> servTime)</span> </span>&#123;
        <span class="hljs-keyword">this</span>.name = name;
        <span class="hljs-keyword">this</span>.servTime = servTime;
        <span class="hljs-keyword">this</span>.addTime = System.currentTimeMillis();
    &#125;

    <span class="hljs-function"><span class="hljs-keyword">public</span> <span class="hljs-title">Task</span><span class="hljs-params">(String name, <span class="hljs-keyword">int</span> servTime,<span class="hljs-keyword">int</span> level)</span> </span>&#123;
        <span class="hljs-keyword">this</span>.name = name;
        <span class="hljs-keyword">this</span>.servTime = servTime;
        <span class="hljs-keyword">this</span>.addTime = System.currentTimeMillis();
        <span class="hljs-keyword">this</span>.level = level;
    &#125;

    <span class="hljs-function"><span class="hljs-keyword">public</span> <span class="hljs-keyword">void</span> <span class="hljs-title">execute</span><span class="hljs-params">()</span> </span>&#123;
        <span class="hljs-keyword">try</span> &#123;
            <span class="hljs-comment">// ï¼é‡ç‚¹ï¼šæ‰§è¡Œæ—¶ç¡çœ ï¼Œè¡¨ç¤ºè¯¥ä»»åŠ¡è€—æ—¶servTimeæ¯«ç§’</span>
            Thread.currentThread().sleep(servTime);
        &#125; <span class="hljs-keyword">catch</span> (InterruptedException e) &#123;
            e.printStackTrace();
        &#125;
        System.out.println(String.format(<span class="hljs-string">&quot;execute:name=%s,addTime=%s,servTime=%s&quot;</span>, name, addTime, servTime));
    &#125;
&#125;</code></pre>

<p>ä¾ç„¶ä½¿ç”¨TreeMapå®ç°æ’åºï¼Œæ³¨æ„çš„æ˜¯ï¼Œkeyè¦å–ä¼˜å…ˆçº§</p>
<pre><code class="hljs java"><span class="hljs-keyword">package</span> com.itheima.schedule;

<span class="hljs-keyword">import</span> java.util.Map;
<span class="hljs-keyword">import</span> java.util.Random;
<span class="hljs-keyword">import</span> java.util.TreeMap;

<span class="hljs-keyword">public</span> <span class="hljs-class"><span class="hljs-keyword">class</span> <span class="hljs-title">HPF</span> </span>&#123;
    <span class="hljs-function"><span class="hljs-keyword">public</span> <span class="hljs-keyword">static</span> <span class="hljs-keyword">void</span> <span class="hljs-title">main</span><span class="hljs-params">(String[] args)</span> <span class="hljs-keyword">throws</span> InterruptedException </span>&#123;
        <span class="hljs-comment">//æœ‰åºMapï¼Œå°†æœåŠ¡ä¼˜å…ˆçº§ä½œä¸ºkeyæ’åº </span>
        <span class="hljs-keyword">final</span> TreeMap&lt;Integer, Task&gt; treeMap = <span class="hljs-keyword">new</span> TreeMap();
        <span class="hljs-comment">//å‘é˜Ÿåˆ—ä¸­æ”¾å…¥5ä¸ªä»»åŠ¡ </span>
        <span class="hljs-keyword">for</span> (<span class="hljs-keyword">int</span> i = <span class="hljs-number">0</span>; i &lt; <span class="hljs-number">5</span>; i++) &#123;
            System.out.println(<span class="hljs-string">&quot;add task:&quot;</span> + i);
            <span class="hljs-keyword">int</span> servTime = <span class="hljs-keyword">new</span> Random().nextInt(<span class="hljs-number">1000</span>);
            <span class="hljs-comment">//æ³¨æ„æ”¾å…¥çš„keyï¼Œæ˜¯ä¼˜å…ˆçº§ï¼Œè¿™é‡Œç”¨iæ ‡è¯† </span>
            treeMap.put(i, <span class="hljs-keyword">new</span> Task(<span class="hljs-string">&quot;task&quot;</span> + i, servTime, i));
        &#125;
        <span class="hljs-comment">//æœåŠ¡çº¿ç¨‹ï¼Œä»»åŠ¡ç”±è¯¥çº¿ç¨‹è·å–å’Œæ‰§è¡Œ </span>
        <span class="hljs-keyword">new</span> Thread(<span class="hljs-keyword">new</span> Runnable() &#123;
            <span class="hljs-meta">@Override</span>
            <span class="hljs-function"><span class="hljs-keyword">public</span> <span class="hljs-keyword">void</span> <span class="hljs-title">run</span><span class="hljs-params">()</span> </span>&#123;
                <span class="hljs-keyword">while</span> (<span class="hljs-keyword">true</span>) &#123;
                    <span class="hljs-keyword">try</span> &#123;
                        <span class="hljs-comment">//æœ‰åºMapä¸­ï¼Œä¼˜å…ˆçº§æœ€é«˜çš„ï¼Œåœ¨åº•éƒ¨éƒ¨ï¼Œé‚£ä¹ˆè‡ªç„¶å°±ä¼šä¼˜å…ˆè¢«å–å‡º </span>
                        Map.Entry&lt;Integer, Task&gt; entry = treeMap.pollLastEntry();
                        <span class="hljs-keyword">if</span> (entry == <span class="hljs-keyword">null</span>) &#123;
                            Thread.currentThread().sleep(<span class="hljs-number">100</span>);
                        &#125; <span class="hljs-keyword">else</span> &#123;
                            entry.getValue().execute();
                        &#125;
                    &#125; <span class="hljs-keyword">catch</span> (Exception e) &#123;
                        e.printStackTrace();
                    &#125;
                &#125;
            &#125;
        &#125;).start();
    &#125;
&#125;</code></pre>

<h5 id="ç»“æœåˆ†æ-10"><a href="#ç»“æœåˆ†æ-10" class="headerlink" title="ç»“æœåˆ†æ"></a>ç»“æœåˆ†æ</h5><pre><code class="hljs apache"><span class="hljs-attribute">add</span> task:<span class="hljs-number">0</span>
<span class="hljs-attribute">add</span> task:<span class="hljs-number">1</span>
<span class="hljs-attribute">add</span> task:<span class="hljs-number">2</span>
<span class="hljs-attribute">add</span> task:<span class="hljs-number">3</span>
<span class="hljs-attribute">add</span> task:<span class="hljs-number">4</span>
<span class="hljs-attribute">execute</span>:name=task<span class="hljs-number">4</span>,addTime=<span class="hljs-number">1598006945022</span>,servTime=<span class="hljs-number">591</span>
<span class="hljs-attribute">execute</span>:name=task<span class="hljs-number">3</span>,addTime=<span class="hljs-number">1598006945022</span>,servTime=<span class="hljs-number">974</span>
<span class="hljs-attribute">execute</span>:name=task<span class="hljs-number">2</span>,addTime=<span class="hljs-number">1598006945022</span>,servTime=<span class="hljs-number">52</span>
<span class="hljs-attribute">execute</span>:name=task<span class="hljs-number">1</span>,addTime=<span class="hljs-number">1598006945022</span>,servTime=<span class="hljs-number">281</span>
<span class="hljs-attribute">execute</span>:name=task<span class="hljs-number">0</span>,addTime=<span class="hljs-number">1598006945022</span>,servTime=<span class="hljs-number">609</span></code></pre>

<p>æŒ‰0-4é¡ºåºåŠ å…¥task </p>
<p>æ‰§è¡Œæ—¶ï¼ŒæŒ‰4-0ï¼Œä¼˜å…ˆçº§é«˜çš„å…ˆå¾—åˆ°æ‰§è¡Œï¼Œè€Œä¸æœåŠ¡æ—¶é—´ï¼ŒåŠ å…¥çš„æ—¶é—´æ— å…³ </p>
<h4 id="åº”ç”¨æ¡ˆä¾‹-1"><a href="#åº”ç”¨æ¡ˆä¾‹-1" class="headerlink" title="åº”ç”¨æ¡ˆä¾‹"></a>åº”ç”¨æ¡ˆä¾‹</h4><p>CPUèµ„æºè°ƒåº¦ </p>
<p>äº‘è®¡ç®—èµ„æºè°ƒåº¦ </p>
<p>å®¹å™¨åŒ–Dockerç¼–æ’ä¸è°ƒåº¦ </p>
<h3 id="å®šæ—¶ç®—æ³•ä¸åº”ç”¨"><a href="#å®šæ—¶ç®—æ³•ä¸åº”ç”¨" class="headerlink" title="å®šæ—¶ç®—æ³•ä¸åº”ç”¨"></a>å®šæ—¶ç®—æ³•ä¸åº”ç”¨</h3><p>ç³»ç»Ÿæˆ–è€…é¡¹ç›®ä¸­éš¾å…ä¼šé‡åˆ°å„ç§éœ€è¦è‡ªåŠ¨å»æ‰§è¡Œçš„ä»»åŠ¡ï¼Œå®ç°è¿™äº›ä»»åŠ¡çš„æ‰‹æ®µä¹Ÿå¤šç§å¤šæ ·ï¼Œå¦‚æ“ä½œç³»ç»Ÿçš„crontabï¼Œspringæ¡†æ¶çš„quartzï¼Œjavaçš„Timerå’ŒScheduledThreadPooléƒ½æ˜¯å®šæ—¶ä»»åŠ¡ä¸­çš„å…¸å‹æ‰‹æ®µã€‚ </p>
<h4 id="æœ€å°å †"><a href="#æœ€å°å †" class="headerlink" title="æœ€å°å †"></a>æœ€å°å †</h4><h5 id="æ¦‚è¿°-8"><a href="#æ¦‚è¿°-8" class="headerlink" title="æ¦‚è¿°"></a>æ¦‚è¿°</h5><p>Timeræ˜¯javaä¸­æœ€å…¸å‹çš„åŸºäºä¼˜å…ˆçº§é˜Ÿåˆ—+æœ€å°å †å®ç°çš„å®šæ—¶å™¨ï¼Œå†…éƒ¨ç»´æŠ¤ä¸€ä¸ªå­˜æ”¾å®šæ—¶ä»»åŠ¡çš„ä¼˜å…ˆçº§é˜Ÿåˆ—ï¼Œè¯¥ä¼˜å…ˆçº§é˜Ÿåˆ—ä½¿ç”¨äº†æœ€å°å †æ’åºã€‚å½“æˆ‘ä»¬è°ƒç”¨scheduleæ–¹æ³•çš„æ—¶å€™ï¼Œä¸€ä¸ªæ–°çš„ä»»åŠ¡è¢«åŠ å…¥queueï¼Œå †é‡æ’ï¼Œå§‹ç»ˆä¿æŒå †é¡¶æ˜¯æ‰§è¡Œæ—¶é—´æœ€å°ï¼ˆå³æœ€è¿‘é©¬ä¸Šè¦æ‰§è¡Œï¼‰çš„ã€‚åŒæ—¶ï¼Œå†…éƒ¨ç›¸å½“äºèµ·äº†ä¸€ä¸ªçº¿ç¨‹ä¸æ–­æ‰«æé˜Ÿåˆ—ï¼Œä»é˜Ÿåˆ—ä¸­ä¾æ¬¡è·å–å †é¡¶å…ƒç´ æ‰§è¡Œï¼Œä»»åŠ¡å¾—åˆ°è°ƒåº¦ã€‚ </p>
<p>ä¸‹é¢ä»¥Timerä¸ºä¾‹ï¼Œä»‹ç»ä¼˜å…ˆçº§é˜Ÿåˆ—+æœ€å°å †ç®—æ³•çš„å®ç°åŸç†ï¼š </p>
<h5 id="æ¡ˆä¾‹"><a href="#æ¡ˆä¾‹" class="headerlink" title="æ¡ˆä¾‹"></a>æ¡ˆä¾‹</h5><pre><code class="hljs java"><span class="hljs-keyword">package</span> com.itheima.schedule;

<span class="hljs-keyword">import</span> java.util.Timer;
<span class="hljs-keyword">import</span> java.util.TimerTask;

<span class="hljs-class"><span class="hljs-keyword">class</span> <span class="hljs-title">Task</span> <span class="hljs-keyword">extends</span> <span class="hljs-title">TimerTask</span> </span>&#123;
    <span class="hljs-meta">@Override</span>
    <span class="hljs-function"><span class="hljs-keyword">public</span> <span class="hljs-keyword">void</span> <span class="hljs-title">run</span><span class="hljs-params">()</span> </span>&#123;
        System.out.println(<span class="hljs-string">&quot;running...&quot;</span>);
    &#125;
&#125;

<span class="hljs-keyword">public</span> <span class="hljs-class"><span class="hljs-keyword">class</span> <span class="hljs-title">TimerDemo</span> </span>&#123;
    <span class="hljs-function"><span class="hljs-keyword">public</span> <span class="hljs-keyword">static</span> <span class="hljs-keyword">void</span> <span class="hljs-title">main</span><span class="hljs-params">(String[] args)</span> </span>&#123;
        Timer t = <span class="hljs-keyword">new</span> Timer();
        <span class="hljs-comment">//åœ¨1ç§’åæ‰§è¡Œ,ä»¥åæ¯2ç§’è·‘ä¸€æ¬¡ </span>
        t.schedule(<span class="hljs-keyword">new</span> Task(), <span class="hljs-number">1000</span>, <span class="hljs-number">2000</span>);
    &#125;
&#125;</code></pre>

<h5 id="æºç åˆ†æ"><a href="#æºç åˆ†æ" class="headerlink" title="æºç åˆ†æ"></a>æºç åˆ†æ</h5><p>æ–°åŠ ä»»åŠ¡æ—¶ï¼Œt.scheduleæ–¹æ³•ä¼šaddåˆ°é˜Ÿåˆ— </p>
<pre><code class="hljs java"><span class="hljs-function"><span class="hljs-keyword">void</span> <span class="hljs-title">add</span><span class="hljs-params">(TimerTask task)</span> </span>&#123;
    <span class="hljs-comment">// Grow backing store if necessary</span>
    <span class="hljs-keyword">if</span> (size + <span class="hljs-number">1</span> == queue.length) 
        queue = Arrays.copyOf(queue, <span class="hljs-number">2</span> * queue.length);
    queue[++size] = task;
    fixUp(size);
&#125;</code></pre>

<p>addå®ç°äº†å®¹é‡ç»´æŠ¤ï¼Œä¸è¶³æ—¶æ‰©å®¹ï¼ŒåŒæ—¶å°†æ–°ä»»åŠ¡è¿½åŠ åˆ°é˜Ÿåˆ—é˜Ÿå°¾ï¼Œè§¦å‘å †æ’åºï¼Œå§‹ç»ˆä¿æŒå †é¡¶å…ƒç´ æœ€å°</p>
<pre><code class="hljs java"><span class="hljs-comment">//æœ€å°å †æ’åº</span>
<span class="hljs-function"><span class="hljs-keyword">private</span> <span class="hljs-keyword">void</span> <span class="hljs-title">fixUp</span><span class="hljs-params">(<span class="hljs-keyword">int</span> k)</span> </span>&#123;
    <span class="hljs-keyword">while</span> (k &gt; <span class="hljs-number">1</span>) &#123;
        <span class="hljs-comment">//kæŒ‡é’ˆæŒ‡å‘å½“å‰æ–°åŠ å…¥çš„èŠ‚ç‚¹ï¼Œä¹Ÿå°±æ˜¯é˜Ÿåˆ—çš„æœ«å°¾èŠ‚ç‚¹ï¼Œjä¸ºå…¶çˆ¶èŠ‚ç‚¹ </span>
        <span class="hljs-keyword">int</span> j = k &gt;&gt; <span class="hljs-number">1</span>;
        <span class="hljs-comment">//å¦‚æœæ–°åŠ å…¥çš„æ‰§è¡Œæ—¶é—´æ¯”çˆ¶èŠ‚ç‚¹æ™šï¼Œé‚£ä¸éœ€è¦åŠ¨</span>
        <span class="hljs-keyword">if</span> (queue[j].nextExecutionTime &lt;= queue[k].nextExecutionTime)
            <span class="hljs-keyword">break</span>;
        <span class="hljs-comment">//å¦‚æœå¤§äºå…¶çˆ¶èŠ‚ç‚¹ï¼Œçˆ¶å­äº¤æ¢ </span>
        TimerTask tmp = queue[j];
        queue[j] = queue[k];
        queue[k] = tmp;
        <span class="hljs-comment">//äº¤æ¢åï¼Œå½“å‰æŒ‡é’ˆç»§ç»­æŒ‡å‘æ–°åŠ å…¥çš„èŠ‚ç‚¹ï¼Œç»§ç»­å¾ªç¯ï¼ŒçŸ¥é“å †é‡æ’åˆæ ¼ </span>
        k = j;
    &#125;
&#125;</code></pre>

<p>çº¿ç¨‹è°ƒåº¦ä¸­çš„runï¼Œä¸»è¦è°ƒç”¨å†…éƒ¨mainLoop()æ–¹æ³•ï¼Œä½¿ç”¨whileå¾ªç¯</p>
<pre><code class="hljs java"><span class="hljs-function"><span class="hljs-keyword">private</span> <span class="hljs-keyword">void</span> <span class="hljs-title">mainLoop</span><span class="hljs-params">()</span> </span>&#123;
    <span class="hljs-keyword">while</span> (<span class="hljs-keyword">true</span>) &#123;
        <span class="hljs-keyword">try</span> &#123;
            TimerTask task;
            <span class="hljs-keyword">boolean</span> taskFired;
            <span class="hljs-keyword">synchronized</span> (queue) &#123;
                <span class="hljs-comment">//... </span>
                <span class="hljs-comment">// Queue nonempty; look at first evt and do the right thing long currentTime, </span>
                executionTime;
                task = queue.getMin();
                <span class="hljs-keyword">synchronized</span> (task.lock) &#123;
                    <span class="hljs-comment">//... </span>
                    <span class="hljs-comment">// å½“å‰æ—¶é—´ </span>
                    currentTime = System.currentTimeMillis();
                    <span class="hljs-comment">//è¦æ‰§è¡Œçš„æ—¶é—´ </span>
                    executionTime = task.nextExecutionTime;
                    <span class="hljs-comment">//åˆ¤æ–­æ˜¯å¦åˆ°äº†æ‰§è¡Œæ—¶é—´</span>
                    <span class="hljs-keyword">if</span> (taskFired = (executionTime &lt;= currentTime)) &#123;
                        <span class="hljs-comment">//åˆ¤æ–­ä¸‹ä¸€æ¬¡æ‰§è¡Œæ—¶é—´ï¼Œå•æ¬¡çš„æ‰§è¡Œå®Œç§»é™¤ </span>
                        <span class="hljs-comment">// å¾ªç¯çš„ä¿®æ”¹ä¸‹æ¬¡æ‰§è¡Œæ—¶é—´ </span>
                        <span class="hljs-keyword">if</span> (task.period == <span class="hljs-number">0</span>) &#123;
                            <span class="hljs-comment">// Nonâ€repeating, remove </span>
                            queue.removeMin();
                            task.state = TimerTask.EXECUTED;
                        &#125; <span class="hljs-keyword">else</span> &#123;
                            <span class="hljs-comment">// Repeating task, reschedule </span>
                            <span class="hljs-comment">// ä¸‹æ¬¡æ—¶é—´çš„è®¡ç®—æœ‰ä¸¤ç§ç­–ç•¥ </span>
                            <span class="hljs-comment">// 1.periodæ˜¯è´Ÿæ•°,é‚£ä¸‹ä¸€æ¬¡çš„æ‰§è¡Œæ—¶é—´å°±æ˜¯å½“å‰æ—¶é—´â€period </span>
                            <span class="hljs-comment">// 2.periodæ˜¯æ­£æ•°,é‚£ä¸‹ä¸€æ¬¡å°±æ˜¯è¯¥ä»»åŠ¡æœ¬æ¬¡çš„æ‰§è¡Œæ—¶é—´+period </span>
                            <span class="hljs-comment">// æ³¨æ„ï¼è¿™ä¸¤ç§ç­–ç•¥å¤§ä¸ç›¸åŒã€‚å› ä¸ºTimeræ˜¯å•çº¿ç¨‹çš„ </span>
                            <span class="hljs-comment">// å¦‚æœæ˜¯1ï¼Œé‚£ä¹ˆcurrentTimeæ˜¯å½“å‰æ—¶é—´ï¼Œå°±å—ä»»åŠ¡æ‰§è¡Œé•¿çŸ­å½±å“ </span>
                            <span class="hljs-comment">// å¦‚æœæ˜¯2ï¼Œé‚£ä¹ˆexecutionTimeæ˜¯ç»å¯¹æ—¶é—´æˆ³ï¼Œä¸ä»»åŠ¡é•¿çŸ­æ— å…³ </span>
                            queue.rescheduleMin(task.period &lt; <span class="hljs-number">0</span> ? currentTime â€ task.period :
                            executionTime + task.period);
                        &#125;
                    &#125;
                &#125;
                <span class="hljs-comment">//ä¸åˆ°æ‰§è¡Œæ—¶é—´ï¼Œç­‰å¾… </span>
                <span class="hljs-keyword">if</span> (!taskFired)
                    <span class="hljs-comment">// Task hasn&#x27;t yet fired; wait </span>
                    queue.wait(executionTime - currentTime);
            &#125;
            <span class="hljs-comment">//åˆ°è¾¾æ‰§è¡Œæ—¶é—´ï¼Œrunï¼</span>
            <span class="hljs-keyword">if</span> (taskFired)
                <span class="hljs-comment">// Task fired; run it, holding no locks </span>
                task.run();
        &#125; <span class="hljs-keyword">catch</span> (InterruptedException e) &#123;
        &#125;
    &#125;
&#125;</code></pre>

<h5 id="åº”ç”¨-4"><a href="#åº”ç”¨-4" class="headerlink" title="åº”ç”¨"></a>åº”ç”¨</h5><p>æœ¬èŠ‚ä½¿ç”¨Timerä¸ºäº†ä»‹ç»ç®—æ³•åŸç†ï¼Œä½†æ˜¯Timerå·²è¿‡æ—¶ï¼Œå®é™…åº”ç”¨ä¸­æ¨èä½¿ç”¨ScheduledThreadPoolExecutorï¼ˆåŒæ ·å†…éƒ¨ä½¿ç”¨DelayedWorkQueueå’Œæœ€å°å †æ’åºï¼‰</p>
<p>Timeræ˜¯å•çº¿ç¨‹ï¼Œä¸€æ—¦ä¸€ä¸ªå¤±è´¥æˆ–å‡ºç°å¼‚å¸¸ï¼Œå°†æ‰“æ–­å…¨éƒ¨ä»»åŠ¡é˜Ÿåˆ—ï¼Œçº¿ç¨‹æ± ä¸ä¼š</p>
<p>Timeråœ¨jdk1.3+ï¼Œè€Œçº¿ç¨‹æ± éœ€è¦jdk1.5+ </p>
<h4 id="æ—¶é—´è½®"><a href="#æ—¶é—´è½®" class="headerlink" title="æ—¶é—´è½®"></a>æ—¶é—´è½®</h4><h5 id="æ¦‚è¿°-9"><a href="#æ¦‚è¿°-9" class="headerlink" title="æ¦‚è¿°"></a>æ¦‚è¿°</h5><p>æ—¶é—´è½®æ˜¯ä¸€ç§æ›´ä¸ºå¸¸è§çš„å®šæ—¶è°ƒåº¦ç®—æ³•ï¼Œå„ç§æ“ä½œç³»ç»Ÿçš„å®šæ—¶ä»»åŠ¡è°ƒåº¦ï¼Œlinux crontabï¼ŒåŸºäºjavaçš„é€šä¿¡æ¡†æ¶Nettyç­‰ã€‚å…¶çµæ„Ÿæ¥æºäºæˆ‘ä»¬ç”Ÿæ´»ä¸­çš„æ—¶é’Ÿã€‚ </p>
<p>è½®ç›˜å®é™…ä¸Šæ˜¯ä¸€ä¸ªå¤´å°¾ç›¸æ¥çš„ç¯çŠ¶æ•°ç»„ï¼Œæ•°ç»„çš„ä¸ªæ•°å³æ˜¯æ’æ§½æ•°ï¼Œæ¯ä¸ªæ’æ§½ä¸­å¯ä»¥æ”¾ç½®ä»»åŠ¡ã€‚ </p>
<p>ä»¥1å¤©ä¸ºä¾‹ï¼Œå°†ä»»åŠ¡çš„æ‰§è¡Œæ—¶é—´%12ï¼Œæ ¹æ®å¾—åˆ°çš„æ•°å€¼ï¼Œæ”¾ç½®åœ¨æ—¶é—´è½®ä¸Šï¼Œå°æ—¶æŒ‡é’ˆæ²¿ç€è½®ç›˜æ‰«æï¼Œæ‰«åˆ°çš„ç‚¹å–å‡ºä»»åŠ¡æ‰§è¡Œï¼š </p>
<img src="/blog/2020/08/16/%E6%95%B0%E6%8D%AE%E7%BB%93%E6%9E%84-%E5%B8%B8%E8%A7%81%E7%AE%97%E6%B3%95%E4%B8%8E%E5%BA%94%E7%94%A8/pic5.png" srcset="/blog/img/loading.gif" class>

<p>åŒæ—¶åœ¨æ¯ä¸ªæ§½ä¸Šè®¾ç½®ä¸€ä¸ªé˜Ÿåˆ—ï¼Œé˜Ÿåˆ—å¯ä»¥æ— é™è¿½åŠ ï¼Œè§£å†³æ—¶é—´ç‚¹å†²çªé—®é¢˜ï¼ˆç±»ä¼¼HashMapç»“æ„ï¼‰</p>
<img src="/blog/2020/08/16/%E6%95%B0%E6%8D%AE%E7%BB%93%E6%9E%84-%E5%B8%B8%E8%A7%81%E7%AE%97%E6%B3%95%E4%B8%8E%E5%BA%94%E7%94%A8/pic6.png" srcset="/blog/img/loading.gif" class>

<p>é—®é¢˜ï¼šæ¯ä¸ªè½®ç›˜çš„æ—¶é—´æœ‰é™ï¼Œæ¯”å¦‚1ä¸ªæœˆåçš„ç¬¬3å¤©çš„5ç‚¹æ€ä¹ˆåŠï¼Ÿ </p>
<p>æ–¹æ¡ˆä¸€ï¼šåŠ é•¿æ—¶é—´åˆ»åº¦ï¼Œæ‰©å……åˆ°1å¹´ </p>
<p>ä¼˜ç¼ºç‚¹ï¼šç®€å•ï¼Œå æ®å¤§é‡å†…å­˜ï¼Œå³ä½¿æ’æ§½æ²¡æœ‰ä»»åŠ¡ä¹Ÿè¦ç©ºè½®è¯¢ï¼Œç™½ç™½çš„èµ„æºæµªè´¹ï¼Œæ—¶é—´ã€ç©ºé—´å¤æ‚åº¦éƒ½é«˜ </p>
<p>æ–¹æ¡ˆäºŒï¼šæ¯ä¸ªä»»åŠ¡è®°å½•ä¸€ä¸ªè®¡æ•°å™¨ï¼Œè¡¨ç¤ºè½¬å¤šå°‘åœˆåæ‰ä¼šæ‰§è¡Œã€‚æ²¡å½“æŒ‡é’ˆè¿‡æ¥åï¼Œè®¡æ•°å™¨å‡1ï¼Œå‡åˆ°0çš„å†æ‰§è¡Œ </p>
<p>ä¼˜ç¼ºç‚¹ï¼šæ¯åˆ°ä¸€ä¸ªæŒ‡é’ˆéƒ½éœ€è¦å–å‡ºé“¾è¡¨éå†åˆ¤æ–­ï¼Œæ—¶é—´å¤æ‚åº¦é«˜ï¼Œä½†æ˜¯ç©ºé—´å¤æ‚åº¦ä½</p>
<p>æ–¹æ¡ˆä¸‰ï¼šè®¾ç½®å¤šä¸ªæ—¶é—´è½®ï¼Œå¹´è½®ï¼Œæœˆè½®ï¼Œå¤©è½®ã€‚1å¤©å†…çš„æ”¾å…¥å¤©è½®ï¼Œ1å¹´åçš„åˆ™æ”¾å…¥å¹´è½®ï¼Œå½“å¹´è½®æŒ‡é’ˆè¯»åˆ°åï¼Œå°†ä»»åŠ¡å–å‡ºï¼Œæ”¾å…¥ä¸‹ä¸€çº§çš„æœˆè½®å¯¹åº”çš„æ’æ§½ï¼Œæœˆè½®å†åˆ°å¤©è½®ï¼Œç›´åˆ°æœ€å°ç²¾åº¦å–åˆ°ï¼Œä»»åŠ¡è¢«æ‰§è¡Œã€‚ </p>
<p>ä¼˜ç¼ºç‚¹ï¼šä¸éœ€è¦é¢å¤–çš„éå†æ—¶é—´ï¼Œä½†æ˜¯å æ®äº†å¤šä¸ªè½®çš„ç©ºé—´ã€‚ç©ºé—´å¤æ‚åº¦å‡é«˜ï¼Œä½†æ˜¯æ—¶é—´å¤æ‚åº¦é™ä½ </p>
<h5 id="å®ç°-11"><a href="#å®ç°-11" class="headerlink" title="å®ç°"></a>å®ç°</h5><p>å®šä¹‰Taskç±»</p>
<pre><code class="hljs java"><span class="hljs-keyword">package</span> com.itheima.timer;

<span class="hljs-keyword">public</span> <span class="hljs-class"><span class="hljs-keyword">class</span> <span class="hljs-title">RoundTask</span> </span>&#123;
    <span class="hljs-comment">//å»¶è¿Ÿå¤šå°‘ç§’åæ‰§è¡Œ </span>
    <span class="hljs-keyword">int</span> delay;
    <span class="hljs-comment">//åŠ å…¥çš„åºåˆ—å·ï¼Œåªæ˜¯æ ‡è®°ä¸€ä¸‹åŠ å…¥çš„é¡ºåº </span>
    <span class="hljs-keyword">int</span> index;

    <span class="hljs-function"><span class="hljs-keyword">public</span> <span class="hljs-title">RoundTask</span><span class="hljs-params">(<span class="hljs-keyword">int</span> index, <span class="hljs-keyword">int</span> delay)</span> </span>&#123;
        <span class="hljs-keyword">this</span>.index = index;
        <span class="hljs-keyword">this</span>.delay = delay;
    &#125;

    <span class="hljs-function"><span class="hljs-keyword">void</span> <span class="hljs-title">run</span><span class="hljs-params">()</span> </span>&#123;
        System.out.println(<span class="hljs-string">&quot;task &quot;</span> + index + <span class="hljs-string">&quot; start , delay = &quot;</span> + delay);
    &#125;

    <span class="hljs-meta">@Override</span>
    <span class="hljs-function"><span class="hljs-keyword">public</span> String <span class="hljs-title">toString</span><span class="hljs-params">()</span> </span>&#123;
        <span class="hljs-keyword">return</span> String.valueOf(index + <span class="hljs-string">&quot;=&quot;</span> + delay);
    &#125;
&#125;</code></pre>

<p>æ—¶é—´è½®ç®—æ³•</p>
<pre><code class="hljs java"><span class="hljs-keyword">package</span> com.itheima.timer;

<span class="hljs-keyword">import</span> java.util.LinkedList;
<span class="hljs-keyword">import</span> java.util.Random;
<span class="hljs-keyword">import</span> java.util.concurrent.Executors;
<span class="hljs-keyword">import</span> java.util.concurrent.ScheduledExecutorService;
<span class="hljs-keyword">import</span> java.util.concurrent.TimeUnit;
<span class="hljs-keyword">import</span> java.util.concurrent.atomic.AtomicInteger;

<span class="hljs-keyword">public</span> <span class="hljs-class"><span class="hljs-keyword">class</span> <span class="hljs-title">RoundDemo</span> </span>&#123;
    <span class="hljs-comment">//å°è½®æ§½æ•°</span>
    <span class="hljs-keyword">int</span> size1 = <span class="hljs-number">10</span>;
    <span class="hljs-comment">//å¤§è½®æ§½æ•°</span>
    <span class="hljs-keyword">int</span> size2 = <span class="hljs-number">5</span>;
    <span class="hljs-comment">//å°è½®ï¼Œæ•°ç»„ï¼Œæ¯ä¸ªå…ƒç´ æ˜¯ä¸€ä¸ªé“¾è¡¨</span>
    LinkedList&lt;RoundTask&gt;[] t1 = <span class="hljs-keyword">new</span> LinkedList[size1];
    <span class="hljs-comment">//å¤§è½®</span>
    LinkedList&lt;RoundTask&gt;[] t2 = <span class="hljs-keyword">new</span> LinkedList[size2];
    <span class="hljs-comment">//å°è½®è®¡æ•°å™¨ï¼ŒæŒ‡é’ˆè·³åŠ¨çš„æ ¼æ•°ï¼Œæ¯ç§’åŠ 1</span>
    <span class="hljs-keyword">final</span> AtomicInteger flag1 = <span class="hljs-keyword">new</span> AtomicInteger(<span class="hljs-number">0</span>);
    <span class="hljs-comment">//å¤§è½®è®¡æ•°å™¨ï¼ŒæŒ‡é’ˆè·³åŠ¨ä¸ªæ ¼æ•°ï¼Œå³æ¯10såŠ 1</span>
    <span class="hljs-keyword">final</span> AtomicInteger flag2 = <span class="hljs-keyword">new</span> AtomicInteger(<span class="hljs-number">0</span>);
    <span class="hljs-comment">//è°ƒåº¦å™¨ï¼Œæ‹–åŠ¨æŒ‡é’ˆè·³åŠ¨</span>
    ScheduledExecutorService service = Executors.newScheduledThreadPool(<span class="hljs-number">2</span>);

    <span class="hljs-function"><span class="hljs-keyword">public</span> <span class="hljs-title">RoundDemo</span><span class="hljs-params">()</span> </span>&#123;
        <span class="hljs-comment">//åˆå§‹åŒ–æ—¶é—´è½®</span>
        <span class="hljs-keyword">for</span> (<span class="hljs-keyword">int</span> i = <span class="hljs-number">0</span>; i &lt; size1; i++) &#123;
            t1[i] = <span class="hljs-keyword">new</span> LinkedList&lt;&gt;();
        &#125;
        <span class="hljs-keyword">for</span> (<span class="hljs-keyword">int</span> i = <span class="hljs-number">0</span>; i &lt; size2; i++) &#123;
            t2[i] = <span class="hljs-keyword">new</span> LinkedList&lt;&gt;();
        &#125;
    &#125;

    <span class="hljs-comment">//æ‰“å°æ—¶é—´è½®çš„ç»“æ„ï¼Œæ•°ç»„+é“¾è¡¨</span>
    <span class="hljs-function"><span class="hljs-keyword">void</span> <span class="hljs-title">print</span><span class="hljs-params">()</span> </span>&#123;
        System.out.println(<span class="hljs-string">&quot;t1:&quot;</span>);
        <span class="hljs-keyword">for</span> (<span class="hljs-keyword">int</span> i = <span class="hljs-number">0</span>; i &lt; t1.length; i++) &#123;
            System.out.println(t1[i]);
        &#125;
        System.out.println(<span class="hljs-string">&quot;t2:&quot;</span>);
        <span class="hljs-keyword">for</span> (<span class="hljs-keyword">int</span> i = <span class="hljs-number">0</span>; i &lt; t2.length; i++) &#123;
            System.out.println(t2[i]);
        &#125;
    &#125;

    <span class="hljs-comment">//æ·»åŠ ä»»åŠ¡åˆ°æ—¶é—´è½®</span>
    <span class="hljs-function"><span class="hljs-keyword">void</span> <span class="hljs-title">add</span><span class="hljs-params">(RoundTask task)</span> </span>&#123;
        <span class="hljs-keyword">int</span> delay = task.delay;
        <span class="hljs-keyword">if</span> (delay &lt; size1) &#123; <span class="hljs-comment">//10ä»¥å†…çš„ï¼Œåœ¨å°è½® t1[delay].addLast(task);</span>
        &#125; <span class="hljs-keyword">else</span> &#123;
            <span class="hljs-comment">//è¶…è¿‡å°è½®çš„æ”¾å…¥å¤§è½®ï¼Œæ§½é™¤ä»¥å°è½®çš„é•¿åº¦</span>
            t2[delay / size1].addLast(task);
        &#125;
    &#125;

    <span class="hljs-function"><span class="hljs-keyword">void</span> <span class="hljs-title">startT1</span><span class="hljs-params">()</span> </span>&#123;
        <span class="hljs-comment">//æ¯ç§’æ‰§è¡Œä¸€æ¬¡ï¼Œæ¨åŠ¨æ—¶é—´è½®æ—‹è½¬ï¼Œå–åˆ°ä»»åŠ¡ç«‹é©¬æ‰§è¡Œ</span>
        service.scheduleAtFixedRate(<span class="hljs-keyword">new</span> Runnable() &#123;
            <span class="hljs-meta">@Override</span>
            <span class="hljs-function"><span class="hljs-keyword">public</span> <span class="hljs-keyword">void</span> <span class="hljs-title">run</span><span class="hljs-params">()</span> </span>&#123;
                <span class="hljs-keyword">int</span> point = flag1.getAndIncrement() % size1;
                System.out.println(<span class="hljs-string">&quot;t1 â€â€â€â€â€&gt; slot &quot;</span> + point);
                LinkedList&lt;RoundTask&gt; list = t1[point];
                <span class="hljs-keyword">if</span> (!list.isEmpty()) &#123;
                    <span class="hljs-comment">//å¦‚æœå½“å‰æ§½å†…æœ‰ä»»åŠ¡ï¼Œå–å‡ºæ¥ï¼Œä¾æ¬¡æ‰§è¡Œï¼Œæ‰§è¡Œå®Œç§»é™¤</span>
                    <span class="hljs-keyword">while</span> (list.size() != <span class="hljs-number">0</span>) &#123;
                        list.getFirst().run();
                        list.removeFirst();
                    &#125;
                &#125;
            &#125;
        &#125;, <span class="hljs-number">0</span>, <span class="hljs-number">1</span>, TimeUnit.SECONDS);
    &#125;

    <span class="hljs-function"><span class="hljs-keyword">void</span> <span class="hljs-title">startT2</span><span class="hljs-params">()</span> </span>&#123;
        <span class="hljs-comment">//æ¯10ç§’æ‰§è¡Œä¸€æ¬¡ï¼Œæ¨åŠ¨æ—¶é—´è½®æ—‹è½¬ï¼Œå–åˆ°ä»»åŠ¡ä¸‹æ–¹åˆ°t1</span>
        service.scheduleAtFixedRate(<span class="hljs-keyword">new</span> Runnable() &#123;
            <span class="hljs-meta">@Override</span>
            <span class="hljs-function"><span class="hljs-keyword">public</span> <span class="hljs-keyword">void</span> <span class="hljs-title">run</span><span class="hljs-params">()</span> </span>&#123;
                <span class="hljs-keyword">int</span> point = flag2.getAndIncrement() % size2;
                System.out.println(<span class="hljs-string">&quot;t2 =====&gt; slot &quot;</span> + point);
                LinkedList&lt;RoundTask&gt; list = t2[point];
                <span class="hljs-keyword">if</span> (!list.isEmpty()) &#123;
                    <span class="hljs-comment">//å¦‚æœå½“å‰æ§½å†…æœ‰ä»»åŠ¡ï¼Œå–å‡ºï¼Œæ”¾åˆ°å®šä¹‰çš„å°è½®</span>
                    <span class="hljs-keyword">while</span> (list.size() != <span class="hljs-number">0</span>) &#123;
                        RoundTask task = list.getFirst();
                        <span class="hljs-comment">//æ”¾å…¥å°è½®å“ªä¸ªæ§½å‘¢ï¼Ÿå°è½®çš„æ§½æŒ‰10å–ä½™æ•° </span>
                        t1[task.delay % size1].addLast(task);
                        <span class="hljs-comment">//ä»å¤§è½®ä¸­ç§»é™¤</span>
                        list.removeFirst();
                    &#125;
                &#125;
            &#125;
        &#125;, <span class="hljs-number">0</span>, <span class="hljs-number">10</span>, TimeUnit.SECONDS);
    &#125;

    <span class="hljs-function"><span class="hljs-keyword">public</span> <span class="hljs-keyword">static</span> <span class="hljs-keyword">void</span> <span class="hljs-title">main</span><span class="hljs-params">(String[] args)</span> </span>&#123;
        RoundDemo roundDemo = <span class="hljs-keyword">new</span> RoundDemo();
        <span class="hljs-comment">//ç”Ÿæˆ100ä¸ªä»»åŠ¡ï¼Œæ¯ä¸ªä»»åŠ¡çš„å»¶è¿Ÿæ—¶é—´éšæœº </span>
        <span class="hljs-keyword">for</span> (<span class="hljs-keyword">int</span> i = <span class="hljs-number">0</span>; i &lt; <span class="hljs-number">100</span>; i++) &#123;
            roundDemo.add(<span class="hljs-keyword">new</span> RoundTask(i, <span class="hljs-keyword">new</span> Random().nextInt(<span class="hljs-number">50</span>)));
        &#125;
        <span class="hljs-comment">//æ‰“å°ï¼ŒæŸ¥çœ‹æ—¶é—´è½®ä»»åŠ¡å¸ƒå±€ </span>
        roundDemo.print();
        <span class="hljs-comment">//å¯åŠ¨å¤§è½®</span>
        roundDemo.startT2();
        <span class="hljs-comment">//å°è½®å¯åŠ¨</span>
        roundDemo.startT1();
    &#125;
&#125;</code></pre>

<h5 id="ç»“æœåˆ†æ-11"><a href="#ç»“æœåˆ†æ-11" class="headerlink" title="ç»“æœåˆ†æ"></a>ç»“æœåˆ†æ</h5><pre><code class="hljs routeros">Connected <span class="hljs-keyword">to</span> the target VM, address: <span class="hljs-string">&#x27;127.0.0.1:50971&#x27;</span>, transport: <span class="hljs-string">&#x27;socket&#x27;</span>
<span class="hljs-attribute">1598005699</span>=ok:&#123;<span class="hljs-attribute">1598005697</span>=0, <span class="hljs-attribute">1598005698</span>=0, <span class="hljs-attribute">1598005699</span>=1&#125;
<span class="hljs-attribute">1598005699</span>=ok:&#123;<span class="hljs-attribute">1598005697</span>=0, <span class="hljs-attribute">1598005698</span>=0, <span class="hljs-attribute">1598005699</span>=2&#125;
<span class="hljs-keyword">step</span>:1598005700:&#123;<span class="hljs-attribute">1598005698</span>=0, <span class="hljs-attribute">1598005699</span>=2, <span class="hljs-attribute">1598005700</span>=0&#125;
<span class="hljs-attribute">1598005700</span>=ok:&#123;<span class="hljs-attribute">1598005698</span>=0, <span class="hljs-attribute">1598005699</span>=2, <span class="hljs-attribute">1598005700</span>=1&#125;
<span class="hljs-attribute">1598005700</span>=ok:&#123;<span class="hljs-attribute">1598005698</span>=0, <span class="hljs-attribute">1598005699</span>=2, <span class="hljs-attribute">1598005700</span>=2&#125;
<span class="hljs-attribute">1598005700</span>=ok:&#123;<span class="hljs-attribute">1598005698</span>=0, <span class="hljs-attribute">1598005699</span>=2, <span class="hljs-attribute">1598005700</span>=3&#125;
<span class="hljs-keyword">step</span>:1598005701:&#123;<span class="hljs-attribute">1598005699</span>=2, <span class="hljs-attribute">1598005700</span>=3, <span class="hljs-attribute">1598005701</span>=0&#125;
<span class="hljs-attribute">1598005701</span>=reject:&#123;<span class="hljs-attribute">1598005699</span>=2, <span class="hljs-attribute">1598005700</span>=3, <span class="hljs-attribute">1598005701</span>=0&#125;
<span class="hljs-attribute">1598005701</span>=reject:&#123;<span class="hljs-attribute">1598005699</span>=2, <span class="hljs-attribute">1598005700</span>=3, <span class="hljs-attribute">1598005701</span>=0&#125;
<span class="hljs-attribute">1598005701</span>=reject:&#123;<span class="hljs-attribute">1598005699</span>=2, <span class="hljs-attribute">1598005700</span>=3, <span class="hljs-attribute">1598005701</span>=0&#125;
<span class="hljs-keyword">step</span>:1598005702:&#123;<span class="hljs-attribute">1598005700</span>=3, <span class="hljs-attribute">1598005701</span>=0, <span class="hljs-attribute">1598005702</span>=0&#125;
<span class="hljs-attribute">1598005702</span>=ok:&#123;<span class="hljs-attribute">1598005700</span>=3, <span class="hljs-attribute">1598005701</span>=0, <span class="hljs-attribute">1598005702</span>=1&#125;
<span class="hljs-attribute">1598005702</span>=ok:&#123;<span class="hljs-attribute">1598005700</span>=3, <span class="hljs-attribute">1598005701</span>=0, <span class="hljs-attribute">1598005702</span>=2&#125;
<span class="hljs-keyword">step</span>:1598005703:&#123;<span class="hljs-attribute">1598005701</span>=0, <span class="hljs-attribute">1598005702</span>=2, <span class="hljs-attribute">1598005703</span>=0&#125;
<span class="hljs-keyword">step</span>:1598005704:&#123;<span class="hljs-attribute">1598005702</span>=2, <span class="hljs-attribute">1598005703</span>=0, <span class="hljs-attribute">1598005704</span>=0&#125;
<span class="hljs-keyword">step</span>:1598005705:&#123;<span class="hljs-attribute">1598005703</span>=0, <span class="hljs-attribute">1598005704</span>=0, <span class="hljs-attribute">1598005705</span>=0&#125;
â€â€â€â€â€â€â€â€â€â€â€â€â€â€â€â€â€â€â€â€â€â€â€â€â€â€â€
<span class="hljs-attribute">1598005705</span>=ok:&#123;<span class="hljs-attribute">1598005703</span>=0, <span class="hljs-attribute">1598005704</span>=0, <span class="hljs-attribute">1598005705</span>=1&#125;
<span class="hljs-attribute">1598005705</span>=ok:&#123;<span class="hljs-attribute">1598005703</span>=0, <span class="hljs-attribute">1598005704</span>=0, <span class="hljs-attribute">1598005705</span>=2&#125;
<span class="hljs-attribute">1598005705</span>=ok:&#123;<span class="hljs-attribute">1598005703</span>=0, <span class="hljs-attribute">1598005704</span>=0, <span class="hljs-attribute">1598005705</span>=3&#125;
<span class="hljs-attribute">1598005705</span>=ok:&#123;<span class="hljs-attribute">1598005703</span>=0, <span class="hljs-attribute">1598005704</span>=0, <span class="hljs-attribute">1598005705</span>=4&#125;
<span class="hljs-attribute">1598005705</span>=ok:&#123;<span class="hljs-attribute">1598005703</span>=0, <span class="hljs-attribute">1598005704</span>=0, <span class="hljs-attribute">1598005705</span>=5&#125;
<span class="hljs-attribute">1598005705</span>=reject:&#123;<span class="hljs-attribute">1598005703</span>=0, <span class="hljs-attribute">1598005704</span>=0, <span class="hljs-attribute">1598005705</span>=5&#125;
<span class="hljs-attribute">1598005705</span>=reject:&#123;<span class="hljs-attribute">1598005703</span>=0, <span class="hljs-attribute">1598005704</span>=0, <span class="hljs-attribute">1598005705</span>=5&#125;
<span class="hljs-attribute">1598005705</span>=reject:&#123;<span class="hljs-attribute">1598005703</span>=0, <span class="hljs-attribute">1598005704</span>=0, <span class="hljs-attribute">1598005705</span>=5&#125;
<span class="hljs-attribute">1598005705</span>=reject:&#123;<span class="hljs-attribute">1598005703</span>=0, <span class="hljs-attribute">1598005704</span>=0, <span class="hljs-attribute">1598005705</span>=5&#125;
<span class="hljs-attribute">1598005705</span>=reject:&#123;<span class="hljs-attribute">1598005703</span>=0, <span class="hljs-attribute">1598005704</span>=0, <span class="hljs-attribute">1598005705</span>=5&#125;
<span class="hljs-keyword">step</span>:1598005709:&#123;<span class="hljs-attribute">1598005704</span>=0, <span class="hljs-attribute">1598005705</span>=5, <span class="hljs-attribute">1598005709</span>=0&#125;
<span class="hljs-keyword">step</span>:1598005709:&#123;<span class="hljs-attribute">1598005705</span>=5, <span class="hljs-attribute">1598005709</span>=0&#125;
<span class="hljs-keyword">step</span>:1598005709:&#123;<span class="hljs-attribute">1598005709</span>=0&#125;
<span class="hljs-keyword">step</span>:1598005709:&#123;&#125;
<span class="hljs-keyword">step</span>:1598005710:&#123;<span class="hljs-attribute">1598005710</span>=0&#125;
<span class="hljs-keyword">step</span>:1598005711:&#123;<span class="hljs-attribute">1598005710</span>=0, <span class="hljs-attribute">1598005711</span>=0&#125;
<span class="hljs-keyword">step</span>:1598005712:&#123;<span class="hljs-attribute">1598005710</span>=0, <span class="hljs-attribute">1598005711</span>=0, <span class="hljs-attribute">1598005712</span>=0&#125;</code></pre>

<p>è¾“å‡ºç»“æœä¸¥æ ¼æŒ‰delayé¡ºåºæ‰§è¡Œï¼Œè€Œä¸ç®¡indexæ˜¯ä½•æ—¶è¢«æäº¤çš„ </p>
<p>t1ä¸ºå°è½®ï¼Œ10ä¸ªæ§½ï¼Œæ¯ä¸ª1sï¼Œ10sä¸€è½®å› </p>
<p>t2ä¸ºå¤§è½®ï¼Œ5ä¸ªæ§½ï¼Œæ¯ä¸ª10sï¼Œ50sä¸€è½®å› </p>
<p>t1å¾ªç¯åˆ°æ¯ä¸ªæ§½æ—¶ï¼Œæ‰“å°æ§½å†…çš„ä»»åŠ¡æ•°æ®ï¼Œå¦‚ t1â€“&gt;slot9 ï¼Œ æ‰“å°äº†3ä¸ª9sæ‰§è¡Œçš„æ•°æ® </p>
<p>t2å¾ªç¯åˆ°æ¯ä¸ªæ§½æ—¶ï¼Œå°†æ§½å†…çš„ä»»åŠ¡delayæ—¶é—´å–ä½™10åï¼Œæ”¾å…¥å¯¹åº”çš„t1æ§½ä¸­ï¼Œå¦‚ t2==&gt;slot1 </p>
<p>é‚£ä¹ˆt1æ—‹è½¬å¯¹åº”çš„åœˆæ•°åï¼Œå¯ä»¥å–åˆ°t2ä¸‹æ”¾è¿‡æ¥çš„ä»»åŠ¡å¹¶æ‰§è¡Œï¼Œå¦‚10,11â€¦. </p>
<h3 id="è´Ÿè½½å‡è¡¡ç®—æ³•ä¸åº”ç”¨"><a href="#è´Ÿè½½å‡è¡¡ç®—æ³•ä¸åº”ç”¨" class="headerlink" title="è´Ÿè½½å‡è¡¡ç®—æ³•ä¸åº”ç”¨"></a>è´Ÿè½½å‡è¡¡ç®—æ³•ä¸åº”ç”¨</h3><p>è´Ÿè½½å‡è¡¡ï¼Œè‹±æ–‡åç§°ä¸ºLoad Balanceï¼Œå…¶å«ä¹‰å°±æ˜¯æŒ‡å°†è´Ÿè½½ï¼ˆå·¥ä½œä»»åŠ¡ï¼‰è¿›è¡Œå¹³è¡¡ã€åˆ†æ‘Šåˆ°å¤šä¸ªæ“ä½œå•å…ƒä¸Šè¿›è¡Œè¿è¡Œï¼Œä¾‹å¦‚FTPæœåŠ¡å™¨ã€WebæœåŠ¡å™¨ã€ä¼ä¸šæ ¸å¿ƒåº”ç”¨æœåŠ¡å™¨å’Œå…¶å®ƒä¸»è¦ä»»åŠ¡æœåŠ¡å™¨ç­‰ï¼Œä»è€ŒååŒå®Œæˆå·¥ä½œä»»åŠ¡ã€‚æ—¢ç„¶æ¶‰åŠåˆ°å¤šä¸ªæœºå™¨ï¼Œå°±æ¶‰åŠåˆ°ä»»åŠ¡å¦‚ä½•åˆ†å‘ï¼Œè¿™å°±æ˜¯è´Ÿè½½å‡è¡¡ç®—æ³•é—®é¢˜ã€‚ </p>
<h4 id="è½®è¯¢ï¼ˆRoundRobinï¼‰"><a href="#è½®è¯¢ï¼ˆRoundRobinï¼‰" class="headerlink" title="è½®è¯¢ï¼ˆRoundRobinï¼‰"></a>è½®è¯¢ï¼ˆRoundRobinï¼‰</h4><h5 id="æ¦‚è¿°-10"><a href="#æ¦‚è¿°-10" class="headerlink" title="æ¦‚è¿°"></a>æ¦‚è¿°</h5><p>è½®è¯¢å³æ’å¥½é˜Ÿï¼Œä¸€ä¸ªæ¥ä¸€ä¸ªã€‚å‰é¢è°ƒåº¦ç®—æ³•ä¸­ç”¨åˆ°çš„æ—¶é—´ç‰‡è½®è½¬ï¼Œå°±æ˜¯ä¸€ç§å…¸å‹çš„è½®è¯¢ã€‚ä½†æ˜¯å‰é¢ä½¿ç”¨æ•°ç»„å’Œä¸‹æ ‡è½®è¯¢å®ç°ã€‚è¿™é‡Œå°è¯•æ‰‹åŠ¨å†™ä¸€ä¸ªåŒå‘é“¾è¡¨å½¢å¼å®ç°æœåŠ¡å™¨åˆ—è¡¨çš„è¯·æ±‚è½®è¯¢ç®—æ³•ã€‚ </p>
<h5 id="å®ç°-12"><a href="#å®ç°-12" class="headerlink" title="å®ç°"></a>å®ç°</h5><pre><code class="hljs java"><span class="hljs-keyword">package</span> com.itheima.balance;

<span class="hljs-keyword">public</span> <span class="hljs-class"><span class="hljs-keyword">class</span> <span class="hljs-title">RR</span> </span>&#123;
    <span class="hljs-class"><span class="hljs-keyword">class</span> <span class="hljs-title">Server</span> </span>&#123;
        Server prev;
        Server next;
        String name;

        <span class="hljs-function"><span class="hljs-keyword">public</span> <span class="hljs-title">Server</span><span class="hljs-params">(String name)</span> </span>&#123;
            <span class="hljs-keyword">this</span>.name = name;
        &#125;
    &#125;

    <span class="hljs-comment">//å½“å‰æœåŠ¡èŠ‚ç‚¹</span>
    Server current;

    <span class="hljs-comment">//åˆå§‹åŒ–è½®è¯¢ç±»ï¼Œå¤šä¸ªæœåŠ¡å™¨ipç”¨é€—å·éš”å¼€</span>
    <span class="hljs-function"><span class="hljs-keyword">public</span> <span class="hljs-title">RR</span><span class="hljs-params">(String serverName)</span> </span>&#123;
        System.out.println(<span class="hljs-string">&quot;init server list : &quot;</span> + serverName);
        String[] names = serverName.split(<span class="hljs-string">&quot;,&quot;</span>);
        <span class="hljs-keyword">for</span> (<span class="hljs-keyword">int</span> i = <span class="hljs-number">0</span>; i &lt; names.length; i++) &#123;
            Server server = <span class="hljs-keyword">new</span> Server(names[i]);
            <span class="hljs-keyword">if</span> (current == <span class="hljs-keyword">null</span>) &#123;
                <span class="hljs-comment">//å¦‚æœå½“å‰æœåŠ¡å™¨ä¸ºç©ºï¼Œè¯´æ˜æ˜¯ç¬¬ä¸€å°æœºå™¨ï¼Œcurrentå°±æŒ‡å‘æ–°åˆ›å»ºçš„server </span>
                <span class="hljs-keyword">this</span>.current = server;
                <span class="hljs-comment">//åŒæ—¶ï¼Œserverçš„å‰åå‡æŒ‡å‘è‡ªå·±ã€‚ </span>
                current.prev = current;
                current.next = current;
            &#125; <span class="hljs-keyword">else</span> &#123;
                <span class="hljs-comment">//å¦åˆ™è¯´æ˜å·²ç»æœ‰æœºå™¨äº†ï¼ŒæŒ‰æ–°åŠ å¤„ç†ã€‚</span>
                addServer(names[i]);
            &#125;
        &#125;
    &#125;

    <span class="hljs-comment">//æ·»åŠ æœºå™¨</span>
    <span class="hljs-function"><span class="hljs-keyword">void</span> <span class="hljs-title">addServer</span><span class="hljs-params">(String serverName)</span> </span>&#123;
        System.out.println(<span class="hljs-string">&quot;add server : &quot;</span> + serverName);
        Server server = <span class="hljs-keyword">new</span> Server(serverName);
        Server next = <span class="hljs-keyword">this</span>.current.next;
        <span class="hljs-comment">//åœ¨å½“å‰èŠ‚ç‚¹åæ’å…¥æ–°èŠ‚ç‚¹</span>
        <span class="hljs-keyword">this</span>.current.next = server;
        server.prev = <span class="hljs-keyword">this</span>.current;
        <span class="hljs-comment">//ä¿®æ”¹ä¸‹ä¸€èŠ‚ç‚¹çš„prevæŒ‡é’ˆ </span>
        server.next = next;
        next.prev = server;
    &#125;

    <span class="hljs-comment">//å°†å½“å‰æœåŠ¡å™¨ç§»é™¤ï¼ŒåŒæ—¶ä¿®æ”¹å‰åèŠ‚ç‚¹çš„æŒ‡é’ˆï¼Œè®©å…¶ç›´æ¥å…³è” </span>
    <span class="hljs-comment">// ç§»é™¤çš„currentä¼šè¢«å›æ”¶å™¨å›æ”¶æ‰</span>
    <span class="hljs-function"><span class="hljs-keyword">void</span> <span class="hljs-title">remove</span><span class="hljs-params">()</span> </span>&#123;
        System.out.println(<span class="hljs-string">&quot;remove current = &quot;</span> + current.name);
        <span class="hljs-keyword">this</span>.current.prev.next = <span class="hljs-keyword">this</span>.current.next;
        <span class="hljs-keyword">this</span>.current.next.prev = <span class="hljs-keyword">this</span>.current.prev;
        <span class="hljs-keyword">this</span>.current = current.next;
    &#125;

    <span class="hljs-comment">//è¯·æ±‚ã€‚ç”±å½“å‰èŠ‚ç‚¹å¤„ç†å³å¯ </span>
    <span class="hljs-comment">// æ³¨æ„ï¼šå¤„ç†å®Œæˆåï¼ŒcurrentæŒ‡é’ˆåç§» </span>
    <span class="hljs-function"><span class="hljs-keyword">void</span> <span class="hljs-title">request</span><span class="hljs-params">()</span> </span>&#123;
        System.out.println(<span class="hljs-keyword">this</span>.current.name);
        <span class="hljs-keyword">this</span>.current = current.next;
    &#125;

    <span class="hljs-function"><span class="hljs-keyword">public</span> <span class="hljs-keyword">static</span> <span class="hljs-keyword">void</span> <span class="hljs-title">main</span><span class="hljs-params">(String[] args)</span> <span class="hljs-keyword">throws</span> InterruptedException </span>&#123;
        <span class="hljs-comment">//åˆå§‹åŒ–ä¸¤å°æœºå™¨</span>
        RR rr = <span class="hljs-keyword">new</span> RR(<span class="hljs-string">&quot;192.168.0.1,192.168.0.2&quot;</span>);
        <span class="hljs-comment">//å¯åŠ¨ä¸€ä¸ªé¢å¤–çº¿ç¨‹ï¼Œæ¨¡æ‹Ÿä¸åœçš„è¯·æ±‚ </span>
        <span class="hljs-keyword">new</span> Thread(<span class="hljs-keyword">new</span> Runnable() &#123;
            <span class="hljs-meta">@Override</span>
            <span class="hljs-function"><span class="hljs-keyword">public</span> <span class="hljs-keyword">void</span> <span class="hljs-title">run</span><span class="hljs-params">()</span> </span>&#123;
                <span class="hljs-keyword">while</span> (<span class="hljs-keyword">true</span>) &#123;
                    <span class="hljs-keyword">try</span> &#123;
                        Thread.sleep(<span class="hljs-number">500</span>);
                    &#125; <span class="hljs-keyword">catch</span> (InterruptedException e) &#123;
                        e.printStackTrace();
                    &#125;
                    rr.request();
                &#125;
            &#125;
        &#125;).start();
        <span class="hljs-comment">//3såï¼Œ3å·æœºå™¨åŠ å…¥æ¸…å• </span>
        Thread.currentThread().sleep(<span class="hljs-number">3000</span>);
        rr.addServer(<span class="hljs-string">&quot;192.168.0.3&quot;</span>);
        <span class="hljs-comment">//3såï¼Œå½“å‰æœåŠ¡èŠ‚ç‚¹è¢«ç§»é™¤ </span>
        Thread.currentThread().sleep(<span class="hljs-number">3000</span>);
        rr.remove();
    &#125;
&#125;</code></pre>

<h5 id="ç»“æœåˆ†æ-12"><a href="#ç»“æœåˆ†æ-12" class="headerlink" title="ç»“æœåˆ†æ"></a>ç»“æœåˆ†æ</h5><pre><code class="hljs accesslog">init server list : <span class="hljs-number">192</span>.<span class="hljs-number">168</span>.<span class="hljs-number">0</span>.<span class="hljs-number">1</span>,<span class="hljs-number">192</span>.<span class="hljs-number">168</span>.<span class="hljs-number">0</span>.<span class="hljs-number">2</span>
add server : <span class="hljs-number">192</span>.<span class="hljs-number">168</span>.<span class="hljs-number">0</span>.<span class="hljs-number">2</span>
<span class="hljs-number">192.168.0.1</span>
<span class="hljs-number">192.168.0.2</span>
<span class="hljs-number">192.168.0.1</span>
<span class="hljs-number">192.168.0.2</span>
<span class="hljs-number">192.168.0.1</span>
add server : <span class="hljs-number">192</span>.<span class="hljs-number">168</span>.<span class="hljs-number">0</span>.<span class="hljs-number">3</span>
<span class="hljs-number">192.168.0.2</span>
<span class="hljs-number">192.168.0.3</span>
<span class="hljs-number">192.168.0.1</span>
<span class="hljs-number">192.168.0.2</span>
<span class="hljs-number">192.168.0.3</span>
<span class="hljs-number">192.168.0.1</span>
remove current = <span class="hljs-number">192</span>.<span class="hljs-number">168</span>.<span class="hljs-number">0</span>.<span class="hljs-number">2</span>
<span class="hljs-number">192.168.0.3</span>
<span class="hljs-number">192.168.0.1</span></code></pre>

<ul>
<li><p>åˆå§‹åŒ–åï¼Œåªæœ‰1ï¼Œ2ï¼Œä¸¤è€…è½®è¯¢ </p>
</li>
<li><p>3åŠ å…¥åï¼Œ1ï¼Œ2ï¼Œ3ï¼Œä¸‰è€…è½®è¯¢ </p>
</li>
<li><p>ç§»é™¤2åï¼Œåªå‰©1å’Œ3è½®è¯¢</p>
</li>
</ul>
<h5 id="ä¼˜ç¼ºç‚¹-6"><a href="#ä¼˜ç¼ºç‚¹-6" class="headerlink" title="ä¼˜ç¼ºç‚¹"></a>ä¼˜ç¼ºç‚¹</h5><ul>
<li><p>å®ç°ç®€å•ï¼Œæœºå™¨åˆ—è¡¨å¯ä»¥è‡ªç”±åŠ å‡ï¼Œä¸”æ—¶é—´å¤æ‚åº¦ä¸ºo(1) </p>
</li>
<li><p>æ— æ³•é’ˆå¯¹èŠ‚ç‚¹åšåå‘æ€§å®šåˆ¶ï¼ŒèŠ‚ç‚¹å¤„ç†èƒ½åŠ›çš„å¼ºå¼±æ— æ³•åŒºåˆ†å¯¹å¾…</p>
</li>
</ul>
<h4 id="éšæœºï¼ˆRandomï¼‰"><a href="#éšæœºï¼ˆRandomï¼‰" class="headerlink" title="éšæœºï¼ˆRandomï¼‰"></a>éšæœºï¼ˆRandomï¼‰</h4><h5 id="æ¦‚è¿°-11"><a href="#æ¦‚è¿°-11" class="headerlink" title="æ¦‚è¿°"></a>æ¦‚è¿°</h5><p>ä»å¯æœåŠ¡çš„åˆ—è¡¨ä¸­éšæœºå–ä¸€ä¸ªæä¾›å“åº”ã€‚éšæœºå­˜å–çš„åœºæ™¯ä¸‹ï¼Œé€‚åˆä½¿ç”¨æ•°ç»„æ›´é«˜æ•ˆçš„å®ç°ä¸‹æ ‡éšæœºè¯»å–ã€‚ </p>
<h5 id="å®ç°-13"><a href="#å®ç°-13" class="headerlink" title="å®ç°"></a>å®ç°</h5><p>å®šä¹‰ä¸€ä¸ªæ•°ç»„ï¼Œåœ¨æ•°ç»„é•¿åº¦å†…å–éšæœºæ•°ï¼Œä½œä¸ºå…¶ä¸‹æ ‡å³å¯ã€‚éå¸¸ç®€å•</p>
<pre><code class="hljs java"><span class="hljs-keyword">package</span> com.itheima.balance;

<span class="hljs-keyword">import</span> java.util.ArrayList;
<span class="hljs-keyword">import</span> java.util.Random;

<span class="hljs-keyword">public</span> <span class="hljs-class"><span class="hljs-keyword">class</span> <span class="hljs-title">Rand</span> </span>&#123;
    ArrayList&lt;String&gt; ips;

    <span class="hljs-function"><span class="hljs-keyword">public</span> <span class="hljs-title">Rand</span><span class="hljs-params">(String nodeNames)</span> </span>&#123;
        System.out.println(<span class="hljs-string">&quot;init list : &quot;</span> + nodeNames);
        String[] nodes = nodeNames.split(<span class="hljs-string">&quot;,&quot;</span>);
        <span class="hljs-comment">//åˆå§‹åŒ–æœåŠ¡å™¨åˆ—è¡¨ï¼Œé•¿åº¦å–æœºå™¨æ•°</span>
        ips = <span class="hljs-keyword">new</span> ArrayList&lt;&gt;(nodes.length);
        <span class="hljs-keyword">for</span> (String node : nodes) &#123;
            ips.add(node);
        &#125;
    &#125;

    <span class="hljs-comment">//è¯·æ±‚</span>
    <span class="hljs-function"><span class="hljs-keyword">void</span> <span class="hljs-title">request</span><span class="hljs-params">()</span> </span>&#123;
        <span class="hljs-comment">//ä¸‹æ ‡ï¼Œéšæœºæ•°ï¼Œæ³¨æ„å› å­</span>
        <span class="hljs-keyword">int</span> i = <span class="hljs-keyword">new</span> Random().nextInt(ips.size());
        System.out.println(ips.get(i));
    &#125;

    <span class="hljs-comment">//æ·»åŠ èŠ‚ç‚¹ï¼Œæ³¨æ„ï¼Œæ·»åŠ èŠ‚ç‚¹ä¼šé€ æˆå†…éƒ¨æ•°ç»„æ‰©å®¹</span>
    <span class="hljs-comment">// å¯ä»¥æ ¹æ®å®é™…æƒ…å†µåˆå§‹åŒ–æ—¶é¢„ç•™ä¸€å®šç©ºé—´</span>
    <span class="hljs-function"><span class="hljs-keyword">void</span> <span class="hljs-title">addnode</span><span class="hljs-params">(String nodeName)</span> </span>&#123;
        System.out.println(<span class="hljs-string">&quot;add node : &quot;</span> + nodeName);
        ips.add(nodeName);
    &#125;

    <span class="hljs-comment">//ç§»é™¤</span>
    <span class="hljs-function"><span class="hljs-keyword">void</span> <span class="hljs-title">remove</span><span class="hljs-params">(String nodeName)</span> </span>&#123;
        System.out.println(<span class="hljs-string">&quot;remove node : &quot;</span> + nodeName);
        ips.remove(nodeName);
    &#125;

    <span class="hljs-function"><span class="hljs-keyword">public</span> <span class="hljs-keyword">static</span> <span class="hljs-keyword">void</span> <span class="hljs-title">main</span><span class="hljs-params">(String[] args)</span> <span class="hljs-keyword">throws</span> InterruptedException </span>&#123;
        Rand rd = <span class="hljs-keyword">new</span> Rand(<span class="hljs-string">&quot;192.168.0.1,192.168.0.2&quot;</span>);
        <span class="hljs-comment">//å¯åŠ¨ä¸€ä¸ªé¢å¤–çº¿ç¨‹ï¼Œæ¨¡æ‹Ÿä¸åœçš„è¯·æ±‚</span>
        <span class="hljs-keyword">new</span> Thread(<span class="hljs-keyword">new</span> Runnable() &#123;
            <span class="hljs-meta">@Override</span>
            <span class="hljs-function"><span class="hljs-keyword">public</span> <span class="hljs-keyword">void</span> <span class="hljs-title">run</span><span class="hljs-params">()</span> </span>&#123;
                <span class="hljs-keyword">while</span> (<span class="hljs-keyword">true</span>) &#123;
                    <span class="hljs-keyword">try</span> &#123;
                        Thread.sleep(<span class="hljs-number">500</span>);
                    &#125; <span class="hljs-keyword">catch</span> (InterruptedException e) &#123;
                        e.printStackTrace();
                    &#125;
                    rd.request();
                &#125;
            &#125;
        &#125;).start();
        <span class="hljs-comment">//3såï¼Œ3å·æœºå™¨åŠ å…¥æ¸…å•</span>
        Thread.currentThread().sleep(<span class="hljs-number">3000</span>);
        rd.addnode(<span class="hljs-string">&quot;192.168.0.3&quot;</span>);
        <span class="hljs-comment">//3såï¼Œå½“å‰æœåŠ¡èŠ‚ç‚¹è¢«ç§»é™¤</span>
        Thread.currentThread().sleep(<span class="hljs-number">3000</span>);
        rd.remove(<span class="hljs-string">&quot;192.168.0.2&quot;</span>);
    &#125;
&#125;</code></pre>

<h5 id="ç»“æœåˆ†æ-13"><a href="#ç»“æœåˆ†æ-13" class="headerlink" title="ç»“æœåˆ†æ"></a>ç»“æœåˆ†æ</h5><pre><code class="hljs accesslog">init list : <span class="hljs-number">192</span>.<span class="hljs-number">168</span>.<span class="hljs-number">0</span>.<span class="hljs-number">1</span>,<span class="hljs-number">192</span>.<span class="hljs-number">168</span>.<span class="hljs-number">0</span>.<span class="hljs-number">2</span>
<span class="hljs-number">192.168.0.2</span>
<span class="hljs-number">192.168.0.1</span>
<span class="hljs-number">192.168.0.1</span>
<span class="hljs-number">192.168.0.2</span>
<span class="hljs-number">192.168.0.1</span>
add node : <span class="hljs-number">192</span>.<span class="hljs-number">168</span>.<span class="hljs-number">0</span>.<span class="hljs-number">3</span>
<span class="hljs-number">192.168.0.3</span>
<span class="hljs-number">192.168.0.2</span>
<span class="hljs-number">192.168.0.2</span>
<span class="hljs-number">192.168.0.2</span>
<span class="hljs-number">192.168.0.1</span>
<span class="hljs-number">192.168.0.1</span>
remove node : <span class="hljs-number">192</span>.<span class="hljs-number">168</span>.<span class="hljs-number">0</span>.<span class="hljs-number">2</span>
<span class="hljs-number">192.168.0.3</span>
<span class="hljs-number">192.168.0.3</span>
<span class="hljs-number">192.168.0.1</span>
<span class="hljs-number">192.168.0.1</span>
<span class="hljs-number">192.168.0.3</span></code></pre>

<ul>
<li><p>åˆå§‹åŒ–ä¸º1ï¼Œ2ï¼Œä¸¤è€…ä¸æŒ‰é¡ºåºè½®è¯¢ï¼Œè€Œæ˜¯éšæœºå‡ºç° </p>
</li>
<li><p>3åŠ å…¥æœåŠ¡èŠ‚ç‚¹åˆ—è¡¨ </p>
</li>
<li><p>ç§»é™¤2åï¼Œåªå‰©1ï¼Œ3ï¼Œä¾ç„¶æ˜¯ä¸¤è€…éšæœºï¼Œæ— åº </p>
</li>
</ul>
<h4 id="æºåœ°å€å“ˆå¸Œï¼ˆHashï¼‰"><a href="#æºåœ°å€å“ˆå¸Œï¼ˆHashï¼‰" class="headerlink" title="æºåœ°å€å“ˆå¸Œï¼ˆHashï¼‰"></a>æºåœ°å€å“ˆå¸Œï¼ˆHashï¼‰</h4><h5 id="æ¦‚è¿°-12"><a href="#æ¦‚è¿°-12" class="headerlink" title="æ¦‚è¿°"></a>æ¦‚è¿°</h5><p>å¯¹å½“å‰è®¿é—®çš„ipåœ°å€åšä¸€ä¸ªhashå€¼ï¼Œç›¸åŒçš„keyè¢«è·¯ç”±åˆ°åŒä¸€å°æœºå™¨å»ã€‚åœºæ™¯å¸¸è§äºåˆ†å¸ƒå¼é›†ç¾¤ç¯å¢ƒä¸‹ï¼Œç”¨æˆ·ç™»å½•æ—¶çš„è¯·æ±‚è·¯ç”±å’Œä¼šè¯ä¿æŒã€‚ </p>
<h5 id="å®ç°-14"><a href="#å®ç°-14" class="headerlink" title="å®ç°"></a>å®ç°</h5><p>ä½¿ç”¨HashMapå¯ä»¥å®ç°è¯·æ±‚å€¼åˆ°å¯¹åº”èŠ‚ç‚¹çš„æœåŠ¡ï¼Œå…¶æŸ¥æ‰¾æ—¶çš„æ—¶é—´å¤æ‚åº¦ä¸ºo(1)ã€‚å›ºå®šä¸€ç§ç®—æ³•ï¼Œå°†è¯·æ±‚æ˜ å°„åˆ°keyä¸Šå³å¯ã€‚ä¸¾ä¾‹ï¼Œå°†è¯·æ±‚çš„æ¥æºipæœ«å°¾ï¼ŒæŒ‰æœºå™¨æ•°å–ä½™ä½œä¸ºkeyï¼š</p>
<pre><code class="hljs java"><span class="hljs-keyword">package</span> com.itheima.balance;

<span class="hljs-keyword">import</span> java.util.ArrayList;

<span class="hljs-keyword">public</span> <span class="hljs-class"><span class="hljs-keyword">class</span> <span class="hljs-title">Hash</span> </span>&#123;
    ArrayList&lt;String&gt; ips;

    <span class="hljs-function"><span class="hljs-keyword">public</span> <span class="hljs-title">Hash</span><span class="hljs-params">(String nodeNames)</span> </span>&#123;
        System.out.println(<span class="hljs-string">&quot;init list : &quot;</span> + nodeNames);
        String[] nodes = nodeNames.split(<span class="hljs-string">&quot;,&quot;</span>);
        <span class="hljs-comment">//åˆå§‹åŒ–æœåŠ¡å™¨åˆ—è¡¨ï¼Œé•¿åº¦å–æœºå™¨æ•°</span>
        ips = <span class="hljs-keyword">new</span> ArrayList&lt;&gt;(nodes.length);
        <span class="hljs-keyword">for</span> (String node : nodes) &#123;
            ips.add(node);
        &#125;
    &#125;

    <span class="hljs-comment">//æ·»åŠ èŠ‚ç‚¹ï¼Œæ³¨æ„ï¼Œæ·»åŠ èŠ‚ç‚¹ä¼šé€ æˆå†…éƒ¨Hashé‡æ’ï¼Œæ€è€ƒä¸ºä»€ä¹ˆå‘¢ï¼Ÿï¼Ÿï¼Ÿ </span>
    <span class="hljs-comment">// è¿™æ˜¯ä¸ªé—®é¢˜ï¼åœ¨ä¸€è‡´æ€§hashä¸­ä¼šè¿›å…¥è¯¦ç»†æ¢è®¨</span>
    <span class="hljs-function"><span class="hljs-keyword">void</span> <span class="hljs-title">addnode</span><span class="hljs-params">(String nodeName)</span> </span>&#123;
        System.out.println(<span class="hljs-string">&quot;add node : &quot;</span> + nodeName);
        ips.add(nodeName);
    &#125;

    <span class="hljs-comment">//ç§»é™¤</span>
    <span class="hljs-function"><span class="hljs-keyword">void</span> <span class="hljs-title">remove</span><span class="hljs-params">(String nodeName)</span> </span>&#123;
        System.out.println(<span class="hljs-string">&quot;remove node : &quot;</span> + nodeName);
        ips.remove(nodeName);
    &#125;

    <span class="hljs-comment">//æ˜ å°„åˆ°keyçš„ç®—æ³•ï¼Œè¿™é‡Œå–ä½™æ•°åšä¸‹æ ‡ </span>
    <span class="hljs-function"><span class="hljs-keyword">private</span> <span class="hljs-keyword">int</span> <span class="hljs-title">hash</span><span class="hljs-params">(String ip)</span> </span>&#123;
        <span class="hljs-keyword">int</span> last = Integer.valueOf(ip.substring(ip.lastIndexOf(<span class="hljs-string">&quot;.&quot;</span>) + <span class="hljs-number">1</span>, ip.length()));
        <span class="hljs-keyword">return</span> last % ips.size();
    &#125;

    <span class="hljs-comment">//è¯·æ±‚ </span>
    <span class="hljs-comment">// æ³¨æ„ï¼Œè¿™é‡Œå’Œæ¥è®¿ipæ˜¯æœ‰å…³ç³»çš„ï¼Œé‡‡ç”¨ä¸€ä¸ªå‚æ•°ï¼Œè¡¨ç¤ºå½“å‰çš„æ¥è®¿ip </span>
    <span class="hljs-function"><span class="hljs-keyword">void</span> <span class="hljs-title">request</span><span class="hljs-params">(String ip)</span> </span>&#123;
        <span class="hljs-comment">//ä¸‹æ ‡</span>
        <span class="hljs-keyword">int</span> i = hash(ip);
        System.out.println(ip + <span class="hljs-string">&quot;â€â€&gt;&quot;</span> + ips.get(i));
    &#125;

    <span class="hljs-function"><span class="hljs-keyword">public</span> <span class="hljs-keyword">static</span> <span class="hljs-keyword">void</span> <span class="hljs-title">main</span><span class="hljs-params">(String[] args)</span> </span>&#123;
        Hash hash = <span class="hljs-keyword">new</span> Hash(<span class="hljs-string">&quot;192.168.0.1,192.168.0.2&quot;</span>);
        <span class="hljs-keyword">for</span> (<span class="hljs-keyword">int</span> i = <span class="hljs-number">1</span>; i &lt; <span class="hljs-number">10</span>; i++) &#123;
            <span class="hljs-comment">//æ¨¡æ‹Ÿè¯·æ±‚çš„æ¥æºip</span>
            String ip = <span class="hljs-string">&quot;192.168.1.&quot;</span> + i;
            hash.request(ip);
        &#125;
        hash.addnode(<span class="hljs-string">&quot;192.168.0.3&quot;</span>);
        <span class="hljs-keyword">for</span> (<span class="hljs-keyword">int</span> i = <span class="hljs-number">1</span>; i &lt; <span class="hljs-number">10</span>; i++) &#123;
            <span class="hljs-comment">//æ¨¡æ‹Ÿè¯·æ±‚çš„æ¥æºip </span>
            String ip = <span class="hljs-string">&quot;192.168.1.&quot;</span> + i;
            hash.request(ip);
        &#125;
    &#125;
&#125;</code></pre>

<h5 id="ç»“æœåˆ†æ-14"><a href="#ç»“æœåˆ†æ-14" class="headerlink" title="ç»“æœåˆ†æ"></a>ç»“æœåˆ†æ</h5><pre><code class="hljs accesslog">init list : <span class="hljs-number">192</span>.<span class="hljs-number">168</span>.<span class="hljs-number">0</span>.<span class="hljs-number">1</span>,<span class="hljs-number">192</span>.<span class="hljs-number">168</span>.<span class="hljs-number">0</span>.<span class="hljs-number">2</span>
<span class="hljs-number">192.168.1.1</span>â€â€&gt;<span class="hljs-number">192</span>.<span class="hljs-number">168</span>.<span class="hljs-number">0</span>.<span class="hljs-number">2</span>
<span class="hljs-number">192.168.1.2</span>â€â€&gt;<span class="hljs-number">192</span>.<span class="hljs-number">168</span>.<span class="hljs-number">0</span>.<span class="hljs-number">1</span>
<span class="hljs-number">192.168.1.3</span>â€â€&gt;<span class="hljs-number">192</span>.<span class="hljs-number">168</span>.<span class="hljs-number">0</span>.<span class="hljs-number">2</span>
<span class="hljs-number">192.168.1.4</span>â€â€&gt;<span class="hljs-number">192</span>.<span class="hljs-number">168</span>.<span class="hljs-number">0</span>.<span class="hljs-number">1</span>
<span class="hljs-number">192.168.1.5</span>â€â€&gt;<span class="hljs-number">192</span>.<span class="hljs-number">168</span>.<span class="hljs-number">0</span>.<span class="hljs-number">2</span>
<span class="hljs-number">192.168.1.6</span>â€â€&gt;<span class="hljs-number">192</span>.<span class="hljs-number">168</span>.<span class="hljs-number">0</span>.<span class="hljs-number">1</span>
<span class="hljs-number">192.168.1.7</span>â€â€&gt;<span class="hljs-number">192</span>.<span class="hljs-number">168</span>.<span class="hljs-number">0</span>.<span class="hljs-number">2</span>
<span class="hljs-number">192.168.1.8</span>â€â€&gt;<span class="hljs-number">192</span>.<span class="hljs-number">168</span>.<span class="hljs-number">0</span>.<span class="hljs-number">1</span>
<span class="hljs-number">192.168.1.9</span>â€â€&gt;<span class="hljs-number">192</span>.<span class="hljs-number">168</span>.<span class="hljs-number">0</span>.<span class="hljs-number">2</span>
add node : <span class="hljs-number">192</span>.<span class="hljs-number">168</span>.<span class="hljs-number">0</span>.<span class="hljs-number">3</span>
<span class="hljs-number">192.168.1.1</span>â€â€&gt;<span class="hljs-number">192</span>.<span class="hljs-number">168</span>.<span class="hljs-number">0</span>.<span class="hljs-number">2</span>
<span class="hljs-number">192.168.1.2</span>â€â€&gt;<span class="hljs-number">192</span>.<span class="hljs-number">168</span>.<span class="hljs-number">0</span>.<span class="hljs-number">3</span>
<span class="hljs-number">192.168.1.3</span>â€â€&gt;<span class="hljs-number">192</span>.<span class="hljs-number">168</span>.<span class="hljs-number">0</span>.<span class="hljs-number">1</span>
<span class="hljs-number">192.168.1.4</span>â€â€&gt;<span class="hljs-number">192</span>.<span class="hljs-number">168</span>.<span class="hljs-number">0</span>.<span class="hljs-number">2</span>
<span class="hljs-number">192.168.1.5</span>â€â€&gt;<span class="hljs-number">192</span>.<span class="hljs-number">168</span>.<span class="hljs-number">0</span>.<span class="hljs-number">3</span>
<span class="hljs-number">192.168.1.6</span>â€â€&gt;<span class="hljs-number">192</span>.<span class="hljs-number">168</span>.<span class="hljs-number">0</span>.<span class="hljs-number">1</span>
<span class="hljs-number">192.168.1.7</span>â€â€&gt;<span class="hljs-number">192</span>.<span class="hljs-number">168</span>.<span class="hljs-number">0</span>.<span class="hljs-number">2</span>
<span class="hljs-number">192.168.1.8</span>â€â€&gt;<span class="hljs-number">192</span>.<span class="hljs-number">168</span>.<span class="hljs-number">0</span>.<span class="hljs-number">3</span>
<span class="hljs-number">192.168.1.9</span>â€â€&gt;<span class="hljs-number">192</span>.<span class="hljs-number">168</span>.<span class="hljs-number">0</span>.<span class="hljs-number">1</span></code></pre>

<ul>
<li><p>åˆå§‹åŒ–åï¼Œåªæœ‰1ï¼Œ2ï¼Œä¸‹æ ‡ä¸ºæœ«å°¾ipå–ä½™æ•°ï¼Œå¤šæ¬¡è¿è¡Œï¼Œå“åº”çš„æœºå™¨ä¸å˜ï¼Œå®ç°äº†ä¼šè¯ä¿æŒ </p>
</li>
<li><p>3åŠ å…¥åï¼Œé‡æ–°hashï¼Œæœºå™¨åˆ†å¸ƒå‘ç”Ÿå˜åŒ– </p>
</li>
<li><p>2è¢«ç§»é™¤åï¼ŒåŸæ¥hashåˆ°2çš„è¯·æ±‚è¢«é‡æ–°å®šä½ç»™3å“åº” </p>
</li>
</ul>
<h4 id="åŠ æƒè½®è¯¢ï¼ˆWRRï¼‰"><a href="#åŠ æƒè½®è¯¢ï¼ˆWRRï¼‰" class="headerlink" title="åŠ æƒè½®è¯¢ï¼ˆWRRï¼‰"></a>åŠ æƒè½®è¯¢ï¼ˆWRRï¼‰</h4><h5 id="æ¦‚è¿°-13"><a href="#æ¦‚è¿°-13" class="headerlink" title="æ¦‚è¿°"></a>æ¦‚è¿°</h5><p>WeightRoundRobinï¼Œè½®è¯¢åªæ˜¯æœºæ¢°çš„æ—‹è½¬ï¼ŒåŠ æƒè½®è¯¢å¼¥è¡¥äº†æ‰€æœ‰æœºå™¨ä¸€è§†åŒä»çš„ç¼ºç‚¹ã€‚åœ¨è½®è¯¢çš„åŸºç¡€ä¸Šï¼Œåˆå§‹åŒ–æ—¶ï¼Œæœºå™¨æºå¸¦ä¸€ä¸ªæ¯”é‡ã€‚ </p>
<h5 id="å®ç°-15"><a href="#å®ç°-15" class="headerlink" title="å®ç°"></a>å®ç°</h5><p>ç»´æŠ¤ä¸€ä¸ªé“¾è¡¨ï¼Œæ¯ä¸ªæœºå™¨æ ¹æ®æƒé‡ä¸åŒï¼Œå æ®çš„ä¸ªæ•°ä¸åŒã€‚è½®è¯¢æ—¶æƒé‡å¤§çš„ï¼Œä¸ªæ•°å¤šï¼Œè‡ªç„¶å–åˆ°çš„æ¬¡æ•°å˜å¤§ã€‚ä¸¾ä¸ªä¾‹å­ï¼šaï¼Œbï¼Œc ä¸‰å°æœºå™¨ï¼Œæƒé‡åˆ†åˆ«ä¸º4ï¼Œ2ï¼Œ1ï¼Œæ’ä½åä¼šæ˜¯a,a,a,a,b,b,cï¼Œæ¯æ¬¡è¯·æ±‚æ—¶ï¼Œä»åˆ—è¡¨ä¸­ä¾æ¬¡å–èŠ‚ç‚¹ï¼Œä¸‹æ¬¡è¯·æ±‚å†å–ä¸‹ä¸€ä¸ªã€‚åˆ°æœ«å°¾æ—¶ï¼Œå†ä»å¤´å¼€å§‹ã€‚ </p>
<p>ä½†æ˜¯è¿™æ ·æœ‰ä¸€ä¸ªé—®é¢˜ï¼šæœºå™¨åˆ†å¸ƒä¸å¤Ÿå‡åŒ€ï¼Œæ‰å †å‡ºç°äº†â€¦. </p>
<p>è§£å†³ï¼šä¸ºè§£å†³æœºå™¨å¹³æ»‘å‡ºç°çš„é—®é¢˜ï¼Œnginxçš„æºç ä¸­ä½¿ç”¨äº†ä¸€ç§å¹³æ»‘çš„åŠ æƒè½®è¯¢çš„ç®—æ³•ï¼Œè§„åˆ™å¦‚ä¸‹ï¼š</p>
<ul>
<li><p>æ¯ä¸ªèŠ‚ç‚¹ä¸¤ä¸ªæƒé‡ï¼Œweightå’ŒcurrentWeightï¼Œweightæ°¸è¿œä¸å˜æ˜¯é…ç½®æ—¶çš„å€¼ï¼Œcurrentä¸åœå˜åŒ–</p>
</li>
<li><p>å˜åŒ–è§„å¾‹å¦‚ä¸‹ï¼šé€‰æ‹©å‰æ‰€æœ‰current+=weightï¼Œé€‰currentæœ€å¤§çš„å“åº”ï¼Œå“åº”åè®©å®ƒçš„current-=total</p>
</li>
</ul>
<table>
<thead>
<tr>
<th>æ¬¡æ•°</th>
<th>å“åº”å‰</th>
<th>è¢«é€‰ä¸­</th>
<th>å“åº”å</th>
</tr>
</thead>
<tbody><tr>
<td>1</td>
<td>4ï¼Œ2ï¼Œ1</td>
<td>a</td>
<td>-3ï¼Œ2ï¼Œ1</td>
</tr>
<tr>
<td>2</td>
<td>1ï¼Œ4ï¼Œ2</td>
<td>b</td>
<td>1ï¼Œ-3ï¼Œ2</td>
</tr>
<tr>
<td>3</td>
<td>5ï¼Œ-1ï¼Œ3</td>
<td>a</td>
<td>-2ï¼Œ-1ï¼Œ3</td>
</tr>
<tr>
<td>4</td>
<td>2ï¼Œ1ï¼Œ4</td>
<td>c</td>
<td>2ï¼Œ1ï¼Œ-3</td>
</tr>
<tr>
<td>5</td>
<td>6ï¼Œ3ï¼Œ-2</td>
<td>a</td>
<td>-1ï¼Œ3ï¼Œ-2</td>
</tr>
<tr>
<td>6</td>
<td>3ï¼Œ5ï¼Œ-1</td>
<td>b</td>
<td>3ï¼Œ-2ï¼Œ-1</td>
</tr>
<tr>
<td>7</td>
<td>7ï¼Œ0ï¼Œ0</td>
<td>a</td>
<td>0ï¼Œ0ï¼Œ0</td>
</tr>
</tbody></table>
<p>ç»Ÿè®¡ï¼ša=4ï¼Œb=2ï¼Œc=1 ä¸”åˆ†å¸ƒå¹³æ»‘å‡è¡¡</p>
<pre><code class="hljs java"><span class="hljs-keyword">package</span> com.itheima.balance;

<span class="hljs-keyword">import</span> java.util.ArrayList;

<span class="hljs-keyword">public</span> <span class="hljs-class"><span class="hljs-keyword">class</span> <span class="hljs-title">WRR</span> </span>&#123;
    <span class="hljs-class"><span class="hljs-keyword">class</span> <span class="hljs-title">Node</span> </span>&#123;
        <span class="hljs-keyword">int</span> weight, currentWeight;
        String name;

        <span class="hljs-function"><span class="hljs-keyword">public</span> <span class="hljs-title">Node</span><span class="hljs-params">(String name, <span class="hljs-keyword">int</span> weight)</span> </span>&#123;
            <span class="hljs-keyword">this</span>.name = name;
            <span class="hljs-keyword">this</span>.weight = weight;
            <span class="hljs-keyword">this</span>.currentWeight = <span class="hljs-number">0</span>;
        &#125;

        <span class="hljs-meta">@Override</span>
        <span class="hljs-function"><span class="hljs-keyword">public</span> String <span class="hljs-title">toString</span><span class="hljs-params">()</span> </span>&#123;
            <span class="hljs-keyword">return</span> String.valueOf(currentWeight);
        &#125;
    &#125;

    <span class="hljs-comment">//æ‰€æœ‰èŠ‚ç‚¹çš„åˆ—è¡¨</span>
    ArrayList&lt;Node&gt; list;
    <span class="hljs-comment">//æ€»æƒé‡</span>
    <span class="hljs-keyword">int</span> total;

    <span class="hljs-comment">//åˆå§‹åŒ–èŠ‚ç‚¹åˆ—è¡¨ï¼Œæ ¼å¼ï¼ša#4,b#2,c#1</span>
    <span class="hljs-function"><span class="hljs-keyword">public</span> <span class="hljs-title">WRR</span><span class="hljs-params">(String nodes)</span> </span>&#123;
        String[] ns = nodes.split(<span class="hljs-string">&quot;,&quot;</span>);
        list = <span class="hljs-keyword">new</span> ArrayList&lt;&gt;(ns.length);
        <span class="hljs-keyword">for</span> (String n : ns) &#123;
            String[] n1 = n.split(<span class="hljs-string">&quot;#&quot;</span>);
            <span class="hljs-keyword">int</span> weight = Integer.valueOf(n1[<span class="hljs-number">1</span>]);
            list.add(<span class="hljs-keyword">new</span> Node(n1[<span class="hljs-number">0</span>], weight));
            total += weight;
        &#125;
    &#125;

    <span class="hljs-comment">//è·å–å½“å‰èŠ‚ç‚¹</span>
    <span class="hljs-function">Node <span class="hljs-title">getCurrent</span><span class="hljs-params">()</span> </span>&#123;
        <span class="hljs-comment">//æ‰§è¡Œå‰ï¼ŒcurrentåŠ æƒé‡ </span>
        <span class="hljs-keyword">for</span> (Node node : list) &#123;
            node.currentWeight += node.weight;
        &#125;
        <span class="hljs-comment">//éå†ï¼Œå–æƒé‡æœ€é«˜çš„è¿”å›</span>
        Node current = list.get(<span class="hljs-number">0</span>);
        <span class="hljs-keyword">int</span> i = <span class="hljs-number">0</span>;
        <span class="hljs-keyword">for</span> (Node node : list) &#123;
            <span class="hljs-keyword">if</span> (node.currentWeight &gt; i) &#123;
                i = node.currentWeight;
                current = node;
            &#125;
        &#125;
        <span class="hljs-keyword">return</span> current;
    &#125;

    <span class="hljs-comment">//å“åº” </span>
    <span class="hljs-function"><span class="hljs-keyword">void</span> <span class="hljs-title">request</span><span class="hljs-params">()</span> </span>&#123;
        <span class="hljs-comment">//è·å–å½“å‰èŠ‚ç‚¹ </span>
        Node node = <span class="hljs-keyword">this</span>.getCurrent();
        <span class="hljs-comment">//ç¬¬ä¸€åˆ—ï¼Œæ‰§è¡Œå‰çš„current</span>
        System.out.print(list.toString() + <span class="hljs-string">&quot;â€â€â€&quot;</span>);
        <span class="hljs-comment">//ç¬¬äºŒåˆ—ï¼Œé€‰ä¸­çš„èŠ‚ç‚¹å¼€å§‹å“åº”</span>
        System.out.print(node.name + <span class="hljs-string">&quot;â€â€â€&quot;</span>);
        <span class="hljs-comment">//å“åº”åï¼Œcurrentå‡æ‰total</span>
        node.currentWeight -= total;
        <span class="hljs-comment">//ç¬¬ä¸‰åˆ—ï¼Œæ‰§è¡Œåçš„current</span>
        System.out.println(list);
    &#125;

    <span class="hljs-function"><span class="hljs-keyword">public</span> <span class="hljs-keyword">static</span> <span class="hljs-keyword">void</span> <span class="hljs-title">main</span><span class="hljs-params">(String[] args)</span> </span>&#123;
        WRR wrr = <span class="hljs-keyword">new</span> WRR(<span class="hljs-string">&quot;a#4,b#2,c#1&quot;</span>);
        <span class="hljs-comment">//7æ¬¡æ‰§è¡Œè¯·æ±‚ï¼Œçœ‹ç»“æœ</span>
        <span class="hljs-keyword">for</span> (<span class="hljs-keyword">int</span> i = <span class="hljs-number">0</span>; i &lt; <span class="hljs-number">7</span>; i++) &#123;
            wrr.request();
        &#125;
    &#125;
&#125;</code></pre>

<h5 id="ç»“æœåˆ†æ-15"><a href="#ç»“æœåˆ†æ-15" class="headerlink" title="ç»“æœåˆ†æ"></a>ç»“æœåˆ†æ</h5><pre><code class="hljs java">[<span class="hljs-number">4</span>, <span class="hljs-number">2</span>, <span class="hljs-number">1</span>]â€â€â€aâ€â€â€[-<span class="hljs-number">3</span>, <span class="hljs-number">2</span>, <span class="hljs-number">1</span>]
[<span class="hljs-number">1</span>, <span class="hljs-number">4</span>, <span class="hljs-number">2</span>]â€â€â€bâ€â€â€[<span class="hljs-number">1</span>, -<span class="hljs-number">3</span>, <span class="hljs-number">2</span>]
[<span class="hljs-number">5</span>, -<span class="hljs-number">1</span>, <span class="hljs-number">3</span>]â€â€â€aâ€â€â€[-<span class="hljs-number">2</span>, -<span class="hljs-number">1</span>, <span class="hljs-number">3</span>]
[<span class="hljs-number">2</span>, <span class="hljs-number">1</span>, <span class="hljs-number">4</span>]â€â€â€câ€â€â€[<span class="hljs-number">2</span>, <span class="hljs-number">1</span>, -<span class="hljs-number">3</span>]
[<span class="hljs-number">6</span>, <span class="hljs-number">3</span>, -<span class="hljs-number">2</span>]â€â€â€aâ€â€â€[-<span class="hljs-number">1</span>, <span class="hljs-number">3</span>, -<span class="hljs-number">2</span>]
[<span class="hljs-number">3</span>, <span class="hljs-number">5</span>, -<span class="hljs-number">1</span>]â€â€â€bâ€â€â€[<span class="hljs-number">3</span>, -<span class="hljs-number">2</span>, -<span class="hljs-number">1</span>]
[<span class="hljs-number">7</span>, <span class="hljs-number">0</span>, <span class="hljs-number">0</span>]â€â€â€aâ€â€â€[<span class="hljs-number">0</span>, <span class="hljs-number">0</span>, <span class="hljs-number">0</span>]</code></pre>

<h4 id="åŠ æƒéšæœºï¼ˆWRï¼‰"><a href="#åŠ æƒéšæœºï¼ˆWRï¼‰" class="headerlink" title="åŠ æƒéšæœºï¼ˆWRï¼‰"></a>åŠ æƒéšæœºï¼ˆWRï¼‰</h4><h5 id="æ¦‚è¿°-14"><a href="#æ¦‚è¿°-14" class="headerlink" title="æ¦‚è¿°"></a>æ¦‚è¿°</h5><p>WeightRandomï¼Œæœºå™¨éšæœºè¢«ç­›é€‰ï¼Œä½†æ˜¯åšä¸€ç»„åŠ æƒå€¼ï¼Œæ ¹æ®æƒå€¼ä¸åŒï¼Œé€‰ä¸­çš„æ¦‚ç‡ä¸åŒã€‚åœ¨è¿™ä¸ªæ¦‚å¿µä¸Šï¼Œå¯ä»¥è®¤ä¸ºéšæœºæ˜¯ä¸€ç§ç­‰æƒå€¼çš„ç‰¹æ®Šæƒ…å†µã€‚</p>
<h5 id="å®ç°-16"><a href="#å®ç°-16" class="headerlink" title="å®ç°"></a>å®ç°</h5><p>è®¾è®¡æ€è·¯ä¾ç„¶ç›¸åŒï¼Œæ ¹æ®æƒå€¼å¤§å°ï¼Œç”Ÿæˆä¸åŒæ•°é‡çš„èŠ‚ç‚¹ï¼ŒèŠ‚ç‚¹æ’é˜Ÿåï¼Œéšæœºè·å–ã€‚è¿™é‡Œçš„æ•°æ®ç»“æ„ä¸»è¦æ¶‰åŠåˆ°éšæœºçš„è¯»å–ï¼Œæ‰€ä»¥ä¼˜é€‰ä¸ºæ•°ç»„ã€‚ </p>
<p>ä¸éšæœºç›¸åŒçš„æ˜¯ï¼ŒåŒæ ·ä¸ºæ•°ç»„éšæœºç­›é€‰ï¼Œä¸åŒåœ¨äºï¼Œéšæœºåªæ˜¯æ¯å°æœºå™¨1ä¸ªï¼ŒåŠ æƒåå˜ä¸ºå¤šä¸ªã€‚</p>
<pre><code class="hljs java"><span class="hljs-keyword">package</span> com.itheima.balance;

<span class="hljs-keyword">import</span> java.util.ArrayList;
<span class="hljs-keyword">import</span> java.util.Random;

<span class="hljs-keyword">public</span> <span class="hljs-class"><span class="hljs-keyword">class</span> <span class="hljs-title">WR</span> </span>&#123;
    <span class="hljs-comment">//æ‰€æœ‰èŠ‚ç‚¹çš„åˆ—è¡¨ </span>
    ArrayList&lt;String&gt; list;

    <span class="hljs-comment">//åˆå§‹åŒ–èŠ‚ç‚¹åˆ—è¡¨</span>
    <span class="hljs-function"><span class="hljs-keyword">public</span> <span class="hljs-title">WR</span><span class="hljs-params">(String nodes)</span> </span>&#123;
        String[] ns = nodes.split(<span class="hljs-string">&quot;,&quot;</span>);
        list = <span class="hljs-keyword">new</span> ArrayList&lt;&gt;();
        <span class="hljs-keyword">for</span> (String n : ns) &#123;
            String[] n1 = n.split(<span class="hljs-string">&quot;#&quot;</span>);
            <span class="hljs-keyword">int</span> weight = Integer.valueOf(n1[<span class="hljs-number">1</span>]);
            <span class="hljs-keyword">for</span> (<span class="hljs-keyword">int</span> i = <span class="hljs-number">0</span>; i &lt; weight; i++) &#123;
                list.add(n1[<span class="hljs-number">0</span>]);
            &#125;
        &#125;
    &#125;

    <span class="hljs-function"><span class="hljs-keyword">void</span> <span class="hljs-title">request</span><span class="hljs-params">()</span> </span>&#123;
        <span class="hljs-comment">//ä¸‹æ ‡ï¼Œéšæœºæ•°ï¼Œæ³¨æ„å› å­</span>
        <span class="hljs-keyword">int</span> i = <span class="hljs-keyword">new</span> Random().nextInt(list.size());
        System.out.println(list.get(i));
    &#125;

    <span class="hljs-function"><span class="hljs-keyword">public</span> <span class="hljs-keyword">static</span> <span class="hljs-keyword">void</span> <span class="hljs-title">main</span><span class="hljs-params">(String[] args)</span> </span>&#123;
        WR wr = <span class="hljs-keyword">new</span> WR(<span class="hljs-string">&quot;a#2,b#1&quot;</span>);
        <span class="hljs-keyword">for</span> (<span class="hljs-keyword">int</span> i = <span class="hljs-number">0</span>; i &lt; <span class="hljs-number">9</span>; i++) &#123;
            wr.request();
        &#125;
    &#125;
&#125;</code></pre>

<h5 id="ç»“æœåˆ†æ-16"><a href="#ç»“æœåˆ†æ-16" class="headerlink" title="ç»“æœåˆ†æ"></a>ç»“æœåˆ†æ</h5><pre><code class="hljs stylus">a
a
b
a
a
a
b
a
a</code></pre>

<ul>
<li><p>è¿è¡Œ9æ¬¡ï¼Œaï¼Œbäº¤æ›¿å‡ºç°ï¼Œa=6,b=3,æ»¡è¶³2:1æ¯”ä¾‹</p>
</li>
<li><p>æ³¨æ„ï¼æ—¢ç„¶æ˜¯éšæœºï¼Œå°±å­˜åœ¨éšæœºæ€§ï¼Œä¸è§å¾—æ¯æ¬¡æ‰§è¡Œéƒ½ä¼šä¸¥æ ¼æ¯”ä¾‹ã€‚æ ·æœ¬è¶‹å‘æ— ç©·æ—¶ï¼Œæ¯”ä¾‹çº¦å‡†ç¡®</p>
</li>
</ul>
<h4 id="æœ€å°è¿æ¥æ•°ï¼ˆLCï¼‰"><a href="#æœ€å°è¿æ¥æ•°ï¼ˆLCï¼‰" class="headerlink" title="æœ€å°è¿æ¥æ•°ï¼ˆLCï¼‰"></a>æœ€å°è¿æ¥æ•°ï¼ˆLCï¼‰</h4><h5 id="æ¦‚è¿°-15"><a href="#æ¦‚è¿°-15" class="headerlink" title="æ¦‚è¿°"></a>æ¦‚è¿°</h5><p>LeastConnectionsï¼Œå³ç»Ÿè®¡å½“å‰æœºå™¨çš„è¿æ¥æ•°ï¼Œé€‰æœ€å°‘çš„å»å“åº”æ–°çš„è¯·æ±‚ã€‚å‰é¢çš„ç®—æ³•æ˜¯ç«™åœ¨è¯·æ±‚ç»´åº¦ï¼Œè€Œæœ€å°è¿æ¥æ•°æ˜¯ç«™åœ¨æœºå™¨çš„ç»´åº¦ã€‚</p>
<h5 id="å®ç°-17"><a href="#å®ç°-17" class="headerlink" title="å®ç°"></a>å®ç°</h5><p>å®šä¹‰ä¸€ä¸ªé“¾æ¥è¡¨è®°å½•æœºå™¨çš„èŠ‚ç‚¹idå’Œæœºå™¨è¿æ¥æ•°é‡çš„è®¡æ•°å™¨ã€‚å†…éƒ¨é‡‡ç”¨æœ€å°å †åšæ’åºå¤„ç†ï¼Œå“åº”æ—¶å–å †é¡¶èŠ‚ç‚¹å³æ˜¯æœ€å°è¿æ¥æ•°ã€‚</p>
<pre><code class="hljs java"><span class="hljs-keyword">package</span> com.itheima.balance;

<span class="hljs-keyword">import</span> java.util.Arrays;
<span class="hljs-keyword">import</span> java.util.concurrent.atomic.AtomicInteger;

<span class="hljs-keyword">public</span> <span class="hljs-class"><span class="hljs-keyword">class</span> <span class="hljs-title">LC</span> </span>&#123;
    <span class="hljs-comment">//èŠ‚ç‚¹åˆ—è¡¨</span>
    Node[] nodes;

    <span class="hljs-comment">//åˆå§‹åŒ–èŠ‚ç‚¹ï¼Œåˆ›å»ºå † </span>
    <span class="hljs-comment">// å› ä¸ºå¼€å§‹æ—¶å„èŠ‚ç‚¹è¿æ¥æ•°éƒ½ä¸º0ï¼Œæ‰€ä»¥ç›´æ¥å¡«å……æ•°ç»„å³å¯</span>
    LC(String ns) &#123;
        String[] ns1 = ns.split(<span class="hljs-string">&quot;,&quot;</span>);
        nodes = <span class="hljs-keyword">new</span> Node[ns1.length + <span class="hljs-number">1</span>];
        <span class="hljs-keyword">for</span> (<span class="hljs-keyword">int</span> i = <span class="hljs-number">0</span>; i &lt; ns1.length; i++) &#123;
            nodes[i + <span class="hljs-number">1</span>] = <span class="hljs-keyword">new</span> Node(ns1[i]);
        &#125;
    &#125;

    <span class="hljs-comment">//èŠ‚ç‚¹ä¸‹æ²‰ï¼Œä¸å·¦å³å­èŠ‚ç‚¹æ¯”å¯¹ï¼Œé€‰é‡Œé¢æœ€å°çš„äº¤æ¢ </span>
    <span class="hljs-comment">// ç›®çš„æ˜¯å§‹ç»ˆä¿æŒæœ€å°å †çš„é¡¶ç‚¹å…ƒç´ å€¼æœ€å° </span>
    <span class="hljs-comment">// i:è¦ä¸‹æ²‰çš„é¡¶ç‚¹åºå· </span>
    <span class="hljs-function"><span class="hljs-keyword">void</span> <span class="hljs-title">down</span><span class="hljs-params">(<span class="hljs-keyword">int</span> i)</span> </span>&#123;
        <span class="hljs-comment">//é¡¶ç‚¹åºå·éå†ï¼Œåªè¦åˆ°1åŠå³å¯ï¼Œæ—¶é—´å¤æ‚åº¦ä¸ºO(log2n) </span>
        <span class="hljs-keyword">while</span> (i &lt;&lt; <span class="hljs-number">1</span> &lt; nodes.length) &#123;
            <span class="hljs-comment">//å·¦å­ï¼Œä¸ºä½•å·¦ç§»1ä½ï¼Ÿå›é¡¾ä¸€ä¸‹äºŒå‰æ ‘åºå· </span>
            <span class="hljs-keyword">int</span> left = i &lt;&lt; <span class="hljs-number">1</span>;
            <span class="hljs-comment">//å³å­ï¼Œå·¦+1å³å¯ </span>
            <span class="hljs-keyword">int</span> right = left + <span class="hljs-number">1</span>;
            <span class="hljs-comment">//æ ‡è®°ï¼ŒæŒ‡å‘ æœ¬èŠ‚ç‚¹ï¼Œå·¦ã€å³å­èŠ‚ç‚¹é‡Œæœ€å°çš„ï¼Œä¸€å¼€å§‹å–iè‡ªå·± </span>
            <span class="hljs-keyword">int</span> flag = i;
            <span class="hljs-comment">//åˆ¤æ–­å·¦å­æ˜¯å¦å°äºæœ¬èŠ‚ç‚¹</span>
            <span class="hljs-keyword">if</span> (nodes[left].get() &lt; nodes[i].get()) &#123;
                flag = left;
            &#125;
            <span class="hljs-comment">//åˆ¤æ–­å³å­</span>
            <span class="hljs-keyword">if</span> (right &lt; nodes.length &amp;&amp; nodes[flag].get() &gt; nodes[right].get()) &#123;
                flag = right;
            &#125;
            <span class="hljs-comment">//ä¸¤è€…ä¸­æœ€å°çš„ä¸æœ¬èŠ‚ç‚¹ä¸ç›¸ç­‰ï¼Œåˆ™äº¤æ¢</span>
            <span class="hljs-keyword">if</span> (flag != i) &#123;
                Node temp = nodes[i];
                nodes[i] = nodes[flag];
                nodes[flag] = temp;
                i = flag;
            &#125; <span class="hljs-keyword">else</span> &#123;
                <span class="hljs-comment">//å¦åˆ™ç›¸ç­‰ï¼Œå †æ’åºå®Œæˆï¼Œé€€å‡ºå¾ªç¯å³å¯</span>
                <span class="hljs-keyword">break</span>;
            &#125;
        &#125;
    &#125;

    <span class="hljs-comment">//è¯·æ±‚ã€‚éå¸¸ç®€å•ï¼Œç›´æ¥å–æœ€å°å †çš„å †é¡¶å…ƒç´ å°±æ˜¯è¿æ¥æ•°æœ€å°‘çš„æœºå™¨</span>
    <span class="hljs-function"><span class="hljs-keyword">void</span> <span class="hljs-title">request</span><span class="hljs-params">()</span> </span>&#123;
        System.out.println(<span class="hljs-string">&quot;â€â€â€â€â€â€â€â€â€â€â€â€â€â€â€â€â€â€â€â€â€&quot;</span>);
        <span class="hljs-comment">//å–å †é¡¶å…ƒç´ å“åº”è¯·æ±‚</span>
        Node node = nodes[<span class="hljs-number">1</span>];
        System.out.println(node.name + <span class="hljs-string">&quot; accept&quot;</span>);
        <span class="hljs-comment">//è¿æ¥æ•°åŠ 1</span>
        node.inc();
        <span class="hljs-comment">//æ’åºå‰çš„å † </span>
        System.out.println(<span class="hljs-string">&quot;before:&quot;</span> + Arrays.toString(nodes));
        <span class="hljs-comment">//å †é¡¶ä¸‹æ²‰</span>
        down(<span class="hljs-number">1</span>);
        <span class="hljs-comment">//æ’åºåçš„å † </span>
        System.out.println(<span class="hljs-string">&quot;after:&quot;</span> + Arrays.toString(nodes));
    &#125;

    <span class="hljs-function"><span class="hljs-keyword">public</span> <span class="hljs-keyword">static</span> <span class="hljs-keyword">void</span> <span class="hljs-title">main</span><span class="hljs-params">(String[] args)</span> </span>&#123;
        <span class="hljs-comment">//å‡è®¾æœ‰7å°æœºå™¨</span>
        LC lc = <span class="hljs-keyword">new</span> LC(<span class="hljs-string">&quot;a,b,c,d,e,f,g&quot;</span>);
        <span class="hljs-comment">//æ¨¡æ‹Ÿ10ä¸ªè¯·æ±‚è¿æ¥</span>
        <span class="hljs-keyword">for</span> (<span class="hljs-keyword">int</span> i = <span class="hljs-number">0</span>; i &lt; <span class="hljs-number">10</span>; i++) &#123;
            lc.request();
        &#125;
    &#125;

    <span class="hljs-class"><span class="hljs-keyword">class</span> <span class="hljs-title">Node</span> </span>&#123;
        <span class="hljs-comment">//èŠ‚ç‚¹æ ‡è¯†</span>
        String name;
        <span class="hljs-comment">// è®¡æ•°å™¨ </span>
        AtomicInteger count = <span class="hljs-keyword">new</span> AtomicInteger(<span class="hljs-number">0</span>);

        <span class="hljs-function"><span class="hljs-keyword">public</span> <span class="hljs-title">Node</span><span class="hljs-params">(String name)</span> </span>&#123;
            <span class="hljs-keyword">this</span>.name = name;
        &#125;

        <span class="hljs-comment">//è®¡æ•°å™¨å¢åŠ  </span>
        <span class="hljs-function"><span class="hljs-keyword">public</span> <span class="hljs-keyword">void</span> <span class="hljs-title">inc</span><span class="hljs-params">()</span> </span>&#123;
            count.getAndIncrement();
        &#125;

        <span class="hljs-comment">//è·å–è¿æ¥æ•° </span>
        <span class="hljs-function"><span class="hljs-keyword">public</span> <span class="hljs-keyword">int</span> <span class="hljs-title">get</span><span class="hljs-params">()</span> </span>&#123;
            <span class="hljs-keyword">return</span> count.get();
        &#125;

        <span class="hljs-meta">@Override</span>
        <span class="hljs-function"><span class="hljs-keyword">public</span> String <span class="hljs-title">toString</span><span class="hljs-params">()</span> </span>&#123;
            <span class="hljs-keyword">return</span> name + <span class="hljs-string">&quot;=&quot;</span> + count;
        &#125;
    &#125;
&#125;</code></pre>

<h5 id="ç»“æœåˆ†æ-17"><a href="#ç»“æœåˆ†æ-17" class="headerlink" title="ç»“æœåˆ†æ"></a>ç»“æœåˆ†æ</h5><pre><code class="hljs routeros">â€â€â€â€â€â€â€â€â€â€â€â€â€â€â€â€â€â€â€â€â€
a accept
before:[<span class="hljs-literal">null</span>, <span class="hljs-attribute">a</span>=1, <span class="hljs-attribute">b</span>=0, <span class="hljs-attribute">c</span>=0, <span class="hljs-attribute">d</span>=0, <span class="hljs-attribute">e</span>=0, <span class="hljs-attribute">f</span>=0, <span class="hljs-attribute">g</span>=0]
after:[<span class="hljs-literal">null</span>, <span class="hljs-attribute">b</span>=0, <span class="hljs-attribute">d</span>=0, <span class="hljs-attribute">c</span>=0, <span class="hljs-attribute">a</span>=1, <span class="hljs-attribute">e</span>=0, <span class="hljs-attribute">f</span>=0, <span class="hljs-attribute">g</span>=0]
â€â€â€â€â€â€â€â€â€â€â€â€â€â€â€â€â€â€â€â€â€
b accept
before:[<span class="hljs-literal">null</span>, <span class="hljs-attribute">b</span>=1, <span class="hljs-attribute">d</span>=0, <span class="hljs-attribute">c</span>=0, <span class="hljs-attribute">a</span>=1, <span class="hljs-attribute">e</span>=0, <span class="hljs-attribute">f</span>=0, <span class="hljs-attribute">g</span>=0]
after:[<span class="hljs-literal">null</span>, <span class="hljs-attribute">d</span>=0, <span class="hljs-attribute">e</span>=0, <span class="hljs-attribute">c</span>=0, <span class="hljs-attribute">a</span>=1, <span class="hljs-attribute">b</span>=1, <span class="hljs-attribute">f</span>=0, <span class="hljs-attribute">g</span>=0]
â€â€â€â€â€â€â€â€â€â€â€â€â€â€â€â€â€â€â€â€â€
d accept
before:[<span class="hljs-literal">null</span>, <span class="hljs-attribute">d</span>=1, <span class="hljs-attribute">e</span>=0, <span class="hljs-attribute">c</span>=0, <span class="hljs-attribute">a</span>=1, <span class="hljs-attribute">b</span>=1, <span class="hljs-attribute">f</span>=0, <span class="hljs-attribute">g</span>=0]
after:[<span class="hljs-literal">null</span>, <span class="hljs-attribute">e</span>=0, <span class="hljs-attribute">d</span>=1, <span class="hljs-attribute">c</span>=0, <span class="hljs-attribute">a</span>=1, <span class="hljs-attribute">b</span>=1, <span class="hljs-attribute">f</span>=0, <span class="hljs-attribute">g</span>=0]
â€â€â€â€â€â€â€â€â€â€â€â€â€â€â€â€â€â€â€â€â€
e accept
before:[<span class="hljs-literal">null</span>, <span class="hljs-attribute">e</span>=1, <span class="hljs-attribute">d</span>=1, <span class="hljs-attribute">c</span>=0, <span class="hljs-attribute">a</span>=1, <span class="hljs-attribute">b</span>=1, <span class="hljs-attribute">f</span>=0, <span class="hljs-attribute">g</span>=0]
after:[<span class="hljs-literal">null</span>, <span class="hljs-attribute">c</span>=0, <span class="hljs-attribute">d</span>=1, <span class="hljs-attribute">f</span>=0, <span class="hljs-attribute">a</span>=1, <span class="hljs-attribute">b</span>=1, <span class="hljs-attribute">e</span>=1, <span class="hljs-attribute">g</span>=0]
â€â€â€â€â€â€â€â€â€â€â€â€â€â€â€â€â€â€â€â€â€</code></pre>

<ul>
<li><p>åˆå§‹åŒ–åï¼Œå †èŠ‚ç‚¹å€¼éƒ½ä¸º0ï¼Œå³æ¯ä¸ªæœºå™¨è¿æ¥æ•°éƒ½ä¸º0 </p>
</li>
<li><p>å †é¡¶è¿æ¥åï¼Œä¸‹æ²‰ï¼Œå †é‡æ–°æ’åºï¼Œæœ€å°å †è§„åˆ™ä¿æŒæˆç«‹ </p>
</li>
</ul>
<h4 id="åº”ç”¨æ¡ˆä¾‹-2"><a href="#åº”ç”¨æ¡ˆä¾‹-2" class="headerlink" title="åº”ç”¨æ¡ˆä¾‹"></a>åº”ç”¨æ¡ˆä¾‹</h4><h5 id="nginx-upstream"><a href="#nginx-upstream" class="headerlink" title="nginx upstream"></a>nginx upstream</h5><pre><code class="hljs yaml"><span class="hljs-string">upstream</span> <span class="hljs-string">frontend</span> &#123; 
	<span class="hljs-comment">#æºåœ°å€hash </span>
	<span class="hljs-string">ip_hash;</span>
  <span class="hljs-string">server</span> <span class="hljs-number">192.168</span><span class="hljs-number">.0</span><span class="hljs-number">.1</span><span class="hljs-string">:8081;</span> 
  <span class="hljs-string">server</span> <span class="hljs-number">192.168</span><span class="hljs-number">.0</span><span class="hljs-number">.2</span><span class="hljs-string">:8082</span> <span class="hljs-string">weight=1</span> <span class="hljs-string">down;</span> 
  <span class="hljs-string">server</span> <span class="hljs-number">192.168</span><span class="hljs-number">.0</span><span class="hljs-number">.3</span><span class="hljs-string">:8083</span> <span class="hljs-string">weight=2;</span> 
  <span class="hljs-string">server</span> <span class="hljs-number">192.168</span><span class="hljs-number">.0</span><span class="hljs-number">.4</span><span class="hljs-string">:8084</span> <span class="hljs-string">weight=3</span> <span class="hljs-string">backup;</span>
  <span class="hljs-string">server</span> <span class="hljs-number">192.168</span><span class="hljs-number">.0</span><span class="hljs-number">.5</span><span class="hljs-string">:8085</span> <span class="hljs-string">weight=4</span> <span class="hljs-string">max_fails=3</span> <span class="hljs-string">fail_timeout=30s;</span> 
&#125;</code></pre>

<ul>
<li><p>ip_hashï¼šå³æºåœ°å€hashç®—æ³• </p>
</li>
<li><p>downï¼šè¡¨ç¤ºå½“å‰çš„serveræš‚æ—¶ä¸å‚ä¸è´Ÿè½½ </p>
</li>
<li><p>weightï¼šå³åŠ æƒç®—æ³•ï¼Œé»˜è®¤ä¸º1ï¼Œweightè¶Šå¤§ï¼Œè´Ÿè½½çš„æƒé‡å°±è¶Šå¤§ã€‚ </p>
</li>
<li><p>backupï¼šå¤‡ä»½æœºå™¨ï¼Œåªæœ‰å…¶å®ƒæ‰€æœ‰çš„ébackupæœºå™¨downæˆ–è€…å¿™çš„æ—¶å€™ï¼Œå†è¯·æ±‚backupæœºå™¨ã€‚ </p>
</li>
<li><p>max_failsï¼šæœ€å¤§å¤±è´¥æ¬¡æ•°ï¼Œé»˜è®¤å€¼ä¸º1ï¼Œè¿™é‡Œä¸º3ï¼Œä¹Ÿå°±æ˜¯æœ€å¤šè¿›è¡Œ3æ¬¡å°è¯• </p>
</li>
<li><p>fail_timeoutï¼šè¶…æ—¶æ—¶é—´ä¸º30ç§’ï¼Œé»˜è®¤å€¼æ˜¯10sã€‚ </p>
</li>
</ul>
<p>æ³¨æ„ï¼weightå’Œbackupä¸èƒ½å’Œip_hashå…³é”®å­—ä¸€èµ·ä½¿ç”¨ã€‚ </p>
<h5 id="springcloud-ribbon-IRule"><a href="#springcloud-ribbon-IRule" class="headerlink" title="springcloud ribbon IRule"></a>springcloud ribbon IRule</h5><pre><code class="hljs routeros"><span class="hljs-comment">#è®¾ç½®è´Ÿè½½å‡è¡¡ç­–ç•¥ eurekaâ€applicationâ€serviceä¸ºè°ƒç”¨çš„æœåŠ¡çš„åç§° </span>
eurekaâ€applicationâ€ service.ribbon.<span class="hljs-attribute">NFLoadBalancerRuleClassName</span>=com.netflix.loadbalancer.RandomRule</code></pre>

<ul>
<li><p>RoundRobinRuleï¼šè½®è¯¢ </p>
</li>
<li><p>RandomRuleï¼šéšæœº </p>
</li>
<li><p>AvailabilityFilteringRuleï¼šå…ˆè¿‡æ»¤æ‰ç”±äºå¤šæ¬¡è®¿é—®æ•…éšœè€Œå¤„äºæ–­è·¯å™¨è·³é—¸çŠ¶æ€çš„æœåŠ¡ï¼Œè¿˜æœ‰å¹¶å‘çš„è¿æ¥æ•°é‡è¶…è¿‡é˜ˆå€¼çš„æœåŠ¡ï¼Œç„¶åå¯¹å‰©ä½™çš„æœåŠ¡è½®è¯¢ </p>
</li>
<li><p>WeightedResponseTimeRuleï¼šæ ¹æ®å¹³å‡å“åº”æ—¶é—´è®¡ç®—æ‰€æœ‰æœåŠ¡çš„æƒé‡ï¼Œå“åº”æ—¶é—´è¶Šå¿«æœåŠ¡æƒé‡è¶Šå¤§ã€‚åˆšå¯åŠ¨æ—¶å¦‚æœç»Ÿè®¡ä¿¡æ¯ä¸è¶³ï¼Œåˆ™ä½¿ç”¨RoundRobinRuleç­–ç•¥ï¼Œç­‰ç»Ÿè®¡ä¿¡æ¯è¶³å¤Ÿï¼Œä¼šåˆ‡æ¢åˆ°è¯¥ç­–ç•¥ </p>
</li>
<li><p>RetryRuleï¼šå…ˆæŒ‰ç…§RoundRobinRuleçš„ç­–ç•¥ï¼Œå¦‚æœè·å–æœåŠ¡å¤±è´¥åˆ™åœ¨æŒ‡å®šæ—¶é—´å†…é‡è¯•ï¼Œè·å–å¯ç”¨çš„æœåŠ¡ </p>
</li>
<li><p>BestAvailableRuleï¼šä¼šå…ˆè¿‡æ»¤æ‰ç”±äºå¤šæ¬¡è®¿é—®æ•…éšœè€Œå¤„äºæ–­è·¯å™¨è·³é—¸çŠ¶æ€çš„æœåŠ¡ï¼Œç„¶åé€‰æ‹©ä¸€ä¸ªå¹¶å‘é‡æœ€å°çš„æœåŠ¡ </p>
</li>
<li><p>ZoneAvoidanceRuleï¼šé»˜è®¤è§„åˆ™ï¼Œç»¼åˆåˆ¤æ–­serveræ‰€åœ¨åŒºåŸŸçš„æ€§èƒ½å’Œserverçš„å¯ç”¨æ€§ </p>
</li>
</ul>
<h5 id="dubboè´Ÿè½½å‡è¡¡"><a href="#dubboè´Ÿè½½å‡è¡¡" class="headerlink" title="dubboè´Ÿè½½å‡è¡¡"></a>dubboè´Ÿè½½å‡è¡¡</h5><p>ä½¿ç”¨Serviceæ³¨è§£ </p>
<p><code>@Service(loadbalance = &quot;roundrobin&quot;,weight = 100) </code></p>
<ul>
<li><p>RandomLoadBalance: éšæœºï¼Œè¿™ç§æ–¹å¼æ˜¯dubboé»˜è®¤çš„è´Ÿè½½å‡è¡¡ç­–ç•¥ </p>
</li>
<li><p>RoundRobinLoadBalanceï¼šè½®è¯¢ </p>
</li>
<li><p>LeastActiveLoadBalanceï¼šæœ€å°‘æ´»è·ƒæ¬¡æ•°ï¼Œdubboæ¡†æ¶è‡ªå®šä¹‰äº†ä¸€ä¸ªFilterï¼Œç”¨äºè®¡ç®—æœåŠ¡è¢«è°ƒç”¨çš„æ¬¡æ•° </p>
</li>
<li><p>ConsistentHashLoadBalanceï¼šä¸€è‡´æ€§hash </p>
</li>
</ul>
<h3 id="åŠ å¯†ç®—æ³•ä¸åº”ç”¨"><a href="#åŠ å¯†ç®—æ³•ä¸åº”ç”¨" class="headerlink" title="åŠ å¯†ç®—æ³•ä¸åº”ç”¨"></a>åŠ å¯†ç®—æ³•ä¸åº”ç”¨</h3><h4 id="æ•£åˆ—"><a href="#æ•£åˆ—" class="headerlink" title="æ•£åˆ—"></a>æ•£åˆ—</h4><h5 id="æ¦‚è¿°-16"><a href="#æ¦‚è¿°-16" class="headerlink" title="æ¦‚è¿°"></a>æ¦‚è¿°</h5><p>ä¸¥æ ¼æ¥è®²è¿™ä¸ç®—æ˜¯ä¸€ç§åŠ å¯†ï¼Œè€Œåº”è¯¥å«åšä¿¡æ¯æ‘˜è¦ç®—æ³•ã€‚è¯¥ç®—æ³•ä½¿ç”¨æ•£åˆ—å‡½æ•°æŠŠæ¶ˆæ¯æˆ–æ•°æ®å‹ç¼©æˆæ‘˜è¦ï¼Œä½¿å¾—æ•°æ®é‡å˜å°ï¼Œå°†æ•°æ®çš„æ ¼å¼å›ºå®šä¸‹æ¥ã€‚é€šè¿‡æ•°æ®æ‰“ä¹±æ··åˆï¼Œé‡æ–°åˆ›å»ºä¸€ä¸ªå«åšæ•£åˆ—å€¼ </p>
<h5 id="å¸¸è§ç®—æ³•"><a href="#å¸¸è§ç®—æ³•" class="headerlink" title="å¸¸è§ç®—æ³•"></a>å¸¸è§ç®—æ³•</h5><p>MD5ã€SHAï¼ˆ128ã€256ï¼‰ç³»åˆ—</p>
<table>
<thead>
<tr>
<th>åç§°</th>
<th>å®‰å…¨æ€§</th>
<th>é€Ÿåº¦</th>
</tr>
</thead>
<tbody><tr>
<td>SHA-1</td>
<td>é«˜</td>
<td>ğŸˆµï¸</td>
</tr>
<tr>
<td>MD5</td>
<td>ä¸­</td>
<td>å¿«</td>
</tr>
</tbody></table>
<h5 id="åº”ç”¨-5"><a href="#åº”ç”¨-5" class="headerlink" title="åº”ç”¨"></a>åº”ç”¨</h5><p>å¸¸ç”¨äºå¯†ç å­˜å‚¨ï¼Œæˆ–æ–‡ä»¶æŒ‡çº¹æ ¡éªŒã€‚</p>
<p>ç½‘ç«™ç”¨æˆ·æ³¨å†Œåï¼Œå¯†ç ç»è¿‡MD5åŠ å¯†åçš„å€¼ï¼Œå­˜å‚¨è¿›DBã€‚å†æ¬¡ç™»å½•æ—¶ï¼Œå°†ç”¨æˆ·è¾“å…¥çš„å¯†ç æŒ‰åŒæ ·çš„æ–¹å¼åŠ å¯†ï¼Œä¸æ•°æ®åº“ä¸­çš„å¯†æ–‡æ¯”å¯¹ã€‚è¿™æ ·å³ä½¿æ•°æ®åº“è¢«ç ´è§£ï¼Œæˆ–è€…å¼€å‘äººå‘˜å¯è§ï¼ŒåŸºäºMD5çš„ä¸å¯é€†æ€§ï¼Œä»ç„¶ä¸çŸ¥é“å¯†ç æ˜¯ä»€ä¹ˆã€‚</p>
<p>å…¶æ¬¡æ˜¯æ–‡ä»¶æ ¡éªŒåœºæ™¯ã€‚ä¾‹å¦‚ä»æŸç«™ä¸‹è½½çš„æ–‡ä»¶ï¼ˆå°¤å…¶æ˜¯å¤§æ–‡ä»¶ï¼Œæ¯”å¦‚ç³»ç»Ÿé•œåƒisoï¼‰ï¼Œå®˜æ–¹ç½‘ç«™éƒ½ä¼šæ”¾ç½®ä¸€ä¸ªç­¾åï¼ˆå¯èƒ½æ˜¯MD5ï¼Œæˆ–è€…SHAï¼‰ï¼Œå½“ç”¨æˆ·æ‹¿åˆ°æ–‡ä»¶åï¼Œå¯ä»¥æœ¬åœ°æ‰§è¡Œæ•£åˆ—ç®—æ³•ä¸å®˜ç½‘ç­¾åæ¯”å¯¹æ˜¯å¦ä¸€è‡´ï¼Œæ¥åˆ¤æ–­æ–‡ä»¶æ˜¯å¦è¢«ç¯¡æ”¹ã€‚å¦‚ubuntu20.04çš„é•œåƒï¼š </p>
<img src="/blog/2020/08/16/%E6%95%B0%E6%8D%AE%E7%BB%93%E6%9E%84-%E5%B8%B8%E8%A7%81%E7%AE%97%E6%B3%95%E4%B8%8E%E5%BA%94%E7%94%A8/pic7.png" srcset="/blog/img/loading.gif" class>

<h5 id="å®ç°-18"><a href="#å®ç°-18" class="headerlink" title="å®ç°"></a>å®ç°</h5><pre><code class="hljs java"><span class="hljs-keyword">package</span> com.itheima.pwd;

<span class="hljs-keyword">import</span> org.apache.commons.codec.digest.DigestUtils;

<span class="hljs-keyword">import</span> java.math.BigInteger;
<span class="hljs-keyword">import</span> java.security.MessageDigest;

<span class="hljs-keyword">public</span> <span class="hljs-class"><span class="hljs-keyword">class</span> <span class="hljs-title">Hash</span> </span>&#123;
    <span class="hljs-comment">/**</span>
<span class="hljs-comment">     * jdkçš„securityå®ç°md5</span>
<span class="hljs-comment">     */</span>
    <span class="hljs-function"><span class="hljs-keyword">public</span> <span class="hljs-keyword">static</span> String <span class="hljs-title">md5</span><span class="hljs-params">(String src)</span> </span>&#123;
        <span class="hljs-keyword">byte</span>[] pwd = <span class="hljs-keyword">null</span>;
        <span class="hljs-keyword">try</span> &#123;
            pwd = MessageDigest.getInstance(<span class="hljs-string">&quot;md5&quot;</span>).digest(src.getBytes(<span class="hljs-string">&quot;utfâ€8&quot;</span>));
        &#125; <span class="hljs-keyword">catch</span> (Exception e) &#123;
            e.printStackTrace();
        &#125;
        String code = <span class="hljs-keyword">new</span> BigInteger(<span class="hljs-number">1</span>, pwd).toString(<span class="hljs-number">16</span>);
        <span class="hljs-keyword">for</span> (<span class="hljs-keyword">int</span> i = <span class="hljs-number">0</span>; i &lt; <span class="hljs-number">32</span> - code.length();
             i++) &#123;
            code = <span class="hljs-string">&quot;0&quot;</span> + code;
        &#125;
        <span class="hljs-keyword">return</span> code;
    &#125;

    <span class="hljs-function"><span class="hljs-keyword">public</span> <span class="hljs-keyword">static</span> String <span class="hljs-title">commonsMd5</span><span class="hljs-params">(String src)</span> </span>&#123;
        <span class="hljs-keyword">return</span> DigestUtils.md5Hex(src);
    &#125;

    <span class="hljs-comment">/**</span>
<span class="hljs-comment">     * jdkå®ç°shaç®—æ³•</span>
<span class="hljs-comment">     */</span>
    <span class="hljs-function"><span class="hljs-keyword">public</span> <span class="hljs-keyword">static</span> String <span class="hljs-title">sha</span><span class="hljs-params">(String src)</span> <span class="hljs-keyword">throws</span> Exception </span>&#123;
        MessageDigest sha = MessageDigest.getInstance(<span class="hljs-string">&quot;sha&quot;</span>);
        <span class="hljs-keyword">byte</span>[] shaByte = sha.digest(src.getBytes(<span class="hljs-string">&quot;utfâ€8&quot;</span>));
        StringBuffer code = <span class="hljs-keyword">new</span> StringBuffer();
        <span class="hljs-keyword">for</span> (<span class="hljs-keyword">int</span> i = <span class="hljs-number">0</span>; i &lt; shaByte.length; i++) &#123;
            <span class="hljs-keyword">int</span> val = ((<span class="hljs-keyword">int</span>) shaByte[i]) &amp; <span class="hljs-number">0xff</span>;
            <span class="hljs-keyword">if</span> (val &lt; <span class="hljs-number">16</span>) &#123;
                code.append(<span class="hljs-string">&quot;0&quot;</span>);
            &#125;
            code.append(Integer.toHexString(val));
        &#125;
        <span class="hljs-keyword">return</span> code.toString();
    &#125;

    <span class="hljs-function"><span class="hljs-keyword">public</span> <span class="hljs-keyword">static</span> String <span class="hljs-title">commonsSha</span><span class="hljs-params">(String src)</span> <span class="hljs-keyword">throws</span> Exception </span>&#123;
        <span class="hljs-keyword">return</span> DigestUtils.sha1Hex(src);
    &#125;

    <span class="hljs-function"><span class="hljs-keyword">public</span> <span class="hljs-keyword">static</span> <span class="hljs-keyword">void</span> <span class="hljs-title">main</span><span class="hljs-params">(String[] args)</span> <span class="hljs-keyword">throws</span> Exception </span>&#123;
        String name = <span class="hljs-string">&quot;æ¶æ„å¸ˆè®­ç»ƒè¥&quot;</span>;
        System.out.println(name);
        System.out.println(md5(name));
        System.out.println(commonsMd5(name));
        System.out.println(sha(name));
        System.out.println(commonsSha(name));
    &#125;
&#125;</code></pre>

<h5 id="ç»“æœåˆ†æ-18"><a href="#ç»“æœåˆ†æ-18" class="headerlink" title="ç»“æœåˆ†æ"></a>ç»“æœåˆ†æ</h5><pre><code class="hljs llvm">æ¶æ„å¸ˆè®­ç»ƒè¥
d<span class="hljs-number">98</span><span class="hljs-keyword">c</span><span class="hljs-number">9e606978909</span>dd<span class="hljs-number">8</span>cbeda<span class="hljs-number">3409</span>b<span class="hljs-number">38</span>ba
d<span class="hljs-number">98</span><span class="hljs-keyword">c</span><span class="hljs-number">9e606978909</span>dd<span class="hljs-number">8</span>cbeda<span class="hljs-number">3409</span>b<span class="hljs-number">38</span>ba
a<span class="hljs-number">74474</span>a<span class="hljs-number">705</span>b<span class="hljs-number">01</span>a<span class="hljs-number">8</span>ed<span class="hljs-number">1</span>bfae<span class="hljs-number">76</span>f<span class="hljs-number">4</span>b<span class="hljs-number">8</span><span class="hljs-keyword">c</span><span class="hljs-number">36518341959</span>
a<span class="hljs-number">74474</span>a<span class="hljs-number">705</span>b<span class="hljs-number">01</span>a<span class="hljs-number">8</span>ed<span class="hljs-number">1</span>bfae<span class="hljs-number">76</span>f<span class="hljs-number">4</span>b<span class="hljs-number">8</span><span class="hljs-keyword">c</span><span class="hljs-number">36518341959</span></code></pre>

<ul>
<li><p>jdkä¸commonså‡ç”Ÿæˆäº†ç›¸åŒçš„æ•£åˆ—å€¼ </p>
</li>
<li><p>å¤šæ¬¡è¿è¡Œï¼Œä¾ç„¶ç”Ÿæˆå›ºå®šå€¼ </p>
</li>
<li><p>commons-codecè¿˜æœ‰å¾ˆå¤šå¯ç”¨æ–¹æ³•ï¼Œå¦‚ï¼šsha256ï¼Œsha512â€¦ </p>
</li>
</ul>
<h4 id="å¯¹ç§°"><a href="#å¯¹ç§°" class="headerlink" title="å¯¹ç§°"></a>å¯¹ç§°</h4><h5 id="æ¦‚è¿°-17"><a href="#æ¦‚è¿°-17" class="headerlink" title="æ¦‚è¿°"></a>æ¦‚è¿°</h5><p>åŠ å¯†ä¸è§£å¯†ç”¨çš„éƒ½æ˜¯åŒä¸€ä¸ªç§˜é’¥ï¼Œæ€§èƒ½æ¯”éå¯¹ç§°åŠ å¯†é«˜å¾ˆå¤šã€‚ </p>
<h5 id="å¸¸è§ç®—æ³•-1"><a href="#å¸¸è§ç®—æ³•-1" class="headerlink" title="å¸¸è§ç®—æ³•"></a>å¸¸è§ç®—æ³•</h5><p>å¸¸è§çš„å¯¹ç§°åŠ å¯†ç®—æ³•æœ‰ DESã€3DESã€AES </p>
<p>DESç®—æ³•åœ¨POSã€ATMã€ç£å¡åŠæ™ºèƒ½å¡ï¼ˆICå¡ï¼‰ã€åŠ æ²¹ç«™ã€é«˜é€Ÿå…¬è·¯æ”¶è´¹ç«™ç­‰é¢†åŸŸè¢«å¹¿æ³›åº”ç”¨ï¼Œä»¥æ­¤æ¥å®ç°å…³é”®æ•°æ®çš„ä¿å¯†ï¼Œå¦‚ä¿¡ç”¨å¡æŒå¡äººçš„PINçš„åŠ å¯†ä¼ è¾“ï¼ŒICå¡ä¸POSé—´çš„åŒå‘è®¤è¯ã€é‡‘èäº¤æ˜“æ•°æ®åŒ…çš„MACæ ¡éªŒç­‰</p>
<p>3DESæ˜¯DESåŠ å¯†ç®—æ³•çš„ä¸€ç§æ¨¡å¼ï¼Œæ˜¯DESçš„ä¸€ä¸ªæ›´å®‰å…¨çš„å˜å½¢ã€‚ä»DESå‘AESçš„è¿‡æ¸¡ç®—æ³•</p>
<p>AESï¼Œæ˜¯ä¸‹ä¸€ä»£çš„åŠ å¯†ç®—æ³•æ ‡å‡†ï¼Œé€Ÿåº¦å¿«ï¼Œå®‰å…¨çº§åˆ«æ›´é«˜ã€‚ </p>
<table>
<thead>
<tr>
<th>åç§°</th>
<th>å¯†é’¥åç§°</th>
<th>è¿è¡Œé€Ÿåº¦</th>
<th>å®‰å…¨æ€§</th>
<th>èµ„æºæ¶ˆè€—</th>
</tr>
</thead>
<tbody><tr>
<td>DES</td>
<td>56ä½</td>
<td>è¾ƒå¿«</td>
<td>ä½</td>
<td>ä¸­</td>
</tr>
<tr>
<td>3DES</td>
<td>112ä½æˆ–168ä½</td>
<td>æ…¢</td>
<td>ä¸­</td>
<td>é«˜</td>
</tr>
<tr>
<td>AES</td>
<td>128ã€192ã€256ä½</td>
<td>å¿«</td>
<td>é«˜</td>
<td>ä½</td>
</tr>
</tbody></table>
<h5 id="åº”ç”¨-6"><a href="#åº”ç”¨-6" class="headerlink" title="åº”ç”¨"></a>åº”ç”¨</h5><p>å¸¸ç”¨äºå¯¹æ•ˆç‡è¦æ±‚è¾ƒé«˜çš„å®æ—¶æ•°æ®åŠ å¯†é€šä¿¡ã€‚ </p>
<h5 id="å®ç°-19"><a href="#å®ç°-19" class="headerlink" title="å®ç°"></a>å®ç°</h5><p>ä»¥AESä¸ºä¾‹ï¼š </p>
<pre><code class="hljs java"><span class="hljs-keyword">package</span> com.itheima.pwd;

<span class="hljs-keyword">import</span> org.apache.commons.codec.binary.Base64;

<span class="hljs-keyword">import</span> javax.crypto.Cipher;
<span class="hljs-keyword">import</span> javax.crypto.KeyGenerator;
<span class="hljs-keyword">import</span> javax.crypto.spec.SecretKeySpec;
<span class="hljs-keyword">import</span> java.security.Key;

<span class="hljs-keyword">public</span> <span class="hljs-class"><span class="hljs-keyword">class</span> <span class="hljs-title">AES</span> </span>&#123;
    <span class="hljs-function"><span class="hljs-keyword">public</span> <span class="hljs-keyword">static</span> <span class="hljs-keyword">void</span> <span class="hljs-title">main</span><span class="hljs-params">(String[] args)</span> <span class="hljs-keyword">throws</span> Exception </span>&#123;
        <span class="hljs-comment">//ç”ŸæˆKEY </span>
        KeyGenerator keyGenerator = KeyGenerator.getInstance(<span class="hljs-string">&quot;AES&quot;</span>);
        keyGenerator.init(<span class="hljs-number">128</span>);
        <span class="hljs-comment">//keyè½¬æ¢</span>
        Key key = <span class="hljs-keyword">new</span> SecretKeySpec(keyGenerator.generateKey().getEncoded(), <span class="hljs-string">&quot;AES&quot;</span>);
        Cipher cipher = Cipher.getInstance(<span class="hljs-string">&quot;AES/ECB/PKCS5Padding&quot;</span>);
        String src = <span class="hljs-string">&quot;æ¶æ„å¸ˆè®­ç»ƒè¥&quot;</span>;
        System.out.println(<span class="hljs-string">&quot;æ˜æ–‡ï¼š&quot;</span> + src);
        <span class="hljs-comment">//åŠ å¯†</span>
        cipher.init(Cipher.ENCRYPT_MODE, key);
        <span class="hljs-keyword">byte</span>[] result = cipher.doFinal(src.getBytes());
        System.out.println(<span class="hljs-string">&quot;åŠ å¯†ï¼š&quot;</span> + Base64.encodeBase64String(result));
        <span class="hljs-comment">//è§£å¯† </span>
        cipher.init(Cipher.DECRYPT_MODE, key);
        result = cipher.doFinal(result);
        System.out.println(<span class="hljs-string">&quot;è§£å¯†ï¼š&quot;</span> + <span class="hljs-keyword">new</span> String(result));
    &#125;
&#125;</code></pre>

<h5 id="ç»“æœåˆ†æ-19"><a href="#ç»“æœåˆ†æ-19" class="headerlink" title="ç»“æœåˆ†æ"></a>ç»“æœåˆ†æ</h5><pre><code class="hljs gcode">æ˜æ–‡ï¼šæ¶æ„å¸ˆè®­ç»ƒè¥
åŠ å¯†ï¼šea<span class="hljs-number">4</span>/<span class="hljs-symbol">nl4</span>a<span class="hljs-number">7</span>MadH<span class="hljs-symbol">nixqbKVHdBLJ6</span>kDpXle<span class="hljs-symbol">n0</span>Q<span class="hljs-number">4</span>bzH<span class="hljs-number">2</span>ZXk=
è§£å¯†ï¼šæ¶æ„å¸ˆè®­ç»ƒè¥</code></pre>

<h4 id="éå¯¹ç§°"><a href="#éå¯¹ç§°" class="headerlink" title="éå¯¹ç§°"></a>éå¯¹ç§°</h4><h5 id="æ¦‚è¿°-18"><a href="#æ¦‚è¿°-18" class="headerlink" title="æ¦‚è¿°"></a>æ¦‚è¿°</h5><p>éå¯¹ç§°å³åŠ å¯†ä¸è§£å¯†ä¸æ˜¯åŒä¸€æŠŠé’¥åŒ™ï¼Œè€Œæ˜¯åˆ†æˆå…¬é’¥å’Œç§é’¥ã€‚ç§é’¥åœ¨ä¸ªäººæ‰‹é‡Œï¼Œå…¬é’¥å…¬å¼€ã€‚è¿™ä¸€å¯¹é’¥åŒ™ä¸€ä¸ªç”¨äºåŠ å¯†ï¼Œå¦ä¸€ä¸ªç”¨äºè§£å¯†ã€‚ä½¿ç”¨å…¶ä¸­ä¸€ä¸ªåŠ å¯†åï¼Œåˆ™åŸå§‹æ˜æ–‡åªèƒ½ç”¨å¯¹åº”çš„å¦ä¸€ä¸ªå¯†é’¥è§£å¯†ï¼Œå³ä½¿æœ€åˆç”¨äºåŠ å¯†çš„å¯†é’¥ä¹Ÿä¸èƒ½ç”¨ä½œè§£å¯†ã€‚æ­£æ˜¯å› ä¸ºè¿™ç§ç‰¹æ€§ï¼Œæ‰€ä»¥ç§°ä¸ºéå¯¹ç§°åŠ å¯†ã€‚</p>
<h5 id="å¸¸è§ç®—æ³•-2"><a href="#å¸¸è§ç®—æ³•-2" class="headerlink" title="å¸¸è§ç®—æ³•"></a>å¸¸è§ç®—æ³•</h5><p>RSAã€ElGamalã€èƒŒåŒ…ç®—æ³•ã€Rabinï¼ˆRSAçš„ç‰¹ä¾‹ï¼‰ã€è¿ªè²ï¼èµ«å°”æ›¼å¯†é’¥äº¤æ¢åè®®ä¸­çš„å…¬é’¥åŠ å¯†ç®—æ³•ã€æ¤­åœ†æ›²çº¿åŠ å¯†ç®—æ³•ï¼ˆè‹±è¯­ï¼šElliptic Curve Cryptography, ECCï¼‰ã€‚ä½¿ç”¨æœ€å¹¿æ³›çš„æ˜¯RSAç®—æ³•ï¼ˆå‘æ˜è€…Rivestã€Shmirå’ŒAdlemanå§“æ°é¦–å­—æ¯ç¼©å†™ï¼‰</p>
<table>
<thead>
<tr>
<th>åç§°</th>
<th>æˆç†Ÿåº¦</th>
<th>è¿è¡Œé€Ÿåº¦</th>
<th>è¿è¡Œé€Ÿåº¦</th>
<th>èµ„æºæ¶ˆè€—</th>
</tr>
</thead>
<tbody><tr>
<td>RAS</td>
<td>é«˜</td>
<td>é«˜</td>
<td>ä¸­</td>
<td>ä¸­</td>
</tr>
<tr>
<td>ECC</td>
<td>é«˜</td>
<td>é«˜</td>
<td>æ…¢</td>
<td>é«˜</td>
</tr>
</tbody></table>
<h5 id="åº”ç”¨-7"><a href="#åº”ç”¨-7" class="headerlink" title="åº”ç”¨"></a>åº”ç”¨</h5><p>æœ€å¸¸è§çš„ï¼Œä¸¤ç‚¹ï¼šhttpså’Œæ•°å­—ç­¾åã€‚ </p>
<p>ä¸¥æ ¼æ„ä¹‰ä¸Šè®²ï¼Œhttpså¹¶éæ‰€æœ‰è¯·æ±‚éƒ½ä½¿ç”¨éå¯¹ç§°ã€‚åŸºäºæ€§èƒ½è€ƒè™‘ï¼Œhttpså…ˆä½¿ç”¨éå¯¹ç§°çº¦å®šä¸€ä¸ªkeyï¼ŒåæœŸä½¿ç”¨è¯¥keyè¿›è¡Œå¯¹ç§°åŠ å¯†å’Œæ•°æ®ä¼ è¾“ã€‚ </p>
<img src="/blog/2020/08/16/%E6%95%B0%E6%8D%AE%E7%BB%93%E6%9E%84-%E5%B8%B8%E8%A7%81%E7%AE%97%E6%B3%95%E4%B8%8E%E5%BA%94%E7%94%A8/pic8.png" srcset="/blog/img/loading.gif" class>

<p>æ•°å­—ç­¾ååˆ™æ˜¯ç”¨äºéªŒè¯æŠ¥æ–‡æ˜¯å¦ä¸ºæœåŠ¡å™¨å‘å‡ºçš„ï¼Œç”¨äºé˜²ä¼ªå’Œè®¤è¯ã€‚è¿‡ç¨‹å¦‚ä¸‹ï¼š</p>
<p>ç­¾å‘ï¼š</p>
<ul>
<li><p>æœåŠ¡å™¨å¤–å‘å¸ƒå…¬é’¥ï¼Œç§é’¥ä¿å¯† </p>
</li>
<li><p>æœåŠ¡å™¨å¯¹æ¶ˆæ¯Mè®¡ç®—æ‘˜è¦ï¼ˆå¦‚MD5ç­‰å…¬å¼€ç®—æ³•ï¼‰ï¼Œå¾—åˆ°æ‘˜è¦D </p>
</li>
<li><p>æœåŠ¡å™¨ä½¿ç”¨ç§é’¥å¯¹Dè¿›è¡Œç­¾åï¼Œå¾—åˆ°ç­¾åS </p>
</li>
<li><p>å°†Må’ŒSä¸€èµ·å‘ç»™å®¢æˆ· </p>
</li>
</ul>
<p>éªŒè¯ï¼š</p>
<ul>
<li><p>å®¢æˆ·ç«¯å¯¹Mä½¿ç”¨åŒä¸€æ‘˜è¦ç®—æ³•è®¡ç®—æ‘˜è¦ï¼Œå¾—åˆ°æ‘˜è¦D </p>
</li>
<li><p>ä½¿ç”¨æœåŠ¡å™¨å…¬é’¥å¯¹Sè¿›è¡Œè§£å¯†ï¼Œå¾—åˆ°æ‘˜è¦Dâ€™ </p>
</li>
<li><p>å¦‚æœDå’ŒDâ€™ç›¸åŒï¼Œé‚£ä¹ˆè¯æ˜Mç¡®å®æ˜¯æœåŠ¡å™¨å‘å‡ºçš„</p>
</li>
</ul>
<h5 id="å®ç°-20"><a href="#å®ç°-20" class="headerlink" title="å®ç°"></a>å®ç°</h5><pre><code class="hljs java"><span class="hljs-keyword">package</span> com.itheima.pwd;

<span class="hljs-keyword">import</span> org.apache.commons.codec.binary.Base64;

<span class="hljs-keyword">import</span> javax.crypto.Cipher;
<span class="hljs-keyword">import</span> java.nio.charset.StandardCharsets;
<span class="hljs-keyword">import</span> java.security.*;
<span class="hljs-keyword">import</span> java.security.interfaces.RSAPrivateKey;
<span class="hljs-keyword">import</span> java.security.interfaces.RSAPublicKey;
<span class="hljs-keyword">import</span> java.security.spec.PKCS8EncodedKeySpec;
<span class="hljs-keyword">import</span> java.security.spec.X509EncodedKeySpec;

<span class="hljs-keyword">public</span> <span class="hljs-class"><span class="hljs-keyword">class</span> <span class="hljs-title">RSAUtil</span> </span>&#123;
    <span class="hljs-keyword">static</span> String privKey;
    <span class="hljs-keyword">static</span> String publicKey;

    <span class="hljs-function"><span class="hljs-keyword">public</span> <span class="hljs-keyword">static</span> <span class="hljs-keyword">void</span> <span class="hljs-title">main</span><span class="hljs-params">(String[] args)</span> <span class="hljs-keyword">throws</span> Exception </span>&#123;
        <span class="hljs-comment">//ç”Ÿæˆå…¬é’¥å’Œç§é’¥ </span>
        genKeyPair();
        <span class="hljs-comment">//åŠ å¯†å­—ç¬¦ä¸² </span>
        String message = <span class="hljs-string">&quot;æ¶æ„å¸ˆè®­ç»ƒè¥&quot;</span>;
        System.out.println(<span class="hljs-string">&quot;æ˜æ–‡ï¼š&quot;</span> + message);
        System.out.println(<span class="hljs-string">&quot;éšæœºå…¬é’¥ä¸º:&quot;</span> + publicKey);
        System.out.println(<span class="hljs-string">&quot;éšæœºç§é’¥ä¸º:&quot;</span> + privKey);
        String messageEn = encrypt(message, publicKey);
        System.out.println(<span class="hljs-string">&quot;å…¬é’¥åŠ å¯†:&quot;</span> + messageEn);
        String messageDe = decrypt(messageEn, privKey);
        System.out.println(<span class="hljs-string">&quot;ç§é’¥è§£å¯†:&quot;</span> + messageDe);
    &#125;

    <span class="hljs-comment">/**</span>
<span class="hljs-comment">     * éšæœºç”Ÿæˆå¯†é’¥å¯¹</span>
<span class="hljs-comment">     */</span>
    <span class="hljs-function"><span class="hljs-keyword">public</span> <span class="hljs-keyword">static</span> <span class="hljs-keyword">void</span> <span class="hljs-title">genKeyPair</span><span class="hljs-params">()</span> <span class="hljs-keyword">throws</span> NoSuchAlgorithmException </span>&#123;
        <span class="hljs-comment">// KeyPairGeneratorç±»ç”¨äºç”Ÿæˆå…¬é’¥å’Œç§é’¥å¯¹ï¼ŒåŸºäºRSAç®—æ³•ç”Ÿæˆå¯¹è±¡</span>
        KeyPairGenerator keyPairGen = KeyPairGenerator.getInstance(<span class="hljs-string">&quot;RSA&quot;</span>);
        <span class="hljs-comment">// åˆå§‹åŒ–å¯†é’¥å¯¹ç”Ÿæˆå™¨ï¼Œå¯†é’¥å¤§å°ä¸º96â€1024ä½</span>
        keyPairGen.initialize(<span class="hljs-number">1024</span>, <span class="hljs-keyword">new</span> SecureRandom());
        <span class="hljs-comment">// ç”Ÿæˆä¸€ä¸ªå¯†é’¥å¯¹ï¼Œä¿å­˜åœ¨keyPairä¸­</span>
        KeyPair keyPair = keyPairGen.generateKeyPair();
        privKey = <span class="hljs-keyword">new</span> String(Base64.encodeBase64((keyPair.getPrivate().getEncoded())));
        publicKey = <span class="hljs-keyword">new</span> String(Base64.encodeBase64(keyPair.getPublic().getEncoded()));
    &#125;

    <span class="hljs-comment">/**</span>
<span class="hljs-comment">     * RSAå…¬é’¥åŠ å¯†</span>
<span class="hljs-comment">     */</span>
    <span class="hljs-function"><span class="hljs-keyword">public</span> <span class="hljs-keyword">static</span> String <span class="hljs-title">encrypt</span><span class="hljs-params">(String str, String publicKey)</span> <span class="hljs-keyword">throws</span> Exception </span>&#123;
        <span class="hljs-comment">//base64ç¼–ç çš„å…¬é’¥ </span>
        <span class="hljs-keyword">byte</span>[] decoded = Base64.decodeBase64(publicKey);
        RSAPublicKey pubKey = (RSAPublicKey) KeyFactory.getInstance(<span class="hljs-string">&quot;RSA&quot;</span>).generatePublic(<span class="hljs-keyword">new</span> X509EncodedKeySpec(decoded));
        <span class="hljs-comment">//RSAåŠ å¯†</span>
        Cipher cipher = Cipher.getInstance(<span class="hljs-string">&quot;RSA&quot;</span>);
        cipher.init(Cipher.ENCRYPT_MODE, pubKey);
        String outStr = Base64.encodeBase64String(cipher.doFinal(str.getBytes(StandardCharsets.UTF_8)));
        <span class="hljs-keyword">return</span> outStr;
    &#125;

    <span class="hljs-comment">/**</span>
<span class="hljs-comment">     * RSAç§é’¥è§£å¯†</span>
<span class="hljs-comment">     */</span>
    <span class="hljs-function"><span class="hljs-keyword">public</span> <span class="hljs-keyword">static</span> String <span class="hljs-title">decrypt</span><span class="hljs-params">(String str, String privateKey)</span> <span class="hljs-keyword">throws</span> Exception </span>&#123;
        <span class="hljs-comment">//64ä½è§£ç åŠ å¯†åçš„å­—ç¬¦ä¸² </span>
        <span class="hljs-keyword">byte</span>[] inputByte = Base64.decodeBase64(str.getBytes(StandardCharsets.UTF_8));
        <span class="hljs-keyword">byte</span>[] decoded = Base64.decodeBase64(privateKey);
        RSAPrivateKey priKey = (RSAPrivateKey) KeyFactory.getInstance(<span class="hljs-string">&quot;RSA&quot;</span>).generatePrivate(<span class="hljs-keyword">new</span> PKCS8EncodedKeySpec(decoded));
        Cipher cipher = Cipher.getInstance(<span class="hljs-string">&quot;RSA&quot;</span>);
        cipher.init(Cipher.DECRYPT_MODE, priKey);
        <span class="hljs-keyword">return</span> <span class="hljs-keyword">new</span> String(cipher.doFinal(inputByte));
    &#125;
&#125;</code></pre>

<h5 id="ç»“æœåˆ†æ-20"><a href="#ç»“æœåˆ†æ-20" class="headerlink" title="ç»“æœåˆ†æ"></a>ç»“æœåˆ†æ</h5><pre><code class="hljs awk">æ˜æ–‡ï¼šæ¶æ„å¸ˆè®­ç»ƒè¥
éšæœºå…¬é’¥ä¸º:MIGfMA0GCSqGSIb3DQEBAQUAA4GNADCBiQKBgQCbuScdNarQtGJJMf9lGZ9KsD1ArYX7BFMxXDok7Wk75ItYkYJHJaOz2+EpGstXQb5XzBXUlT9pZTXsPHafhxFdLp3v9twc8clU890Wi7vxC755qcEp6Lr6uTT6t9hT295OkLjDwaE+OCAZBLKo8WDl7Z7oL05kxkPc0Id5SaBi7wIDAQAB
éšæœºç§é’¥ä¸º:MIICdQIBADANBgkqhkiG9w0BAQEFAASCAl8wggJbAgEAAoGBAJu5Jx01qtC0Ykkx<span class="hljs-regexp">/2UZn0qwPUCthfsEUzFcOiTtaTvki1iRgkclo7Pb4Skay1dBvlfMFdSVP2llNew8dp+HEV0une/</span><span class="hljs-number">23</span>BzxyVTz3RaLu<span class="hljs-regexp">/ELvnmpwSnouvq5NPq32FPb3k6QuMPBoT44IBkEsqjxYOXtnugvTmTGQ9zQh3lJoGLvAgMBAAECgYAXGSKlIYXByU/</span>e3YyteVx4XqXnRxXdgum4I574RULbwG2u6H5zgTDEB<span class="hljs-regexp">/Rg/</span>Xl16umJ6lq+mpi6UGnsLZfG1+kKNuTSLNkmXxk0UO1nIfAYC67BgL+bP21<span class="hljs-regexp">/wEBu5T9cpessLdyZDtx4LK6ORRBWLWA2UhRg+e/u</span>wDOIO+<span class="hljs-number">4</span>ezto3WQJBANkEOTSnkMTnvr3umpV290+Eh3ve4bR<span class="hljs-regexp">/eKBQxO3P+3CRvJq9AgBCGNszwhM/</span><span class="hljs-number">7</span>GQxJBZi9<span class="hljs-regexp">/7W6t/</span>M7hIPkEtSsJsCQQC3skhLCDGuv7xXA<span class="hljs-regexp">/IJuY9SjN6FLkIDtEZML8l02/</span>leowZHz7NxiYSBpBQQHLiOYz<span class="hljs-regexp">/lwKM0XdxWAtZsxMnC1so9AkB1h7EHkDx6N1v49xEnI0/</span>a89aAQnwQSfzlLfkJJltxYqw3TWeZBjL5<span class="hljs-regexp">/DT+Qd9ff7GgoibXEEQRwqWoiF9IO9dDAkBKqXbCsGDpItsdDuh4VWhQaBslTGjeco5D9wRNr/</span><span class="hljs-number">7</span>KHT63P08y7W7i9lqFNfc5QFO<span class="hljs-regexp">/QS3UYfXlK6AVc2KCA6UNAkBHEtQVQK4hr0bsTERt6t+FGFGsM2lc6PuBKMHt6phPTS0P5hCZZJM/</span>E/LBkPD4ZuP7zORK7ZEbff9mZj+c+<span class="hljs-number">61</span>J
å…¬é’¥åŠ å¯†:bDB0sRUj2rISKIklqNAq+EPn2ptp1zxvuWdtU<span class="hljs-regexp">/eH4frYVw98SqNEq3fC3HLTzNRc4B2KozykgUWWR1tlBzAnhOy1/</span>xuzzcwjFKonjZH0XR7mUzzz2glKN66vEdnFRngoleB9BpXk2nCuUCTmq6MJ2bxgc7pfAeCSFecDFixGcig=
ç§é’¥è§£å¯†:æ¶æ„å¸ˆè®­ç»ƒè¥</code></pre>

<ul>
<li><p>åŠ å¯†è§£å¯†å®ç°å®Œæ•´è¿˜åŸ </p>
</li>
<li><p>å¿…é¡»ç”¨å¦ä¸€æŠŠé’¥åŒ™è§£å¯†ï¼Œå¦‚æœç”¨å…¬é’¥åŠ å¯†åå†ä½¿ç”¨å…¬é’¥è§£å¯†ï¼Œåˆ™å¤±è´¥ </p>
</li>
</ul>
<h3 id="ä¸€è‡´æ€§hashåŠå…¶åº”ç”¨"><a href="#ä¸€è‡´æ€§hashåŠå…¶åº”ç”¨" class="headerlink" title="ä¸€è‡´æ€§hashåŠå…¶åº”ç”¨"></a>ä¸€è‡´æ€§<strong>hash</strong>åŠå…¶åº”ç”¨</h3><h4 id="èƒŒæ™¯"><a href="#èƒŒæ™¯" class="headerlink" title="èƒŒæ™¯"></a>èƒŒæ™¯</h4><p>è´Ÿè½½å‡è¡¡ç­–ç•¥ä¸­ï¼Œæˆ‘ä»¬æåˆ°è¿‡æºåœ°å€hashç®—æ³•ï¼Œè®©æŸäº›è¯·æ±‚å›ºå®šçš„è½åœ¨å¯¹åº”çš„æœåŠ¡å™¨ä¸Šã€‚è¿™æ ·å¯ä»¥è§£å†³ä¼šè¯ä¿¡æ¯ä¿ç•™çš„é—®é¢˜ã€‚ </p>
<p>å¦‚æœæœºå™¨èŠ‚ç‚¹æ•°å‘ç”Ÿå˜æ›´ã€‚é‚£ä¹ˆè¯·æ±‚ä¼šè¢«é‡æ–°hashï¼Œæ‰“ç ´äº†åŸå§‹çš„è®¾è®¡åˆè¡·ï¼Œè¿™æ—¶å°±éœ€è¦ä¸€è‡´æ€§hashæ¥è§£å†³ã€‚</p>
<h4 id="åŸç†"><a href="#åŸç†" class="headerlink" title="åŸç†"></a>åŸç†</h4><p>ä»¥4å°æœºå™¨ä¸ºä¾‹ï¼Œä¸€è‡´æ€§hashçš„ç®—æ³•å¦‚ä¸‹ï¼š</p>
<ul>
<li><p>é¦–å…ˆæ±‚å‡ºå„ä¸ªæœåŠ¡å™¨çš„å“ˆå¸Œå€¼ï¼Œå¹¶å°†å…¶é…ç½®åˆ°0ï½232çš„åœ†ä¸Š </p>
</li>
<li><p>ç„¶åé‡‡ç”¨åŒæ ·çš„æ–¹æ³•æ±‚å‡ºå­˜å‚¨æ•°æ®çš„é”®çš„å“ˆå¸Œå€¼ï¼Œä¹Ÿæ˜ å°„åœ†ä¸Š </p>
</li>
<li><p>ä»æ•°æ®æ˜ å°„åˆ°çš„ä½ç½®å¼€å§‹é¡ºæ—¶é’ˆæŸ¥æ‰¾ï¼Œå°†æ•°æ®ä¿å­˜åˆ°æ‰¾åˆ°çš„ç¬¬ä¸€ä¸ªæœåŠ¡å™¨ä¸Š </p>
</li>
<li><p>å¦‚æœåˆ°æœ€å¤§å€¼ä»ç„¶æ‰¾ä¸åˆ°ï¼Œå°±å–ç¬¬ä¸€ä¸ªã€‚è¿™å°±æ˜¯ä¸ºå•¥å½¢è±¡çš„ç§°ä¹‹ä¸ºç¯ </p>
</li>
</ul>
<img src="/blog/2020/08/16/%E6%95%B0%E6%8D%AE%E7%BB%93%E6%9E%84-%E5%B8%B8%E8%A7%81%E7%AE%97%E6%B3%95%E4%B8%8E%E5%BA%94%E7%94%A8/pic9.png" srcset="/blog/img/loading.gif" class>

<p>æ·»åŠ èŠ‚ç‚¹ï¼š</p>
<img src="/blog/2020/08/16/%E6%95%B0%E6%8D%AE%E7%BB%93%E6%9E%84-%E5%B8%B8%E8%A7%81%E7%AE%97%E6%B3%95%E4%B8%8E%E5%BA%94%E7%94%A8/pic10.png" srcset="/blog/img/loading.gif" class>

<h4 id="ç‰¹æ€§"><a href="#ç‰¹æ€§" class="headerlink" title="ç‰¹æ€§"></a>ç‰¹æ€§</h4><ul>
<li><p>å•è°ƒæ€§(Monotonicity)ï¼šå•è°ƒæ€§æ˜¯æŒ‡å¦‚æœå·²ç»æœ‰ä¸€äº›è¯·æ±‚é€šè¿‡å“ˆå¸Œåˆ†æ´¾åˆ°äº†ç›¸åº”çš„æœåŠ¡å™¨è¿›è¡Œå¤„ç†ï¼Œåˆæœ‰æ–°çš„æœåŠ¡å™¨åŠ å…¥åˆ°ç³»ç»Ÿä¸­æ—¶å€™ï¼Œåº”ä¿è¯åŸæœ‰çš„è¯·æ±‚å¯ä»¥è¢«æ˜ å°„åˆ°åŸæœ‰çš„æˆ–è€…æ–°çš„æœåŠ¡å™¨ä¸­å»ï¼Œè€Œä¸ä¼šè¢«æ˜ å°„åˆ°åŸæ¥çš„å…¶å®ƒæœåŠ¡å™¨ä¸Šå»ã€‚ </p>
</li>
<li><p>åˆ†æ•£æ€§(Spread)ï¼šåˆ†å¸ƒå¼ç¯å¢ƒä¸­ï¼Œå®¢æˆ·ç«¯è¯·æ±‚æ—¶å¯èƒ½åªçŸ¥é“å…¶ä¸­ä¸€éƒ¨åˆ†æœåŠ¡å™¨ï¼Œé‚£ä¹ˆä¸¤ä¸ªå®¢æˆ·ç«¯çœ‹åˆ°ä¸åŒçš„éƒ¨åˆ†ï¼Œå¹¶ä¸”è®¤ä¸ºè‡ªå·±çœ‹åˆ°çš„éƒ½æ˜¯å®Œæ•´çš„hashç¯ï¼Œé‚£ä¹ˆé—®é¢˜æ¥äº†ï¼Œç›¸åŒçš„keyå¯èƒ½è¢«è·¯ç”±åˆ°ä¸åŒæœåŠ¡å™¨ä¸Šå»ã€‚ä»¥ä¸Šå›¾ä¸ºä¾‹ï¼ŒåŠ å…¥client1çœ‹åˆ°çš„æ˜¯1,4ï¼›client2çœ‹åˆ°çš„æ˜¯2,3ï¼›é‚£ä¹ˆ2-4ä¹‹é—´çš„keyä¼šè¢«ä¿©å®¢æˆ·ç«¯é‡å¤æ˜ å°„åˆ°3,4ä¸Šå»ã€‚åˆ†æ•£æ€§ååº”çš„æ˜¯è¿™ç§é—®é¢˜çš„ä¸¥é‡ç¨‹åº¦ã€‚ </p>
</li>
<li><p>å¹³è¡¡æ€§(Balance)ï¼šå¹³è¡¡æ€§æ˜¯æŒ‡å®¢æˆ·ç«¯hashåçš„è¯·æ±‚åº”è¯¥èƒ½å¤Ÿåˆ†æ•£åˆ°ä¸åŒçš„æœåŠ¡å™¨ä¸Šå»ã€‚ä¸€è‡´æ€§hashå¯ä»¥åšåˆ°å°½é‡åˆ†æ•£ï¼Œä½†æ˜¯ä¸èƒ½ä¿è¯æ¯ä¸ªæœåŠ¡å™¨å¤„ç†çš„è¯·æ±‚çš„æ•°é‡å®Œå…¨ç›¸åŒã€‚è¿™ç§åå·®ç§°ä¸ºhashå€¾æ–œã€‚å¦‚æœèŠ‚ç‚¹çš„åˆ†å¸ƒç®—æ³•è®¾è®¡ä¸åˆç†ï¼Œé‚£ä¹ˆå¹³è¡¡æ€§å°±ä¼šæ”¶åˆ°å¾ˆå¤§çš„å½±å“ã€‚ </p>
</li>
</ul>
<p>ä¼˜åŒ–</p>
<p>å¢åŠ è™šæ‹ŸèŠ‚ç‚¹å¯ä»¥ä¼˜åŒ–hashç®—æ³•ï¼Œä½¿å¾—åˆ‡æ®µå’Œåˆ†å¸ƒæ›´ç»†åŒ–ã€‚å³å®é™…æœ‰må°æœºå™¨ï¼Œä½†æ˜¯æ‰©å……nå€ï¼Œåœ¨ç¯ä¸Šæ”¾ç½®m*nä¸ªï¼Œé‚£ä¹ˆå‡åˆ†åï¼Œkeyçš„æ®µä¼šåˆ†å¸ƒæ›´ç»†åŒ–ã€‚</p>
<img src="/blog/2020/08/16/%E6%95%B0%E6%8D%AE%E7%BB%93%E6%9E%84-%E5%B8%B8%E8%A7%81%E7%AE%97%E6%B3%95%E4%B8%8E%E5%BA%94%E7%94%A8/pic11.png" srcset="/blog/img/loading.gif" class>

<h3 id="å®ç°-21"><a href="#å®ç°-21" class="headerlink" title="å®ç°"></a>å®ç°</h3><pre><code class="hljs java"><span class="hljs-keyword">package</span> com.itheima.hash;

<span class="hljs-keyword">import</span> java.util.SortedMap;
<span class="hljs-keyword">import</span> java.util.TreeMap;

<span class="hljs-comment">/**</span>
<span class="hljs-comment"> * ä¸€è‡´æ€§Hashç®—æ³•</span>
<span class="hljs-comment"> */</span>
<span class="hljs-keyword">public</span> <span class="hljs-class"><span class="hljs-keyword">class</span> <span class="hljs-title">Hash</span> </span>&#123;
    <span class="hljs-comment">//æœåŠ¡å™¨åˆ—è¡¨</span>
    <span class="hljs-keyword">private</span> <span class="hljs-keyword">static</span> String[] servers = &#123;<span class="hljs-string">&quot;192.168.0.1&quot;</span>, <span class="hljs-string">&quot;192.168.0.2&quot;</span>, <span class="hljs-string">&quot;192.168.0.3&quot;</span>, <span class="hljs-string">&quot;192.168.0.4&quot;</span>&#125;;
    <span class="hljs-comment">//keyè¡¨ç¤ºæœåŠ¡å™¨çš„hashå€¼ï¼Œvalueè¡¨ç¤ºæœåŠ¡å™¨</span>
    <span class="hljs-keyword">private</span> <span class="hljs-keyword">static</span> SortedMap&lt;Integer, String&gt; serverMap = <span class="hljs-keyword">new</span> TreeMap&lt;Integer, String&gt;();

    <span class="hljs-keyword">static</span> &#123;
        <span class="hljs-keyword">for</span> (<span class="hljs-keyword">int</span> i = <span class="hljs-number">0</span>; i &lt; servers.length; i++) &#123;
            <span class="hljs-keyword">int</span> hash = getHash(servers[i]);
            <span class="hljs-comment">//ç†è®ºä¸Šï¼Œhashç¯çš„æœ€å¤§å€¼ä¸º2^32</span>
            <span class="hljs-comment">// è¿™é‡Œä¸ºåšå®ä¾‹ï¼Œå°†ipæœ«å°¾ä½œä¸ºä¸Šé™ä¹Ÿå°±æ˜¯254</span>
            <span class="hljs-comment">// é‚£ä¹ˆæœåŠ¡å™¨æ˜¯0â€4ï¼Œä¹˜ä»¥60åå¯ä»¥å‡åŒ€åˆ†å¸ƒåˆ° 0â€254 çš„ç¯ä¸Šå»</span>
            <span class="hljs-comment">// å®é™…çš„è¯·æ±‚ipåˆ°æ¥æ—¶ï¼Œåœ¨ç¯ä¸ŠæŸ¥æ‰¾å³å¯</span>
            hash *= <span class="hljs-number">60</span>;
            System.out.println(<span class="hljs-string">&quot;add &quot;</span> + servers[i] + <span class="hljs-string">&quot;, hash=&quot;</span> + hash);
            serverMap.put(hash, servers[i]);
        &#125;
    &#125;

    <span class="hljs-comment">//æŸ¥æ‰¾èŠ‚ç‚¹</span>
    <span class="hljs-function"><span class="hljs-keyword">private</span> <span class="hljs-keyword">static</span> String <span class="hljs-title">getServer</span><span class="hljs-params">(String key)</span> </span>&#123;
        <span class="hljs-keyword">int</span> hash = getHash(key);
        <span class="hljs-comment">//å¾—åˆ°å¤§äºè¯¥Hashå€¼çš„æ‰€æœ‰server</span>
        SortedMap&lt;Integer, String&gt; subMap = serverMap.tailMap(hash);
        <span class="hljs-keyword">if</span> (subMap.isEmpty()) &#123;
            <span class="hljs-comment">//å¦‚æœæ²¡æœ‰æ¯”è¯¥keyçš„hashå€¼å¤§çš„ï¼Œåˆ™ä»ç¬¬ä¸€ä¸ªnodeå¼€å§‹</span>
            Integer i = serverMap.firstKey();
            <span class="hljs-comment">//è¿”å›å¯¹åº”çš„æœåŠ¡å™¨</span>
            <span class="hljs-keyword">return</span> serverMap.get(i);
        &#125; <span class="hljs-keyword">else</span> &#123;
            <span class="hljs-comment">//ç¬¬ä¸€ä¸ªKeyå°±æ˜¯é¡ºæ—¶é’ˆè¿‡å»ç¦»nodeæœ€è¿‘çš„é‚£ä¸ªç»“ç‚¹</span>
            Integer i = subMap.firstKey();
            <span class="hljs-comment">//è¿”å›å¯¹åº”çš„æœåŠ¡å™¨</span>
            <span class="hljs-keyword">return</span> subMap.get(i);
        &#125;
    &#125;

    <span class="hljs-comment">//è¿ç®—hashå€¼</span>
    <span class="hljs-comment">// è¯¥å‡½æ•°å¯ä»¥è‡ªç”±å®šä¹‰ï¼Œåªè¦åšåˆ°å–å€¼ç¦»æ•£å³å¯</span>
    <span class="hljs-comment">// è¿™é‡Œå–ipåœ°å€çš„æœ€åä¸€èŠ‚</span>
    <span class="hljs-function"><span class="hljs-keyword">private</span> <span class="hljs-keyword">static</span> <span class="hljs-keyword">int</span> <span class="hljs-title">getHash</span><span class="hljs-params">(String str)</span> </span>&#123;


        String last = str.substring(str.lastIndexOf(<span class="hljs-string">&quot;.&quot;</span>) + <span class="hljs-number">1</span>, str.length());
        <span class="hljs-keyword">return</span> Integer.valueOf(last);
    &#125;

    <span class="hljs-function"><span class="hljs-keyword">public</span> <span class="hljs-keyword">static</span> <span class="hljs-keyword">void</span> <span class="hljs-title">main</span><span class="hljs-params">(String[] args)</span> </span>&#123;
        <span class="hljs-comment">//æ¨¡æ‹Ÿ5ä¸ªéšæœºipè¯·æ±‚ </span>
        <span class="hljs-keyword">for</span> (<span class="hljs-keyword">int</span> i = <span class="hljs-number">1</span>; i &lt; <span class="hljs-number">8</span>; i++) &#123;
            String ip = <span class="hljs-string">&quot;192.168.1.&quot;</span> + i * <span class="hljs-number">30</span>;
            System.out.println(ip + <span class="hljs-string">&quot; â€â€â€&gt; &quot;</span> + getServer(ip));
        &#125;
        <span class="hljs-comment">//å°†5å·æœåŠ¡å™¨åŠ åˆ°2â€3ä¹‹é—´ï¼Œå–ä¸­é—´ä½ç½®ï¼Œ150 </span>
        System.out.println(<span class="hljs-string">&quot;add 192.168.0.5ï¼Œhash=150&quot;</span>);
        serverMap.put(<span class="hljs-number">150</span>, <span class="hljs-string">&quot;192.168.0.5&quot;</span>);
        <span class="hljs-comment">//å†æ¬¡å‘èµ·5ä¸ªè¯·æ±‚ </span>
        <span class="hljs-keyword">for</span> (<span class="hljs-keyword">int</span> i = <span class="hljs-number">1</span>; i &lt; <span class="hljs-number">8</span>; i++) &#123;
            String ip = <span class="hljs-string">&quot;192.168.1.&quot;</span> + i * <span class="hljs-number">30</span>;
            System.out.println(ip + <span class="hljs-string">&quot; â€â€â€&gt; &quot;</span> + getServer(ip));
        &#125;
    &#125;
&#125;</code></pre>

<h4 id="éªŒè¯"><a href="#éªŒè¯" class="headerlink" title="éªŒè¯"></a>éªŒè¯</h4><pre><code class="hljs accesslog">add <span class="hljs-number">192</span>.<span class="hljs-number">168</span>.<span class="hljs-number">0</span>.<span class="hljs-number">1</span>, hash=<span class="hljs-number">60</span>
add <span class="hljs-number">192</span>.<span class="hljs-number">168</span>.<span class="hljs-number">0</span>.<span class="hljs-number">2</span>, hash=<span class="hljs-number">120</span>
add <span class="hljs-number">192</span>.<span class="hljs-number">168</span>.<span class="hljs-number">0</span>.<span class="hljs-number">3</span>, hash=<span class="hljs-number">180</span>
add <span class="hljs-number">192</span>.<span class="hljs-number">168</span>.<span class="hljs-number">0</span>.<span class="hljs-number">4</span>, hash=<span class="hljs-number">240</span>
<span class="hljs-number">192.168.1.30</span> â€â€â€&gt; <span class="hljs-number">192</span>.<span class="hljs-number">168</span>.<span class="hljs-number">0</span>.<span class="hljs-number">1</span>
<span class="hljs-number">192.168.1.60</span> â€â€â€&gt; <span class="hljs-number">192</span>.<span class="hljs-number">168</span>.<span class="hljs-number">0</span>.<span class="hljs-number">1</span>
<span class="hljs-number">192.168.1.90</span> â€â€â€&gt; <span class="hljs-number">192</span>.<span class="hljs-number">168</span>.<span class="hljs-number">0</span>.<span class="hljs-number">2</span>
<span class="hljs-number">192.168.1.120</span> â€â€â€&gt; <span class="hljs-number">192</span>.<span class="hljs-number">168</span>.<span class="hljs-number">0</span>.<span class="hljs-number">2</span>
<span class="hljs-number">192.168.1.150</span> â€â€â€&gt; <span class="hljs-number">192</span>.<span class="hljs-number">168</span>.<span class="hljs-number">0</span>.<span class="hljs-number">3</span>
<span class="hljs-number">192.168.1.180</span> â€â€â€&gt; <span class="hljs-number">192</span>.<span class="hljs-number">168</span>.<span class="hljs-number">0</span>.<span class="hljs-number">3</span>
<span class="hljs-number">192.168.1.210</span> â€â€â€&gt; <span class="hljs-number">192</span>.<span class="hljs-number">168</span>.<span class="hljs-number">0</span>.<span class="hljs-number">4</span>
add <span class="hljs-number">192</span>.<span class="hljs-number">168</span>.<span class="hljs-number">0</span>.<span class="hljs-number">5</span>ï¼Œhash=<span class="hljs-number">150</span>
<span class="hljs-number">192.168.1.30</span> â€â€â€&gt; <span class="hljs-number">192</span>.<span class="hljs-number">168</span>.<span class="hljs-number">0</span>.<span class="hljs-number">1</span>
<span class="hljs-number">192.168.1.60</span> â€â€â€&gt; <span class="hljs-number">192</span>.<span class="hljs-number">168</span>.<span class="hljs-number">0</span>.<span class="hljs-number">1</span>
<span class="hljs-number">192.168.1.90</span> â€â€â€&gt; <span class="hljs-number">192</span>.<span class="hljs-number">168</span>.<span class="hljs-number">0</span>.<span class="hljs-number">2</span>
<span class="hljs-number">192.168.1.120</span> â€â€â€&gt; <span class="hljs-number">192</span>.<span class="hljs-number">168</span>.<span class="hljs-number">0</span>.<span class="hljs-number">2</span>
<span class="hljs-number">192.168.1.150</span> â€â€â€&gt; <span class="hljs-number">192</span>.<span class="hljs-number">168</span>.<span class="hljs-number">0</span>.<span class="hljs-number">5</span>
<span class="hljs-number">192.168.1.180</span> â€â€â€&gt; <span class="hljs-number">192</span>.<span class="hljs-number">168</span>.<span class="hljs-number">0</span>.<span class="hljs-number">3</span>
<span class="hljs-number">192.168.1.210</span> â€â€â€&gt; <span class="hljs-number">192</span>.<span class="hljs-number">168</span>.<span class="hljs-number">0</span>.<span class="hljs-number">4</span></code></pre>

<ul>
<li><p>4å°æœºå™¨åŠ å…¥hashç¯ </p>
</li>
<li><p>æ¨¡æ‹Ÿè¯·æ±‚ï¼Œæ ¹æ®hashå€¼ï¼Œå‡†ç¡®è°ƒåº¦åˆ°ä¸‹æ¸¸èŠ‚ç‚¹ </p>
</li>
<li><p>æ·»åŠ èŠ‚ç‚¹5ï¼Œkeyå–150 </p>
</li>
<li><p>å†æ¬¡å‘èµ·è¯·æ±‚ </p>
</li>
</ul>
<h3 id="å…¸å‹ä¸šåŠ¡åœºæ™¯åº”ç”¨"><a href="#å…¸å‹ä¸šåŠ¡åœºæ™¯åº”ç”¨" class="headerlink" title="å…¸å‹ä¸šåŠ¡åœºæ™¯åº”ç”¨"></a>å…¸å‹ä¸šåŠ¡åœºæ™¯åº”ç”¨</h3><h4 id="ç½‘ç«™æ•æ„Ÿè¯è¿‡æ»¤"><a href="#ç½‘ç«™æ•æ„Ÿè¯è¿‡æ»¤" class="headerlink" title="ç½‘ç«™æ•æ„Ÿè¯è¿‡æ»¤"></a>ç½‘ç«™æ•æ„Ÿè¯è¿‡æ»¤</h4><h5 id="åœºæ™¯"><a href="#åœºæ™¯" class="headerlink" title="åœºæ™¯"></a>åœºæ™¯</h5><p>æ•æ„Ÿè¯ã€æ–‡å­—è¿‡æ»¤æ˜¯ä¸€ä¸ªç½‘ç«™å¿…ä¸å¯å°‘çš„åŠŸèƒ½ï¼Œé«˜æ•ˆçš„è¿‡æ»¤ç®—æ³•æ˜¯éå¸¸æœ‰å¿…è¦çš„ã€‚é’ˆå¯¹è¿‡æ»¤é¦–å…ˆæƒ³åˆ°çš„å¯èƒ½æ˜¯è¿™æ ·ï¼š</p>
<p>æ–¹æ¡ˆä¸€ã€ä½¿ç”¨javaé‡Œçš„String containsï¼Œé€ä¸ªéå†æ•æ„Ÿè¯ï¼š </p>
<pre><code class="hljs java">String[] s = <span class="hljs-string">&quot;å¹¿å‘Š,å¹¿å‘Šè¯,ä¸­å¥–&quot;</span>.split(<span class="hljs-string">&quot;,&quot;</span>);
String text = <span class="hljs-string">&quot;è®¨åŒçš„å¹¿å‘Šè¯&quot;</span>;
<span class="hljs-keyword">boolean</span> flag = <span class="hljs-keyword">false</span>;
<span class="hljs-keyword">for</span> (String s1 : s) &#123;
    <span class="hljs-keyword">if</span> (text.contains(s1)) &#123;
        flag = <span class="hljs-keyword">true</span>;
        <span class="hljs-keyword">break</span>;
    &#125;
&#125;
System.out.println(flag);</code></pre>

<p>æ–¹æ¡ˆäºŒã€æ­£åˆ™è¡¨è¾¾å¼ï¼š </p>
<pre><code class="hljs java">System.out.println(text.matches(<span class="hljs-string">&quot;.*(å¹¿å‘Š|å¹¿å‘Šè¯|ä¸­å¥–).*&quot;</span>));</code></pre>

<p>å…¶å®æ— è®ºé‡‡å–å“ªä¸ªæ–¹æ³•ï¼ŒåŸºæœ¬æ˜¯æ¢æ±¤ä¸æ¢è¯ã€‚éƒ½æ˜¯æ•´ä½“å­—ç¬¦åŒ¹é…ï¼Œæ•ˆç‡å€¼å¾—å•†æ¦·ã€‚ </p>
<p>é‚£æ€ä¹ˆåŠå‘¢ï¼ŸDFAç®—æ³•å‡ºåœºã€‚</p>
<h5 id="æ¦‚è¿°-19"><a href="#æ¦‚è¿°-19" class="headerlink" title="æ¦‚è¿°"></a>æ¦‚è¿°</h5><p>DFAå³Deterministic Finite Automatonï¼Œä¹Ÿå°±æ˜¯ç¡®å®šæœ‰ç©·è‡ªåŠ¨æœºï¼Œå®ƒæ˜¯æ˜¯é€šè¿‡eventå’Œå½“å‰çš„stateå¾—åˆ°ä¸‹ä¸€ä¸ªstateï¼Œå³event+state=nextstateã€‚ </p>
<p>å¯¹ç…§åˆ°ä»¥ä¸Šæ¡ˆä¾‹ï¼ŒæŸ¥æ‰¾å’Œåœæ­¢æŸ¥æ‰¾æ˜¯åŠ¨ä½œï¼Œæ‰¾æ²¡æ‰¾åˆ°æ˜¯çŠ¶æ€ï¼Œæ¯ä¸€æ­¥çš„æŸ¥æ‰¾å’Œç»“æœå†³å®šä¸‹ä¸€æ­¥è¦ä¸è¦ç»§ç»­ã€‚DFAç®—æ³•åœ¨æ•æ„Ÿè¯ä¸Šåº”ç”¨çš„å…³é”®æ˜¯æ„å»ºæ•æ„Ÿè¯åº“ï¼Œå¦‚æœæˆ‘ä»¬æŠŠä»¥ä¸Šæ¡ˆä¾‹ç¿»è¯‘æˆjsonè¡¨è¾¾å¦‚ä¸‹ï¼š</p>
<pre><code class="hljs json">&#123;
	<span class="hljs-attr">&quot;isEnd&quot;</span>: <span class="hljs-number">0</span>,
	<span class="hljs-attr">&quot;å¹¿&quot;</span>: &#123;
		<span class="hljs-attr">&quot;isEnd&quot;</span>: <span class="hljs-number">0</span>,
		<span class="hljs-attr">&quot;å‘Š&quot;</span>: &#123;
			<span class="hljs-attr">&quot;isEnd&quot;</span>: <span class="hljs-number">1</span>,
			<span class="hljs-attr">&quot;è¯&quot;</span>: &#123;
				<span class="hljs-attr">&quot;isEnd&quot;</span>: <span class="hljs-number">1</span>
			&#125;
		&#125;
	&#125;,
	<span class="hljs-attr">&quot;ä¸­&quot;</span>: &#123;
		<span class="hljs-attr">&quot;isEnd&quot;</span>: <span class="hljs-number">0</span>,
		<span class="hljs-attr">&quot;å¥–&quot;</span>: &#123;
			<span class="hljs-attr">&quot;isEnd&quot;</span>: <span class="hljs-number">1</span>
		&#125;
	&#125;
&#125;</code></pre>

<p>æŸ¥æ‰¾è¿‡ç¨‹å¦‚ä¸‹ï¼šé¦–å…ˆæŠŠtextæŒ‰å­—æ‹†åˆ†ï¼Œé€ä¸ªå­—æŸ¥æ‰¾è¯åº“çš„keyï¼Œå…ˆä»â€œè®¨â€å¼€å§‹ï¼Œæ²¡æœ‰å°±ä¸‹ä¸€ä¸ªå­—â€œåŒâ€ï¼Œç›´åˆ°â€œå¹¿â€ï¼Œæ‰¾åˆ°å°±åˆ¤æ–­isEndï¼Œå¦‚æœä¸º1ï¼Œè¯´æ˜åŒ¹é…æˆåŠŸåŒ…å«æ•æ„Ÿè¯ï¼Œå¦‚æœä¸º0ï¼Œé‚£å°±ç»§ç»­åŒ¹é…â€œå‘Šâ€ï¼Œç›´åˆ°isEnd=1ä¸ºæ­¢ã€‚ </p>
<p>åŒ¹é…ç­–ç•¥ä¸Šï¼Œæœ‰ä¸¤ç§ã€‚æœ€å°å’Œæœ€å¤§åŒ¹é…ã€‚æœ€å°åˆ™åŒ¹é…ã€å¹¿å‘Šã€‘ï¼Œæœ€å¤§åˆ™éœ€è¦åŒ¹é…åˆ°åº•ã€å¹¿å‘Šè¯ã€‘ </p>
<h5 id="å®ç°-22"><a href="#å®ç°-22" class="headerlink" title="å®ç°"></a>å®ç°</h5><pre><code class="hljs java"><span class="hljs-keyword">package</span> com.itheima.hash;

<span class="hljs-keyword">import</span> com.alibaba.fastjson.JSON;

<span class="hljs-keyword">import</span> java.util.HashMap;
<span class="hljs-keyword">import</span> java.util.HashSet;
<span class="hljs-keyword">import</span> java.util.Map;
<span class="hljs-keyword">import</span> java.util.Set;

<span class="hljs-comment">/**</span>
<span class="hljs-comment"> * æ•æ„Ÿè¯å¤„ç†DFAç®—æ³•</span>
<span class="hljs-comment"> */</span>

<span class="hljs-keyword">public</span> <span class="hljs-class"><span class="hljs-keyword">class</span> <span class="hljs-title">SensitiveWordUtil</span> </span>&#123;
    <span class="hljs-comment">//çŸ­åŒ¹é…è§„åˆ™ï¼Œå¦‚ï¼šæ•æ„Ÿè¯åº“[&quot;å¹¿å‘Š&quot;,&quot;å¹¿å‘Šè¯&quot;]ï¼Œè¯­å¥ï¼š&quot;æˆ‘æ˜¯å¹¿å‘Šè¯&quot;ï¼ŒåŒ¹é…ç»“æœï¼šæˆ‘æ˜¯[å¹¿å‘Š]</span>
    <span class="hljs-keyword">public</span> <span class="hljs-keyword">static</span> <span class="hljs-keyword">final</span> <span class="hljs-keyword">int</span> SHORT_MATCH = <span class="hljs-number">1</span>;
    <span class="hljs-comment">//é•¿åŒ¹é…è§„åˆ™ï¼Œå¦‚ï¼šæ•æ„Ÿè¯åº“[&quot;å¹¿å‘Š&quot;,&quot;å¹¿å‘Šè¯&quot;]ï¼Œè¯­å¥ï¼š&quot;æˆ‘æ˜¯å¹¿å‘Šè¯&quot;ï¼ŒåŒ¹é…ç»“æœï¼šæˆ‘æ˜¯[å¹¿å‘Šè¯]</span>
    <span class="hljs-keyword">public</span> <span class="hljs-keyword">static</span> <span class="hljs-keyword">final</span> <span class="hljs-keyword">int</span> LONG_MATCH = <span class="hljs-number">2</span>;
    <span class="hljs-comment">/**</span>
<span class="hljs-comment">     * æ•æ„Ÿè¯åº“</span>
<span class="hljs-comment">     */</span>
    <span class="hljs-keyword">public</span> <span class="hljs-keyword">static</span> HashMap sensitiveWordMap;

    <span class="hljs-comment">/**</span>
<span class="hljs-comment">     * åˆå§‹åŒ–æ•æ„Ÿè¯åº“</span>
<span class="hljs-comment">     * words:æ•æ„Ÿè¯ï¼Œå¤šä¸ªç”¨è‹±æ–‡é€—å·åˆ†éš”</span>
<span class="hljs-comment">     */</span>
    <span class="hljs-function"><span class="hljs-keyword">private</span> <span class="hljs-keyword">static</span> <span class="hljs-keyword">void</span> <span class="hljs-title">initSensitiveWordMap</span><span class="hljs-params">(String words)</span> </span>&#123;
        String[] w = words.split(<span class="hljs-string">&quot;,&quot;</span>);
        sensitiveWordMap = <span class="hljs-keyword">new</span> HashMap(w.length);
        Map nowMap;
        <span class="hljs-keyword">for</span> (String key : w) &#123;
            nowMap = sensitiveWordMap;
            <span class="hljs-keyword">for</span> (<span class="hljs-keyword">int</span> i = <span class="hljs-number">0</span>; i &lt; key.length(); i++) &#123;
                <span class="hljs-comment">//è½¬æ¢æˆcharå‹</span>
                <span class="hljs-keyword">char</span> keyChar = key.charAt(i);
                <span class="hljs-comment">//åº“ä¸­è·å–å…³é”®å­—</span>
                Map wordMap = (Map) nowMap.get(keyChar);
                <span class="hljs-comment">//å¦‚æœä¸å­˜åœ¨æ–°å»ºä¸€ä¸ªï¼Œå¹¶åŠ å…¥è¯åº“</span>
                <span class="hljs-keyword">if</span> (wordMap == <span class="hljs-keyword">null</span>) &#123;
                    wordMap = <span class="hljs-keyword">new</span> HashMap();
                    wordMap.put(<span class="hljs-string">&quot;isEnd&quot;</span>, <span class="hljs-string">&quot;0&quot;</span>);
                    nowMap.put(keyChar, wordMap);
                &#125;
                nowMap = wordMap;
                <span class="hljs-keyword">if</span> (i == key.length() - <span class="hljs-number">1</span>) &#123;
                    <span class="hljs-comment">//æœ€åä¸€ä¸ª</span>
                    nowMap.put(<span class="hljs-string">&quot;isEnd&quot;</span>, <span class="hljs-string">&quot;1&quot;</span>);
                &#125;
            &#125;
        &#125;
    &#125;

    <span class="hljs-comment">/**</span>
<span class="hljs-comment">     * åˆ¤æ–­æ–‡å­—æ˜¯å¦åŒ…å«æ•æ„Ÿå­—ç¬¦ *<span class="hljs-doctag">@return</span> è‹¥åŒ…å«è¿”å›trueï¼Œå¦åˆ™è¿”å›false</span>
<span class="hljs-comment">     */</span>
    <span class="hljs-function"><span class="hljs-keyword">public</span> <span class="hljs-keyword">static</span> <span class="hljs-keyword">boolean</span> <span class="hljs-title">contains</span><span class="hljs-params">(String txt, <span class="hljs-keyword">int</span> matchType)</span> </span>&#123;
        <span class="hljs-keyword">for</span> (<span class="hljs-keyword">int</span> i = <span class="hljs-number">0</span>; i &lt; txt.length(); i++) &#123;
            <span class="hljs-keyword">int</span> matchFlag = checkSensitiveWord(txt, i, matchType);
            <span class="hljs-comment">//åˆ¤æ–­æ˜¯å¦åŒ…å«æ•æ„Ÿå­—ç¬¦</span>
            <span class="hljs-keyword">if</span> (matchFlag &gt; <span class="hljs-number">0</span>) &#123;
                <span class="hljs-comment">//å¤§äº0å­˜åœ¨ï¼Œè¿”å›true</span>
                <span class="hljs-keyword">return</span> <span class="hljs-keyword">true</span>;
            &#125;
        &#125;
        <span class="hljs-keyword">return</span> <span class="hljs-keyword">false</span>;
    &#125;

    <span class="hljs-comment">/*** æ²¿ç€æ–‡æœ¬å­—ç¬¦æŒ¨ä¸ªå¾€åæ£€ç´¢æ–‡å­—ä¸­çš„æ•æ„Ÿè¯ */</span>
    <span class="hljs-function"><span class="hljs-keyword">public</span> <span class="hljs-keyword">static</span> Set&lt;String&gt; <span class="hljs-title">getSensitiveWord</span><span class="hljs-params">(String txt, <span class="hljs-keyword">int</span> matchType)</span> </span>&#123;
        Set&lt;String&gt; sensitiveWordList = <span class="hljs-keyword">new</span> HashSet&lt;&gt;();
        <span class="hljs-keyword">for</span> (<span class="hljs-keyword">int</span> i = <span class="hljs-number">0</span>; i &lt; txt.length(); i++) &#123;
            <span class="hljs-comment">//åˆ¤æ–­æ˜¯å¦åŒ…å«æ•æ„Ÿå­—ç¬¦</span>
            <span class="hljs-keyword">int</span> length = checkSensitiveWord(txt, i, matchType);
            <span class="hljs-keyword">if</span> (length &gt; <span class="hljs-number">0</span>) &#123;
                <span class="hljs-comment">//å­˜åœ¨,åŠ å…¥listä¸­</span>
                sensitiveWordList.add(txt.substring(i, i + length));
                <span class="hljs-comment">//æŒ‡é’ˆæ²¿ç€æ–‡æœ¬å¾€åç§»åŠ¨æ•æ„Ÿè¯çš„é•¿åº¦</span>
                <span class="hljs-comment">// ä¹Ÿå°±æ˜¯ä¸€æ—¦æ‰¾åˆ°æ•æ„Ÿè¯ï¼ŒåŠ åˆ°åˆ—è¡¨åï¼Œè¶Šè¿‡è¿™ä¸ªè¯çš„å­—ç¬¦ï¼Œç»§ç»­å¾€ä¸‹æœç´¢</span>
                <span class="hljs-comment">// ä½†æ˜¯å¿…é¡»å‡1ï¼Œå› ä¸ºforå¾ªç¯ä¼šè‡ªå¢ï¼Œå¦‚æœä¸å‡ä¼šé€ æˆä¸‹æ¬¡å¾ªç¯è·³æ ¼è€Œå¿½ç•¥å­—ç¬¦</span>
                <span class="hljs-comment">// è¿™ä¼šé€ æˆä¸¥é‡è¯¯å·®</span>
                i = i + length - <span class="hljs-number">1</span>;
            &#125;
            <span class="hljs-comment">//å¦‚æœæ‰¾ä¸åˆ°ï¼Œiå°±è€è€å®å®ä¸€ä¸ªå­—ä¸€ä¸ªå­—çš„å¾€åç§»åŠ¨ï¼Œä½œä¸ºbeginè¿›è¡Œä¸‹ä¸€è½®</span>
        &#125;
        <span class="hljs-keyword">return</span> sensitiveWordList;
    &#125;

    <span class="hljs-comment">/**</span>
<span class="hljs-comment">     * ä»ç¬¬beginIndexä¸ªå­—ç¬¦çš„ä½ç½®ï¼Œå¾€åæŸ¥æ‰¾æ•æ„Ÿè¯</span>
<span class="hljs-comment">     * å¦‚æœæ‰¾åˆ°ï¼Œè¿”å›æ•æ„Ÿè¯å­—ç¬¦çš„é•¿åº¦ï¼Œä¸å­˜åœ¨è¿”å›0</span>
<span class="hljs-comment">     * è¿™ä¸ªé•¿åº¦ç”¨äºæ‰¾åˆ°åæå–æ•æ„Ÿè¯å’Œåç§»æŒ‡é’ˆï¼Œæ˜¯ä¸ªæ€§èƒ½å…³æ³¨ç‚¹</span>
<span class="hljs-comment">     */</span>
    <span class="hljs-function"><span class="hljs-keyword">private</span> <span class="hljs-keyword">static</span> <span class="hljs-keyword">int</span> <span class="hljs-title">checkSensitiveWord</span><span class="hljs-params">(String txt, <span class="hljs-keyword">int</span> beginIndex, <span class="hljs-keyword">int</span> matchType)</span> </span>&#123;
        <span class="hljs-comment">//æ•æ„Ÿè¯ç»“æŸæ ‡è¯†ä½ï¼šç”¨äºæ•æ„Ÿè¯åªæœ‰1ä½çš„æƒ…å†µ</span>
        <span class="hljs-keyword">boolean</span> flag = <span class="hljs-keyword">false</span>;
        <span class="hljs-comment">//åŒ¹é…åˆ°çš„æ•æ„Ÿå­—çš„ä¸ªæ•°ï¼Œä¹Ÿå°±æ˜¯æ•æ„Ÿè¯é•¿åº¦</span>
        <span class="hljs-keyword">int</span> length = <span class="hljs-number">0</span>;
        <span class="hljs-keyword">char</span> word;
        <span class="hljs-comment">//ä»æ ¹Mapå¼€å§‹æŸ¥æ‰¾</span>
        Map nowMap = sensitiveWordMap;
        <span class="hljs-keyword">for</span> (<span class="hljs-keyword">int</span> i = beginIndex; i &lt; txt.length(); i++) &#123;
            <span class="hljs-comment">//è¢«åˆ¤æ–­è¯­å¥çš„ç¬¬iä¸ªå­—ç¬¦å¼€å§‹</span>
            word = txt.charAt(i);

            <span class="hljs-comment">//è·å–æŒ‡å®škeyï¼Œå¹¶ä¸”å°†æ•æ„Ÿåº“æŒ‡é’ˆæŒ‡å‘ä¸‹çº§</span>
            nowMap = (Map) nowMap.get(word);
            <span class="hljs-keyword">if</span> (nowMap != <span class="hljs-keyword">null</span>) &#123;
                <span class="hljs-comment">//å­˜åœ¨ï¼Œåˆ™åˆ¤æ–­æ˜¯å¦ä¸ºæœ€åä¸€ä¸ª</span>
                <span class="hljs-comment">// æ‰¾åˆ°ç›¸åº”keyï¼ŒåŒ¹é…é•¿åº¦+1</span>
                length++;
                <span class="hljs-comment">//å¦‚æœä¸ºæœ€åä¸€ä¸ªåŒ¹é…è§„åˆ™,ç»“æŸå¾ªç¯ï¼Œè¿”å›åŒ¹é…æ ‡è¯†æ•°</span>
                <span class="hljs-keyword">if</span> (<span class="hljs-string">&quot;1&quot;</span>.equals(nowMap.get(<span class="hljs-string">&quot;isEnd&quot;</span>))) &#123;
                    <span class="hljs-comment">//ç»“æŸæ ‡å¿—ä½ä¸ºtrue</span>
                    flag = <span class="hljs-keyword">true</span>;
                    <span class="hljs-comment">//çŸ­åŒ¹é…ï¼Œç›´æ¥è¿”å›,é•¿åŒ¹é…è¿˜éœ€ç»§ç»­æŸ¥æ‰¾</span>
                    <span class="hljs-keyword">if</span> (SHORT_MATCH == matchType) &#123;
                        <span class="hljs-keyword">break</span>;
                    &#125;
                &#125;
            &#125; <span class="hljs-keyword">else</span> &#123;
                <span class="hljs-comment">//æ•æ„Ÿåº“ä¸å­˜åœ¨ï¼Œç›´æ¥ä¸­æ–­</span>
                <span class="hljs-keyword">break</span>;
            &#125;
        &#125;
        <span class="hljs-keyword">if</span> (length &lt; <span class="hljs-number">2</span> || !flag) &#123;
            <span class="hljs-comment">//é•¿åº¦å¿…é¡»å¤§äºç­‰äº1æ‰ç®—æ˜¯è¯ï¼Œå­—çš„è¯å°±ä¸å¿…è¿™ä¹ˆæŠ˜è…¾äº†</span>
            length = <span class="hljs-number">0</span>;
        &#125;
        <span class="hljs-keyword">return</span> length;
    &#125;

    <span class="hljs-function"><span class="hljs-keyword">public</span> <span class="hljs-keyword">static</span> <span class="hljs-keyword">void</span> <span class="hljs-title">main</span><span class="hljs-params">(String[] args)</span> </span>&#123;
        <span class="hljs-comment">//åˆå§‹åŒ–æ•æ„Ÿè¯åº“</span>
        SensitiveWordUtil.initSensitiveWordMap(<span class="hljs-string">&quot;å¹¿å‘Š,å¹¿å‘Šè¯,ä¸­å¥–&quot;</span>);
        System.out.println(<span class="hljs-string">&quot;æ•æ„Ÿè¯åº“ç»“æ„ï¼š&quot;</span> + JSON.toJSONString(sensitiveWordMap));
        String string = <span class="hljs-string">&quot;å…³äºä¸­å¥–å¹¿å‘Šçš„å¹¿å‘Šè¯ç­›é€‰&quot;</span>;
        System.out.println(<span class="hljs-string">&quot;è¢«æ£€æµ‹æ–‡æœ¬ï¼š&quot;</span> + string);
        System.out.println(<span class="hljs-string">&quot;å¾…æ£€æµ‹å­—æ•°ï¼š&quot;</span> + string.length());
        <span class="hljs-comment">//æ˜¯å¦å«æœ‰å…³é”®å­—</span>
        <span class="hljs-keyword">boolean</span> result = SensitiveWordUtil.contains(string, SensitiveWordUtil.LONG_MATCH);
        System.out.println(<span class="hljs-string">&quot;é•¿åŒ¹é…ï¼š&quot;</span> + result);
        result = SensitiveWordUtil.contains(string, SensitiveWordUtil.SHORT_MATCH);
        System.out.println(<span class="hljs-string">&quot;çŸ­åŒ¹é…ï¼š&quot;</span> + result);
        <span class="hljs-comment">//è·å–è¯­å¥ä¸­çš„æ•æ„Ÿè¯</span>
        Set&lt;String&gt; set = SensitiveWordUtil.getSensitiveWord(string, SensitiveWordUtil.LONG_MATCH);
        System.out.println(<span class="hljs-string">&quot;é•¿åŒ¹é…åˆ°ï¼š&quot;</span> + set);
        set = SensitiveWordUtil.getSensitiveWord(string, SensitiveWordUtil.SHORT_MATCH);
        System.out.println(<span class="hljs-string">&quot;çŸ­åŒ¹é…åˆ°ï¼š&quot;</span> + set);
    &#125;
&#125;</code></pre>

<h5 id="ç»“æœåˆ†æ-21"><a href="#ç»“æœåˆ†æ-21" class="headerlink" title="ç»“æœåˆ†æ"></a>ç»“æœåˆ†æ</h5><pre><code class="hljs actionscript">æ•æ„Ÿè¯åº“ç»“æ„ï¼š&#123;<span class="hljs-string">&quot;ä¸­&quot;</span>:&#123;<span class="hljs-string">&quot;å¥–&quot;</span>:&#123;<span class="hljs-string">&quot;isEnd&quot;</span>:<span class="hljs-string">&quot;1&quot;</span>&#125;,<span class="hljs-string">&quot;isEnd&quot;</span>:<span class="hljs-string">&quot;0&quot;</span>&#125;,<span class="hljs-string">&quot;å¹¿&quot;</span>:&#123;<span class="hljs-string">&quot;å‘Š&quot;</span>:&#123;<span class="hljs-string">&quot;isEnd&quot;</span>:<span class="hljs-string">&quot;1&quot;</span>,<span class="hljs-string">&quot;è¯&quot;</span>:&#123;<span class="hljs-string">&quot;isEnd&quot;</span>:<span class="hljs-string">&quot;1&quot;</span>&#125;&#125;,<span class="hljs-string">&quot;isEnd&quot;</span>:<span class="hljs-string">&quot;0&quot;</span>&#125;&#125;
è¢«æ£€æµ‹æ–‡æœ¬ï¼šå…³äºä¸­å¥–å¹¿å‘Šçš„å¹¿å‘Šè¯ç­›é€‰
å¾…æ£€æµ‹å­—æ•°ï¼š<span class="hljs-number">12</span>
é•¿åŒ¹é…ï¼š<span class="hljs-literal">true</span>
çŸ­åŒ¹é…ï¼š<span class="hljs-literal">true</span>
é•¿åŒ¹é…åˆ°ï¼š[ä¸­å¥–, å¹¿å‘Š, å¹¿å‘Šè¯]
çŸ­åŒ¹é…åˆ°ï¼š[ä¸­å¥–, å¹¿å‘Š]</code></pre>

<ul>
<li><p>æ•æ„Ÿè¯ç»“æ„åˆå§‹åŒ–åç¬¦åˆé¢„æœŸ </p>
</li>
<li><p>æ£€æµ‹å’Œé•¿çŸ­åŒ¹é…æœ‰ç»“æœ </p>
</li>
<li><p>åŒ¹é…çš„æ•æ„Ÿè¯åˆ—è¡¨æ­£ç¡® </p>
</li>
</ul>
<h4 id="æœ€ä¼˜å•†å“topk"><a href="#æœ€ä¼˜å•†å“topk" class="headerlink" title="æœ€ä¼˜å•†å“topk"></a>æœ€ä¼˜å•†å“topk</h4><h5 id="èƒŒæ™¯-1"><a href="#èƒŒæ™¯-1" class="headerlink" title="èƒŒæ™¯"></a>èƒŒæ™¯</h5><p>topkæ˜¯ä¸€ä¸ªå…¸å‹çš„ä¸šåŠ¡åœºæ™¯ï¼Œé™¤äº†æœ€ä¼˜å•†å“ï¼ŒåŒ…æ‹¬æ¨èæ’åã€ç§¯åˆ†æ’åæ‰€æœ‰æ¶‰åŠåˆ°æ’åå‰kçš„åœ°æ–¹éƒ½æ˜¯è¯¥ç®—æ³•çš„åº”ç”¨åœºåˆã€‚ </p>
<p>topkå³å¾—åˆ°ä¸€ä¸ªé›†åˆåï¼Œç­›é€‰é‡Œé¢æ’åå‰kä¸ªæ•°å€¼ã€‚é—®é¢˜çœ‹ä¼¼ç®€å•ï¼Œä½†æ˜¯é‡Œé¢çš„æ•°æ®ç»“æ„å’Œç®—æ³•ä½“ç°ç€å¯¹è§£å†³æ–¹æ¡ˆæ€§èƒ½çš„æ€ç´¢å’Œæ·±åº¦æŒ–æ˜ã€‚åˆ°åº•æœ‰å‡ ç§æ–¹æ³•ï¼Œè¿™äº›æ–¹æ¡ˆé‡Œè•´å«çš„ä¼˜åŒ–æ€è·¯ç©¶ç«Ÿæ˜¯æ€ä¹ˆæ ·çš„ï¼Ÿè¿™èŠ‚æ¥è®¨è®º </p>
<h5 id="æ–¹æ¡ˆ"><a href="#æ–¹æ¡ˆ" class="headerlink" title="æ–¹æ¡ˆ"></a>æ–¹æ¡ˆ</h5><p>æ–¹æ¡ˆä¸€ï¼š </p>
<p>å…¨å±€æ’åºï¼Œå°†é›†åˆæ•´ä½“æ’åºåï¼Œå–å‡ºæœ€å¤§çš„kä¸ªå€¼å°±æ˜¯éœ€è¦çš„ç»“æœã€‚ </p>
<p>è¿™ç§æ–¹æ¡ˆæœ€ç³Ÿç³•ï¼Œæˆ‘åªéœ€è¦æ’åå‰kçš„å…ƒç´ ï¼Œå…¶ä»–n-kä¸ªçš„é¡ºåºæˆ‘å¹¶ä¸å…³å¿ƒï¼Œä½†æ˜¯è¿ç®—è¿‡ç¨‹ä¸­ï¼Œéƒ½å¾—è·Ÿç€åšäº†æ²¡ç”¨çš„æ’åºæ“ä½œã€‚ </p>
<p>æ–¹æ¡ˆäºŒï¼š </p>
<p>å±€éƒ¨æ’åºï¼Œæ—¢ç„¶å…¨å±€æ²¡å¿…è¦ï¼Œé‚£æˆ‘åªå–å‰kä¸ªï¼Œåé¢çš„å°±æ²¡å¿…è¦ç†ä¼šäº†ã€‚ </p>
<p>å†’æ³¡æ’åºåœ¨æ’åºç®—æ³•ä¸­å¯ä»¥èƒœä»»è¯¥æ“ä½œã€‚æˆ‘ä»¬æŒ‰æœ€å¤§å€¼å¾€ä¸Šå†’æ³¡ä¸ºä¾‹ï¼Œåªè¦æ‰§è¡Œkæ¬¡å†’æ³¡ï¼Œé‚£å‰kåå°±å¯ä»¥ç¡®å®šã€‚ </p>
<p>ä½†æ˜¯è¿™ç§æ–¹æ¡ˆä¾ç„¶ä¸æ˜¯æœ€ä¼˜åŠæ³•ã€‚å› ä¸ºæˆ‘ä»¬éœ€è¦çš„æ˜¯å‰kåï¼Œé‚£è‡³äºè¿™kä¸ªï¼Œè°å¤§è°å°å¹¶ä¸éœ€è¦å…³å¿ƒï¼Œæ’åºä¾ç„¶æ˜¯ä¸ªæµªè´¹ã€‚ </p>
<p>æ–¹æ¡ˆä¸‰ï¼š </p>
<p>æœ€å°å †ï¼Œæ—¢ç„¶æ²¡å¿…è¦æ’åºï¼Œé‚£æˆ‘ä»¬å°±ä¸æ’åºã€‚ </p>
<p>å…ˆå°†å‰kä¸ªå…ƒç´ å½¢æˆä¸€ä¸ªæœ€å°å †ï¼Œåé¢çš„n-kä¸ªå…ƒç´ ä¾æ¬¡ä¸å †é¡¶æ¯”è¾ƒï¼Œå°åˆ™ä¸¢å¼ƒå¤§åˆ™æ›¿æ¢å †é¡¶å¹¶è°ƒæ•´å †ã€‚ç›´åˆ°nä¸ªå…¨éƒ¨å®Œæˆä¸ºæ­¢ã€‚æœ€å°å †æ˜¯topkçš„ç»å…¸è§£å†³æ–¹æ¡ˆã€‚ </p>
<h5 id="å®ç°-23"><a href="#å®ç°-23" class="headerlink" title="å®ç°"></a>å®ç°</h5><p>ä¸‹é¢å°±ç”¨æœ€å°å †å®ç°topk</p>
<pre><code class="hljs java"><span class="hljs-keyword">package</span> com.itheima.hash;

<span class="hljs-keyword">import</span> java.util.Arrays;

<span class="hljs-keyword">public</span> <span class="hljs-class"><span class="hljs-keyword">class</span> <span class="hljs-title">Topk</span> </span>&#123;
    <span class="hljs-comment">//å †å…ƒç´ ä¸‹æ²‰ï¼Œå½¢æˆæœ€å°å †ï¼Œåºå·ä»iå¼€å§‹ </span>
    <span class="hljs-function"><span class="hljs-keyword">static</span> <span class="hljs-keyword">void</span> <span class="hljs-title">down</span><span class="hljs-params">(<span class="hljs-keyword">int</span>[] nodes, <span class="hljs-keyword">int</span> i)</span> </span>&#123;
        <span class="hljs-comment">//é¡¶ç‚¹åºå·éå†ï¼Œåªè¦åˆ°1åŠå³å¯ï¼Œæ—¶é—´å¤æ‚åº¦ä¸ºO(log2n)</span>
        <span class="hljs-keyword">while</span> (i &lt;&lt; <span class="hljs-number">1</span> &lt; nodes.length) &#123;
            <span class="hljs-comment">//å·¦å­ï¼Œä¸ºä½•å·¦ç§»1ä½ï¼Ÿå›é¡¾ä¸€ä¸‹äºŒå‰æ ‘åºå· </span>
            <span class="hljs-keyword">int</span> left = i &lt;&lt; <span class="hljs-number">1</span>;
            <span class="hljs-comment">//å³å­ï¼Œå·¦+1å³å¯ </span>
            <span class="hljs-keyword">int</span> right = left + <span class="hljs-number">1</span>;
            <span class="hljs-comment">//æ ‡è®°ï¼ŒæŒ‡å‘ æœ¬èŠ‚ç‚¹ï¼Œå·¦ã€å³å­èŠ‚ç‚¹é‡Œæœ€å°çš„ï¼Œä¸€å¼€å§‹å–iè‡ªå·± </span>
            <span class="hljs-keyword">int</span> flag = i;
            <span class="hljs-comment">//åˆ¤æ–­å·¦å­æ˜¯å¦å°äºæœ¬èŠ‚ç‚¹ </span>
            <span class="hljs-keyword">if</span> (nodes[left] &lt; nodes[i]) &#123;
                flag = left;
            &#125;
            <span class="hljs-comment">//åˆ¤æ–­å³å­ </span>
            <span class="hljs-keyword">if</span> (right &lt; nodes.length &amp;&amp; nodes[flag] &gt; nodes[right]) &#123;
                flag = right;
            &#125;
            <span class="hljs-comment">//ä¸¤è€…ä¸­æœ€å°çš„ä¸æœ¬èŠ‚ç‚¹ä¸ç›¸ç­‰ï¼Œåˆ™äº¤æ¢ </span>
            <span class="hljs-keyword">if</span> (flag != i) &#123;
                <span class="hljs-keyword">int</span> temp = nodes[i];
                nodes[i] = nodes[flag];
                nodes[flag] = temp;
                i = flag;
            &#125; <span class="hljs-keyword">else</span> &#123;
                <span class="hljs-comment">//å¦åˆ™ç›¸ç­‰ï¼Œå †æ’åºå®Œæˆï¼Œé€€å‡ºå¾ªç¯å³å¯ </span>
                <span class="hljs-keyword">break</span>;
            &#125;
        &#125;
    &#125;

    <span class="hljs-function"><span class="hljs-keyword">public</span> <span class="hljs-keyword">static</span> <span class="hljs-keyword">void</span> <span class="hljs-title">main</span><span class="hljs-params">(String[] args)</span> </span>&#123;
        <span class="hljs-comment">//åŸå§‹æ•°æ® </span>
        <span class="hljs-keyword">int</span>[] src = &#123;<span class="hljs-number">3</span>, <span class="hljs-number">6</span>, <span class="hljs-number">2</span>, <span class="hljs-number">7</span>, <span class="hljs-number">4</span>, <span class="hljs-number">8</span>, <span class="hljs-number">1</span>, <span class="hljs-number">9</span>, <span class="hljs-number">2</span>, <span class="hljs-number">5</span>&#125;;
        <span class="hljs-comment">//è¦å–å‡ ä¸ª </span>
        <span class="hljs-keyword">int</span> k = <span class="hljs-number">5</span>;
        <span class="hljs-comment">//å †ï¼Œä¸ºå•¥æ˜¯k+1ï¼Ÿè¯·æ³¨æ„ï¼Œæœ€å°å †çš„0æ˜¯æ— ç”¨çš„ï¼Œåºå·ä»1å¼€å§‹ </span>
        <span class="hljs-keyword">int</span>[] nodes = <span class="hljs-keyword">new</span> <span class="hljs-keyword">int</span>[k + <span class="hljs-number">1</span>];
        <span class="hljs-comment">//å–å‰kä¸ªæ•°ï¼Œæ³¨æ„è¿™é‡Œåªæ˜¯ä¸ªäºŒå‰æ ‘ï¼Œè¿˜ä¸æ»¡è¶³æœ€å°å †çš„è¦æ±‚</span>
        <span class="hljs-keyword">for</span> (<span class="hljs-keyword">int</span> i = <span class="hljs-number">0</span>; i &lt; k; i++) &#123;
            nodes[i + <span class="hljs-number">1</span>] = src[i];
        &#125;
        System.out.println(<span class="hljs-string">&quot;before:&quot;</span> + Arrays.toString(nodes));
        <span class="hljs-comment">//ä»æœ€åº•çš„å­æ ‘å¼€å§‹ï¼Œå †é¡¶ä¸‹æ²‰ </span>
        <span class="hljs-comment">// è¿™é‡Œæ‰çœŸæ­£çš„å½¢æˆæœ€å°å †</span>
        <span class="hljs-keyword">for</span> (<span class="hljs-keyword">int</span> i = k &gt;&gt; <span class="hljs-number">1</span>; i &gt;= <span class="hljs-number">1</span>; i--) &#123;
            down(nodes, i);
        &#125;
        System.out.println(<span class="hljs-string">&quot;create:&quot;</span> + Arrays.toString(nodes));
        <span class="hljs-comment">//æŠŠä½™ä¸‹çš„nâ€kä¸ªæ•°ï¼Œæ”¾åˆ°å †é¡¶ï¼Œä¾æ¬¡ä¸‹æ²‰ï¼Œtopkå †ç®—æ³•çš„å¼€å§‹ </span>
        <span class="hljs-keyword">for</span> (<span class="hljs-keyword">int</span> i = src.length - k; i &lt; src.length; i++) &#123;
            <span class="hljs-keyword">if</span> (nodes[<span class="hljs-number">1</span>] &lt; src[i]) &#123;
                nodes[<span class="hljs-number">1</span>] = src[i];
                down(nodes, <span class="hljs-number">1</span>);
            &#125;
        &#125;
        System.out.println(<span class="hljs-string">&quot;topk:&quot;</span> + Arrays.toString(nodes));
    &#125;
&#125;</code></pre>

<h5 id="ç»“æœåˆ†æ-22"><a href="#ç»“æœåˆ†æ-22" class="headerlink" title="ç»“æœåˆ†æ"></a>ç»“æœåˆ†æ</h5><pre><code class="hljs apache"><span class="hljs-attribute">before</span>:[<span class="hljs-number">0</span>, <span class="hljs-number">3</span>, <span class="hljs-number">6</span>, <span class="hljs-number">2</span>, <span class="hljs-number">7</span>, <span class="hljs-number">4</span>]
<span class="hljs-attribute">create</span>:[<span class="hljs-number">0</span>, <span class="hljs-number">2</span>, <span class="hljs-number">4</span>, <span class="hljs-number">3</span>, <span class="hljs-number">7</span>, <span class="hljs-number">6</span>]
<span class="hljs-attribute">topk</span>:[<span class="hljs-number">0</span>, <span class="hljs-number">5</span>, <span class="hljs-number">6</span>, <span class="hljs-number">8</span>, <span class="hljs-number">7</span>, <span class="hljs-number">9</span>]</code></pre>

<p>æœ€ç»ˆè·å–kä¸ªå€¼æˆåŠŸï¼Œç¬¦åˆè¦æ±‚ </p>
<p>ä¸­é—´ä¸æ¶‰åŠæ’åºé—®é¢˜</p>

            </div>
            <hr>
            <div>
              <div class="post-metas mb-3">
                
                  <div class="post-meta mr-3">
                    <i class="iconfont icon-category"></i>
                    
                      <a class="hover-with-bg" href="/blog/categories/%E6%95%B0%E6%8D%AE%E7%BB%93%E6%9E%84%E4%B8%8E%E7%AE%97%E6%B3%95/">æ•°æ®ç»“æ„ä¸ç®—æ³•</a>
                    
                  </div>
                
                
                  <div class="post-meta">
                    <i class="iconfont icon-tags"></i>
                    
                      <a class="hover-with-bg" href="/blog/tags/%E5%8A%A0%E5%AF%86%E7%AE%97%E6%B3%95/">åŠ å¯†ç®—æ³•</a>
                    
                      <a class="hover-with-bg" href="/blog/tags/%E5%A4%B1%E6%95%88%E7%AE%97%E6%B3%95/">å¤±æ•ˆç®—æ³•</a>
                    
                      <a class="hover-with-bg" href="/blog/tags/%E9%99%90%E6%B5%81%E7%AE%97%E6%B3%95/">é™æµç®—æ³•</a>
                    
                      <a class="hover-with-bg" href="/blog/tags/%E8%B0%83%E5%BA%A6%E7%AE%97%E6%B3%95/">è°ƒåº¦ç®—æ³•</a>
                    
                      <a class="hover-with-bg" href="/blog/tags/%E5%AE%9A%E6%97%B6%E7%AE%97%E6%B3%95/">å®šæ—¶ç®—æ³•</a>
                    
                      <a class="hover-with-bg" href="/blog/tags/%E8%B4%9F%E8%BD%BD%E5%9D%87%E8%A1%A1%E7%AE%97%E6%B3%95/">è´Ÿè½½å‡è¡¡ç®—æ³•</a>
                    
                      <a class="hover-with-bg" href="/blog/tags/%E4%B8%80%E8%87%B4%E6%80%A7Hash/">ä¸€è‡´æ€§Hash</a>
                    
                      <a class="hover-with-bg" href="/blog/tags/%E7%AE%97%E6%B3%95/">ç®—æ³•</a>
                    
                  </div>
                
              </div>
              
                <p class="note note-warning">æœ¬åšå®¢æ‰€æœ‰æ–‡ç« é™¤ç‰¹åˆ«å£°æ˜å¤–ï¼Œå‡é‡‡ç”¨ <a target="_blank" href="https://creativecommons.org/licenses/by-sa/4.0/deed.zh" rel="nofollow noopener noopener">CC BY-SA 4.0 åè®®</a> ï¼Œè½¬è½½è¯·æ³¨æ˜å‡ºå¤„ï¼</p>
              
              
                <div class="post-prevnext row">
                  <article class="post-prev col-6">
                    
                    
                      <a href="/blog/2020/08/22/%E7%BC%93%E5%AD%98-Redis%E7%9A%84%E5%9F%BA%E6%9C%AC%E4%BB%8B%E7%BB%8D/">
                        <i class="iconfont icon-arrowleft"></i>
                        <span class="hidden-mobile">Redisçš„åŸºæœ¬ä»‹ç»</span>
                        <span class="visible-mobile">ä¸Šä¸€ç¯‡</span>
                      </a>
                    
                  </article>
                  <article class="post-next col-6">
                    
                    
                      <a href="/blog/2020/08/15/%E6%95%B0%E6%8D%AE%E7%BB%93%E6%9E%84-%E6%95%B0%E6%8D%AE%E7%BB%93%E6%9E%84%E5%92%8C%E7%AE%97%E6%B3%95%E5%9F%BA%E7%A1%80/">
                        <span class="hidden-mobile">æ•°æ®ç»“æ„å’Œç®—æ³•åŸºç¡€</span>
                        <span class="visible-mobile">ä¸‹ä¸€ç¯‡</span>
                        <i class="iconfont icon-arrowright"></i>
                      </a>
                    
                  </article>
                </div>
              
            </div>

            
          </article>
        </div>
      </div>
    </div>
    
      <div class="d-none d-lg-block col-lg-2 toc-container" id="toc-ctn">
        <div id="toc">
  <p class="toc-header"><i class="iconfont icon-list"></i>&nbsp;ç›®å½•</p>
  <div class="toc-body" id="toc-body"></div>
</div>

      </div>
    
  </div>
</div>

<!-- Custom -->


    

    
      <a id="scroll-top-button" href="#" role="button">
        <i class="iconfont icon-arrowup" aria-hidden="true"></i>
      </a>
    

    
      <div class="modal fade" id="modalSearch" tabindex="-1" role="dialog" aria-labelledby="ModalLabel"
     aria-hidden="true">
  <div class="modal-dialog modal-dialog-scrollable modal-lg" role="document">
    <div class="modal-content">
      <div class="modal-header text-center">
        <h4 class="modal-title w-100 font-weight-bold">æœç´¢</h4>
        <button type="button" id="local-search-close" class="close" data-dismiss="modal" aria-label="Close">
          <span aria-hidden="true">&times;</span>
        </button>
      </div>
      <div class="modal-body mx-3">
        <div class="md-form mb-5">
          <input type="text" id="local-search-input" class="form-control validate">
          <label data-error="x" data-success="v"
                 for="local-search-input">å…³é”®è¯</label>
        </div>
        <div class="list-group" id="local-search-result"></div>
      </div>
    </div>
  </div>
</div>
    

    
  </main>

  <footer class="text-center mt-5 py-3">
  <div class="footer-content">
     <a href="https://hexo.io" target="_blank" rel="nofollow noopener"><span>Hexo</span></a> <i class="iconfont icon-love"></i> <a href="https://github.com/fluid-dev/hexo-theme-fluid" target="_blank" rel="nofollow noopener"><span>Fluid</span></a> 
  </div>
  

  

  
</footer>

<!-- SCRIPTS -->

  <script  src="https://cdn.staticfile.org/nprogress/0.2.0/nprogress.min.js" ></script>
  <link  rel="stylesheet" href="https://cdn.staticfile.org/nprogress/0.2.0/nprogress.min.css" />

  <script>
    NProgress.configure({"showSpinner":false,"trickleSpeed":200})
    NProgress.start()
    document.addEventListener('DOMContentLoaded', function() {
      window.NProgress && window.NProgress.inc();
    })
    window.addEventListener('load', function() {
      NProgress.done();
    })
  </script>


<script  src="https://cdn.staticfile.org/jquery/3.5.1/jquery.min.js" ></script>
<script  src="https://cdn.staticfile.org/twitter-bootstrap/4.5.3/js/bootstrap.min.js" ></script>
<script  src="/blog/js/debouncer.js" ></script>
<script  src="/blog/js/events.js" ></script>
<script  src="/blog/js/plugins.js" ></script>

<!-- Plugins -->


  
    <script  src="/blog/js/lazyload.js" ></script>
  



  



  <script  src="https://cdn.staticfile.org/tocbot/4.12.0/tocbot.min.js" ></script>



  <script  src="https://cdn.staticfile.org/fancybox/3.5.7/jquery.fancybox.min.js" ></script>



  <script  src="https://cdn.staticfile.org/anchor-js/4.3.0/anchor.min.js" ></script>



  <script defer src="https://cdn.staticfile.org/clipboard.js/2.0.6/clipboard.min.js" ></script>





  <script  src="https://cdn.staticfile.org/typed.js/2.0.11/typed.min.js" ></script>
  <script>
    (function (window, document) {
      var typing = Fluid.plugins.typing;
      var title = document.getElementById('subtitle').title;
      
      typing(title)
      
    })(window, document);
  </script>



  <script  src="/blog/js/local-search.js" ></script>
  <script>
    (function () {
      var path = "/blog/local-search.xml";
      var inputArea = document.querySelector("#local-search-input");
      inputArea.onclick = function () {
        searchFunc(path, 'local-search-input', 'local-search-result');
        this.onclick = null
      }
    })()
  </script>















<!-- ä¸»é¢˜çš„å¯åŠ¨é¡¹ ä¿æŒåœ¨æœ€åº•éƒ¨ -->
<script  src="/blog/js/boot.js" ></script>



</body>
</html>
