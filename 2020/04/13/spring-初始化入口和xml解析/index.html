

<!DOCTYPE html>
<html lang="zh-CN" data-default-color-scheme=&#34;auto&#34;>



<head>
  <meta charset="UTF-8">
  <link rel="apple-touch-icon" sizes="76x76" href="/blog/img/favicon.png">
  <link rel="icon" type="image/png" href="/blog/img/favicon.png">
  <meta name="viewport"
        content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no, shrink-to-fit=no">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  
  <meta name="theme-color" content="#2f4154">
  <meta name="description" content="">
  <meta name="author" content="">
  <meta name="keywords" content="">
  <title>Springçš„åˆå§‹åŒ–å…¥å£å’Œxmlè§£æ - ğŸğŸŠ&#39;s blog</title>

  <link  rel="stylesheet" href="https://cdn.staticfile.org/twitter-bootstrap/4.4.1/css/bootstrap.min.css" />


  <link  rel="stylesheet" href="https://cdn.staticfile.org/github-markdown-css/4.0.0/github-markdown.min.css" />
  <link  rel="stylesheet" href="/blog/lib/hint/hint.min.css" />

  
    
    <link  rel="stylesheet" href="https://cdn.staticfile.org/highlight.js/10.0.0/styles/github-gist.min.css" />
  

  


<!-- ä¸»é¢˜ä¾èµ–çš„å›¾æ ‡åº“ï¼Œä¸è¦è‡ªè¡Œä¿®æ”¹ -->

<link rel="stylesheet" href="//at.alicdn.com/t/font_1749284_6peoq002giu.css">



<link rel="stylesheet" href="//at.alicdn.com/t/font_1736178_pjno9b9zyxs.css">


<link  rel="stylesheet" href="/blog/css/main.css" />

<!-- è‡ªå®šä¹‰æ ·å¼ä¿æŒåœ¨æœ€åº•éƒ¨ -->


  <script  src="/blog/js/utils.js" ></script>
  <script  src="/blog/js/color-schema.js" ></script>
<meta name="generator" content="Hexo 4.2.1"></head>


<body>
  <header style="height: 70vh;">
    <nav id="navbar" class="navbar fixed-top  navbar-expand-lg navbar-dark scrolling-navbar">
  <div class="container">
    <a class="navbar-brand"
       href="/blog/">&nbsp;<strong>ğŸğŸŠ's blog</strong>&nbsp;</a>

    <button id="navbar-toggler-btn" class="navbar-toggler" type="button" data-toggle="collapse"
            data-target="#navbarSupportedContent"
            aria-controls="navbarSupportedContent" aria-expanded="false" aria-label="Toggle navigation">
      <div class="animated-icon"><span></span><span></span><span></span></div>
    </button>

    <!-- Collapsible content -->
    <div class="collapse navbar-collapse" id="navbarSupportedContent">
      <ul class="navbar-nav ml-auto text-center">
        
          
          
          
          
            <li class="nav-item">
              <a class="nav-link" href="/blog/">
                <i class="iconfont icon-home-fill"></i>
                ä¸»é¡µ
              </a>
            </li>
          
        
          
          
          
          
            <li class="nav-item">
              <a class="nav-link" href="/blog/archives/">
                <i class="iconfont icon-archive-fill"></i>
                å½’æ¡£
              </a>
            </li>
          
        
          
          
          
          
            <li class="nav-item">
              <a class="nav-link" href="/blog/categories/">
                <i class="iconfont icon-category-fill"></i>
                åˆ†ç±»
              </a>
            </li>
          
        
          
          
          
          
            <li class="nav-item">
              <a class="nav-link" href="/blog/tags/">
                <i class="iconfont icon-tags-fill"></i>
                æ ‡ç­¾
              </a>
            </li>
          
        
          
          
          
          
            <li class="nav-item">
              <a class="nav-link" href="/blog/about/">
                <i class="iconfont icon-user-fill"></i>
                å…³äº
              </a>
            </li>
          
        
        
          <li class="nav-item" id="search-btn">
            <a class="nav-link" data-toggle="modal" data-target="#modalSearch">&nbsp;<i
                class="iconfont icon-search"></i>&nbsp;</a>
          </li>
        
        
          <li class="nav-item" id="color-toggle-btn">
            <a class="nav-link" href="javascript:">&nbsp;<i
                class="iconfont icon-dark" id="color-toggle-icon"></i>&nbsp;</a>
          </li>
        
      </ul>
    </div>
  </div>
</nav>

    <div class="banner intro-2" id="background" parallax=true
         style="background: url('/blog/img/default.png') no-repeat center center;
           background-size: cover;">
      <div class="full-bg-img">
        <div class="mask flex-center" style="background-color: rgba(0, 0, 0, 0.3)">
          <div class="container page-header text-center fade-in-up">
            <span class="h2" id="subtitle">
              
            </span>

            
              
  <div class="mt-3 post-meta">
    <i class="iconfont icon-date-fill" aria-hidden="true"></i>
    <time datetime="2020-04-13 19:02" pubdate>
      2020å¹´4æœˆ13æ—¥ æ™šä¸Š
    </time>
  </div>


<div class="mt-1">
  
    
    <span class="post-meta mr-2">
      <i class="iconfont icon-chart"></i>
      7.5k å­—
    </span>
  

  
    
    <span class="post-meta mr-2">
      <i class="iconfont icon-clock-fill"></i>
      
      
      111
       åˆ†é’Ÿ
    </span>
  

  
  
</div>

            
          </div>

          
        </div>
      </div>
    </div>
  </header>

  <main>
    
      

<div class="container-fluid">
  <div class="row">
    <div class="d-none d-lg-block col-lg-2"></div>
    <div class="col-lg-8 nopadding-md">
      <div class="container nopadding-md" id="board-ctn">
        <div class="py-5" id="board">
          <article class="post-content mx-auto" id="post">
            <!-- SEO header -->
            <h1 style="display: none">Springçš„åˆå§‹åŒ–å…¥å£å’Œxmlè§£æ</h1>
            
            <div class="markdown-body" id="post-body">
              <h2 id="Springçš„å†å²"><a href="#Springçš„å†å²" class="headerlink" title="Springçš„å†å²"></a>Springçš„å†å²</h2><ul>
<li><p>2002å¹´10æœˆï¼ŒRod Johnsoå‘å¸ƒã€ŠExpert One-on-One J2EE è®¾è®¡å’Œå¼€å‘ã€‹ä¸€ä¹¦</p>
</li>
<li><p>2004 å¹´ 3 æœˆï¼ŒSpring1.0 å‘å¸ƒ</p>
<p>2003 å¹´ 6 æœˆï¼ŒSpring Framework ç¬¬ä¸€æ¬¡ä»¥ Apache 2.0 è®¸å¯è¯ä¸‹å‘å¸ƒ 0.9 ç‰ˆ æœ¬ï¼Œ2004 å¹´ 3 æœˆï¼ŒSpring1.0 æ­£å¼å‘å¸ƒã€‚å¯¹äº Spring1.0ï¼Œå…¶æºç åªæœ‰ä¸€ä¸ªåŒ…ï¼Œåœ¨è¯¥åŒ…ä¸­åŒ…å«äº† aopã€beansã€contextã€ coreã€jdbcã€orm ç­‰ã€‚å¯¹äºæ­¤æ—¶çš„ç‰ˆæœ¬ï¼ŒSpring1.0 ä»…æ”¯æŒ XML é…ç½®çš„æ–¹å¼ã€‚</p>
</li>
<li><p>2006 å¹´ 10 æœˆï¼ŒSpring2.0 å‘å¸ƒ<br>å¯¹äº 2.0ï¼ŒSpring ä¸»è¦å¢åŠ äº†å¯¹æ³¨è§£çš„æ”¯æŒï¼Œå®ç°äº†åŸºäºæ³¨è§£çš„é…ç½®ã€‚</p>
<p>åœ¨ 2007 å¹´ 11 æœˆï¼Œå‘å¸ƒ Spring2.5ï¼Œè¯¥ç‰ˆæœ¬å…·å¤‡çš„ç‰¹æ€§æœ‰ï¼š</p>
<ul>
<li><p>æ·»åŠ å¯æ‰©å±•çš„ XML é…ç½®åŠŸèƒ½ï¼Œç”¨äºç®€åŒ– XML é…ç½®ï¼Œ</p>
</li>
<li><p>æ”¯æŒ Java5</p>
</li>
<li><p>æ·»åŠ é¢å¤–çš„ IOC å®¹å™¨æ‰©å±•ç‚¹ï¼Œæ”¯æŒåŠ¨æ€è¯­è¨€(å¦‚ groovyï¼Œaop å¢å¼ºåŠŸèƒ½å’Œæ–° çš„ bean èŒƒå›´ )</p>
</li>
</ul>
</li>
<li><p>2009 å¹´ 12 æœˆï¼ŒSpring3.0 å‘å¸ƒ</p>
<p>Spring3.0 ä¸»è¦å…·æœ‰çš„ç‰¹æ€§æœ‰: </p>
<ul>
<li>æ¨¡å—é‡ç»„ç³»ç»Ÿ</li>
<li>æ”¯æŒ Spring è¡¨è¾¾å¼è¯­è¨€(Spring Expression)</li>
<li>åŸºäº Java çš„ Bean é…ç½®(JavaConfig) æ”¯æŒåµŒå…¥å¼æ•°æ®åº“:HSQLã€H2 ç­‰ æ”¯æŒ REST</li>
<li>æ”¯æŒ Java6</li>
</ul>
</li>
<li><p>2013 å¹´ 12 æœˆï¼Œå‘å¸ƒ Spring4.0</p>
<p>å¯¹äº Spring4.0 æ˜¯ Spring ç‰ˆæœ¬å†å²ä¸Šçš„ä¸€é‡å¤§å‡çº§ã€‚å…¶ç‰¹æ€§ä¸º: </p>
<ul>
<li>å…¨é¢æ”¯æŒ Java8æ”¯æŒ Lambda è¡¨è¾¾å¼ã€‚</li>
<li>æ”¯æŒ Java8 çš„æ—¶é—´å’Œæ—¥æœŸ API</li>
<li>æ”¯æŒé‡å¤æ³¨è§£</li>
<li>æ”¯æŒ Java8 çš„ Optional</li>
<li>æ ¸å¿ƒå®¹å™¨å¢å¼º</li>
<li>å¢åŠ æ³›å‹ä¾èµ–æ³¨å…¥</li>
<li>å¢åŠ  Map ä¾èµ–æ³¨å…¥</li>
<li>å¢åŠ  List ä¾èµ–æ³¨å…¥</li>
<li>æ”¯æŒ lazy æ³¨è§£é…ç½®æ‡’åŠ è½½</li>
<li>æ”¯æŒ Condition æ¡ä»¶æ³¨è§£</li>
<li>CGLIB åŠ¨æ€ä»£ç†å¢å¼º</li>
<li>æ”¯æŒåŸºäº GroovyDSL å®šä¹‰ Bean</li>
<li>Web å¢å¼º</li>
<li>å¢å¼º SpringMVCï¼ŒåŸºäº Servlet3.0 å¼€å‘</li>
<li>æä¾› RestController æ³¨è§£</li>
<li>æä¾› AsyncRestTemplate æ”¯æŒå®¢æˆ·ç«¯çš„å¼‚æ­¥æ— é˜»å¡è¯·æ±‚</li>
<li>å¢åŠ å¯¹ WebSocket çš„æ”¯æŒ</li>
</ul>
</li>
<li><p>2017 å¹´ 9 æœˆï¼ŒSpring5.0 å‘å¸ƒ</p>
<p>Spring5.0 ç‰¹æ€§å¦‚ä¸‹ï¼š</p>
<ul>
<li>å‡çº§åˆ° Java8ã€JavaEE7</li>
<li>åºŸå¼ƒä½ç‰ˆæœ¬ï¼Œå°† Java8ã€JavaEE 7 ä½œä¸ºæœ€ä½ç‰ˆæœ¬è¦æ±‚ å…¼å®¹ Java9ã€å…¼å®¹ JavaEE8</li>
<li>ååº”å¼ç¼–ç¨‹æ¨¡å‹ï¼Œå¢åŠ  WebFlux æ¨¡å—</li>
<li>å‡çº§ SpringMVCï¼Œå¢åŠ å¯¹æœ€æ–°çš„ API(Jackson ç­‰)çš„æ”¯æŒ å¢åŠ å‡½æ•°å¼ç¼–ç¨‹æ¨¡å¼</li>
<li>é‡æ„æºç ï¼Œéƒ¨åˆ†åŠŸèƒ½ä½¿ç”¨ Lambda è¡¨è¾¾å¼å®ç°</li>
</ul>
</li>
</ul>
<h2 id="Springçš„å­é¡¹ç›®"><a href="#Springçš„å­é¡¹ç›®" class="headerlink" title="Springçš„å­é¡¹ç›®"></a>Springçš„å­é¡¹ç›®</h2><ul>
<li>Spring IO Platform : Spring IO æ˜¯å¯é›†æˆçš„ã€æ„å»ºç°ä»£åŒ–åº”ç”¨çš„ç‰ˆæœ¬å¹³å°ã€‚Spring IO æ˜¯æ¨¡å—åŒ–çš„ã€ä¼ä¸šçº§çš„åˆ†å¸ƒå¼ç³»ç»Ÿï¼ŒåŒ…æ‹¬ä¸€ç³»åˆ—ä¾èµ–ï¼Œæ˜¯çš„å¼€å‘è€…ä»…èƒ½å¯¹è‡ªå·±æ‰€éœ€çš„éƒ¨åˆ†è¿›è¡Œå®Œå…¨çš„éƒ¨ç½²æ§åˆ¶ã€‚</li>
<li>Spring Boot:Spring åº”ç”¨å¿«é€Ÿå¼€å‘å·¥å…·ï¼Œç”¨æ¥ç®€åŒ– Spring åº”ç”¨å¼€å‘è¿‡ç¨‹ã€‚ </li>
<li>Spring XD:Spring XD(eXtreme Dateï¼Œæé™æ•°æ®)æ˜¯ Pivotal çš„å¤§æ•°æ®äº§å“ã€‚å®ƒç»“åˆäº† Spring Boot å’Œ Grailsï¼Œç»„æˆ Spring IO å¹³å°çš„æ‰§è¡Œéƒ¨åˆ†ã€‚</li>
<li>Spring Data:Spring Data æ˜¯ä¸ºäº†ç®€åŒ–æ„å»ºåŸºäº Spring æ¡†æ¶åº”ç”¨çš„æ•°æ®è®¿é—®å®ç°ï¼ŒåŒ…æ‹¬éå…³ç³»æ•°æ®åº“ã€Map-Reduce æ¡†æ¶ã€äº‘æ•°æ®æœåŠ¡ç­‰;å¦å¤–ï¼Œä¹ŸåŒ…å«å¯¹å…³ ç³»æ•°æ®åº“çš„è®¿é—®æ”¯æŒã€‚</li>
<li>Spring Integration:Spring Integration ä¸ºä¼ä¸šæ•°æ®é›†æˆæä¾›äº†å„ç§é€‚é…å™¨ï¼Œå¯ä»¥é€šè¿‡è¿™äº›é€‚é…å™¨æ¥è½¬æ¢å„ç§æ¶ˆæ¯æ ¼å¼ï¼Œå¹¶å¸®åŠ© Spring åº”ç”¨å®Œæˆä¸ä¼ä¸šåº”ç”¨ç³»ç»Ÿçš„é›†æˆã€‚</li>
<li>Spring Batch:Spring Batch æ˜¯ä¸€ä¸ªè½»é‡çº§çš„å®Œæ•´æ‰¹å¤„ç†æ¡†æ¶ï¼Œæ—¨åœ¨å¸®åŠ©åº”ç”¨å¼€å‘è€…æ„å»ºä¸€ä¸ªå¥å£®ã€é«˜æ•ˆçš„ä¼ä¸šçº§æ‰¹å¤„ç†åº”ç”¨(è¿™äº›åº”ç”¨çš„ç‰¹ç‚¹æ˜¯ä¸éœ€è¦ä¸ç”¨ æˆ·äº¤äº’ï¼Œé‡å¤çš„æ“ä½œé‡å¤§ï¼Œå¯¹äºå¤§å®¹é‡çš„æ‰¹é‡æ•°æ®å¤„ç†è€Œè¨€ï¼Œè¿™äº›æ“ä½œå¾€å¾€è¦æ±‚ è¾ƒé«˜çš„å¯é æ€§)</li>
<li>Spring Security:Spring Security æ˜¯ä¸€ä¸ªèƒ½å¤Ÿä¸ºåŸºäº Spring çš„ä¼ä¸šåº”ç”¨ç³»ç»Ÿæ ä¾›å£°æ˜å¼çš„å®‰å…¨è®¿é—®æ§åˆ¶è§£å†³æ–¹æ¡ˆçš„å®‰å…¨æ¡†æ¶ã€‚å®ƒæä¾›äº†ä¸€ç»„å¯ä»¥åœ¨ Spring åº”ç”¨ ä¸Šä¸‹æ–‡é…ç½®çš„ beanï¼Œå……åˆ†åˆ©ç”¨ Ioc å’Œ AOP åŠŸèƒ½ï¼Œä¸ºåº”ç”¨ç³»ç»Ÿæä¾›å£°æ˜å¼çš„å®‰å…¨ è®¿é—®æ§åˆ¶åŠŸèƒ½ã€‚</li>
<li>Spring Hateoas:Spring Hateoas æ˜¯ä¸€ä¸ªç”¨æˆ·æ”¯æŒå®ç°è¶…æ–‡æœ¬é©±åŠ¨çš„ REST Web æœåŠ¡çš„å¼€å‘åº“ï¼Œæ˜¯ Hateoas çš„å®ç°ã€‚Hateoas(Hypermedia as the engine of application state)æ˜¯ REST æ¶æ„é£æ ¼ä¸­æœ€å¤æ‚çš„çº¦æŸï¼Œä¹Ÿæ˜¯æ„å»ºæˆç†Ÿ REST æœåŠ¡çš„æ ¸ å¿ƒã€‚å®ƒçš„é‡è¦æ€§åœ¨äºæ‰“ç ´äº†å®¢æˆ·ç«¯å’ŒæœåŠ¡å™¨ä¹‹é—´ä¸¥æ ¼çš„å¥‘çº¦ï¼Œæ˜¯çš„å®¢æˆ·ç«¯å¯ä»¥æ›´åŠ æ™ºèƒ½å’Œè‡ªé€‚åº”ã€‚</li>
<li>Spring Social:Spring Social æ˜¯ Spring æ¡†æ¶çš„æ‰©å±•ï¼Œç”¨æ¥æ–¹ä¾¿å¼€å‘ Web ç¤¾äº¤åº”ç”¨ç¨‹åºï¼Œå¯é€šè¿‡è¯¥é¡¹ç›®æ¥åˆ›å»ºä¸å„ç§ç¤¾äº¤ç½‘ç«™çš„äº¤äº’ï¼Œå¦‚ Facebookï¼ŒLinkedInã€ Twitter ç­‰ã€‚</li>
<li>Spring AMQP:Spring AMQP æ˜¯åŸºäº Spring æ¡†æ¶çš„ AMQP æ¶ˆæ¯è§£å†³æ–¹æ¡ˆï¼Œæä¾› æ¨¡ç‰ˆåŒ–çš„å‘é€å’Œæ¥æ”¶æ¶ˆæ¯çš„æŠ½è±¡å±‚ï¼Œæä¾›åŸºäºæ¶ˆæ¯é©±åŠ¨çš„ POJOã€‚è¿™ä¸ªé¡¹ç›®æ”¯æŒ Javaå’Œ.NETè¿ä¸ªç‰ˆæœ¬ã€‚Spring Sourceæ——ä¸‹çš„Rabbit MQå°±æ˜¯ä¸€ä¸ªå¼€æºçš„åŸºäºAMQP çš„æ¶ˆæ¯æœåŠ¡å™¨ã€‚</li>
<li>Spring for Android:Spring for Android ä¸º Android ç»ˆç«¯å¼€å‘åº”ç”¨æä¾› Spring çš„ æ”¯æŒï¼Œå®ƒæä¾›äº†ä¸€ä¸ªåœ¨ Android åº”ç”¨ç¯å¢ƒä¸­å·¥ä½œã€åŸºäº Javaçš„REST å®¢æˆ·ç«¯ã€‚</li>
<li>Spring Mobile:Spring Mobile æ˜¯åŸºäº Spring MVC æ„å»ºçš„ï¼Œä¸ºç§»åŠ¨ç«¯çš„æœåŠ¡å™¨ åº”ç”¨å¼€å‘æä¾›æ”¯æŒã€‚</li>
<li>Spring Web Flow:Spring Web Flow(SWF)ä¸€ä¸ªå»ºç«‹åœ¨ Spring MVC åŸºç¡€ä¸Šçš„ Web é¡µé¢æµå¼•æ“ã€‚</li>
<li>Spring Web Service:Spring Web Service æ˜¯åŸºäº Spring æ¡†æ¶çš„ Web æœåŠ¡æ¡†æ¶ï¼Œ ä¸»è¦ä¾§é‡äºåŸºäºæ–‡æ¡£é©±åŠ¨çš„ Web æœåŠ¡ï¼Œæä¾› SOAP æœåŠ¡å¼€å‘ï¼Œå…è®¸é€šè¿‡å¤šç§æ–¹ å¼åˆ›å»º Web æœåŠ¡ã€‚</li>
<li>Spring LDAP:Spring LDAP æ˜¯ä¸€ä¸ªç”¨æˆ·æ“ä½œ LDAP çš„ Java æ¡†æ¶ï¼Œç±»ä¼¼ Spring JDBC æä¾›äº† JdbcTemplate æ–¹å¼æ¥æ“ä½œæ•°æ®åº“ã€‚è¿™ä¸ªæ¡†æ¶æä¾›äº†ä¸€ä¸ª LdapTemplate æ“ ä½œæ¨¡ç‰ˆï¼Œå¯å¸®åŠ©å¼€å‘äººå‘˜ç®€åŒ– looking upã€closing contextsã€encoding/decodingã€ filters ç­‰æ“ä½œã€‚</li>
<li>Spring Session: Spring Session è‡´åŠ›äºæä¾›ä¸€ä¸ªå…¬å…±åŸºç¡€è®¾æ–½ä¼šè¯ï¼Œæ”¯æŒä»ä»»æ„ç¯å¢ƒä¸­è®¿é—®ä¸€ä¸ªä¼šè¯ï¼Œåœ¨ Web ç¯å¢ƒä¸‹æ”¯æŒç‹¬ç«‹äºå®¹å™¨çš„é›†ç¾¤ä¼šè¯ï¼Œæ”¯æŒå¯æ’æ‹”ç­–ç•¥æ¥ç¡®å®š Session IDï¼ŒWebSocket æ´»è·ƒçš„æ—¶å€™å¯ä»¥ç®€å•åœ°ä¿æŒ HttpSessionã€‚</li>
<li>Spring Shell: Spring Shell æä¾›äº¤äº’å¼çš„ Shellï¼Œç”¨æˆ·å¯ä»¥ç®€å•çš„åŸºäº Spring çš„ç¼–ç¨‹æ¨¡å‹æ¥å¼€å‘å‘½ä»¤ã€‚</li>
</ul>
<h2 id="Springå®¹å™¨çš„åŠ è½½æ–¹å¼"><a href="#Springå®¹å™¨çš„åŠ è½½æ–¹å¼" class="headerlink" title="Springå®¹å™¨çš„åŠ è½½æ–¹å¼"></a>Springå®¹å™¨çš„åŠ è½½æ–¹å¼</h2><ul>
<li><p>ç±»è·¯å¾„è·å–é…ç½®æ–‡ä»¶<br>ApplicationContext applicationContext= new ClassPathXmlApplicationContext(â€œspring.xmlâ€);</p>
</li>
<li><p>æ–‡ä»¶ç³»ç»Ÿè·¯å¾„è·å–é…ç½®æ–‡ä»¶ã€ç»å¯¹è·¯å¾„ã€‘<br>ApplicationContext applicationContext = new FileSystemXmlApplicationContext(â€œE:\idea\public\springdemo\src\main\resou rces\spring.xmlâ€);</p>
</li>
<li><p>æ— é…ç½®æ–‡ä»¶åŠ è½½å®¹å™¨ ApplicationContext applicationContext = new<br>AnnotationConfigApplicationContext(â€œcom.xx.jackâ€);</p>
</li>
<li><p>springboot åŠ è½½å®¹å™¨ ApplicationContext applicationContext = new<br>EmbeddedWebApplicationContext();</p>
</li>
</ul>
<h2 id="Springå®¹å™¨åŠ è½½çš„æ ¸å¿ƒæ–¹æ³•"><a href="#Springå®¹å™¨åŠ è½½çš„æ ¸å¿ƒæ–¹æ³•" class="headerlink" title="Springå®¹å™¨åŠ è½½çš„æ ¸å¿ƒæ–¹æ³•"></a>Springå®¹å™¨åŠ è½½çš„æ ¸å¿ƒæ–¹æ³•</h2><p>AbstractApplicationContext.refresh()æ–¹æ³•</p>
<p>refresh()æ–¹æ³•æ˜¯springå®¹å™¨å¯åŠ¨è¿‡ç¨‹ä¸­çš„æ ¸å¿ƒæ–¹æ³•ï¼Œspringå®¹å™¨è¦åŠ è½½å¿…é¡»æ‰§è¡Œè¯¥æ–¹æ³•ã€‚</p>
<pre><code class="hljs java"><span class="hljs-meta">@Override</span>
<span class="hljs-function"><span class="hljs-keyword">public</span> <span class="hljs-keyword">void</span> <span class="hljs-title">refresh</span><span class="hljs-params">()</span> <span class="hljs-keyword">throws</span> BeansException, IllegalStateException </span>&#123;
	<span class="hljs-keyword">synchronized</span> (<span class="hljs-keyword">this</span>.startupShutdownMonitor) &#123;
		<span class="hljs-comment">//ä¸ºå®¹å™¨åˆå§‹åŒ–åšå‡†å¤‡ï¼Œé‡è¦ç¨‹åº¦ï¼š0</span>
		<span class="hljs-comment">//Prepare this context for refreshing.</span>
		prepareRefresh();

		<span class="hljs-comment">/**</span>
<span class="hljs-comment">		* é‡è¦ç¨‹åº¦ï¼š5</span>
<span class="hljs-comment">		* 1ã€åˆ›å»ºBeanFactoryå¯¹è±¡</span>
<span class="hljs-comment">		* 2ã€xmlè§£æ</span>
<span class="hljs-comment">		* 	ä¼ ç»Ÿæ ‡ç­¾è§£æï¼šbeanã€importç­‰</span>
<span class="hljs-comment">		* 	è‡ªå®šä¹‰æ ‡ç­¾è§£æ å¦‚ï¼š&lt;context:component-scan base-package="com.xiangxue.jack"/&gt;</span>
<span class="hljs-comment">		* 	è‡ªå®šä¹‰æ ‡ç­¾è§£ææµç¨‹ï¼š</span>
<span class="hljs-comment">		* 		aã€æ ¹æ®å½“å‰è§£ææ ‡ç­¾çš„å¤´ä¿¡æ¯æ‰¾åˆ°å¯¹åº”çš„namespaceUri</span>
<span class="hljs-comment">		* 		bã€åŠ è½½springæ‰€ä»¥jarä¸­çš„spring.handlersæ–‡ä»¶ã€‚å¹¶å»ºç«‹æ˜ å°„å…³ç³»</span>
<span class="hljs-comment">		* 		cã€æ ¹æ®namespaceUriä»æ˜ å°„å…³ç³»ä¸­æ‰¾åˆ°å¯¹åº”çš„å®ç°äº†NamespaceHandleræ¥å£çš„ç±»</span>
<span class="hljs-comment">		* 		dã€è°ƒç”¨ç±»çš„initæ–¹æ³•ï¼Œinitæ–¹æ³•æ˜¯æ³¨å†Œäº†å„ç§è‡ªå®šä¹‰æ ‡ç­¾çš„è§£æç±»</span>
<span class="hljs-comment">		* 		eã€æ ¹æ®namespaceUriæ‰¾åˆ°å¯¹åº”çš„è§£æç±»ï¼Œç„¶åè°ƒç”¨paseræ–¹æ³•å®Œæˆæ ‡ç­¾è§£æ</span>
<span class="hljs-comment">		*</span>
<span class="hljs-comment">		* 3ã€æŠŠè§£æå‡ºæ¥çš„xmlæ ‡ç­¾å°è£…æˆBeanDefinitionå¯¹è±¡</span>
<span class="hljs-comment">		* */</span>
		<span class="hljs-comment">// Tell the subclass to refresh the internal bean factory.</span>
		ConfigurableListableBeanFactory beanFactory = obtainFreshBeanFactory();

		<span class="hljs-comment">/*</span>
<span class="hljs-comment">		* ç»™beanFactoryè®¾ç½®ä¸€äº›å±æ€§å€¼ï¼Œå¯ä»¥ä¸çœ‹</span>
<span class="hljs-comment">		* */</span>
		<span class="hljs-comment">// Prepare the bean factory for use in this context.</span>
		prepareBeanFactory(beanFactory);

		<span class="hljs-keyword">try</span> &#123;
			<span class="hljs-comment">//TODO</span>
			<span class="hljs-comment">// Allows post-processing of the bean factory in context subclasses.</span>
			postProcessBeanFactory(beanFactory);

			<span class="hljs-comment">/*</span>
<span class="hljs-comment">			* BeanDefinitionRegistryPostProcessor</span>
<span class="hljs-comment">			* BeanFactoryPostProcessor</span>
<span class="hljs-comment">			* å®Œæˆå¯¹è¿™ä¸¤ä¸ªæ¥å£çš„è°ƒç”¨</span>
<span class="hljs-comment">			* */</span>
			<span class="hljs-comment">// Invoke factory processors registered as beans in the context.</span>
			invokeBeanFactoryPostProcessors(beanFactory);

			<span class="hljs-comment">/*</span>
<span class="hljs-comment">			* æŠŠå®ç°äº†BeanPostProcessoræ¥å£çš„ç±»å®ä¾‹åŒ–ï¼Œå¹¶ä¸”åŠ å…¥åˆ°BeanFactoryä¸­</span>
<span class="hljs-comment">			* */</span>
			<span class="hljs-comment">// Register bean processors that intercept bean creation.</span>
			registerBeanPostProcessors(beanFactory);

			<span class="hljs-comment">/*</span>
<span class="hljs-comment">			* å›½é™…åŒ–,é‡è¦ç¨‹åº¦2</span>
<span class="hljs-comment">			* */</span>
			<span class="hljs-comment">// Initialize message source for this context.</span>
			initMessageSource();

			<span class="hljs-comment">//åˆå§‹åŒ–äº‹ä»¶ç®¡ç†ç±»</span>
			<span class="hljs-comment">// Initialize event multicaster for this context.</span>
			initApplicationEventMulticaster();

			<span class="hljs-comment">//è¿™ä¸ªæ–¹æ³•ç€é‡ç†è§£æ¨¡æ¿è®¾è®¡æ¨¡å¼ï¼Œå› ä¸ºåœ¨springbootä¸­ï¼Œè¿™ä¸ªæ–¹æ³•æ˜¯ç”¨æ¥åšå†…åµŒtomcatå¯åŠ¨çš„</span>
			<span class="hljs-comment">// Initialize other special beans in specific context subclasses.</span>
			onRefresh();

			<span class="hljs-comment">/*</span>
<span class="hljs-comment">			* å¾€äº‹ä»¶ç®¡ç†ç±»ä¸­æ³¨å†Œäº‹ä»¶ç±»</span>
<span class="hljs-comment">			* */</span>
			<span class="hljs-comment">// Check for listener beans and register them.</span>
			registerListeners();

			<span class="hljs-comment">/*</span>
<span class="hljs-comment">			* è¿™ä¸ªæ–¹æ³•æ˜¯springä¸­æœ€é‡è¦çš„æ–¹æ³•ï¼Œæ²¡æœ‰ä¹‹ä¸€</span>
<span class="hljs-comment">			* æ‰€ä»¥è¿™ä¸ªæ–¹æ³•ä¸€å®šè¦ç†è§£è¦å…·ä½“çœ‹</span>
<span class="hljs-comment">			* 1ã€beanå®ä¾‹åŒ–è¿‡ç¨‹</span>
<span class="hljs-comment">			* 2ã€ioc</span>
<span class="hljs-comment">			* 3ã€æ³¨è§£æ”¯æŒ</span>
<span class="hljs-comment">			* 4ã€BeanPostProcessorçš„æ‰§è¡Œ</span>
<span class="hljs-comment">			* 5ã€Aopçš„å…¥å£</span>
<span class="hljs-comment">			*</span>
<span class="hljs-comment">			* */</span>
			<span class="hljs-comment">// Instantiate all remaining (non-lazy-init) singletons.</span>
			finishBeanFactoryInitialization(beanFactory);

			<span class="hljs-comment">// Last step: publish corresponding event.</span>
			finishRefresh();
		&#125;

		<span class="hljs-keyword">catch</span> (BeansException ex) &#123;
			<span class="hljs-keyword">if</span> (logger.isWarnEnabled()) &#123;
				logger.warn(<span class="hljs-string">"Exception encountered during context initialization - "</span> +
						<span class="hljs-string">"cancelling refresh attempt: "</span> + ex);
			&#125;

			<span class="hljs-comment">// Destroy already created singletons to avoid dangling resources.</span>
			destroyBeans();

			<span class="hljs-comment">// Reset 'active' flag.</span>
			cancelRefresh(ex);

			<span class="hljs-comment">// Propagate exception to caller.</span>
			<span class="hljs-keyword">throw</span> ex;
		&#125;

		<span class="hljs-keyword">finally</span> &#123;
			<span class="hljs-comment">// Reset common introspection caches in Spring's core, since we</span>
			<span class="hljs-comment">// might not ever need metadata for singleton beans anymore...</span>
			resetCommonCaches();
		&#125;
	&#125;
&#125;</code></pre>

<h2 id="è®¾è®¡æ¨¡å¼1-æ¨¡ç‰ˆè®¾è®¡æ¨¡å¼"><a href="#è®¾è®¡æ¨¡å¼1-æ¨¡ç‰ˆè®¾è®¡æ¨¡å¼" class="headerlink" title="è®¾è®¡æ¨¡å¼1-æ¨¡ç‰ˆè®¾è®¡æ¨¡å¼"></a>è®¾è®¡æ¨¡å¼1-æ¨¡ç‰ˆè®¾è®¡æ¨¡å¼</h2><p>springæºç ä¸­å¤§é‡ä½¿ç”¨äº†æ¨¡ç‰ˆè®¾è®¡æ¨¡å¼ï¼Œæ˜¯ä½¿ç”¨çš„æœ€å¤šçš„è®¾è®¡æ¨¡å¼ã€‚</p>
<p>æ¨¡ç‰ˆè®¾è®¡æ¨¡å¼ä¸€èˆ¬æœ‰ä¸¤ç§ç±»ï¼ŒæŠ½è±¡çš„çˆ¶ç±»ï¼Œä»¥åŠå…·ä½“å®ç°çš„å­ç±»ã€‚çˆ¶ç±»ä¸­å®ç°é€»è¾‘ä¸­ä¸å˜çš„éƒ¨åˆ†ï¼Œå°†å¯å˜çš„è¡Œä¸ºå®šä¹‰ä¸ºæŠ½è±¡æ–¹æ³•äº¤ç»™å­ç±»å®ç°ï¼Œä½†æ–¹æ³•çš„æ‰§è¡Œé¡ºåºç”±çˆ¶ç±»å†³å®šã€‚</p>
<p>åˆ›å»ºä¸€ä¸ªæŠ½è±¡æ¨¡ç‰ˆç»“æ„</p>
<pre><code class="hljs java"><span class="hljs-keyword">public</span> <span class="hljs-keyword">abstract</span> <span class="hljs-class"><span class="hljs-keyword">class</span> <span class="hljs-title">AblstractClass</span> </span>&#123;

    <span class="hljs-comment">//æ¨¡æ¿æ–¹æ³•ç”¨æ¥æ§åˆ¶å­ç±»çš„é¡ºåº è¦æƒ³æœ‰äººç”Ÿå¿…é¡»æŒ‰è€çˆ¸çš„äººç”Ÿé¡ºåºæ¥  </span>
    <span class="hljs-comment">//å£°æ˜finalä¸è®©å­ç±»è¦†ç›–è¿™ä¸ªæ–¹æ³•ï¼Œé˜²æ­¢æ”¹å˜äººç”Ÿé¡ºåº</span>
    <span class="hljs-keyword">public</span> <span class="hljs-keyword">final</span> <span class="hljs-keyword">void</span> äººç”Ÿ()&#123;
        å­¦ä¹ ();
        å·¥ä½œ();
        çˆ±æƒ…();
    &#125;
    
    <span class="hljs-comment">//å®¶é‡Œç©·æ›´å¾—ç”¨å·¥å­¦ä¹ </span>
    <span class="hljs-keyword">public</span> <span class="hljs-keyword">void</span> å­¦ä¹ ()&#123;
        System.out.println(<span class="hljs-string">"æ¯å¤©æ™šä¸Šè¶´åœ¨é‚»å±…çª—ä¸Šå­¦ä¹ "</span>);
    &#125;
    
    <span class="hljs-comment">//å·¥ä½œå¿…é¡»ç¨³å®š</span>
    <span class="hljs-keyword">public</span> <span class="hljs-keyword">void</span> å·¥ä½œ()&#123;       
        System.out.println(<span class="hljs-string">"ä»ä¸€è€Œç»ˆ"</span>);
    &#125;
    
    <span class="hljs-comment">//æ‹çˆ±è‡ªç”±  è®©å„¿å­è‡ªç”±æ‹å»</span>
    <span class="hljs-keyword">public</span> <span class="hljs-keyword">abstract</span> <span class="hljs-keyword">void</span> çˆ±æƒ…();
&#125;</code></pre>

<p>åˆ›å»ºä¸€ä¸ªå…·ä½“æ¨¡ç‰ˆ</p>
<pre><code class="hljs java"><span class="hljs-keyword">public</span> <span class="hljs-class"><span class="hljs-keyword">class</span> <span class="hljs-title">ConcreteClass</span> <span class="hljs-keyword">extends</span> <span class="hljs-title">AblstractClass</span> </span>&#123;
    
    <span class="hljs-comment">//å„¿å­ä¸è®¤å¯çˆ¶äº²çš„å­¦ä¹ æ–¹æ³•  è€ƒé«˜åˆ†å½±å“åŒå­¦å…³ç³»</span>
    <span class="hljs-meta">@Override</span>
    <span class="hljs-keyword">public</span> <span class="hljs-keyword">void</span> å­¦ä¹ () &#123;
        System.out.println(<span class="hljs-string">"60åˆ†ä¸‡å²..."</span>);
    &#125;
    
    <span class="hljs-comment">//çˆ¶äº²ç»™æˆ‘çˆ±æƒ…è‡ªç”±  ä¸€å®šå¥½å¥½è°ˆæ‹çˆ±</span>
    <span class="hljs-meta">@Override</span>
    <span class="hljs-keyword">public</span> <span class="hljs-keyword">void</span> çˆ±æƒ…() &#123;
        System.out.println(<span class="hljs-string">"è‚¤ç™½è²Œç¾å¤§é•¿è…¿..."</span>);
    &#125;
&#125;</code></pre>

<p>å…·ä½“çš„è°ƒç”¨</p>
<pre><code class="hljs java"><span class="hljs-keyword">public</span> <span class="hljs-class"><span class="hljs-keyword">class</span> <span class="hljs-title">TestMain</span> </span>&#123;

    <span class="hljs-function"><span class="hljs-keyword">public</span> <span class="hljs-keyword">static</span> <span class="hljs-keyword">void</span> <span class="hljs-title">main</span><span class="hljs-params">(String[] args)</span> </span>&#123;
         ConcreteClass cs  = <span class="hljs-keyword">new</span> ConcreteClass();
         cs.äººç”Ÿ();
    &#125;
&#125;</code></pre>

<h2 id="xmlè§£æ"><a href="#xmlè§£æ" class="headerlink" title="xmlè§£æ"></a>xmlè§£æ</h2><p>ConfigurableListableBeanFactory beanFactory = obtainFreshBeanFactory();</p>
<p>è¯¥æ–¹æ³•ä¸»è¦è¿›è¡Œxmlè§£æå·¥ä½œï¼Œæµç¨‹å¦‚ä¸‹ï¼š</p>
<ol>
<li><p>åˆ›å»ºXmlBeanDefinitionReaderå¯¹è±¡</p>
<pre><code class="hljs java">XmlBeanDefinitionReader beanDefinitionReader = <span class="hljs-keyword">new</span> XmlBeanDefinitionReader(beanFactory);</code></pre>
</li>
<li><p>é€šè¿‡Readerå¯¹è±¡åŠ è½½é…ç½®æ–‡ä»¶</p>
<pre><code class="hljs java"><span class="hljs-function"><span class="hljs-keyword">protected</span> <span class="hljs-keyword">void</span> <span class="hljs-title">loadBeanDefinitions</span><span class="hljs-params">(XmlBeanDefinitionReader reader)</span> <span class="hljs-keyword">throws</span> BeansException, IOException </span>&#123;
	Resource[] configResources = getConfigResources();
	<span class="hljs-keyword">if</span> (configResources != <span class="hljs-keyword">null</span>) &#123;
		reader.loadBeanDefinitions(configResources);
	&#125;
	<span class="hljs-comment">//è·å–éœ€è¦åŠ è½½çš„xmlé…ç½®æ–‡ä»¶</span>
	String[] configLocations = getConfigLocations();
	<span class="hljs-keyword">if</span> (configLocations != <span class="hljs-keyword">null</span>) &#123;
		reader.loadBeanDefinitions(configLocations);
	&#125;
&#125;</code></pre>
</li>
<li><p>æ ¹æ®åŠ è½½çš„é…ç½®æ–‡ä»¶æŠŠé…ç½®æ–‡ä»¶å°è£…æˆdocumentå¯¹è±¡</p>
<pre><code class="hljs java"><span class="hljs-function"><span class="hljs-keyword">protected</span> <span class="hljs-keyword">int</span> <span class="hljs-title">doLoadBeanDefinitions</span><span class="hljs-params">(InputSource inputSource, Resource resource)</span></span>
<span class="hljs-function">		<span class="hljs-keyword">throws</span> BeanDefinitionStoreException </span>&#123;
   
	<span class="hljs-keyword">try</span> &#123;
		<span class="hljs-comment">//æŠŠinputSource å°è£…æˆDocumentæ–‡ä»¶å¯¹è±¡ï¼Œè¿™æ˜¯jdkçš„API</span>
		Document doc = doLoadDocument(inputSource, resource);
   
		<span class="hljs-comment">//ä¸»è¦çœ‹è¿™ä¸ªæ–¹æ³•ï¼Œæ ¹æ®è§£æå‡ºæ¥çš„documentå¯¹è±¡ï¼Œæ‹¿åˆ°é‡Œé¢çš„æ ‡ç­¾å…ƒç´ å°è£…æˆBeanDefinition</span>
		<span class="hljs-keyword">int</span> count = registerBeanDefinitions(doc, resource);
		<span class="hljs-keyword">if</span> (logger.isDebugEnabled()) &#123;
			logger.debug(<span class="hljs-string">"Loaded "</span> + count + <span class="hljs-string">" bean definitions from "</span> + resource);
		&#125;
		<span class="hljs-keyword">return</span> count;
	&#125;</code></pre>
</li>
<li><p>åˆ›å»ºBeanDefinitionDocumentReaderå¯¹è±¡ï¼ŒDocumentReaderè´Ÿè´£å¯¹documentå¯¹è±¡è§£æ</p>
<pre><code class="hljs java"><span class="hljs-function"><span class="hljs-keyword">public</span> <span class="hljs-keyword">int</span> <span class="hljs-title">registerBeanDefinitions</span><span class="hljs-params">(Document doc, Resource resource)</span> <span class="hljs-keyword">throws</span> BeanDefinitionStoreException </span>&#123;
	<span class="hljs-comment">//åˆæ¥ä¸€è®°å§”æ‰˜æ¨¡å¼ï¼ŒBeanDefinitionDocumentReaderå§”æ‰˜è¿™ä¸ªç±»è¿›è¡Œdocumentçš„è§£æ</span>
	BeanDefinitionDocumentReader documentReader = createBeanDefinitionDocumentReader();
	<span class="hljs-keyword">int</span> countBefore = getRegistry().getBeanDefinitionCount();
	<span class="hljs-comment">//ä¸»è¦çœ‹è¿™ä¸ªæ–¹æ³•ï¼ŒcreateReaderContext(resource) XmlReaderContextä¸Šä¸‹æ–‡ï¼Œå°è£…äº†XmlBeanDefinitionReaderå¯¹è±¡</span>
	documentReader.registerBeanDefinitions(doc, createReaderContext(resource));
	<span class="hljs-keyword">return</span> getRegistry().getBeanDefinitionCount() - countBefore;
&#125;</code></pre>
</li>
<li><p>parseDefaultElement(ele,delegate);è´Ÿè´£å¸¸è§„æ ‡ç­¾çš„è§£æï¼Œdelegate.parseCustomElement(ele)è´Ÿè´£è‡ªå®šä¹‰æ ‡ç­¾çš„è§£æ</p>
<pre><code class="hljs reasonml">protected void parse<span class="hljs-constructor">BeanDefinitions(Element <span class="hljs-params">root</span>, BeanDefinitionParserDelegate <span class="hljs-params">delegate</span>)</span> &#123;
	<span class="hljs-keyword">if</span> (delegate.is<span class="hljs-constructor">DefaultNamespace(<span class="hljs-params">root</span>)</span>) &#123;
		NodeList nl = root.get<span class="hljs-constructor">ChildNodes()</span>;
		for (<span class="hljs-built_in">int</span> i = <span class="hljs-number">0</span>; i &lt; nl.get<span class="hljs-constructor">Length()</span>; i++) &#123;
			Node node = nl.item(i);
			<span class="hljs-keyword">if</span> (node instanceof Element) &#123;
				Element ele = (Element) node;
				<span class="hljs-keyword">if</span> (delegate.is<span class="hljs-constructor">DefaultNamespace(<span class="hljs-params">ele</span>)</span>) &#123;
					<span class="hljs-comment">//é»˜è®¤æ ‡ç­¾è§£æ</span>
					parse<span class="hljs-constructor">DefaultElement(<span class="hljs-params">ele</span>, <span class="hljs-params">delegate</span>)</span>;
				&#125;
				<span class="hljs-keyword">else</span> &#123;
					<span class="hljs-comment">//è‡ªå®šä¹‰æ ‡ç­¾è§£æ</span>
					delegate.parse<span class="hljs-constructor">CustomElement(<span class="hljs-params">ele</span>)</span>;
				&#125;
			&#125;
		&#125;
	&#125;
	<span class="hljs-keyword">else</span> &#123;
		delegate.parse<span class="hljs-constructor">CustomElement(<span class="hljs-params">root</span>)</span>;
	&#125;
&#125;</code></pre>
</li>
<li><p>æœ€ç»ˆè§£æçš„æ ‡ç­¾å°è£…æˆBeanDefinitionå¹¶ç¼“å­˜åˆ°å®¹å™¨ä¸­ã€‚</p>
</li>
<li><p>xmlæµç¨‹åˆ†æ</p>
</li>
</ol>
<img src="/blog/2020/04/13/spring-%E5%88%9D%E5%A7%8B%E5%8C%96%E5%85%A5%E5%8F%A3%E5%92%8Cxml%E8%A7%A3%E6%9E%90/pic1.png" srcset="/blog/img/loading.gif" class>

<h2 id="è‡ªå®šä¹‰æ ‡ç­¾è§£æ"><a href="#è‡ªå®šä¹‰æ ‡ç­¾è§£æ" class="headerlink" title="è‡ªå®šä¹‰æ ‡ç­¾è§£æ"></a>è‡ªå®šä¹‰æ ‡ç­¾è§£æ</h2><ol>
<li><p>é¦–å…ˆè·å–è‡ªå®šä¹‰æ ‡ç­¾å¤´çš„namespaceå‘½åç©ºé—´ï¼Œä¾‹å¦‚ï¼š<code>http://www.springframework.org/schema/context</code>ï¼Œç„¶åé€šè¿‡namespaceè·å–åˆ°NamespaceHandlerå¤„ç†ç±»ï¼Œä¹‹åå†ä½¿ç”¨NamespaceHandlerä¸­çš„è§£æç±»è§£ææ ‡ç­¾è·å¾—BeanDefinitionå¯¹è±¡ã€‚</p>
<pre><code class="hljs java"><span class="hljs-function"><span class="hljs-keyword">public</span> BeanDefinition <span class="hljs-title">parseCustomElement</span><span class="hljs-params">(Element ele, @Nullable BeanDefinition containingBd)</span> </span>&#123;
  <span class="hljs-comment">// è·å–è‡ªå®šä¹‰æ ‡ç­¾çš„å‘½åç©ºé—´</span>
	String namespaceUri = getNamespaceURI(ele);
	<span class="hljs-keyword">if</span> (namespaceUri == <span class="hljs-keyword">null</span>) &#123;
		<span class="hljs-keyword">return</span> <span class="hljs-keyword">null</span>;
	&#125;
   <span class="hljs-comment">// è¿™é‡Œæœ‰SPIæœåŠ¡å‘ç°çš„æ€æƒ³ï¼Œæ ¹æ®é…ç½®æ–‡ä»¶è·å–namespaceUriå¯¹åº”çš„å¤„ç†ç±»</span>
	NamespaceHandler handler = <span class="hljs-keyword">this</span>.readerContext.getNamespaceHandlerResolver().resolve(namespaceUri);
	<span class="hljs-keyword">if</span> (handler == <span class="hljs-keyword">null</span>) &#123;
		error(<span class="hljs-string">"Unable to locate Spring NamespaceHandler for XML schema namespace ["</span> + namespaceUri + <span class="hljs-string">"]"</span>, ele);
		<span class="hljs-keyword">return</span> <span class="hljs-keyword">null</span>;
	&#125;
	<span class="hljs-keyword">return</span> handler.parse(ele, <span class="hljs-keyword">new</span> ParserContext(<span class="hljs-keyword">this</span>.readerContext, <span class="hljs-keyword">this</span>, containingBd));
&#125;</code></pre>
</li>
<li><p>è·å–namespaceä¸NamespaceHandlerå®ä¾‹çš„æ˜ å°„å…³ç³»ï¼Œç„¶åé€šè¿‡åå°„åˆ›å»ºå®ä¾‹ï¼Œå¹¶è°ƒç”¨NamespaceHandlerçš„init()æ–¹æ³•å®Œæˆè§£æç±»çš„æ³¨å†Œã€‚</p>
<pre><code class="hljs java"><span class="hljs-function"><span class="hljs-keyword">public</span> NamespaceHandler <span class="hljs-title">resolve</span><span class="hljs-params">(String namespaceUri)</span> </span>&#123;
	<span class="hljs-comment">//è·å–springä¸­æ‰€æœ‰jaråŒ…é‡Œé¢çš„ "META-INF/spring.handlers"æ–‡ä»¶ï¼Œå¹¶ä¸”å»ºç«‹æ˜ å°„å…³ç³»</span>
	Map&lt;String, Object&gt; handlerMappings = getHandlerMappings();
   
	<span class="hljs-comment">//æ ¹æ®namespaceUriï¼šhttp://www.springframework.org/schema/pï¼Œè·å–åˆ°è¿™ä¸ªå‘½åç©ºé—´çš„å¤„ç†ç±»</span>
	Object handlerOrClassName = handlerMappings.get(namespaceUri);
	<span class="hljs-keyword">if</span> (handlerOrClassName == <span class="hljs-keyword">null</span>) &#123;
		<span class="hljs-keyword">return</span> <span class="hljs-keyword">null</span>;
	&#125;
	<span class="hljs-keyword">else</span> <span class="hljs-keyword">if</span> (handlerOrClassName <span class="hljs-keyword">instanceof</span> NamespaceHandler) &#123;
		<span class="hljs-keyword">return</span> (NamespaceHandler) handlerOrClassName;
	&#125;
	<span class="hljs-keyword">else</span> &#123;
		String className = (String) handlerOrClassName;
		<span class="hljs-keyword">try</span> &#123;
			Class&lt;?&gt; handlerClass = ClassUtils.forName(className, <span class="hljs-keyword">this</span>.classLoader);
			<span class="hljs-keyword">if</span> (!NamespaceHandler<span class="hljs-class">.<span class="hljs-keyword">class</span>.<span class="hljs-title">isAssignableFrom</span>(<span class="hljs-title">handlerClass</span>)) </span>&#123;
				<span class="hljs-keyword">throw</span> <span class="hljs-keyword">new</span> FatalBeanException(<span class="hljs-string">"Class ["</span> + className + <span class="hljs-string">"] for namespace ["</span> + namespaceUri +
						"] does not implement the [" + NamespaceHandler.class.getName() + "] interface");
			&#125;
			NamespaceHandler namespaceHandler = (NamespaceHandler) BeanUtils.instantiateClass(handlerClass);
   
			<span class="hljs-comment">//è°ƒç”¨å¤„ç†ç±»çš„initæ–¹æ³•ï¼Œåœ¨initæ–¹æ³•ä¸­å®Œæˆæ ‡ç­¾å…ƒç´ è§£æç±»çš„æ³¨å†Œ</span>
			namespaceHandler.init();
			handlerMappings.put(namespaceUri, namespaceHandler);
			<span class="hljs-keyword">return</span> namespaceHandler;
		&#125;
		<span class="hljs-keyword">catch</span> (ClassNotFoundException ex) &#123;
			<span class="hljs-keyword">throw</span> <span class="hljs-keyword">new</span> FatalBeanException(<span class="hljs-string">"Could not find NamespaceHandler class ["</span> + className +
					<span class="hljs-string">"] for namespace ["</span> + namespaceUri + <span class="hljs-string">"]"</span>, ex);
		&#125;
		<span class="hljs-keyword">catch</span> (LinkageError err) &#123;
			<span class="hljs-keyword">throw</span> <span class="hljs-keyword">new</span> FatalBeanException(<span class="hljs-string">"Unresolvable class definition for NamespaceHandler class ["</span> +
					className + <span class="hljs-string">"] for namespace ["</span> + namespaceUri + <span class="hljs-string">"]"</span>, err);
		&#125;
	&#125;
&#125;</code></pre>
</li>
<li><p>è·å–namespaceè·ŸNamespaceHandleræ˜ å°„å…³ç³»çš„è¯¦ç»†è¿‡ç¨‹ã€‚springåœ¨jaråŒ…çš„META-INF/spring.handlersæ–‡ä»¶ä¸­ï¼Œå·²ç»ä¿å­˜äº†NamespaceUriå’ŒNamepsaceHandlerä¹‹é—´çš„æ˜ å°„ã€‚æ­¤å¤„ä¼šåŠ è½½spring.handlersä¸­çš„æ‰€æœ‰å†…å®¹å¹¶ä¿å­˜åœ¨mapä¸­ã€‚</p>
<pre><code class="hljs java"><span class="hljs-function"><span class="hljs-keyword">private</span> Map&lt;String, Object&gt; <span class="hljs-title">getHandlerMappings</span><span class="hljs-params">()</span> </span>&#123;
	Map&lt;String, Object&gt; handlerMappings = <span class="hljs-keyword">this</span>.handlerMappings;
	<span class="hljs-keyword">if</span> (handlerMappings == <span class="hljs-keyword">null</span>) &#123;
		<span class="hljs-keyword">synchronized</span> (<span class="hljs-keyword">this</span>) &#123;
			handlerMappings = <span class="hljs-keyword">this</span>.handlerMappings;
			<span class="hljs-keyword">if</span> (handlerMappings == <span class="hljs-keyword">null</span>) &#123;
				<span class="hljs-keyword">if</span> (logger.isTraceEnabled()) &#123;
					logger.trace(<span class="hljs-string">"Loading NamespaceHandler mappings from ["</span> + <span class="hljs-keyword">this</span>.handlerMappingsLocation + <span class="hljs-string">"]"</span>);
				&#125;
				<span class="hljs-keyword">try</span> &#123;
					<span class="hljs-comment">//åŠ è½½"META-INF/spring.handlers"æ–‡ä»¶è¿‡ç¨‹</span>
					Properties mappings =
							PropertiesLoaderUtils.loadAllProperties(<span class="hljs-keyword">this</span>.handlerMappingsLocation, <span class="hljs-keyword">this</span>.classLoader);
					<span class="hljs-keyword">if</span> (logger.isTraceEnabled()) &#123;
						logger.trace(<span class="hljs-string">"Loaded NamespaceHandler mappings: "</span> + mappings);
					&#125;
   
					<span class="hljs-comment">//æ‰€æœ‰"META-INF/spring.handlers"æ–‡ä»¶é‡Œé¢çš„å†…å®¹å»ºç«‹æ˜ å°„å…³ç³»</span>
					handlerMappings = <span class="hljs-keyword">new</span> ConcurrentHashMap&lt;&gt;(mappings.size());
					CollectionUtils.mergePropertiesIntoMap(mappings, handlerMappings);
					<span class="hljs-keyword">this</span>.handlerMappings = handlerMappings;
				&#125;
				<span class="hljs-keyword">catch</span> (IOException ex) &#123;
					<span class="hljs-keyword">throw</span> <span class="hljs-keyword">new</span> IllegalStateException(
							<span class="hljs-string">"Unable to load NamespaceHandler mappings from location ["</span> + <span class="hljs-keyword">this</span>.handlerMappingsLocation + <span class="hljs-string">"]"</span>, ex);
				&#125;
			&#125;
		&#125;
	&#125;
	<span class="hljs-keyword">return</span> handlerMappings;
&#125;</code></pre>


</li>
</ol>
<h2 id="é»˜è®¤æ ‡ç­¾çš„è§£æ"><a href="#é»˜è®¤æ ‡ç­¾çš„è§£æ" class="headerlink" title="é»˜è®¤æ ‡ç­¾çš„è§£æ"></a>é»˜è®¤æ ‡ç­¾çš„è§£æ</h2><ol>
<li><p>é»˜è®¤æ ‡ç­¾åˆ†ä¸ºå››ç§ï¼Œimportã€aliasã€beanã€beansï¼Œè¿™é‡Œä¸»è¦çœ‹beanæ ‡ç­¾çš„è§£æã€‚</p>
<pre><code class="hljs java"><span class="hljs-function"><span class="hljs-keyword">private</span> <span class="hljs-keyword">void</span> <span class="hljs-title">parseDefaultElement</span><span class="hljs-params">(Element ele, BeanDefinitionParserDelegate delegate)</span> </span>&#123;
	<span class="hljs-comment">//importæ ‡ç­¾è§£æ  é‡è¦ç¨‹åº¦ 1 ï¼Œå¯çœ‹å¯ä¸çœ‹</span>
	<span class="hljs-keyword">if</span> (delegate.nodeNameEquals(ele, IMPORT_ELEMENT)) &#123;
		importBeanDefinitionResource(ele);
	&#125;
	<span class="hljs-comment">//aliasæ ‡ç­¾è§£æ åˆ«åæ ‡ç­¾  é‡è¦ç¨‹åº¦ 1 ï¼Œå¯çœ‹å¯ä¸çœ‹</span>
	<span class="hljs-keyword">else</span> <span class="hljs-keyword">if</span> (delegate.nodeNameEquals(ele, ALIAS_ELEMENT)) &#123;
		processAliasRegistration(ele);
	&#125;
	<span class="hljs-comment">//beanæ ‡ç­¾ï¼Œé‡è¦ç¨‹åº¦  5ï¼Œå¿…é¡»çœ‹</span>
	<span class="hljs-keyword">else</span> <span class="hljs-keyword">if</span> (delegate.nodeNameEquals(ele, BEAN_ELEMENT)) &#123;
		processBeanDefinition(ele, delegate);
	&#125;
	<span class="hljs-keyword">else</span> <span class="hljs-keyword">if</span> (delegate.nodeNameEquals(ele, NESTED_BEANS_ELEMENT)) &#123;
		<span class="hljs-comment">// recurse</span>
		doRegisterBeanDefinitions(ele);
	&#125;
&#125;</code></pre>
</li>
<li><p>å…ˆè°ƒç”¨parseBeanDefinitionElement(ele)æ–¹æ³•é¦–å…ˆè§£æèŠ‚ç‚¹å±æ€§å°è£…ä¸ºBeanDefinitionHolderå¯¹è±¡ï¼Œä¹‹åå†è§£æBeanDefinitionHolderå¯¹è±¡ä¸­çš„è‡ªå®šä¹‰å±æ€§ï¼Œå¹¶ä½¿ç”¨è£…é¥°è€…æ¨¡å¼å°†è§£æåçš„å±æ€§è®¾ç½®åˆ°BeanDefinitionHolderä¸­ï¼Œç„¶åå¯¹BeanDefinitionHolderè¿›è¡Œæ³¨å†Œã€‚</p>
<pre><code class="hljs java"><span class="hljs-function"><span class="hljs-keyword">protected</span> <span class="hljs-keyword">void</span> <span class="hljs-title">processBeanDefinition</span><span class="hljs-params">(Element ele, BeanDefinitionParserDelegate delegate)</span> </span>&#123;
	<span class="hljs-comment">//é‡ç‚¹çœ‹è¿™ä¸ªæ–¹æ³•ï¼Œé‡è¦ç¨‹åº¦ 5 ï¼Œè§£æeleï¼Œå°è£…æˆBeanDefinition</span>
	BeanDefinitionHolder bdHolder = delegate.parseBeanDefinitionElement(ele);
	<span class="hljs-keyword">if</span> (bdHolder != <span class="hljs-keyword">null</span>) &#123;
   
		<span class="hljs-comment">//è¯¥æ–¹æ³•åŠŸèƒ½ä¸é‡è¦ï¼Œè®¾è®¡æ¨¡å¼é‡ç‚¹çœ‹ä¸€ä¸‹ï¼Œè£…é¥°è€…è®¾è®¡æ¨¡å¼ï¼ŒåŠ ä¸ŠSPIè®¾è®¡æ€æƒ³</span>
		bdHolder = delegate.decorateBeanDefinitionIfRequired(ele, bdHolder);
		<span class="hljs-keyword">try</span> &#123;
   
			<span class="hljs-comment">//å®Œæˆdocumentåˆ°BeanDefinitionå¯¹è±¡è½¬æ¢åï¼Œå¯¹BeanDefinitionå¯¹è±¡è¿›è¡Œç¼“å­˜æ³¨å†Œ</span>
			<span class="hljs-comment">// Register the final decorated instance.</span>
			<span class="hljs-comment">//æ³¨å†Œè¿‡ç¨‹ï¼Œé‡è¦ç¨‹åº¦5</span>
			BeanDefinitionReaderUtils.registerBeanDefinition(bdHolder, getReaderContext().getRegistry());
		&#125;
		<span class="hljs-keyword">catch</span> (BeanDefinitionStoreException ex) &#123;
			getReaderContext().error(<span class="hljs-string">"Failed to register bean definition with name '"</span> +
					bdHolder.getBeanName() + <span class="hljs-string">"'"</span>, ele, ex);
		&#125;
		<span class="hljs-comment">// Send registration event.</span>
		getReaderContext().fireComponentRegistered(<span class="hljs-keyword">new</span> BeanComponentDefinition(bdHolder));
	&#125;
&#125;</code></pre>
</li>
<li><p>åˆæ¬¡è§£ææ ‡ç­¾çš„è¿‡ç¨‹ã€‚è¿™é‡Œè§£æå®Œæˆåä¼šè¿”å›åˆ°ä¸Šå±‚æ–¹æ³•ï¼Œä¸Šå±‚æ–¹æ³•ä¼šå°†BeanDefinitionã€beannameã€aliasesï¼ˆåˆ«åï¼‰å°è£…ä¸ºBeanDefinitionHolderå¹¶è¿”å›ã€‚</p>
<pre><code class="hljs java"><span class="hljs-function"><span class="hljs-keyword">public</span> AbstractBeanDefinition <span class="hljs-title">parseBeanDefinitionElement</span><span class="hljs-params">(</span></span>
<span class="hljs-function"><span class="hljs-params">		Element ele, String beanName, @Nullable BeanDefinition containingBean)</span> </span>&#123;
   
	<span class="hljs-keyword">this</span>.parseState.push(<span class="hljs-keyword">new</span> BeanEntry(beanName));
   
	String className = <span class="hljs-keyword">null</span>;
	<span class="hljs-keyword">if</span> (ele.hasAttribute(CLASS_ATTRIBUTE)) &#123;
		className = ele.getAttribute(CLASS_ATTRIBUTE).trim();
	&#125;
	String parent = <span class="hljs-keyword">null</span>;
	<span class="hljs-keyword">if</span> (ele.hasAttribute(PARENT_ATTRIBUTE)) &#123;
		parent = ele.getAttribute(PARENT_ATTRIBUTE);
	&#125;
   
	<span class="hljs-keyword">try</span> &#123;
		<span class="hljs-comment">//åˆ›å»ºGenericBeanDefinitionå¯¹è±¡</span>
		AbstractBeanDefinition bd = createBeanDefinition(className, parent);
   
		<span class="hljs-comment">//è§£æbeanæ ‡ç­¾çš„å±æ€§ï¼Œå¹¶æŠŠè§£æå‡ºæ¥çš„å±æ€§è®¾ç½®åˆ°BeanDefinitionå¯¹è±¡ä¸­</span>
		parseBeanDefinitionAttributes(ele, beanName, containingBean, bd);
		bd.setDescription(DomUtils.getChildElementValueByTagName(ele, DESCRIPTION_ELEMENT));
   
		<span class="hljs-comment">//è§£æbeanä¸­çš„metaæ ‡ç­¾</span>
		parseMetaElements(ele, bd);
   
		<span class="hljs-comment">//è§£æbeanä¸­çš„lookup-methodæ ‡ç­¾  é‡è¦ç¨‹åº¦ï¼š2ï¼Œå¯çœ‹å¯ä¸çœ‹</span>
		parseLookupOverrideSubElements(ele, bd.getMethodOverrides());
   
		<span class="hljs-comment">//è§£æbeanä¸­çš„replaced-methodæ ‡ç­¾  é‡è¦ç¨‹åº¦ï¼š2ï¼Œå¯çœ‹å¯ä¸çœ‹</span>
		parseReplacedMethodSubElements(ele, bd.getMethodOverrides());
   
		<span class="hljs-comment">//è§£æbeanä¸­çš„constructor-argæ ‡ç­¾  é‡è¦ç¨‹åº¦ï¼š2ï¼Œå¯çœ‹å¯ä¸çœ‹</span>
		parseConstructorArgElements(ele, bd);
   
		<span class="hljs-comment">//è§£æbeanä¸­çš„propertyæ ‡ç­¾  é‡è¦ç¨‹åº¦ï¼š2ï¼Œå¯çœ‹å¯ä¸çœ‹</span>
		parsePropertyElements(ele, bd);
   
		<span class="hljs-comment">//å¯ä»¥ä¸çœ‹ï¼Œç”¨ä¸åˆ°</span>
		parseQualifierElements(ele, bd);
   
		bd.setResource(<span class="hljs-keyword">this</span>.readerContext.getResource());
		bd.setSource(extractSource(ele));
   
		<span class="hljs-keyword">return</span> bd;
	&#125;</code></pre>
</li>
<li><p>å¯¹æ ‡ç­¾ä¸­çš„è‡ªå®šä¹‰å±æ€§å†æ¬¡è¿›è¡Œè§£æï¼Œæ­¤å¤„ç”¨åˆ°çš„SPIæ€æƒ³è·Ÿè£…é¥°è€…æ¨¡å¼ï¼Œé€šè¿‡SPIæ€æƒ³è·å–å¤„ç†ç±»çš„æ–¹å¼ä¸è‡ªå®šä¹‰æ ‡ç­¾è§£æä¸­çš„æ–¹å¼ç›¸åŒï¼Œæ­¤å¤„ä¸å†èµ˜è¿°ã€‚</p>
<pre><code class="hljs java"><span class="hljs-function"><span class="hljs-keyword">public</span> BeanDefinitionHolder <span class="hljs-title">decorateIfRequired</span><span class="hljs-params">(</span></span>
<span class="hljs-function"><span class="hljs-params">		Node node, BeanDefinitionHolder originalDef, @Nullable BeanDefinition containingBd)</span> </span>&#123;
   
	<span class="hljs-comment">//æ ¹æ®nodeè·å–åˆ°nodeçš„å‘½åç©ºé—´ï¼Œå½¢å¦‚ï¼šhttp://www.springframework.org/schema/p</span>
	String namespaceUri = getNamespaceURI(node);
	<span class="hljs-keyword">if</span> (namespaceUri != <span class="hljs-keyword">null</span> &amp;&amp; !isDefaultNamespace(namespaceUri)) &#123;
   
		<span class="hljs-comment">//è¿™é‡Œæœ‰SPIæœåŠ¡å‘ç°çš„æ€æƒ³ï¼Œæ ¹æ®é…ç½®æ–‡ä»¶è·å–namespaceUriå¯¹åº”çš„å¤„ç†ç±»</span>
		NamespaceHandler handler = <span class="hljs-keyword">this</span>.readerContext.getNamespaceHandlerResolver().resolve(namespaceUri);
		<span class="hljs-keyword">if</span> (handler != <span class="hljs-keyword">null</span>) &#123;
   
			<span class="hljs-comment">//è°ƒç”¨NamespaceHandlerå¤„ç†ç±»çš„decorateæ–¹æ³•ï¼Œå¼€å§‹å…·ä½“è£…é¥°è¿‡ç¨‹ï¼Œå¹¶è¿”å›è£…é¥°å®Œçš„å¯¹è±¡</span>
			BeanDefinitionHolder decorated =
					handler.decorate(node, originalDef, <span class="hljs-keyword">new</span> ParserContext(<span class="hljs-keyword">this</span>.readerContext, <span class="hljs-keyword">this</span>, containingBd));
			<span class="hljs-keyword">if</span> (decorated != <span class="hljs-keyword">null</span>) &#123;
				<span class="hljs-keyword">return</span> decorated;
			&#125;
		&#125;
		<span class="hljs-keyword">else</span> <span class="hljs-keyword">if</span> (namespaceUri.startsWith(<span class="hljs-string">"http://www.springframework.org/"</span>)) &#123;
			error(<span class="hljs-string">"Unable to locate Spring NamespaceHandler for XML schema namespace ["</span> + namespaceUri + <span class="hljs-string">"]"</span>, node);
		&#125;
		<span class="hljs-keyword">else</span> &#123;
			<span class="hljs-comment">// A custom namespace, not to be handled by Spring - maybe "xml:...".</span>
			<span class="hljs-keyword">if</span> (logger.isDebugEnabled()) &#123;
				logger.debug(<span class="hljs-string">"No Spring NamespaceHandler found for XML schema namespace ["</span> + namespaceUri + <span class="hljs-string">"]"</span>);
			&#125;
		&#125;
	&#125;
	<span class="hljs-keyword">return</span> originalDef;
&#125;</code></pre>
</li>
<li><p>æ³¨å†Œè¿‡ç¨‹ï¼Œæ­¤å¤„å®Œæˆå®ŒæˆBeanDefinitionçš„æ³¨å†Œåä¼šå°†beannameä¸aliaseså»ºç«‹è”ç³»ã€‚</p>
<pre><code class="hljs java"><span class="hljs-function"><span class="hljs-keyword">public</span> <span class="hljs-keyword">static</span> <span class="hljs-keyword">void</span> <span class="hljs-title">registerBeanDefinition</span><span class="hljs-params">(</span></span>
<span class="hljs-function"><span class="hljs-params">		BeanDefinitionHolder definitionHolder, BeanDefinitionRegistry registry)</span></span>
<span class="hljs-function">		<span class="hljs-keyword">throws</span> BeanDefinitionStoreException </span>&#123;
   
	<span class="hljs-comment">// Register bean definition under primary name.</span>
	String beanName = definitionHolder.getBeanName();
   
	<span class="hljs-comment">//å®ŒæˆBeanDefinitionçš„æ³¨å†Œï¼Œé‡ç‚¹çœ‹ï¼Œé‡è¦ç¨‹åº¦ 5</span>
	registry.registerBeanDefinition(beanName, definitionHolder.getBeanDefinition());
   
	<span class="hljs-comment">//å»ºç«‹åˆ«åå’Œ idçš„æ˜ å°„ï¼Œè¿™æ ·å°±å¯ä»¥æ ¹æ®åˆ«åè·å–åˆ°id</span>
	<span class="hljs-comment">// Register aliases for bean name, if any.</span>
	String[] aliases = definitionHolder.getAliases();
	<span class="hljs-keyword">if</span> (aliases != <span class="hljs-keyword">null</span>) &#123;
		<span class="hljs-keyword">for</span> (String alias : aliases) &#123;
			registry.registerAlias(beanName, alias);
		&#125;
	&#125;
&#125;</code></pre>
</li>
<li><p>BeanDefinitionçš„æ³¨å†Œè¯¦ç»†è¿‡ç¨‹ã€‚å°†beannameä¸beanDefinitionç¼“å­˜åˆ°mapä¸­ã€beanNameæ”¾åˆ°beanDefinitionNamesä¸­ï¼Œä¹‹åå°†é€šè¿‡beanDefinitionNameså®ä¾‹åŒ–bean</p>
<pre><code class="hljs java"><span class="hljs-function"><span class="hljs-keyword">public</span> <span class="hljs-keyword">void</span> <span class="hljs-title">registerBeanDefinition</span><span class="hljs-params">(String beanName, BeanDefinition beanDefinition)</span></span>
<span class="hljs-function">		<span class="hljs-keyword">throws</span> BeanDefinitionStoreException </span>&#123;
   
	Assert.hasText(beanName, <span class="hljs-string">"Bean name must not be empty"</span>);
	Assert.notNull(beanDefinition, <span class="hljs-string">"BeanDefinition must not be null"</span>);
   
	<span class="hljs-keyword">if</span> (beanDefinition <span class="hljs-keyword">instanceof</span> AbstractBeanDefinition) &#123;
		<span class="hljs-keyword">try</span> &#123;
			((AbstractBeanDefinition) beanDefinition).validate();
		&#125;
		<span class="hljs-keyword">catch</span> (BeanDefinitionValidationException ex) &#123;
			<span class="hljs-keyword">throw</span> <span class="hljs-keyword">new</span> BeanDefinitionStoreException(beanDefinition.getResourceDescription(), beanName,
					<span class="hljs-string">"Validation of bean definition failed"</span>, ex);
		&#125;
	&#125;
   
	<span class="hljs-comment">//å…ˆåˆ¤æ–­BeanDefinitionæ˜¯å¦å·²ç»æ³¨å†Œ</span>
	BeanDefinition existingDefinition = <span class="hljs-keyword">this</span>.beanDefinitionMap.get(beanName);
	<span class="hljs-keyword">if</span> (existingDefinition != <span class="hljs-keyword">null</span>) &#123;
		<span class="hljs-keyword">if</span> (!isAllowBeanDefinitionOverriding()) &#123;
			<span class="hljs-keyword">throw</span> <span class="hljs-keyword">new</span> BeanDefinitionOverrideException(beanName, beanDefinition, existingDefinition);
		&#125;
		<span class="hljs-keyword">else</span> <span class="hljs-keyword">if</span> (existingDefinition.getRole() &lt; beanDefinition.getRole()) &#123;
			<span class="hljs-comment">// e.g. was ROLE_APPLICATION, now overriding with ROLE_SUPPORT or ROLE_INFRASTRUCTURE</span>
			<span class="hljs-keyword">if</span> (logger.isInfoEnabled()) &#123;
				logger.info(<span class="hljs-string">"Overriding user-defined bean definition for bean '"</span> + beanName +
						<span class="hljs-string">"' with a framework-generated bean definition: replacing ["</span> +
						existingDefinition + <span class="hljs-string">"] with ["</span> + beanDefinition + <span class="hljs-string">"]"</span>);
			&#125;
		&#125;
		<span class="hljs-keyword">else</span> <span class="hljs-keyword">if</span> (!beanDefinition.equals(existingDefinition)) &#123;
			<span class="hljs-keyword">if</span> (logger.isDebugEnabled()) &#123;
				logger.debug(<span class="hljs-string">"Overriding bean definition for bean '"</span> + beanName +
						<span class="hljs-string">"' with a different definition: replacing ["</span> + existingDefinition +
						<span class="hljs-string">"] with ["</span> + beanDefinition + <span class="hljs-string">"]"</span>);
			&#125;
		&#125;
		<span class="hljs-keyword">else</span> &#123;
			<span class="hljs-keyword">if</span> (logger.isTraceEnabled()) &#123;
				logger.trace(<span class="hljs-string">"Overriding bean definition for bean '"</span> + beanName +
						<span class="hljs-string">"' with an equivalent definition: replacing ["</span> + existingDefinition +
						<span class="hljs-string">"] with ["</span> + beanDefinition + <span class="hljs-string">"]"</span>);
			&#125;
		&#125;
		<span class="hljs-keyword">this</span>.beanDefinitionMap.put(beanName, beanDefinition);
	&#125;
	<span class="hljs-keyword">else</span> &#123;
		<span class="hljs-keyword">if</span> (hasBeanCreationStarted()) &#123;
			<span class="hljs-comment">// Cannot modify startup-time collection elements anymore (for stable iteration)</span>
			<span class="hljs-keyword">synchronized</span> (<span class="hljs-keyword">this</span>.beanDefinitionMap) &#123;
				<span class="hljs-keyword">this</span>.beanDefinitionMap.put(beanName, beanDefinition);
				List&lt;String&gt; updatedDefinitions = <span class="hljs-keyword">new</span> ArrayList&lt;&gt;(<span class="hljs-keyword">this</span>.beanDefinitionNames.size() + <span class="hljs-number">1</span>);
				updatedDefinitions.addAll(<span class="hljs-keyword">this</span>.beanDefinitionNames);
				updatedDefinitions.add(beanName);
				<span class="hljs-keyword">this</span>.beanDefinitionNames = updatedDefinitions;
				<span class="hljs-keyword">if</span> (<span class="hljs-keyword">this</span>.manualSingletonNames.contains(beanName)) &#123;
					Set&lt;String&gt; updatedSingletons = <span class="hljs-keyword">new</span> LinkedHashSet&lt;&gt;(<span class="hljs-keyword">this</span>.manualSingletonNames);
					updatedSingletons.remove(beanName);
					<span class="hljs-keyword">this</span>.manualSingletonNames = updatedSingletons;
				&#125;
			&#125;
		&#125;
		<span class="hljs-keyword">else</span> &#123;
			<span class="hljs-comment">//æŠŠbeanDefinitionç¼“å­˜åˆ°mapä¸­</span>
			<span class="hljs-comment">// Still in startup registration phase</span>
			<span class="hljs-keyword">this</span>.beanDefinitionMap.put(beanName, beanDefinition);
   
			<span class="hljs-comment">//æŠŠbeanNameæ”¾åˆ°beanDefinitionNames listä¸­</span>
			<span class="hljs-keyword">this</span>.beanDefinitionNames.add(beanName);
			<span class="hljs-keyword">this</span>.manualSingletonNames.remove(beanName);
		&#125;
		<span class="hljs-keyword">this</span>.frozenBeanDefinitionNames = <span class="hljs-keyword">null</span>;
	&#125;
   
	<span class="hljs-keyword">if</span> (existingDefinition != <span class="hljs-keyword">null</span> || containsSingleton(beanName)) &#123;
		resetBeanDefinition(beanName);
	&#125;
&#125;</code></pre>

</li>
</ol>
<h2 id="è®¾è®¡æ¨¡å¼2-å§”æ‰˜æ¨¡å¼"><a href="#è®¾è®¡æ¨¡å¼2-å§”æ‰˜æ¨¡å¼" class="headerlink" title="è®¾è®¡æ¨¡å¼2-å§”æ‰˜æ¨¡å¼"></a>è®¾è®¡æ¨¡å¼2-å§”æ‰˜æ¨¡å¼</h2><p>ä¸å±äº23ç§è®¾è®¡æ¨¡å¼ä¹‹ä¸€ï¼Œæ˜¯é¢å‘å¯¹è±¡è®¾è®¡æ¨¡å¼ä¸­å¸¸ç”¨çš„ä¸€ç§æ¨¡å¼ï¼Œå¯ä»¥ç†è§£ä¸ºé™æ€ä»£ç†å’Œç­–ç•¥æ¨¡å¼çš„ä¸€ç§ç‰¹æ®Šçš„ç»„åˆã€‚ç®€å•æ¥è¯´å°±æ˜¯æ¥å—è¯·æ±‚çš„å¯¹è±¡å°†è¯·æ±‚å§”æ‰˜ç»™å¦ä¸€ä¸ªå¯¹è±¡æ¥å¤„ç†ï¼Œåœ¨springä¸­æ¯”è¾ƒå¸¸è§ã€‚</p>
<pre><code class="hljs java"><span class="hljs-keyword">public</span> <span class="hljs-class"><span class="hljs-keyword">interface</span> <span class="hljs-title">Company</span></span>&#123;
	<span class="hljs-function"><span class="hljs-keyword">void</span> <span class="hljs-title">product</span><span class="hljs-params">()</span></span>;
&#125;</code></pre>

<pre><code class="hljs java"><span class="hljs-keyword">public</span> <span class="hljs-class"><span class="hljs-keyword">class</span> <span class="hljs-title">Sum</span> <span class="hljs-keyword">implements</span> <span class="hljs-title">Company</span></span>&#123;
  <span class="hljs-meta">@Override</span>
  <span class="hljs-function"><span class="hljs-keyword">public</span> <span class="hljs-keyword">void</span> <span class="hljs-title">product</span><span class="hljs-params">()</span></span>&#123;
    System.out.println(<span class="hljs-string">"sum product"</span>);
  &#125;
&#125;</code></pre>

<pre><code class="hljs java"><span class="hljs-keyword">public</span> <span class="hljs-class"><span class="hljs-keyword">class</span> <span class="hljs-title">Boss</span> <span class="hljs-title">implemets</span> <span class="hljs-title">Company</span></span>&#123;
	Sun sun = <span class="hljs-keyword">new</span> Sun();
	
	<span class="hljs-meta">@Override</span>
	<span class="hljs-function"><span class="hljs-keyword">public</span> <span class="hljs-keyword">void</span> <span class="hljs-title">product</span><span class="hljs-params">()</span></span>&#123;
		sun.product();
	&#125;
&#125;</code></pre>

<h2 id="è®¾è®¡æ¨¡å¼3-è£…é¥°æ¨¡å¼"><a href="#è®¾è®¡æ¨¡å¼3-è£…é¥°æ¨¡å¼" class="headerlink" title="è®¾è®¡æ¨¡å¼3-è£…é¥°æ¨¡å¼"></a>è®¾è®¡æ¨¡å¼3-è£…é¥°æ¨¡å¼</h2><p>è£…é¥°æ¨¡å¼é€šè¿‡åˆ›å»ºä¸€ä¸ªåŒ…è£…å¯¹è±¡ï¼ŒåŒ…è£…å¯¹è±¡ä¸­é€šå¸¸æŒæœ‰çœŸå®å¯¹è±¡çš„å¼•ç”¨ï¼Œé€šå¸¸ä¸è£…é¥°å¯¹è±¡æœ‰ç›¸åŒçš„æ¥å£ï¼Œæä¾›ä¸çœŸå®å¯¹è±¡ç›¸åŒçš„äº¤äº’æ–¹å¼ã€‚è£…é¥°å¯¹è±¡åœ¨æ¥æ”¶è¯·æ±‚æ—¶ä¼šå°†è¯·æ±‚è½¬å‘ç»™çœŸå®å¯¹è±¡ï¼Œå¹¶åœ¨è½¬å‘å‰åå¢åŠ ä¸€äº›é™„åŠ åŠŸèƒ½ã€‚è¿™æ ·å°±å¯ä»¥åœ¨ä¸æ”¹å˜çœŸå®å¯¹è±¡çš„å‰æä¸‹ï¼ŒåŠ¨æ€æ‰©å±•çœŸå®å¯¹è±¡çš„åŠŸèƒ½ã€‚</p>
<p>åˆ›å»ºè£…é¥°çš„å…¬å…±æ¥å£</p>
<pre><code class="hljs java"><span class="hljs-keyword">public</span> <span class="hljs-class"><span class="hljs-keyword">interface</span> <span class="hljs-title">Person</span> </span>&#123;
    <span class="hljs-function"><span class="hljs-keyword">void</span> <span class="hljs-title">desc</span><span class="hljs-params">()</span></span>;
&#125;</code></pre>

<p>åˆ›å»ºè¢«è£…é¥°ç±»</p>
<pre><code class="hljs java"><span class="hljs-keyword">public</span> <span class="hljs-class"><span class="hljs-keyword">class</span> <span class="hljs-title">FeiZhai</span> <span class="hljs-keyword">implements</span> <span class="hljs-title">Person</span> </span>&#123;
    <span class="hljs-meta">@Override</span>
    <span class="hljs-function"><span class="hljs-keyword">public</span> <span class="hljs-keyword">void</span> <span class="hljs-title">desc</span><span class="hljs-params">()</span> </span>&#123;
        System.out.println(<span class="hljs-string">"è¿™æ˜¯ä¸€ä¸ªå¿«ä¹è‚¥å®…"</span>);
    &#125;
&#125;</code></pre>

<p>åˆ›å»ºè£…é¥°å™¨</p>
<pre><code class="hljs java"><span class="hljs-keyword">public</span> <span class="hljs-class"><span class="hljs-keyword">class</span> <span class="hljs-title">Decorator</span> <span class="hljs-keyword">implements</span> <span class="hljs-title">Person</span> </span>&#123;
    Person person;
    <span class="hljs-function"><span class="hljs-keyword">public</span> <span class="hljs-title">PersonDecorator</span><span class="hljs-params">(Person person)</span> </span>&#123;
        <span class="hljs-keyword">this</span>.person = person;
    &#125;

    <span class="hljs-meta">@Override</span>
    <span class="hljs-function"><span class="hljs-keyword">public</span> <span class="hljs-keyword">void</span> <span class="hljs-title">desc</span><span class="hljs-params">()</span> </span>&#123;
        person.desc();
    &#125;
&#125;</code></pre>

<p>åˆ›å»ºè£…é¥°å­ç±»ï¼š</p>
<pre><code class="hljs java"><span class="hljs-keyword">public</span> <span class="hljs-class"><span class="hljs-keyword">class</span> <span class="hljs-title">DecoratorDnfPlayer</span> <span class="hljs-keyword">extends</span> <span class="hljs-title">PersonDecorator</span> </span>&#123;
    <span class="hljs-function"><span class="hljs-keyword">public</span> <span class="hljs-title">HighPerson</span><span class="hljs-params">(Person person)</span> </span>&#123;
        <span class="hljs-keyword">super</span>(person);
    &#125;

    <span class="hljs-meta">@Override</span>
    <span class="hljs-function"><span class="hljs-keyword">public</span> <span class="hljs-keyword">void</span> <span class="hljs-title">desc</span><span class="hljs-params">()</span> </span>&#123;
        <span class="hljs-keyword">super</span>.desc();
        System.out.println(<span class="hljs-string">"DNFç©å®¶ï¼Œå…«ç™¾ä¸‡å‹‡å£«ä¹‹ä¸€ï¼ï¼ï¼"</span>);
    &#125;
&#125;</code></pre>

<p>å…·ä½“ä½¿ç”¨</p>
<pre><code class="hljs java"><span class="hljs-keyword">public</span> <span class="hljs-class"><span class="hljs-keyword">class</span> <span class="hljs-title">DecorationTest</span> </span>&#123;
    <span class="hljs-meta">@Test</span>
    <span class="hljs-function"><span class="hljs-keyword">public</span> <span class="hljs-keyword">void</span> <span class="hljs-title">test</span><span class="hljs-params">()</span></span>&#123;
        System.out.println(<span class="hljs-string">"åˆ›å»ºä¸€ä¸ªè‚¥å®…"</span>);
        Person person = <span class="hljs-keyword">new</span> FeiZhai();
        person.desc();
        System.out.println(<span class="hljs-string">"ä½¿ç”¨è£…é¥°å™¨ï¼Œè£…é¥°è‚¥å®…"</span>);
        person = <span class="hljs-keyword">new</span> DecoratorDnfPlayer(persion);
        person.desc();
    &#125;
&#125;</code></pre>

<h2 id="è®¾è®¡æ¨¡å¼4ç­–ç•¥æ¨¡å¼"><a href="#è®¾è®¡æ¨¡å¼4ç­–ç•¥æ¨¡å¼" class="headerlink" title="è®¾è®¡æ¨¡å¼4ç­–ç•¥æ¨¡å¼"></a>è®¾è®¡æ¨¡å¼4ç­–ç•¥æ¨¡å¼</h2><p>ç®€å•æ¥è¯´å°±æ˜¯åˆ›å»ºä¸åŒçš„å¤„ç†é€»è¾‘ï¼Œç„¶åæ ¹æ®æ¡ä»¶å»é€‰æ‹©å¤„ç†é€»è¾‘ã€‚å½“ä»£ç ä¸­å‡ºç°å¤§é‡çš„ifæ—¶ï¼Œä¸ºäº†é¿å…ä¿®æ”¹æ ¸å¿ƒä»£ç ï¼Œä»¥åŠå¢åŠ æ‹“å±•æ€§å°±ç»å¸¸éœ€è¦ä½¿ç”¨ç­–ç•¥æ¨¡å¼ã€‚</p>
<p>æ¯”å¦‚ï¼Œæœ‰çœä»½ä¸åŒçœä»½åšä¸åŒå¤„ç†çš„éœ€æ±‚æ—¶ï¼š</p>
<p>å…ˆåˆ›å»ºä¸€ä¸ªæ¥å£</p>
<pre><code class="hljs java"><span class="hljs-keyword">public</span> <span class="hljs-class"><span class="hljs-keyword">interface</span> <span class="hljs-title">Province</span> </span>&#123;
    <span class="hljs-function"><span class="hljs-keyword">public</span> <span class="hljs-keyword">boolean</span> <span class="hljs-title">support</span><span class="hljs-params">(String flag)</span></span>;
    <span class="hljs-function"><span class="hljs-keyword">public</span> String <span class="hljs-title">handler</span><span class="hljs-params">()</span></span>;
&#125;</code></pre>

<p>æ¹–åŒ—çš„å¤„ç†ç­–ç•¥</p>
<pre><code class="hljs java"><span class="hljs-meta">@Component</span>
<span class="hljs-keyword">public</span> <span class="hljs-class"><span class="hljs-keyword">class</span> <span class="hljs-title">HN</span> <span class="hljs-keyword">implements</span> <span class="hljs-title">Province</span></span>&#123;
    <span class="hljs-keyword">private</span> <span class="hljs-keyword">static</span> String flag = <span class="hljs-string">"HN"</span>;

    <span class="hljs-meta">@Override</span>
    <span class="hljs-function"><span class="hljs-keyword">public</span> <span class="hljs-keyword">boolean</span> <span class="hljs-title">support</span><span class="hljs-params">(String flag)</span> </span>&#123;
        <span class="hljs-keyword">return</span> HN.flag.equalsIgnoreCase(flag);
    &#125;

    <span class="hljs-meta">@Override</span>
    <span class="hljs-function"><span class="hljs-keyword">public</span> String <span class="hljs-title">handler</span><span class="hljs-params">()</span> </span>&#123;
        System.out.println(<span class="hljs-string">"======HNå¤„ç†ç±»å¤„ç†"</span>);
        <span class="hljs-keyword">return</span> <span class="hljs-keyword">null</span>;
    &#125;
&#125;</code></pre>

<p>æ¹–å—çš„å¤„ç†ç­–ç•¥</p>
<pre><code class="hljs java"><span class="hljs-meta">@Component</span>
<span class="hljs-keyword">public</span> <span class="hljs-class"><span class="hljs-keyword">class</span> <span class="hljs-title">HN</span> <span class="hljs-keyword">implements</span> <span class="hljs-title">Province</span></span>&#123;

    <span class="hljs-keyword">private</span> <span class="hljs-keyword">static</span> String flag = <span class="hljs-string">"HN"</span>;

    <span class="hljs-meta">@Override</span>
    <span class="hljs-function"><span class="hljs-keyword">public</span> <span class="hljs-keyword">boolean</span> <span class="hljs-title">support</span><span class="hljs-params">(String flag)</span> </span>&#123;
        <span class="hljs-keyword">return</span> HN.flag.equalsIgnoreCase(flag);
    &#125;

    <span class="hljs-meta">@Override</span>
    <span class="hljs-function"><span class="hljs-keyword">public</span> String <span class="hljs-title">handler</span><span class="hljs-params">()</span> </span>&#123;
        System.out.println(<span class="hljs-string">"======HNå¤„ç†ç±»å¤„ç†"</span>);
        <span class="hljs-keyword">return</span> <span class="hljs-keyword">null</span>;
    &#125;
&#125;</code></pre>

<p>å…·ä½“çš„ä½¿ç”¨</p>
<pre><code class="hljs java"><span class="hljs-function"><span class="hljs-keyword">public</span> <span class="hljs-keyword">void</span> <span class="hljs-title">test1</span><span class="hljs-params">()</span> </span>&#123;

    String flag = <span class="hljs-string">"CQ"</span>;

    Map&lt;String, Province&gt; beansOfType = applicationContext.getBeansOfType(Province<span class="hljs-class">.<span class="hljs-keyword">class</span>)</span>;

    beansOfType.forEach((k,v) -&gt; &#123;
        <span class="hljs-keyword">if</span>(v.support(flag)) &#123;
            v.handler();
        &#125;
    &#125;);
&#125;</code></pre>

<h2 id="è®¾è®¡æ¨¡å¼5å»ºé€ è€…æ¨¡å¼"><a href="#è®¾è®¡æ¨¡å¼5å»ºé€ è€…æ¨¡å¼" class="headerlink" title="è®¾è®¡æ¨¡å¼5å»ºé€ è€…æ¨¡å¼"></a>è®¾è®¡æ¨¡å¼5å»ºé€ è€…æ¨¡å¼</h2><p>å½“ç±»çš„å±æ€§è¿‡äºå¤æ‚æ—¶ï¼Œä½¿ç”¨æ„é€ æ–¹æ³•æˆ–set()æ–¹æ³•è®¾ç½®ä¼šè®©ä»£ç å˜çš„æ··ä¹±ï¼Œè¿™æ—¶å°±å¯ä»¥é€šè¿‡å»ºé€ è€…æ¨¡å¼å¯¹ç±»è¿›è¡Œè£…é…ã€‚</p>
<pre><code class="hljs java"><span class="hljs-keyword">public</span> <span class="hljs-class"><span class="hljs-keyword">class</span> <span class="hljs-title">BuilderClass</span> </span>&#123;

    <span class="hljs-keyword">private</span> <span class="hljs-keyword">final</span> <span class="hljs-keyword">int</span> servingSize;
    <span class="hljs-keyword">private</span> <span class="hljs-keyword">final</span> <span class="hljs-keyword">int</span> servings;
    <span class="hljs-keyword">private</span> <span class="hljs-keyword">final</span> <span class="hljs-keyword">int</span> calories;
    <span class="hljs-keyword">private</span> <span class="hljs-keyword">final</span> <span class="hljs-keyword">int</span> fat;
    <span class="hljs-keyword">private</span> <span class="hljs-keyword">final</span> <span class="hljs-keyword">int</span> sodium;
    <span class="hljs-keyword">private</span> <span class="hljs-keyword">final</span> <span class="hljs-keyword">int</span> carbohydrate;

    <span class="hljs-keyword">public</span> <span class="hljs-keyword">static</span> <span class="hljs-class"><span class="hljs-keyword">class</span> <span class="hljs-title">Builder</span> </span>&#123;
        <span class="hljs-comment">// å¿…è¦å‚æ•°</span>
        <span class="hljs-keyword">private</span> <span class="hljs-keyword">final</span> <span class="hljs-keyword">int</span> servingSize;
        <span class="hljs-keyword">private</span> <span class="hljs-keyword">final</span> <span class="hljs-keyword">int</span> servings;

        <span class="hljs-comment">// å¯é€‰å‚æ•°</span>
        <span class="hljs-keyword">private</span> <span class="hljs-keyword">int</span> calories = <span class="hljs-number">0</span>;
        <span class="hljs-keyword">private</span> <span class="hljs-keyword">int</span> fat = <span class="hljs-number">0</span>;
        <span class="hljs-keyword">private</span> <span class="hljs-keyword">int</span> carbohydrate = <span class="hljs-number">0</span>;
        <span class="hljs-keyword">private</span> <span class="hljs-keyword">int</span> sodium = <span class="hljs-number">0</span>;

        <span class="hljs-function"><span class="hljs-keyword">public</span> <span class="hljs-title">Builder</span><span class="hljs-params">(<span class="hljs-keyword">int</span> servingSize, <span class="hljs-keyword">int</span> servings)</span> </span>&#123;
            <span class="hljs-keyword">this</span>.servingSize = servingSize;
            <span class="hljs-keyword">this</span>.servings = servings;
        &#125;

        <span class="hljs-function"><span class="hljs-keyword">public</span> Builder <span class="hljs-title">calories</span><span class="hljs-params">(<span class="hljs-keyword">int</span> val)</span> </span>&#123;
            calories = val;
            <span class="hljs-keyword">return</span> <span class="hljs-keyword">this</span>;
        &#125;

        <span class="hljs-function"><span class="hljs-keyword">public</span> Builder <span class="hljs-title">fat</span><span class="hljs-params">(<span class="hljs-keyword">int</span> val)</span> </span>&#123;
            fat = val;
            <span class="hljs-keyword">return</span> <span class="hljs-keyword">this</span>;
        &#125;

        <span class="hljs-function"><span class="hljs-keyword">public</span> Builder <span class="hljs-title">carbohydrate</span><span class="hljs-params">(<span class="hljs-keyword">int</span> val)</span> </span>&#123;
            carbohydrate = val;
            <span class="hljs-keyword">return</span> <span class="hljs-keyword">this</span>;
        &#125;

        <span class="hljs-function"><span class="hljs-keyword">public</span> Builder <span class="hljs-title">sodium</span><span class="hljs-params">(<span class="hljs-keyword">int</span> val)</span> </span>&#123;
            sodium = val;
            <span class="hljs-keyword">return</span> <span class="hljs-keyword">this</span>;
        &#125;

        <span class="hljs-function"><span class="hljs-keyword">public</span> BuilderClass <span class="hljs-title">build</span><span class="hljs-params">()</span> </span>&#123;
            <span class="hljs-keyword">return</span> <span class="hljs-keyword">new</span> BuilderClass(<span class="hljs-keyword">this</span>);
        &#125;
    &#125;

    <span class="hljs-function"><span class="hljs-keyword">private</span> <span class="hljs-title">BuilderClass</span><span class="hljs-params">(Builder builder)</span> </span>&#123;
        servingSize = builder.servingSize;
        servings = builder.servings;
        calories = builder.calories;
        fat = builder.fat;
        sodium = builder.sodium;
        carbohydrate = builder.carbohydrate;
    &#125;

    <span class="hljs-function"><span class="hljs-keyword">public</span> <span class="hljs-keyword">static</span> <span class="hljs-keyword">void</span> <span class="hljs-title">main</span><span class="hljs-params">(String[] args)</span> </span>&#123;
        BuilderClass cocaCola = <span class="hljs-keyword">new</span> BuilderClass.Builder(<span class="hljs-number">240</span>, <span class="hljs-number">8</span>)
                .calories(<span class="hljs-number">100</span>).sodium(<span class="hljs-number">35</span>).carbohydrate(<span class="hljs-number">27</span>).build();
    &#125;
&#125;</code></pre>

<h2 id="component-scanæ ‡ç­¾çš„è§£æ"><a href="#component-scanæ ‡ç­¾çš„è§£æ" class="headerlink" title="component-scanæ ‡ç­¾çš„è§£æ"></a>component-scanæ ‡ç­¾çš„è§£æ</h2><ol>
<li><p>contextå±äºè‡ªå®šä¹‰æ ‡ç­¾ï¼Œæ‰€ä»¥éœ€è¦å…ˆé€šè¿‡namespaceå‘½åç©ºé—´åœ¨spring.handlersæ–‡ä»¶ä¸­è·å–åˆ°å¯¹åº”çš„NamepsaceHandlerå¤„ç†ç±»ä¹‹åå†è°ƒç”¨init()æ–¹æ³•æ³¨å†ŒBeanDefinitionParserè§£æç±»ï¼Œç„¶åå†è·å–scanå¯¹åº”çš„BeanDefinitionParserè§£æç±»è¿›è¡Œè§£æã€‚</p>
<pre><code class="hljs elixir">http\<span class="hljs-symbol">://www</span>.springframework.org/schema/context=org.springframework.context.config.ContextNamespaceHandler
http\<span class="hljs-symbol">://www</span>.springframework.org/schema/jee=org.springframework.ejb.config.JeeNamespaceHandler
http\<span class="hljs-symbol">://www</span>.springframework.org/schema/lang=org.springframework.scripting.config.LangNamespaceHandler
http\<span class="hljs-symbol">://www</span>.springframework.org/schema/task=org.springframework.scheduling.config.TaskNamespaceHandler
http\<span class="hljs-symbol">://www</span>.springframework.org/schema/cache=org.springframework.cache.config.CacheNamespaceHandler</code></pre>
</li>
<li><p>è°ƒç”¨ContextNamespaceHandlerçš„init()æ–¹æ³•æ³¨å†ŒBeanDefinitionParserè§£æç±»ã€‚</p>
<pre><code class="hljs java"><span class="hljs-meta">@Override</span>
<span class="hljs-function"><span class="hljs-keyword">public</span> <span class="hljs-keyword">void</span> <span class="hljs-title">init</span><span class="hljs-params">()</span> </span>&#123;
	registerBeanDefinitionParser(<span class="hljs-string">"property-placeholder"</span>, <span class="hljs-keyword">new</span> PropertyPlaceholderBeanDefinitionParser());
	registerBeanDefinitionParser(<span class="hljs-string">"property-override"</span>, <span class="hljs-keyword">new</span> PropertyOverrideBeanDefinitionParser());
	registerBeanDefinitionParser(<span class="hljs-string">"annotation-config"</span>, <span class="hljs-keyword">new</span> AnnotationConfigBeanDefinitionParser());
	registerBeanDefinitionParser(<span class="hljs-string">"component-scan"</span>, <span class="hljs-keyword">new</span> ComponentScanBeanDefinitionParser());
	registerBeanDefinitionParser(<span class="hljs-string">"load-time-weaver"</span>, <span class="hljs-keyword">new</span> LoadTimeWeaverBeanDefinitionParser());
	registerBeanDefinitionParser(<span class="hljs-string">"spring-configured"</span>, <span class="hljs-keyword">new</span> SpringConfiguredBeanDefinitionParser());
	registerBeanDefinitionParser(<span class="hljs-string">"mbean-export"</span>, <span class="hljs-keyword">new</span> MBeanExportBeanDefinitionParser());
	registerBeanDefinitionParser(<span class="hljs-string">"mbean-server"</span>, <span class="hljs-keyword">new</span> MBeanServerBeanDefinitionParser());
&#125;</code></pre>
</li>
<li><p>BeanDefinitionParserçš„parser()æ–¹æ³•ä¸­çš„é€»è¾‘ã€‚åœ¨è¿™é‡Œå°†åˆ›å»ºæ‰«æå™¨å¯¹åŸºç¡€åŒ…è·¯å¾„ä¸‹çš„ç±»è¿›è¡Œæ‰«æï¼Œå¹¶åˆ›å»ºä¸ºBeanDefinitonå¯¹è±¡ï¼Œç„¶åé€šè¿‡registerComponents()æ–¹æ³•æ³¨å†ŒBeanPostProcessorã€‚BeanPostProcessorä¸»è¦æ˜¯æ”¯æ’‘ç±»ä¸­å…¶ä»–æ³¨è§£çš„åŠŸèƒ½ï¼Œå¦‚@Autowiredã€@PostConstructã€@PreDestoryç­‰ã€‚</p>
<pre><code class="hljs java"><span class="hljs-function"><span class="hljs-keyword">public</span> BeanDefinition <span class="hljs-title">parse</span><span class="hljs-params">(Element element, ParserContext parserContext)</span> </span>&#123;
	<span class="hljs-comment">//è·å–basePackageå±æ€§</span>
	String basePackage = element.getAttribute(BASE_PACKAGE_ATTRIBUTE);
	basePackage = parserContext.getReaderContext().getEnvironment().resolvePlaceholders(basePackage);
	<span class="hljs-comment">//å¯ä»¥ç”¨é€—å·åˆ†å¼€</span>
	String[] basePackages = StringUtils.tokenizeToStringArray(basePackage,
			ConfigurableApplicationContext.CONFIG_LOCATION_DELIMITERS);
   
	<span class="hljs-comment">//åˆ›å»ºæ³¨è§£æ‰«æå™¨</span>
	<span class="hljs-comment">// Actually scan for bean definitions and register them.</span>
	ClassPathBeanDefinitionScanner scanner = configureScanner(parserContext, element);
	<span class="hljs-comment">//æ‰«æå¹¶æŠŠæ‰«æçš„ç±»å°è£…æˆbeanDefinitionå¯¹è±¡  æ ¸å¿ƒæ–¹æ³•ï¼Œé‡è¦ç¨‹åº¦ 5</span>
	Set&lt;BeanDefinitionHolder&gt; beanDefinitions = scanner.doScan(basePackages);
   <span class="hljs-comment">//æ³¨å†ŒBeanPostProcessor</span>
	registerComponents(parserContext.getReaderContext(), beanDefinitions, element);
   
	<span class="hljs-keyword">return</span> <span class="hljs-keyword">null</span>;
&#125;</code></pre>
</li>
<li><p>doScan()æ–¹æ³•ä¸­ä¼šæ‰«æåˆ°æœ‰æ³¨è§£çš„ç±»å¹¶å°è£…æˆBeanDefinitionHolderå¯¹è±¡ã€‚åœ¨é€šè¿‡findCandidateComponents()è·å–åˆ°BeanDefinitionä¹‹åï¼Œä¼šæ ¹æ®ScopeMetadataå¯¹BeanDefinitionHolderçš„å±æ€§å†æ¬¡è¿›è¡Œè®¾ç½®ï¼Œå¹¶åˆ›å»ºBeanDefinitionHolderå¯¹è±¡ï¼Œæœ€åæ³¨å†ŒBeanDefinitonHolderã€‚æ³¨å†Œè¿‡ç¨‹ä¸é»˜è®¤å®ä¾‹åŒ–ä¸­ç›¸åŒï¼Œæ­¤å¤„ä¸å†èµ˜è¿°ã€‚</p>
<pre><code class="hljs java"><span class="hljs-function"><span class="hljs-keyword">protected</span> Set&lt;BeanDefinitionHolder&gt; <span class="hljs-title">doScan</span><span class="hljs-params">(String... basePackages)</span> </span>&#123;
	Assert.notEmpty(basePackages, <span class="hljs-string">"At least one base package must be specified"</span>);
	Set&lt;BeanDefinitionHolder&gt; beanDefinitions = <span class="hljs-keyword">new</span> LinkedHashSet&lt;&gt;();
	<span class="hljs-keyword">for</span> (String basePackage : basePackages) &#123;
		<span class="hljs-comment">//æ‰«æåˆ°æœ‰æ³¨è§£çš„ç±»å¹¶å°è£…æˆBeanDefinitionå¯¹è±¡</span>
		Set&lt;BeanDefinition&gt; candidates = findCandidateComponents(basePackage);
		<span class="hljs-keyword">for</span> (BeanDefinition candidate : candidates) &#123;
			ScopeMetadata scopeMetadata = <span class="hljs-keyword">this</span>.scopeMetadataResolver.resolveScopeMetadata(candidate);
			candidate.setScope(scopeMetadata.getScopeName());
			String beanName = <span class="hljs-keyword">this</span>.beanNameGenerator.generateBeanName(candidate, <span class="hljs-keyword">this</span>.registry);
			<span class="hljs-keyword">if</span> (candidate <span class="hljs-keyword">instanceof</span> AbstractBeanDefinition) &#123;
				postProcessBeanDefinition((AbstractBeanDefinition) candidate, beanName);
			&#125;
			<span class="hljs-keyword">if</span> (candidate <span class="hljs-keyword">instanceof</span> AnnotatedBeanDefinition) &#123;
				<span class="hljs-comment">//æ”¯æŒäº†@Lazy @DependOnæ³¨è§£</span>
				AnnotationConfigUtils.processCommonDefinitionAnnotations((AnnotatedBeanDefinition) candidate);
			&#125;
			<span class="hljs-keyword">if</span> (checkCandidate(beanName, candidate)) &#123;
				BeanDefinitionHolder definitionHolder = <span class="hljs-keyword">new</span> BeanDefinitionHolder(candidate, beanName);
				<span class="hljs-comment">//è¿™é‡Œä¸çœ‹</span>
				definitionHolder =
						AnnotationConfigUtils.applyScopedProxyMode(scopeMetadata, definitionHolder, <span class="hljs-keyword">this</span>.registry);
				beanDefinitions.add(definitionHolder);
   
				<span class="hljs-comment">//BeanDefinitionæ³¨å†Œ</span>
				registerBeanDefinition(definitionHolder, <span class="hljs-keyword">this</span>.registry);
			&#125;
		&#125;
	&#125;
	<span class="hljs-keyword">return</span> beanDefinitions;
&#125;</code></pre>
</li>
<li><p>findCandidateComponents()ä¼šé€’å¯»æ‰¾åŒ…è·¯å¾„ä¸‹æ–‡ä»¶ï¼Œç„¶åå°†æ–‡ä»¶å°è£…ä¸ºMetadataReaderå¯¹è±¡ï¼Œä¹‹åå†æ ¹æ®MetadataReaderä¸­çš„ç±»æ³¨è§£åˆ¤æ–­æ˜¯å¦è¿›è¡Œå®ä¾‹åŒ–ã€‚è¿›è¡Œå¤„ç†å¹¶å°è£…ä¸ºBeanDefinitionã€‚MetadataReaderä¸­æŒæœ‰ä¸€ä¸ªClassMetadataï¼ŒClassMetadataå¯¹è±¡ä¸­å‡ ä¹åŒ…æ‹¬ç±»çš„æ‰€æœ‰ä¿¡æ¯ã€‚</p>
<pre><code class="hljs java"><span class="hljs-function"><span class="hljs-keyword">private</span> Set&lt;BeanDefinition&gt; <span class="hljs-title">scanCandidateComponents</span><span class="hljs-params">(String basePackage)</span> </span>&#123;
	Set&lt;BeanDefinition&gt; candidates = <span class="hljs-keyword">new</span> LinkedHashSet&lt;&gt;();
	<span class="hljs-keyword">try</span> &#123;
		String packageSearchPath = ResourcePatternResolver.CLASSPATH_ALL_URL_PREFIX +
				resolveBasePackage(basePackage) + <span class="hljs-string">'/'</span> + <span class="hljs-keyword">this</span>.resourcePattern;
   
		<span class="hljs-comment">//è¿™é‡Œé€’å½’å¯»æ‰¾æ–‡ä»¶</span>
		Resource[] resources = getResourcePatternResolver().getResources(packageSearchPath);
		<span class="hljs-keyword">boolean</span> traceEnabled = logger.isTraceEnabled();
		<span class="hljs-keyword">boolean</span> debugEnabled = logger.isDebugEnabled();
		<span class="hljs-keyword">for</span> (Resource resource : resources) &#123;
			<span class="hljs-keyword">if</span> (traceEnabled) &#123;
				logger.trace(<span class="hljs-string">"Scanning "</span> + resource);
			&#125;
			<span class="hljs-keyword">if</span> (resource.isReadable()) &#123;
				<span class="hljs-keyword">try</span> &#123;
					<span class="hljs-comment">//å°†æ–‡ä»¶ä¿¡æ¯åŒ…è£…ä¸ºç±»åŸºæœ¬ä¿¡æ¯çš„å¯¹è±¡</span>
					MetadataReader metadataReader = getMetadataReaderFactory().getMetadataReader(resource);
					<span class="hljs-comment">//å¦‚æœç±»ä¸Šé¢æœ‰includeFiltersä¸­çš„æ³¨è§£</span>
					<span class="hljs-keyword">if</span> (isCandidateComponent(metadataReader)) &#123;
						ScannedGenericBeanDefinition sbd = <span class="hljs-keyword">new</span> ScannedGenericBeanDefinition(metadataReader);
						sbd.setResource(resource);
						sbd.setSource(resource);
						<span class="hljs-keyword">if</span> (isCandidateComponent(sbd)) &#123;
							<span class="hljs-keyword">if</span> (debugEnabled) &#123;
								logger.debug(<span class="hljs-string">"Identified candidate component class: "</span> + resource);
							&#125;
							candidates.add(sbd);
						&#125;
						<span class="hljs-keyword">else</span> &#123;
							<span class="hljs-keyword">if</span> (debugEnabled) &#123;
								logger.debug(<span class="hljs-string">"Ignored because not a concrete top-level class: "</span> + resource);
							&#125;
						&#125;
					&#125;
					<span class="hljs-keyword">else</span> &#123;
						<span class="hljs-keyword">if</span> (traceEnabled) &#123;
							logger.trace(<span class="hljs-string">"Ignored because not matching any filter: "</span> + resource);
						&#125;
					&#125;
				&#125;
				<span class="hljs-keyword">catch</span> (Throwable ex) &#123;
					<span class="hljs-keyword">throw</span> <span class="hljs-keyword">new</span> BeanDefinitionStoreException(
							<span class="hljs-string">"Failed to read candidate component class: "</span> + resource, ex);
				&#125;
			&#125;
			<span class="hljs-keyword">else</span> &#123;
				<span class="hljs-keyword">if</span> (traceEnabled) &#123;
					logger.trace(<span class="hljs-string">"Ignored because not readable: "</span> + resource);
				&#125;
			&#125;
		&#125;
	&#125;
	<span class="hljs-keyword">catch</span> (IOException ex) &#123;
		<span class="hljs-keyword">throw</span> <span class="hljs-keyword">new</span> BeanDefinitionStoreException(<span class="hljs-string">"I/O failure during classpath scanning"</span>, ex);
	&#125;
	<span class="hljs-keyword">return</span> candidates;
&#125;</code></pre>
</li>
<li><p>é€’å½’å¯»æ‰¾æ–‡ä»¶çš„ä¸»è¦æ–¹æ³•</p>
<pre><code class="hljs java"><span class="hljs-function"><span class="hljs-keyword">protected</span> <span class="hljs-keyword">void</span> <span class="hljs-title">doRetrieveMatchingFiles</span><span class="hljs-params">(String fullPattern, File dir, Set&lt;File&gt; result)</span> <span class="hljs-keyword">throws</span> IOException </span>&#123;
	<span class="hljs-keyword">if</span> (logger.isTraceEnabled()) &#123;
		logger.trace(<span class="hljs-string">"Searching directory ["</span> + dir.getAbsolutePath() +
				<span class="hljs-string">"] for files matching pattern ["</span> + fullPattern + <span class="hljs-string">"]"</span>);
	&#125;
	<span class="hljs-keyword">for</span> (File content : listDirectory(dir)) &#123;
		String currPath = StringUtils.replace(content.getAbsolutePath(), File.separator, <span class="hljs-string">"/"</span>);
		<span class="hljs-comment">//å¦‚æœæ˜¯ä¸€ä¸ªæ–‡ä»¶å¤¹ï¼Œåˆ™é€’å½’</span>
		<span class="hljs-keyword">if</span> (content.isDirectory() &amp;&amp; getPathMatcher().matchStart(fullPattern, currPath + <span class="hljs-string">"/"</span>)) &#123;
			<span class="hljs-keyword">if</span> (!content.canRead()) &#123;
				<span class="hljs-keyword">if</span> (logger.isDebugEnabled()) &#123;
					logger.debug(<span class="hljs-string">"Skipping subdirectory ["</span> + dir.getAbsolutePath() +
							<span class="hljs-string">"] because the application is not allowed to read the directory"</span>);
				&#125;
			&#125;
			<span class="hljs-keyword">else</span> &#123;
				doRetrieveMatchingFiles(fullPattern, content, result);
			&#125;
		&#125;
   
		<span class="hljs-comment">//å¦‚æœæ˜¯ä¸€ä¸ªæ–‡ä»¶ï¼Œåˆ™åŠ å…¥åˆ°å®¹å™¨</span>
		<span class="hljs-keyword">if</span> (getPathMatcher().match(fullPattern, currPath)) &#123;
			result.add(content);
		&#125;
	&#125;
&#125;</code></pre>
</li>
<li><p>æ³¨å†ŒBeanPostProcessorè¿‡ç¨‹</p>
<pre><code class="hljs java"><span class="hljs-function"><span class="hljs-keyword">public</span> <span class="hljs-keyword">static</span> Set&lt;BeanDefinitionHolder&gt; <span class="hljs-title">registerAnnotationConfigProcessors</span><span class="hljs-params">(</span></span>
<span class="hljs-function"><span class="hljs-params">		BeanDefinitionRegistry registry, @Nullable Object source)</span> </span>&#123;
   
	DefaultListableBeanFactory beanFactory = unwrapDefaultListableBeanFactory(registry);
	<span class="hljs-keyword">if</span> (beanFactory != <span class="hljs-keyword">null</span>) &#123;
		<span class="hljs-keyword">if</span> (!(beanFactory.getDependencyComparator() <span class="hljs-keyword">instanceof</span> AnnotationAwareOrderComparator)) &#123;
			beanFactory.setDependencyComparator(AnnotationAwareOrderComparator.INSTANCE);
		&#125;
		<span class="hljs-keyword">if</span> (!(beanFactory.getAutowireCandidateResolver() <span class="hljs-keyword">instanceof</span> ContextAnnotationAutowireCandidateResolver)) &#123;
			beanFactory.setAutowireCandidateResolver(<span class="hljs-keyword">new</span> ContextAnnotationAutowireCandidateResolver());
		&#125;
	&#125;
   
	Set&lt;BeanDefinitionHolder&gt; beanDefs = <span class="hljs-keyword">new</span> LinkedHashSet&lt;&gt;(<span class="hljs-number">8</span>);
   
	<span class="hljs-keyword">if</span> (!registry.containsBeanDefinition(CONFIGURATION_ANNOTATION_PROCESSOR_BEAN_NAME)) &#123;
		RootBeanDefinition def = <span class="hljs-keyword">new</span> RootBeanDefinition(ConfigurationClassPostProcessor<span class="hljs-class">.<span class="hljs-keyword">class</span>)</span>;
		def.setSource(source);
		beanDefs.add(registerPostProcessor(registry, def, CONFIGURATION_ANNOTATION_PROCESSOR_BEAN_NAME));
	&#125;
   
	<span class="hljs-keyword">if</span> (!registry.containsBeanDefinition(AUTOWIRED_ANNOTATION_PROCESSOR_BEAN_NAME)) &#123;
		RootBeanDefinition def = <span class="hljs-keyword">new</span> RootBeanDefinition(AutowiredAnnotationBeanPostProcessor<span class="hljs-class">.<span class="hljs-keyword">class</span>)</span>;
		def.setSource(source);
		beanDefs.add(registerPostProcessor(registry, def, AUTOWIRED_ANNOTATION_PROCESSOR_BEAN_NAME));
	&#125;
   
	<span class="hljs-comment">// Check for JSR-250 support, and if present add the CommonAnnotationBeanPostProcessor.</span>
	<span class="hljs-keyword">if</span> (jsr250Present &amp;&amp; !registry.containsBeanDefinition(COMMON_ANNOTATION_PROCESSOR_BEAN_NAME)) &#123;
		RootBeanDefinition def = <span class="hljs-keyword">new</span> RootBeanDefinition(CommonAnnotationBeanPostProcessor<span class="hljs-class">.<span class="hljs-keyword">class</span>)</span>;
		def.setSource(source);
		beanDefs.add(registerPostProcessor(registry, def, COMMON_ANNOTATION_PROCESSOR_BEAN_NAME));
	&#125;
   
	<span class="hljs-comment">// Check for JPA support, and if present add the PersistenceAnnotationBeanPostProcessor.</span>
	<span class="hljs-keyword">if</span> (jpaPresent &amp;&amp; !registry.containsBeanDefinition(PERSISTENCE_ANNOTATION_PROCESSOR_BEAN_NAME)) &#123;
		RootBeanDefinition def = <span class="hljs-keyword">new</span> RootBeanDefinition();
		<span class="hljs-keyword">try</span> &#123;
			def.setBeanClass(ClassUtils.forName(PERSISTENCE_ANNOTATION_PROCESSOR_CLASS_NAME,
					AnnotationConfigUtils<span class="hljs-class">.<span class="hljs-keyword">class</span>.<span class="hljs-title">getClassLoader</span>()))</span>;
		&#125;
		<span class="hljs-keyword">catch</span> (ClassNotFoundException ex) &#123;
			<span class="hljs-keyword">throw</span> <span class="hljs-keyword">new</span> IllegalStateException(
					<span class="hljs-string">"Cannot load optional framework class: "</span> + PERSISTENCE_ANNOTATION_PROCESSOR_CLASS_NAME, ex);
		&#125;
		def.setSource(source);
		beanDefs.add(registerPostProcessor(registry, def, PERSISTENCE_ANNOTATION_PROCESSOR_BEAN_NAME));
	&#125;
   
	<span class="hljs-keyword">if</span> (!registry.containsBeanDefinition(EVENT_LISTENER_PROCESSOR_BEAN_NAME)) &#123;
		RootBeanDefinition def = <span class="hljs-keyword">new</span> RootBeanDefinition(EventListenerMethodProcessor<span class="hljs-class">.<span class="hljs-keyword">class</span>)</span>;
		def.setSource(source);
		beanDefs.add(registerPostProcessor(registry, def, EVENT_LISTENER_PROCESSOR_BEAN_NAME));
	&#125;
   
	<span class="hljs-keyword">if</span> (!registry.containsBeanDefinition(EVENT_LISTENER_FACTORY_BEAN_NAME)) &#123;
		RootBeanDefinition def = <span class="hljs-keyword">new</span> RootBeanDefinition(DefaultEventListenerFactory<span class="hljs-class">.<span class="hljs-keyword">class</span>)</span>;
		def.setSource(source);
		beanDefs.add(registerPostProcessor(registry, def, EVENT_LISTENER_FACTORY_BEAN_NAME));
	&#125;
   
	<span class="hljs-keyword">return</span> beanDefs;
&#125;</code></pre>

</li>
</ol>
<h2 id="ç®€å•ä¸Šæ‰‹"><a href="#ç®€å•ä¸Šæ‰‹" class="headerlink" title="ç®€å•ä¸Šæ‰‹"></a>ç®€å•ä¸Šæ‰‹</h2><h3 id="ä½¿ç”¨è‡ªå®šä¹‰æ ‡ç­¾è¿æ¥redis"><a href="#ä½¿ç”¨è‡ªå®šä¹‰æ ‡ç­¾è¿æ¥redis" class="headerlink" title="ä½¿ç”¨è‡ªå®šä¹‰æ ‡ç­¾è¿æ¥redis"></a>ä½¿ç”¨è‡ªå®šä¹‰æ ‡ç­¾è¿æ¥redis</h3><ol>
<li>åˆ›å»ºè‡ªå®šä¹‰æ ‡ç­¾çº¦æŸæ–‡ä»¶myMags.xsdï¼Œä½ç½®ä¸ºåœ¨resources/META-INF/</li>
</ol>
<pre><code class="hljs xml"><span class="hljs-meta">&lt;?xml version="1.0" encoding="UTF-8"?&gt;</span>
<span class="hljs-tag">&lt;<span class="hljs-name">xsd:schema</span> <span class="hljs-attr">xmlns</span>=<span class="hljs-string">"http://www.test.com/schema/mytags"</span></span>
<span class="hljs-tag">            <span class="hljs-attr">xmlns:xsd</span>=<span class="hljs-string">"http://www.w3.org/2001/XMLSchema"</span> <span class="hljs-attr">targetNamespace</span>=<span class="hljs-string">"http://www.test.com/schema/mytags"</span></span>
<span class="hljs-tag">            <span class="hljs-attr">elementFormDefault</span>=<span class="hljs-string">"qualified"</span> <span class="hljs-attr">attributeFormDefault</span>=<span class="hljs-string">"unqualified"</span>&gt;</span>
    <span class="hljs-tag">&lt;<span class="hljs-name">xsd:element</span> <span class="hljs-attr">name</span>=<span class="hljs-string">"redis"</span>&gt;</span>
        <span class="hljs-tag">&lt;<span class="hljs-name">xsd:complexType</span>&gt;</span>
            <span class="hljs-tag">&lt;<span class="hljs-name">xsd:attribute</span> <span class="hljs-attr">name</span>=<span class="hljs-string">"id"</span> <span class="hljs-attr">type</span>=<span class="hljs-string">"xsd:string"</span>&gt;</span><span class="hljs-tag">&lt;/<span class="hljs-name">xsd:attribute</span>&gt;</span>
            <span class="hljs-tag">&lt;<span class="hljs-name">xsd:attribute</span> <span class="hljs-attr">name</span>=<span class="hljs-string">"ip"</span> <span class="hljs-attr">type</span>=<span class="hljs-string">"xsd:string"</span>&gt;</span><span class="hljs-tag">&lt;/<span class="hljs-name">xsd:attribute</span>&gt;</span>
            <span class="hljs-tag">&lt;<span class="hljs-name">xsd:attribute</span> <span class="hljs-attr">name</span>=<span class="hljs-string">"port"</span> <span class="hljs-attr">type</span>=<span class="hljs-string">"xsd:string"</span>&gt;</span><span class="hljs-tag">&lt;/<span class="hljs-name">xsd:attribute</span>&gt;</span>
        <span class="hljs-tag">&lt;/<span class="hljs-name">xsd:complexType</span>&gt;</span>
    <span class="hljs-tag">&lt;/<span class="hljs-name">xsd:element</span>&gt;</span>
<span class="hljs-tag">&lt;/<span class="hljs-name">xsd:schema</span>&gt;</span></code></pre>

<ol start="2">
<li>åœ¨ç›¸åŒä½ç½®ä¸ºxsdæ–‡ä»¶åˆ›å»ºæ˜ å°„æ–‡ä»¶spring.schemas</li>
</ol>
<pre><code class="hljs scheme">http\://www.test.com/schema/mytags.xsd=META-INF/myTags.xsd</code></pre>

<ol start="3">
<li>åœ¨ç›¸åŒä½ç½®ä¸‹åˆ›å»ºspring.handlersæ–‡ä»¶</li>
</ol>
<pre><code class="hljs elixir">http\<span class="hljs-symbol">://www</span>.test.com/schema/mytags=org.example.tag.TagsNamespaceHandler</code></pre>

<ol start="4">
<li>åˆ›å»ºRedisBeanDefinitionParserç±»</li>
</ol>
<pre><code class="hljs java"><span class="hljs-keyword">public</span> <span class="hljs-class"><span class="hljs-keyword">class</span> <span class="hljs-title">RedisBeanDefinitionParser</span> <span class="hljs-keyword">extends</span> <span class="hljs-title">AbstractSingleBeanDefinitionParser</span> </span>&#123;
    <span class="hljs-meta">@Override</span>
    <span class="hljs-keyword">protected</span> Class&lt;?&gt; getBeanClass(Element element) &#123;
        <span class="hljs-keyword">return</span> Jedis<span class="hljs-class">.<span class="hljs-keyword">class</span></span>;
    &#125;

    <span class="hljs-meta">@Override</span>
    <span class="hljs-function"><span class="hljs-keyword">protected</span> <span class="hljs-keyword">void</span> <span class="hljs-title">doParse</span><span class="hljs-params">(Element element, BeanDefinitionBuilder builder)</span> </span>&#123;
        String ip = element.getAttribute(<span class="hljs-string">"ip"</span>);
        String port = element.getAttribute(<span class="hljs-string">"port"</span>);

        builder.addConstructorArgValue(ip);
        builder.addConstructorArgValue(Integer.parseInt(port));
    &#125;
&#125;</code></pre>

<ol start="5">
<li>åˆ›å»ºTagsNamespaceHandlerç±»</li>
</ol>
<pre><code class="hljs java"><span class="hljs-keyword">public</span> <span class="hljs-class"><span class="hljs-keyword">class</span> <span class="hljs-title">TagsNamespaceHandler</span> <span class="hljs-keyword">extends</span> <span class="hljs-title">NamespaceHandlerSupport</span> </span>&#123;
    <span class="hljs-meta">@Override</span>
    <span class="hljs-function"><span class="hljs-keyword">public</span> <span class="hljs-keyword">void</span> <span class="hljs-title">init</span><span class="hljs-params">()</span> </span>&#123;
        <span class="hljs-keyword">this</span>.registerBeanDefinitionParser(<span class="hljs-string">"redis"</span>,<span class="hljs-keyword">new</span> RedisBeanDefinitionParser());
    &#125;

    <span class="hljs-meta">@Override</span>
    <span class="hljs-function"><span class="hljs-keyword">public</span> BeanDefinitionHolder <span class="hljs-title">decorate</span><span class="hljs-params">(Node node, BeanDefinitionHolder definition, ParserContext parserContext)</span> </span>&#123;
        <span class="hljs-keyword">return</span> <span class="hljs-keyword">super</span>.decorate(node, definition, parserContext);
    &#125;
&#125;</code></pre>

<ol start="6">
<li>åœ¨spring.xmlä¸­ä½¿ç”¨è‡ªå®šä¹‰æ ‡ç­¾</li>
</ol>
<pre><code class="hljs xml"><span class="hljs-tag">&lt;<span class="hljs-name">beans</span> <span class="hljs-attr">xmlns</span>=<span class="hljs-string">"http://www.springframework.org/schema/beans"</span></span>
<span class="hljs-tag">       <span class="hljs-attr">xmlns:xsi</span>=<span class="hljs-string">"http://www.w3.org/2001/XMLSchema-instance"</span> <span class="hljs-attr">xmlns:my</span>=<span class="hljs-string">"http://www.test.com/schema/mytags"</span></span>
<span class="hljs-tag">       <span class="hljs-attr">xsi:schemaLocation</span>=<span class="hljs-string">"http://www.springframework.org/schema/beans</span></span>
<span class="hljs-tag"><span class="hljs-string">       http://www.springframework.org/schema/beans/spring-beans.xsd</span></span>
<span class="hljs-tag"><span class="hljs-string">       http://www.test.com/schema/mytags</span></span>
<span class="hljs-tag"><span class="hljs-string">       http://www.test.com/schema/mytags.xsd"</span></span>
<span class="hljs-tag">       <span class="hljs-attr">default-lazy-init</span>=<span class="hljs-string">"false"</span>&gt;</span>
    <span class="hljs-comment">&lt;!--è‡ªå®šä¹‰æ ‡ç­¾--&gt;</span>
    <span class="hljs-tag">&lt;<span class="hljs-name">my:redis</span> <span class="hljs-attr">id</span>=<span class="hljs-string">"redis"</span> <span class="hljs-attr">ip</span>=<span class="hljs-string">"localhost"</span> <span class="hljs-attr">port</span>=<span class="hljs-string">"6379"</span>/&gt;</span>
<span class="hljs-tag">&lt;/<span class="hljs-name">beans</span>&gt;</span></code></pre>

<ol start="7">
<li>æµ‹è¯•ç±»</li>
</ol>
<pre><code class="hljs java"><span class="hljs-meta">@RunWith</span>(SpringJUnit4ClassRunner<span class="hljs-class">.<span class="hljs-keyword">class</span>)</span>
<span class="hljs-class">@<span class="hljs-title">ContextConfiguration</span>(<span class="hljs-title">locations</span> </span>= &#123;<span class="hljs-string">"classpath:spring.xml"</span>&#125;)
<span class="hljs-keyword">public</span> <span class="hljs-class"><span class="hljs-keyword">class</span> <span class="hljs-title">MyTest</span> </span>&#123;
    <span class="hljs-meta">@Autowired</span>
    <span class="hljs-keyword">private</span> Jedis jedis;

    <span class="hljs-meta">@Test</span>
    <span class="hljs-function"><span class="hljs-keyword">public</span> <span class="hljs-keyword">void</span> <span class="hljs-title">myTag</span><span class="hljs-params">()</span> </span>&#123;
        jedis.set(<span class="hljs-string">"tag"</span>,<span class="hljs-string">"test"</span>);
        System.out.println(jedis.get(<span class="hljs-string">"tag"</span>));
    &#125;
&#125;</code></pre>

<h3 id="ä½¿ç”¨è‡ªå®šä¹‰æ³¨è§£åˆ›å»ºBeanå¯¹è±¡"><a href="#ä½¿ç”¨è‡ªå®šä¹‰æ³¨è§£åˆ›å»ºBeanå¯¹è±¡" class="headerlink" title="ä½¿ç”¨è‡ªå®šä¹‰æ³¨è§£åˆ›å»ºBeanå¯¹è±¡"></a>ä½¿ç”¨è‡ªå®šä¹‰æ³¨è§£åˆ›å»ºBeanå¯¹è±¡</h3><ol>
<li>åˆ›å»ºMyBeanDefinitionRegistryPostProcessor</li>
</ol>
<pre><code class="hljs java"><span class="hljs-keyword">public</span> <span class="hljs-class"><span class="hljs-keyword">class</span> <span class="hljs-title">MyBeanDefinitionRegistryPostProcessor</span> <span class="hljs-keyword">implements</span> <span class="hljs-title">BeanDefinitionRegistryPostProcessor</span> </span>&#123;

    <span class="hljs-meta">@Override</span>
    <span class="hljs-function"><span class="hljs-keyword">public</span> <span class="hljs-keyword">void</span> <span class="hljs-title">postProcessBeanDefinitionRegistry</span><span class="hljs-params">(BeanDefinitionRegistry registry)</span> <span class="hljs-keyword">throws</span> BeansException </span>&#123;
        GenericBeanDefinition genericBeanDefinition = <span class="hljs-keyword">new</span> GenericBeanDefinition();
        genericBeanDefinition.setBeanClass(BeanClass<span class="hljs-class">.<span class="hljs-keyword">class</span>)</span>;

        MutablePropertyValues propertyValues = genericBeanDefinition.getPropertyValues();
        propertyValues.addPropertyValue(<span class="hljs-string">"username"</span>,<span class="hljs-string">"test"</span>);

        registry.registerBeanDefinition(<span class="hljs-string">"beanClass"</span>,genericBeanDefinition);

        ClassPathBeanDefinitionScanner scanner = <span class="hljs-keyword">new</span> ClassPathBeanDefinitionScanner(registry);
        scanner.addIncludeFilter(<span class="hljs-keyword">new</span> AnnotationTypeFilter(MyService<span class="hljs-class">.<span class="hljs-keyword">class</span>))</span>;
        scanner.scan(<span class="hljs-string">"org.example.beanDefinition"</span>);
    &#125;

    <span class="hljs-meta">@Override</span>
    <span class="hljs-function"><span class="hljs-keyword">public</span> <span class="hljs-keyword">void</span> <span class="hljs-title">postProcessBeanFactory</span><span class="hljs-params">(ConfigurableListableBeanFactory beanFactory)</span> <span class="hljs-keyword">throws</span> BeansException </span>&#123;

    &#125;
&#125;</code></pre>

<ol start="2">
<li>åˆ›å»ºBeanClass</li>
</ol>
<pre><code class="hljs java"><span class="hljs-keyword">public</span> <span class="hljs-class"><span class="hljs-keyword">class</span> <span class="hljs-title">BeanClass</span> </span>&#123;
    <span class="hljs-keyword">private</span> String username;

    <span class="hljs-function"><span class="hljs-keyword">public</span> String <span class="hljs-title">getUsername</span><span class="hljs-params">()</span> </span>&#123;
        <span class="hljs-keyword">return</span> username;
    &#125;

    <span class="hljs-function"><span class="hljs-keyword">public</span> <span class="hljs-keyword">void</span> <span class="hljs-title">setUsername</span><span class="hljs-params">(String username)</span> </span>&#123;
        <span class="hljs-keyword">this</span>.username = username;
    &#125;
&#125;</code></pre>

<ol start="3">
<li>åˆ›å»º</li>
</ol>
<pre><code class="hljs java"><span class="hljs-meta">@Target</span>(&#123;ElementType.TYPE&#125;)
<span class="hljs-meta">@Retention</span>(RetentionPolicy.RUNTIME)
<span class="hljs-meta">@Documented</span>
<span class="hljs-keyword">public</span> <span class="hljs-meta">@interface</span> MyService &#123;ÃŸÃŸ
    <span class="hljs-function">String <span class="hljs-title">value</span><span class="hljs-params">()</span> <span class="hljs-keyword">default</span> ""</span>;
&#125;</code></pre>

<ol start="4">
<li>æµ‹è¯•ç±»</li>
</ol>
<pre><code class="hljs java"><span class="hljs-meta">@RunWith</span>(SpringJUnit4ClassRunner<span class="hljs-class">.<span class="hljs-keyword">class</span>)</span>
<span class="hljs-class">@<span class="hljs-title">ContextConfiguration</span>(<span class="hljs-title">locations</span> </span>= &#123;<span class="hljs-string">"classpath:spring.xml"</span>&#125;)
<span class="hljs-keyword">public</span> <span class="hljs-class"><span class="hljs-keyword">class</span> <span class="hljs-title">MyTest</span> </span>&#123;
    <span class="hljs-meta">@Autowired</span>
    <span class="hljs-keyword">private</span> Jedis jedis;

    <span class="hljs-meta">@Test</span>
    <span class="hljs-function"><span class="hljs-keyword">public</span> <span class="hljs-keyword">void</span> <span class="hljs-title">myTag</span><span class="hljs-params">()</span> </span>&#123;
        jedis.set(<span class="hljs-string">"tag"</span>,<span class="hljs-string">"test"</span>);
        System.out.println(jedis.get(<span class="hljs-string">"tag"</span>));
    &#125;

    <span class="hljs-meta">@Autowired</span>
    <span class="hljs-keyword">private</span> BeanClass beanClass;

    <span class="hljs-meta">@Test</span>
    <span class="hljs-function"><span class="hljs-keyword">public</span> <span class="hljs-keyword">void</span> <span class="hljs-title">beanDefinition</span><span class="hljs-params">()</span></span>&#123;
        System.out.println(beanClass.getUsername());
    &#125;
&#125;</code></pre>


            </div>
            <hr>
            <div>
              <div class="post-metas mb-3">
                
                  <div class="post-meta mr-3">
                    <i class="iconfont icon-category"></i>
                    
                      <a class="hover-with-bg" href="/blog/categories/Spring%E6%BA%90%E7%A0%81%E8%A7%A3%E6%9E%90/">Springæºç è§£æ</a>
                    
                  </div>
                
                
                  <div class="post-meta">
                    <i class="iconfont icon-tags"></i>
                    
                      <a class="hover-with-bg" href="/blog/tags/%E6%BA%90%E7%A0%81%E8%A7%A3%E6%9E%90/">æºç è§£æ</a>
                    
                      <a class="hover-with-bg" href="/blog/tags/spring/">spring</a>
                    
                  </div>
                
              </div>
              
                <p class="note note-warning">æœ¬åšå®¢æ‰€æœ‰æ–‡ç« é™¤ç‰¹åˆ«å£°æ˜å¤–ï¼Œå‡é‡‡ç”¨ <a href="https://creativecommons.org/licenses/by-sa/4.0/deed.zh" target="_blank" rel="nofollow noopener noopener">CC BY-SA 4.0 åè®®</a> ï¼Œè½¬è½½è¯·æ³¨æ˜å‡ºå¤„ï¼</p>
              
              
                <div class="post-prevnext row">
                  <article class="post-prev col-6">
                    
                    
                      <a href="/blog/2020/04/15/spring-%E5%AE%9E%E4%BE%8B%E5%8C%96bean%E7%9A%84%E8%BF%87%E7%A8%8B/">
                        <i class="iconfont icon-arrowleft"></i>
                        <span class="hidden-mobile">Springå®ä¾‹åŒ–Beançš„è¿‡ç¨‹</span>
                        <span class="visible-mobile">ä¸Šä¸€ç¯‡</span>
                      </a>
                    
                  </article>
                  <article class="post-next col-6">
                    
                    
                      <a href="/blog/2020/04/03/MySQL%E7%9A%84%E7%B4%A2%E5%BC%95%E4%B8%8E%E6%89%A7%E8%A1%8C%E8%AE%A1%E5%88%92/">
                        <span class="hidden-mobile">MySQLçš„ç´¢å¼•ä¸æ‰§è¡Œè®¡åˆ’</span>
                        <span class="visible-mobile">ä¸‹ä¸€ç¯‡</span>
                        <i class="iconfont icon-arrowright"></i>
                      </a>
                    
                  </article>
                </div>
              
            </div>

            
          </article>
        </div>
      </div>
    </div>
    
      <div class="d-none d-lg-block col-lg-2 toc-container" id="toc-ctn">
        <div id="toc">
  <p class="toc-header"><i class="iconfont icon-list"></i>&nbsp;ç›®å½•</p>
  <div id="tocbot"></div>
</div>

      </div>
    
  </div>
</div>

<!-- Custom -->


    
  </main>

  
    <a id="scroll-top-button" href="#" role="button">
      <i class="iconfont icon-arrowup" aria-hidden="true"></i>
    </a>
  

  
    <div class="modal fade" id="modalSearch" tabindex="-1" role="dialog" aria-labelledby="ModalLabel"
     aria-hidden="true">
  <div class="modal-dialog modal-dialog-scrollable modal-lg" role="document">
    <div class="modal-content">
      <div class="modal-header text-center">
        <h4 class="modal-title w-100 font-weight-bold">æœç´¢</h4>
        <button type="button" id="local-search-close" class="close" data-dismiss="modal" aria-label="Close">
          <span aria-hidden="true">&times;</span>
        </button>
      </div>
      <div class="modal-body mx-3">
        <div class="md-form mb-5">
          <input type="text" id="local-search-input" class="form-control validate">
          <label data-error="x" data-success="v"
                 for="local-search-input">å…³é”®è¯</label>
        </div>
        <div class="list-group" id="local-search-result"></div>
      </div>
    </div>
  </div>
</div>
  

  

  

  <footer class="mt-5">
  <div class="text-center py-3">
    <div>
      <a href="https://hexo.io" target="_blank" rel="nofollow noopener"><span>Hexo</span></a>
      <i class="iconfont icon-love"></i>
      <a href="https://github.com/fluid-dev/hexo-theme-fluid" target="_blank" rel="nofollow noopener">
        <span>Fluid</span></a>
    </div>
    
  <div class="statistics">
    
    

    
      
        <!-- ä¸è’œå­ç»Ÿè®¡PV -->
        <span id="busuanzi_container_site_pv" style="display: none">
            æ€»è®¿é—®é‡ 
            <span id="busuanzi_value_site_pv"></span>
             æ¬¡
          </span>
      
      
        <!-- ä¸è’œå­ç»Ÿè®¡UV -->
        <span id="busuanzi_container_site_uv" style="display: none">
            æ€»è®¿å®¢æ•° 
            <span id="busuanzi_value_site_uv"></span>
             äºº
          </span>
      
    
  </div>


    

    
  </div>
</footer>

<!-- SCRIPTS -->
<script  src="https://cdn.staticfile.org/jquery/3.4.1/jquery.min.js" ></script>
<script  src="https://cdn.staticfile.org/twitter-bootstrap/4.4.1/js/bootstrap.min.js" ></script>
<script  src="/blog/js/debouncer.js" ></script>
<script  src="/blog/js/main.js" ></script>

<!-- Plugins -->


  
    <script  src="/blog/js/lazyload.js" ></script>
  



  <script defer src="https://cdn.staticfile.org/clipboard.js/2.0.6/clipboard.min.js" ></script>
  <script  src="/blog/js/clipboard-use.js" ></script>



  <script defer src="https://busuanzi.ibruce.info/busuanzi/2.3/busuanzi.pure.mini.js" ></script>





  <script  src="https://cdn.staticfile.org/tocbot/4.11.1/tocbot.min.js" ></script>
  <script>
    $(document).ready(function () {
      var boardCtn = $('#board-ctn');
      var boardTop = boardCtn.offset().top;

      tocbot.init({
        tocSelector: '#tocbot',
        contentSelector: '#post-body',
        headingSelector: 'h1,h2,h3,h4,h5,h6',
        linkClass: 'tocbot-link',
        activeLinkClass: 'tocbot-active-link',
        listClass: 'tocbot-list',
        isCollapsedClass: 'tocbot-is-collapsed',
        collapsibleClass: 'tocbot-is-collapsible',
        collapseDepth: 0,
        scrollSmooth: true,
        headingsOffset: -boardTop
      });
      if ($('.toc-list-item').length > 0) {
        $('#toc').css('visibility', 'visible');
      }
    });
  </script>



  <script  src="https://cdn.staticfile.org/typed.js/2.0.11/typed.min.js" ></script>
  <script>
    var typed = new Typed('#subtitle', {
      strings: [
        '  ',
        "Springçš„åˆå§‹åŒ–å…¥å£å’Œxmlè§£æ&nbsp;",
      ],
      cursorChar: "_",
      typeSpeed: 70,
      loop: false,
    });
    typed.stop();
    $(document).ready(function () {
      $(".typed-cursor").addClass("h2");
      typed.start();
    });
  </script>



  <script  src="https://cdn.staticfile.org/anchor-js/4.2.2/anchor.min.js" ></script>
  <script>
    anchors.options = {
      placement: "right",
      visible: "hover",
      
    };
    var el = "h1,h2,h3,h4,h5,h6".split(",");
    var res = [];
    for (item of el) {
      res.push(".markdown-body > " + item)
    }
    anchors.add(res.join(", "))
  </script>



  <script  src="/blog/js/local-search.js" ></script>
  <script>
    var path = "/blog/local-search.xml";
    var inputArea = document.querySelector("#local-search-input");
    inputArea.onclick = function () {
      searchFunc(path, 'local-search-input', 'local-search-result');
      this.onclick = null
    }
  </script>



  <script  src="https://cdn.staticfile.org/fancybox/3.5.7/jquery.fancybox.min.js" ></script>
  <link  rel="stylesheet" href="https://cdn.staticfile.org/fancybox/3.5.7/jquery.fancybox.min.css" />

  <script>
    $('#post img:not(.no-zoom img, img[no-zoom]), img[zoom]').each(
      function () {
        var element = document.createElement('a');
        $(element).attr('data-fancybox', 'images');
        $(element).attr('href', $(this).attr('src'));
        $(this).wrap(element);
      }
    );
  </script>







  
  
    <script type="text/javascript">
      //å®šä¹‰è·å–è¯è¯­ä¸‹æ ‡
      var a_idx = 0;
      jQuery(document).ready(function ($) {
        //ç‚¹å‡»bodyæ—¶è§¦å‘äº‹ä»¶
        $("body").click(function (e) {
          //éœ€è¦æ˜¾ç¤ºçš„è¯è¯­
          var a = new Array("å¯Œå¼º", "æ°‘ä¸»", "æ–‡æ˜", "å’Œè°", "è‡ªç”±", "å¹³ç­‰", "å…¬æ­£", "æ³•æ²»", "çˆ±å›½", "æ•¬ä¸š", "è¯šä¿¡", "å‹å–„");
          //è®¾ç½®è¯è¯­ç»™spanæ ‡ç­¾
          var $i = $("<span/>").text(a[a_idx]);
          //ä¸‹æ ‡ç­‰äºåŸæ¥ä¸‹æ ‡+1  ä½™ è¯è¯­æ€»æ•°
          a_idx = (a_idx + 1) % a.length;
          //è·å–é¼ æ ‡æŒ‡é’ˆçš„ä½ç½®ï¼Œåˆ†åˆ«ç›¸å¯¹äºæ–‡æ¡£çš„å·¦å’Œå³è¾¹ç¼˜ã€‚
          //è·å–xå’Œyçš„æŒ‡é’ˆåæ ‡
          var x = e.pageX, y = e.pageY;
          //åœ¨é¼ æ ‡çš„æŒ‡é’ˆçš„ä½ç½®ç»™$iå®šä¹‰çš„spanæ ‡ç­¾æ·»åŠ cssæ ·å¼
          $i.css({
            "z-index": 999,
            "top": y - 20,
            "left": x,
            "position": "absolute",
            "font-weight": "bold",
            "color": rand_color()
          });
          // éšæœºé¢œè‰²
          function rand_color() {
            return "rgb(" + ~~(255 * Math.random()) + "," + ~~(255 * Math.random()) + "," + ~~(255 * Math.random()) + ")"
          }
          //åœ¨bodyæ·»åŠ è¿™ä¸ªæ ‡ç­¾
          $("body").append($i);
          //animate() æ–¹æ³•æ‰§è¡Œ CSS å±æ€§é›†çš„è‡ªå®šä¹‰åŠ¨ç”»ã€‚
          //è¯¥æ–¹æ³•é€šè¿‡CSSæ ·å¼å°†å…ƒç´ ä»ä¸€ä¸ªçŠ¶æ€æ”¹å˜ä¸ºå¦ä¸€ä¸ªçŠ¶æ€ã€‚CSSå±æ€§å€¼æ˜¯é€æ¸æ”¹å˜çš„ï¼Œè¿™æ ·å°±å¯ä»¥åˆ›å»ºåŠ¨ç”»æ•ˆæœã€‚
          //è¯¦æƒ…è¯·çœ‹http://www.w3school.com.cn/jquery/effect_animate.asp
          $i.animate({
            //å°†åŸæ¥çš„ä½ç½®å‘ä¸Šç§»åŠ¨180
            "top": y - 180,
            "opacity": 0
            //1500åŠ¨ç”»çš„é€Ÿåº¦
          }, 1500, function () {
            //æ—¶é—´åˆ°äº†è‡ªåŠ¨åˆ é™¤
            $i.remove();
          });
        });
      })
      ;
    </script>
  














</body>
</html>
