<!DOCTYPE html>
<html lang="zh-CN">





<head>
  <meta charset="UTF-8">
  <link rel="apple-touch-icon" sizes="76x76" href="/blog/img/apple-touch-icon.png">
  <link rel="icon" type="image/png" href="/blog/img/favicon.png">
  <meta name="viewport"
        content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no, shrink-to-fit=no">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  
  <meta name="theme-color" content="#2f4154">
  <meta name="description" content="">
  <meta name="author" content="">
  <meta name="keywords" content="">
  <title>springç¨‹åºå…¥å£å’Œxmlè§£æ - ğŸğŸŠ&#39;s blog</title>

  <link  rel="stylesheet" href="https://cdn.staticfile.org/font-awesome/5.12.1/css/all.min.css" />
<link  rel="stylesheet" href="https://cdn.staticfile.org/twitter-bootstrap/4.4.1/css/bootstrap.min.css" />
<link  rel="stylesheet" href="https://cdn.staticfile.org/mdbootstrap/4.13.0/css/mdb.min.css" />
<link  rel="stylesheet" href="https://cdn.staticfile.org/github-markdown-css/3.0.1/github-markdown.min.css" />

<link rel="stylesheet" href="//at.alicdn.com/t/font_1067060_qzomjdt8bmp.css">



  <link  rel="stylesheet" href="/blog/lib/prettify/tomorrow-night-eighties.min.css" />

<link  rel="stylesheet" href="/blog/css/main.css" />


  <link defer rel="stylesheet" href="https://cdn.staticfile.org/fancybox/3.5.7/jquery.fancybox.min.css" />


<!-- è‡ªå®šä¹‰æ ·å¼ä¿æŒåœ¨æœ€åº•éƒ¨ -->


<meta name="generator" content="Hexo 4.2.1"></head>


<body>
  <header style="height: 70vh;">
    <nav id="navbar" class="navbar fixed-top  navbar-expand-lg navbar-dark scrolling-navbar">
  <div class="container">
    <a class="navbar-brand"
       href="/blog/">&nbsp;<strong>ğŸğŸŠ's blog</strong>&nbsp;</a>

    <button id="navbar-toggler-btn" class="navbar-toggler" type="button" data-toggle="collapse"
            data-target="#navbarSupportedContent"
            aria-controls="navbarSupportedContent" aria-expanded="false" aria-label="Toggle navigation">
      <div class="animated-icon"><span></span><span></span><span></span></div>
    </button>

    <!-- Collapsible content -->
    <div class="collapse navbar-collapse" id="navbarSupportedContent">
      <ul class="navbar-nav ml-auto text-center">
        
          
          
          
          
          <li class="nav-item">
            <a class="nav-link" href="/blog/">é¦–é¡µ</a>
          </li>
        
          
          
          
          
          <li class="nav-item">
            <a class="nav-link" href="/blog/archives/">å½’æ¡£</a>
          </li>
        
          
          
          
          
          <li class="nav-item">
            <a class="nav-link" href="/blog/categories/">åˆ†ç±»</a>
          </li>
        
          
          
          
          
          <li class="nav-item">
            <a class="nav-link" href="/blog/tags/">æ ‡ç­¾</a>
          </li>
        
          
          
          
          
          <li class="nav-item">
            <a class="nav-link" href="/blog/about">å…³äº</a>
          </li>
        
        
          <li class="nav-item" id="search-btn">
            <a class="nav-link" data-toggle="modal" data-target="#modalSearch">&nbsp;&nbsp;<i
                class="iconfont icon-search"></i>&nbsp;&nbsp;</a>
          </li>
        
      </ul>
    </div>
  </div>
</nav>

    <div class="view intro-2" id="background" parallax=true
         style="background: url('/blog/img/default.png') no-repeat center center;
           background-size: cover;">
      <div class="full-bg-img">
        <div class="mask rgba-black-light flex-center">
          <div class="container text-center white-text fadeInUp">
            <span class="h2" id="subtitle">
              
            </span>

            
              
                <p class="mt-3 post-meta">
                  <i class="fas fa-calendar-alt" aria-hidden="true"></i>
                  æ˜ŸæœŸä¸€, å››æœˆ 13æ—¥ 2020, 7:02 æ™šä¸Š
                </p>
              

              <p class="mt-1">
                
                  
                  <span class="post-meta">
                    <i class="far fa-chart-bar"></i>
                    7.4k å­—
                  </span>
                

                
                  
                  <span class="post-meta">
                      <i class="far fa-clock"></i>
                      34 åˆ†é’Ÿ
                  </span>
                

                
                  <!-- ä¸è’œå­ç»Ÿè®¡æ–‡ç« PV -->
                  
                  <span id="busuanzi_container_page_pv" class="post-meta" style="display: none">
                    <i class="far fa-eye" aria-hidden="true"></i>
                    <span id="busuanzi_value_page_pv"></span> æ¬¡
                  </span>
                
              </p>
            
          </div>

          
        </div>
      </div>
    </div>
  </header>

  <main>
    
      

<div class="container-fluid">
  <div class="row">
    <div class="d-none d-lg-block col-lg-2"></div>
    <div class="col-lg-8 nopadding-md">
      <div class="container nopadding-md" id="board-ctn">
        <div class="py-5 z-depth-3" id="board">
          <div class="post-content mx-auto" id="post">
            
              <p
                class="note note-warning">æœ¬æ–‡æœ€åæ›´æ–°äºï¼šæ˜ŸæœŸäºŒ, å››æœˆ 21æ—¥ 2020, 6:16 æ™šä¸Š</p>
            
            <div class="markdown-body">
              <h2 id="Springçš„å†å²"><a href="#Springçš„å†å²" class="headerlink" title="Springçš„å†å²"></a>Springçš„å†å²</h2><ul>
<li><p>2002å¹´10æœˆï¼ŒRod Johnsoå‘å¸ƒã€ŠExpert One-on-One J2EE è®¾è®¡å’Œå¼€å‘ã€‹ä¸€ä¹¦</p>
</li>
<li><p>2004 å¹´ 3 æœˆï¼ŒSpring1.0 å‘å¸ƒ</p>
<p>2003 å¹´ 6 æœˆï¼ŒSpring Framework ç¬¬ä¸€æ¬¡ä»¥ Apache 2.0 è®¸å¯è¯ä¸‹å‘å¸ƒ 0.9 ç‰ˆ æœ¬ï¼Œ2004 å¹´ 3 æœˆï¼ŒSpring1.0 æ­£å¼å‘å¸ƒã€‚å¯¹äº Spring1.0ï¼Œå…¶æºç åªæœ‰ä¸€ä¸ªåŒ…ï¼Œåœ¨è¯¥åŒ…ä¸­åŒ…å«äº† aopã€beansã€contextã€ coreã€jdbcã€orm ç­‰ã€‚å¯¹äºæ­¤æ—¶çš„ç‰ˆæœ¬ï¼ŒSpring1.0 ä»…æ”¯æŒ XML é…ç½®çš„æ–¹å¼ã€‚</p>
</li>
<li><p>2006 å¹´ 10 æœˆï¼ŒSpring2.0 å‘å¸ƒ<br>å¯¹äº 2.0ï¼ŒSpring ä¸»è¦å¢åŠ äº†å¯¹æ³¨è§£çš„æ”¯æŒï¼Œå®ç°äº†åŸºäºæ³¨è§£çš„é…ç½®ã€‚</p>
<p>åœ¨ 2007 å¹´ 11 æœˆï¼Œå‘å¸ƒ Spring2.5ï¼Œè¯¥ç‰ˆæœ¬å…·å¤‡çš„ç‰¹æ€§æœ‰ï¼š</p>
<ul>
<li><p>æ·»åŠ å¯æ‰©å±•çš„ XML é…ç½®åŠŸèƒ½ï¼Œç”¨äºç®€åŒ– XML é…ç½®ï¼Œ</p>
</li>
<li><p>æ”¯æŒ Java5</p>
</li>
<li><p>æ·»åŠ é¢å¤–çš„ IOC å®¹å™¨æ‰©å±•ç‚¹ï¼Œæ”¯æŒåŠ¨æ€è¯­è¨€(å¦‚ groovyï¼Œaop å¢å¼ºåŠŸèƒ½å’Œæ–° çš„ bean èŒƒå›´ )</p>
</li>
</ul>
</li>
<li><p>2009 å¹´ 12 æœˆï¼ŒSpring3.0 å‘å¸ƒ</p>
<p>Spring3.0 ä¸»è¦å…·æœ‰çš„ç‰¹æ€§æœ‰: </p>
<ul>
<li>æ¨¡å—é‡ç»„ç³»ç»Ÿ</li>
<li>æ”¯æŒ Spring è¡¨è¾¾å¼è¯­è¨€(Spring Expression)</li>
<li>åŸºäº Java çš„ Bean é…ç½®(JavaConfig) æ”¯æŒåµŒå…¥å¼æ•°æ®åº“:HSQLã€H2 ç­‰ æ”¯æŒ REST</li>
<li>æ”¯æŒ Java6</li>
</ul>
</li>
<li><p>2013 å¹´ 12 æœˆï¼Œå‘å¸ƒ Spring4.0</p>
<p>å¯¹äº Spring4.0 æ˜¯ Spring ç‰ˆæœ¬å†å²ä¸Šçš„ä¸€é‡å¤§å‡çº§ã€‚å…¶ç‰¹æ€§ä¸º: </p>
<ul>
<li>å…¨é¢æ”¯æŒ Java8æ”¯æŒ Lambda è¡¨è¾¾å¼ã€‚</li>
<li>æ”¯æŒ Java8 çš„æ—¶é—´å’Œæ—¥æœŸ API</li>
<li>æ”¯æŒé‡å¤æ³¨è§£</li>
<li>æ”¯æŒ Java8 çš„ Optional</li>
<li>æ ¸å¿ƒå®¹å™¨å¢å¼º</li>
<li>å¢åŠ æ³›å‹ä¾èµ–æ³¨å…¥</li>
<li>å¢åŠ  Map ä¾èµ–æ³¨å…¥</li>
<li>å¢åŠ  List ä¾èµ–æ³¨å…¥</li>
<li>æ”¯æŒ lazy æ³¨è§£é…ç½®æ‡’åŠ è½½</li>
<li>æ”¯æŒ Condition æ¡ä»¶æ³¨è§£</li>
<li>CGLIB åŠ¨æ€ä»£ç†å¢å¼º</li>
<li>æ”¯æŒåŸºäº GroovyDSL å®šä¹‰ Bean</li>
<li>Web å¢å¼º</li>
<li>å¢å¼º SpringMVCï¼ŒåŸºäº Servlet3.0 å¼€å‘</li>
<li>æä¾› RestController æ³¨è§£</li>
<li>æä¾› AsyncRestTemplate æ”¯æŒå®¢æˆ·ç«¯çš„å¼‚æ­¥æ— é˜»å¡è¯·æ±‚</li>
<li>å¢åŠ å¯¹ WebSocket çš„æ”¯æŒ</li>
</ul>
</li>
<li><p>2017 å¹´ 9 æœˆï¼ŒSpring5.0 å‘å¸ƒ</p>
<p>Spring5.0 ç‰¹æ€§å¦‚ä¸‹ï¼š</p>
<ul>
<li>å‡çº§åˆ° Java8ã€JavaEE7</li>
<li>åºŸå¼ƒä½ç‰ˆæœ¬ï¼Œå°† Java8ã€JavaEE 7 ä½œä¸ºæœ€ä½ç‰ˆæœ¬è¦æ±‚ å…¼å®¹ Java9ã€å…¼å®¹ JavaEE8</li>
<li>ååº”å¼ç¼–ç¨‹æ¨¡å‹ï¼Œå¢åŠ  WebFlux æ¨¡å—</li>
<li>å‡çº§ SpringMVCï¼Œå¢åŠ å¯¹æœ€æ–°çš„ API(Jackson ç­‰)çš„æ”¯æŒ å¢åŠ å‡½æ•°å¼ç¼–ç¨‹æ¨¡å¼</li>
<li>é‡æ„æºç ï¼Œéƒ¨åˆ†åŠŸèƒ½ä½¿ç”¨ Lambda è¡¨è¾¾å¼å®ç°</li>
</ul>
</li>
</ul>
<h2 id="Springçš„å­é¡¹ç›®"><a href="#Springçš„å­é¡¹ç›®" class="headerlink" title="Springçš„å­é¡¹ç›®"></a>Springçš„å­é¡¹ç›®</h2><ul>
<li>Spring IO Platform : Spring IO æ˜¯å¯é›†æˆçš„ã€æ„å»ºç°ä»£åŒ–åº”ç”¨çš„ç‰ˆæœ¬å¹³å°ã€‚Spring IO æ˜¯æ¨¡å—åŒ–çš„ã€ä¼ä¸šçº§çš„åˆ†å¸ƒå¼ç³»ç»Ÿï¼ŒåŒ…æ‹¬ä¸€ç³»åˆ—ä¾èµ–ï¼Œæ˜¯çš„å¼€å‘è€…ä»…èƒ½å¯¹è‡ªå·±æ‰€éœ€çš„éƒ¨åˆ†è¿›è¡Œå®Œå…¨çš„éƒ¨ç½²æ§åˆ¶ã€‚</li>
<li>Spring Boot:Spring åº”ç”¨å¿«é€Ÿå¼€å‘å·¥å…·ï¼Œç”¨æ¥ç®€åŒ– Spring åº”ç”¨å¼€å‘è¿‡ç¨‹ã€‚ </li>
<li>Spring XD:Spring XD(eXtreme Dateï¼Œæé™æ•°æ®)æ˜¯ Pivotal çš„å¤§æ•°æ®äº§å“ã€‚å®ƒç»“åˆäº† Spring Boot å’Œ Grailsï¼Œç»„æˆ Spring IO å¹³å°çš„æ‰§è¡Œéƒ¨åˆ†ã€‚</li>
<li>Spring Data:Spring Data æ˜¯ä¸ºäº†ç®€åŒ–æ„å»ºåŸºäº Spring æ¡†æ¶åº”ç”¨çš„æ•°æ®è®¿é—®å®ç°ï¼ŒåŒ…æ‹¬éå…³ç³»æ•°æ®åº“ã€Map-Reduce æ¡†æ¶ã€äº‘æ•°æ®æœåŠ¡ç­‰;å¦å¤–ï¼Œä¹ŸåŒ…å«å¯¹å…³ ç³»æ•°æ®åº“çš„è®¿é—®æ”¯æŒã€‚</li>
<li>Spring Integration:Spring Integration ä¸ºä¼ä¸šæ•°æ®é›†æˆæä¾›äº†å„ç§é€‚é…å™¨ï¼Œå¯ä»¥é€šè¿‡è¿™äº›é€‚é…å™¨æ¥è½¬æ¢å„ç§æ¶ˆæ¯æ ¼å¼ï¼Œå¹¶å¸®åŠ© Spring åº”ç”¨å®Œæˆä¸ä¼ä¸šåº”ç”¨ç³»ç»Ÿçš„é›†æˆã€‚</li>
<li>Spring Batch:Spring Batch æ˜¯ä¸€ä¸ªè½»é‡çº§çš„å®Œæ•´æ‰¹å¤„ç†æ¡†æ¶ï¼Œæ—¨åœ¨å¸®åŠ©åº”ç”¨å¼€å‘è€…æ„å»ºä¸€ä¸ªå¥å£®ã€é«˜æ•ˆçš„ä¼ä¸šçº§æ‰¹å¤„ç†åº”ç”¨(è¿™äº›åº”ç”¨çš„ç‰¹ç‚¹æ˜¯ä¸éœ€è¦ä¸ç”¨ æˆ·äº¤äº’ï¼Œé‡å¤çš„æ“ä½œé‡å¤§ï¼Œå¯¹äºå¤§å®¹é‡çš„æ‰¹é‡æ•°æ®å¤„ç†è€Œè¨€ï¼Œè¿™äº›æ“ä½œå¾€å¾€è¦æ±‚ è¾ƒé«˜çš„å¯é æ€§)</li>
<li>Spring Security:Spring Security æ˜¯ä¸€ä¸ªèƒ½å¤Ÿä¸ºåŸºäº Spring çš„ä¼ä¸šåº”ç”¨ç³»ç»Ÿæ ä¾›å£°æ˜å¼çš„å®‰å…¨è®¿é—®æ§åˆ¶è§£å†³æ–¹æ¡ˆçš„å®‰å…¨æ¡†æ¶ã€‚å®ƒæä¾›äº†ä¸€ç»„å¯ä»¥åœ¨ Spring åº”ç”¨ ä¸Šä¸‹æ–‡é…ç½®çš„ beanï¼Œå……åˆ†åˆ©ç”¨ Ioc å’Œ AOP åŠŸèƒ½ï¼Œä¸ºåº”ç”¨ç³»ç»Ÿæä¾›å£°æ˜å¼çš„å®‰å…¨ è®¿é—®æ§åˆ¶åŠŸèƒ½ã€‚</li>
<li>Spring Hateoas:Spring Hateoas æ˜¯ä¸€ä¸ªç”¨æˆ·æ”¯æŒå®ç°è¶…æ–‡æœ¬é©±åŠ¨çš„ REST Web æœåŠ¡çš„å¼€å‘åº“ï¼Œæ˜¯ Hateoas çš„å®ç°ã€‚Hateoas(Hypermedia as the engine of application state)æ˜¯ REST æ¶æ„é£æ ¼ä¸­æœ€å¤æ‚çš„çº¦æŸï¼Œä¹Ÿæ˜¯æ„å»ºæˆç†Ÿ REST æœåŠ¡çš„æ ¸ å¿ƒã€‚å®ƒçš„é‡è¦æ€§åœ¨äºæ‰“ç ´äº†å®¢æˆ·ç«¯å’ŒæœåŠ¡å™¨ä¹‹é—´ä¸¥æ ¼çš„å¥‘çº¦ï¼Œæ˜¯çš„å®¢æˆ·ç«¯å¯ä»¥æ›´åŠ æ™ºèƒ½å’Œè‡ªé€‚åº”ã€‚</li>
<li>Spring Social:Spring Social æ˜¯ Spring æ¡†æ¶çš„æ‰©å±•ï¼Œç”¨æ¥æ–¹ä¾¿å¼€å‘ Web ç¤¾äº¤åº”ç”¨ç¨‹åºï¼Œå¯é€šè¿‡è¯¥é¡¹ç›®æ¥åˆ›å»ºä¸å„ç§ç¤¾äº¤ç½‘ç«™çš„äº¤äº’ï¼Œå¦‚ Facebookï¼ŒLinkedInã€ Twitter ç­‰ã€‚</li>
<li>Spring AMQP:Spring AMQP æ˜¯åŸºäº Spring æ¡†æ¶çš„ AMQP æ¶ˆæ¯è§£å†³æ–¹æ¡ˆï¼Œæä¾› æ¨¡ç‰ˆåŒ–çš„å‘é€å’Œæ¥æ”¶æ¶ˆæ¯çš„æŠ½è±¡å±‚ï¼Œæä¾›åŸºäºæ¶ˆæ¯é©±åŠ¨çš„ POJOã€‚è¿™ä¸ªé¡¹ç›®æ”¯æŒ Javaå’Œ.NETè¿ä¸ªç‰ˆæœ¬ã€‚Spring Sourceæ——ä¸‹çš„Rabbit MQå°±æ˜¯ä¸€ä¸ªå¼€æºçš„åŸºäºAMQP çš„æ¶ˆæ¯æœåŠ¡å™¨ã€‚</li>
<li>Spring for Android:Spring for Android ä¸º Android ç»ˆç«¯å¼€å‘åº”ç”¨æä¾› Spring çš„ æ”¯æŒï¼Œå®ƒæä¾›äº†ä¸€ä¸ªåœ¨ Android åº”ç”¨ç¯å¢ƒä¸­å·¥ä½œã€åŸºäº Javaçš„REST å®¢æˆ·ç«¯ã€‚</li>
<li>Spring Mobile:Spring Mobile æ˜¯åŸºäº Spring MVC æ„å»ºçš„ï¼Œä¸ºç§»åŠ¨ç«¯çš„æœåŠ¡å™¨ åº”ç”¨å¼€å‘æä¾›æ”¯æŒã€‚</li>
<li>Spring Web Flow:Spring Web Flow(SWF)ä¸€ä¸ªå»ºç«‹åœ¨ Spring MVC åŸºç¡€ä¸Šçš„ Web é¡µé¢æµå¼•æ“ã€‚</li>
<li>Spring Web Service:Spring Web Service æ˜¯åŸºäº Spring æ¡†æ¶çš„ Web æœåŠ¡æ¡†æ¶ï¼Œ ä¸»è¦ä¾§é‡äºåŸºäºæ–‡æ¡£é©±åŠ¨çš„ Web æœåŠ¡ï¼Œæä¾› SOAP æœåŠ¡å¼€å‘ï¼Œå…è®¸é€šè¿‡å¤šç§æ–¹ å¼åˆ›å»º Web æœåŠ¡ã€‚</li>
<li>Spring LDAP:Spring LDAP æ˜¯ä¸€ä¸ªç”¨æˆ·æ“ä½œ LDAP çš„ Java æ¡†æ¶ï¼Œç±»ä¼¼ Spring JDBC æä¾›äº† JdbcTemplate æ–¹å¼æ¥æ“ä½œæ•°æ®åº“ã€‚è¿™ä¸ªæ¡†æ¶æä¾›äº†ä¸€ä¸ª LdapTemplate æ“ ä½œæ¨¡ç‰ˆï¼Œå¯å¸®åŠ©å¼€å‘äººå‘˜ç®€åŒ– looking upã€closing contextsã€encoding/decodingã€ filters ç­‰æ“ä½œã€‚</li>
<li>Spring Session: Spring Session è‡´åŠ›äºæä¾›ä¸€ä¸ªå…¬å…±åŸºç¡€è®¾æ–½ä¼šè¯ï¼Œæ”¯æŒä»ä»»æ„ç¯å¢ƒä¸­è®¿é—®ä¸€ä¸ªä¼šè¯ï¼Œåœ¨ Web ç¯å¢ƒä¸‹æ”¯æŒç‹¬ç«‹äºå®¹å™¨çš„é›†ç¾¤ä¼šè¯ï¼Œæ”¯æŒå¯æ’æ‹”ç­–ç•¥æ¥ç¡®å®š Session IDï¼ŒWebSocket æ´»è·ƒçš„æ—¶å€™å¯ä»¥ç®€å•åœ°ä¿æŒ HttpSessionã€‚</li>
<li>Spring Shell: Spring Shell æä¾›äº¤äº’å¼çš„ Shellï¼Œç”¨æˆ·å¯ä»¥ç®€å•çš„åŸºäº Spring çš„ç¼–ç¨‹æ¨¡å‹æ¥å¼€å‘å‘½ä»¤ã€‚</li>
</ul>
<h2 id="Springå®¹å™¨çš„åŠ è½½æ–¹å¼"><a href="#Springå®¹å™¨çš„åŠ è½½æ–¹å¼" class="headerlink" title="Springå®¹å™¨çš„åŠ è½½æ–¹å¼"></a>Springå®¹å™¨çš„åŠ è½½æ–¹å¼</h2><ul>
<li><p>ç±»è·¯å¾„è·å–é…ç½®æ–‡ä»¶<br>ApplicationContext applicationContext= new ClassPathXmlApplicationContext(â€œspring.xmlâ€);</p>
</li>
<li><p>æ–‡ä»¶ç³»ç»Ÿè·¯å¾„è·å–é…ç½®æ–‡ä»¶ã€ç»å¯¹è·¯å¾„ã€‘<br>ApplicationContext applicationContext = new FileSystemXmlApplicationContext(â€œE:\idea\public\springdemo\src\main\resou rces\spring.xmlâ€);</p>
</li>
<li><p>æ— é…ç½®æ–‡ä»¶åŠ è½½å®¹å™¨ ApplicationContext applicationContext = new<br>AnnotationConfigApplicationContext(â€œcom.xx.jackâ€);</p>
</li>
<li><p>springboot åŠ è½½å®¹å™¨ ApplicationContext applicationContext = new<br>EmbeddedWebApplicationContext();</p>
</li>
</ul>
<h2 id="Springå®¹å™¨åŠ è½½çš„æ ¸å¿ƒæ–¹æ³•"><a href="#Springå®¹å™¨åŠ è½½çš„æ ¸å¿ƒæ–¹æ³•" class="headerlink" title="Springå®¹å™¨åŠ è½½çš„æ ¸å¿ƒæ–¹æ³•"></a>Springå®¹å™¨åŠ è½½çš„æ ¸å¿ƒæ–¹æ³•</h2><p>AbstractApplicationContext.refresh()æ–¹æ³•</p>
<p>refresh()æ–¹æ³•æ˜¯springå®¹å™¨å¯åŠ¨è¿‡ç¨‹ä¸­çš„æ ¸å¿ƒæ–¹æ³•ï¼Œspringå®¹å™¨è¦åŠ è½½å¿…é¡»æ‰§è¡Œè¯¥æ–¹æ³•ã€‚</p>
<pre><code class="java">    @Override
    public void refresh() throws BeansException, IllegalStateException {
        synchronized (this.startupShutdownMonitor) {
            //ä¸ºå®¹å™¨åˆå§‹åŒ–åšå‡†å¤‡ï¼Œé‡è¦ç¨‹åº¦ï¼š0
            //Prepare this context for refreshing.
            prepareRefresh();

            /**
            * é‡è¦ç¨‹åº¦ï¼š5
            * 1ã€åˆ›å»ºBeanFactoryå¯¹è±¡
            * 2ã€xmlè§£æ
            *     ä¼ ç»Ÿæ ‡ç­¾è§£æï¼šbeanã€importç­‰
            *     è‡ªå®šä¹‰æ ‡ç­¾è§£æ å¦‚ï¼š&lt;context:component-scan base-package=&quot;com.xiangxue.jack&quot;/&gt;
            *     è‡ªå®šä¹‰æ ‡ç­¾è§£ææµç¨‹ï¼š
            *         aã€æ ¹æ®å½“å‰è§£ææ ‡ç­¾çš„å¤´ä¿¡æ¯æ‰¾åˆ°å¯¹åº”çš„namespaceUri
            *         bã€åŠ è½½springæ‰€ä»¥jarä¸­çš„spring.handlersæ–‡ä»¶ã€‚å¹¶å»ºç«‹æ˜ å°„å…³ç³»
            *         cã€æ ¹æ®namespaceUriä»æ˜ å°„å…³ç³»ä¸­æ‰¾åˆ°å¯¹åº”çš„å®ç°äº†NamespaceHandleræ¥å£çš„ç±»
            *         dã€è°ƒç”¨ç±»çš„initæ–¹æ³•ï¼Œinitæ–¹æ³•æ˜¯æ³¨å†Œäº†å„ç§è‡ªå®šä¹‰æ ‡ç­¾çš„è§£æç±»
            *         eã€æ ¹æ®namespaceUriæ‰¾åˆ°å¯¹åº”çš„è§£æç±»ï¼Œç„¶åè°ƒç”¨paseræ–¹æ³•å®Œæˆæ ‡ç­¾è§£æ
            *
            * 3ã€æŠŠè§£æå‡ºæ¥çš„xmlæ ‡ç­¾å°è£…æˆBeanDefinitionå¯¹è±¡
            * */
            // Tell the subclass to refresh the internal bean factory.
            ConfigurableListableBeanFactory beanFactory = obtainFreshBeanFactory();

            /*
            * ç»™beanFactoryè®¾ç½®ä¸€äº›å±æ€§å€¼ï¼Œå¯ä»¥ä¸çœ‹
            * */
            // Prepare the bean factory for use in this context.
            prepareBeanFactory(beanFactory);

            try {
                //TODO
                // Allows post-processing of the bean factory in context subclasses.
                postProcessBeanFactory(beanFactory);

                /*
                * BeanDefinitionRegistryPostProcessor
                * BeanFactoryPostProcessor
                * å®Œæˆå¯¹è¿™ä¸¤ä¸ªæ¥å£çš„è°ƒç”¨
                * */
                // Invoke factory processors registered as beans in the context.
                invokeBeanFactoryPostProcessors(beanFactory);

                /*
                * æŠŠå®ç°äº†BeanPostProcessoræ¥å£çš„ç±»å®ä¾‹åŒ–ï¼Œå¹¶ä¸”åŠ å…¥åˆ°BeanFactoryä¸­
                * */
                // Register bean processors that intercept bean creation.
                registerBeanPostProcessors(beanFactory);

                /*
                * å›½é™…åŒ–,é‡è¦ç¨‹åº¦2
                * */
                // Initialize message source for this context.
                initMessageSource();

                //åˆå§‹åŒ–äº‹ä»¶ç®¡ç†ç±»
                // Initialize event multicaster for this context.
                initApplicationEventMulticaster();

                //è¿™ä¸ªæ–¹æ³•ç€é‡ç†è§£æ¨¡æ¿è®¾è®¡æ¨¡å¼ï¼Œå› ä¸ºåœ¨springbootä¸­ï¼Œè¿™ä¸ªæ–¹æ³•æ˜¯ç”¨æ¥åšå†…åµŒtomcatå¯åŠ¨çš„
                // Initialize other special beans in specific context subclasses.
                onRefresh();

                /*
                * å¾€äº‹ä»¶ç®¡ç†ç±»ä¸­æ³¨å†Œäº‹ä»¶ç±»
                * */
                // Check for listener beans and register them.
                registerListeners();

                /*
                * è¿™ä¸ªæ–¹æ³•æ˜¯springä¸­æœ€é‡è¦çš„æ–¹æ³•ï¼Œæ²¡æœ‰ä¹‹ä¸€
                * æ‰€ä»¥è¿™ä¸ªæ–¹æ³•ä¸€å®šè¦ç†è§£è¦å…·ä½“çœ‹
                * 1ã€beanå®ä¾‹åŒ–è¿‡ç¨‹
                * 2ã€ioc
                * 3ã€æ³¨è§£æ”¯æŒ
                * 4ã€BeanPostProcessorçš„æ‰§è¡Œ
                * 5ã€Aopçš„å…¥å£
                *
                * */
                // Instantiate all remaining (non-lazy-init) singletons.
                finishBeanFactoryInitialization(beanFactory);

                // Last step: publish corresponding event.
                finishRefresh();
            }

            catch (BeansException ex) {
                if (logger.isWarnEnabled()) {
                    logger.warn(&quot;Exception encountered during context initialization - &quot; +
                            &quot;cancelling refresh attempt: &quot; + ex);
                }

                // Destroy already created singletons to avoid dangling resources.
                destroyBeans();

                // Reset &#39;active&#39; flag.
                cancelRefresh(ex);

                // Propagate exception to caller.
                throw ex;
            }

            finally {
                // Reset common introspection caches in Spring&#39;s core, since we
                // might not ever need metadata for singleton beans anymore...
                resetCommonCaches();
            }
        }
    }</code></pre>
<h2 id="è®¾è®¡æ¨¡å¼1-æ¨¡ç‰ˆè®¾è®¡æ¨¡å¼"><a href="#è®¾è®¡æ¨¡å¼1-æ¨¡ç‰ˆè®¾è®¡æ¨¡å¼" class="headerlink" title="è®¾è®¡æ¨¡å¼1-æ¨¡ç‰ˆè®¾è®¡æ¨¡å¼"></a>è®¾è®¡æ¨¡å¼1-æ¨¡ç‰ˆè®¾è®¡æ¨¡å¼</h2><p>springæºç ä¸­å¤§é‡ä½¿ç”¨äº†æ¨¡ç‰ˆè®¾è®¡æ¨¡å¼ï¼Œæ˜¯ä½¿ç”¨çš„æœ€å¤šçš„è®¾è®¡æ¨¡å¼ã€‚</p>
<p>æ¨¡ç‰ˆè®¾è®¡æ¨¡å¼ä¸€èˆ¬æœ‰ä¸¤ç§ç±»ï¼ŒæŠ½è±¡çš„çˆ¶ç±»ï¼Œä»¥åŠå…·ä½“å®ç°çš„å­ç±»ã€‚çˆ¶ç±»ä¸­å®ç°é€»è¾‘ä¸­ä¸å˜çš„éƒ¨åˆ†ï¼Œå°†å¯å˜çš„è¡Œä¸ºå®šä¹‰ä¸ºæŠ½è±¡æ–¹æ³•äº¤ç»™å­ç±»å®ç°ï¼Œä½†æ–¹æ³•çš„æ‰§è¡Œé¡ºåºç”±çˆ¶ç±»å†³å®šã€‚</p>
<p>åˆ›å»ºä¸€ä¸ªæŠ½è±¡æ¨¡ç‰ˆç»“æ„</p>
<pre><code class="java">public abstract class AblstractClass {

    //æ¨¡æ¿æ–¹æ³•ç”¨æ¥æ§åˆ¶å­ç±»çš„é¡ºåº è¦æƒ³æœ‰äººç”Ÿå¿…é¡»æŒ‰è€çˆ¸çš„äººç”Ÿé¡ºåºæ¥  
    //å£°æ˜finalä¸è®©å­ç±»è¦†ç›–è¿™ä¸ªæ–¹æ³•ï¼Œé˜²æ­¢æ”¹å˜äººç”Ÿé¡ºåº
    public final void äººç”Ÿ(){
        å­¦ä¹ ();
        å·¥ä½œ();
        çˆ±æƒ…();
    }

    //å®¶é‡Œç©·æ›´å¾—ç”¨å·¥å­¦ä¹ 
    public void å­¦ä¹ (){
        System.out.println(&quot;æ¯å¤©æ™šä¸Šè¶´åœ¨é‚»å±…çª—ä¸Šå­¦ä¹ &quot;);
    }

    //å·¥ä½œå¿…é¡»ç¨³å®š
    public void å·¥ä½œ(){       
        System.out.println(&quot;ä»ä¸€è€Œç»ˆ&quot;);
    }

    //æ‹çˆ±è‡ªç”±  è®©å„¿å­è‡ªç”±æ‹å»
    public abstract void çˆ±æƒ…();
}</code></pre>
<p>åˆ›å»ºä¸€ä¸ªå…·ä½“æ¨¡ç‰ˆ</p>
<pre><code class="java">public class ConcreteClass extends AblstractClass {

    //å„¿å­ä¸è®¤å¯çˆ¶äº²çš„å­¦ä¹ æ–¹æ³•  è€ƒé«˜åˆ†å½±å“åŒå­¦å…³ç³»
    @Override
    public void å­¦ä¹ () {
        System.out.println(&quot;60åˆ†ä¸‡å²...&quot;);
    }

    //çˆ¶äº²ç»™æˆ‘çˆ±æƒ…è‡ªç”±  ä¸€å®šå¥½å¥½è°ˆæ‹çˆ±
    @Override
    public void çˆ±æƒ…() {
        System.out.println(&quot;è‚¤ç™½è²Œç¾å¤§é•¿è…¿...&quot;);
    }
}</code></pre>
<p>å…·ä½“çš„è°ƒç”¨</p>
<pre><code class="java">public class TestMain {

    public static void main(String[] args) {
         ConcreteClass cs  = new ConcreteClass();
         cs.äººç”Ÿ();
    }
}</code></pre>
<h2 id="xmlè§£æ"><a href="#xmlè§£æ" class="headerlink" title="xmlè§£æ"></a>xmlè§£æ</h2><p>ConfigurableListableBeanFactory beanFactory = obtainFreshBeanFactory();</p>
<p>è¯¥æ–¹æ³•ä¸»è¦è¿›è¡Œxmlè§£æå·¥ä½œï¼Œæµç¨‹å¦‚ä¸‹ï¼š</p>
<ol>
<li><p>åˆ›å»ºXmlBeanDefinitionReaderå¯¹è±¡</p>
<pre><code class="java">        XmlBeanDefinitionReader beanDefinitionReader = new XmlBeanDefinitionReader(beanFactory);</code></pre>
</li>
<li><p>é€šè¿‡Readerå¯¹è±¡åŠ è½½é…ç½®æ–‡ä»¶</p>
<pre><code class="java">    protected void loadBeanDefinitions(XmlBeanDefinitionReader reader) throws BeansException, IOException {
        Resource[] configResources = getConfigResources();
        if (configResources != null) {
            reader.loadBeanDefinitions(configResources);
        }
        //è·å–éœ€è¦åŠ è½½çš„xmlé…ç½®æ–‡ä»¶
        String[] configLocations = getConfigLocations();
        if (configLocations != null) {
            reader.loadBeanDefinitions(configLocations);
        }
    }</code></pre>
</li>
<li><p>æ ¹æ®åŠ è½½çš„é…ç½®æ–‡ä»¶æŠŠé…ç½®æ–‡ä»¶å°è£…æˆdocumentå¯¹è±¡</p>
<pre><code class="java">    protected int doLoadBeanDefinitions(InputSource inputSource, Resource resource)
            throws BeanDefinitionStoreException {

        try {
            //æŠŠinputSource å°è£…æˆDocumentæ–‡ä»¶å¯¹è±¡ï¼Œè¿™æ˜¯jdkçš„API
            Document doc = doLoadDocument(inputSource, resource);

            //ä¸»è¦çœ‹è¿™ä¸ªæ–¹æ³•ï¼Œæ ¹æ®è§£æå‡ºæ¥çš„documentå¯¹è±¡ï¼Œæ‹¿åˆ°é‡Œé¢çš„æ ‡ç­¾å…ƒç´ å°è£…æˆBeanDefinition
            int count = registerBeanDefinitions(doc, resource);
            if (logger.isDebugEnabled()) {
                logger.debug(&quot;Loaded &quot; + count + &quot; bean definitions from &quot; + resource);
            }
            return count;
        }</code></pre>
</li>
<li><p>åˆ›å»ºBeanDefinitionDocumentReaderå¯¹è±¡ï¼ŒDocumentReaderè´Ÿè´£å¯¹documentå¯¹è±¡è§£æ</p>
<pre><code class="java">    public int registerBeanDefinitions(Document doc, Resource resource) throws BeanDefinitionStoreException {
        //åˆæ¥ä¸€è®°å§”æ‰˜æ¨¡å¼ï¼ŒBeanDefinitionDocumentReaderå§”æ‰˜è¿™ä¸ªç±»è¿›è¡Œdocumentçš„è§£æ
        BeanDefinitionDocumentReader documentReader = createBeanDefinitionDocumentReader();
        int countBefore = getRegistry().getBeanDefinitionCount();
        //ä¸»è¦çœ‹è¿™ä¸ªæ–¹æ³•ï¼ŒcreateReaderContext(resource) XmlReaderContextä¸Šä¸‹æ–‡ï¼Œå°è£…äº†XmlBeanDefinitionReaderå¯¹è±¡
        documentReader.registerBeanDefinitions(doc, createReaderContext(resource));
        return getRegistry().getBeanDefinitionCount() - countBefore;
    }</code></pre>
</li>
<li><p>parseDefaultElement(ele,delegate);è´Ÿè´£å¸¸è§„æ ‡ç­¾çš„è§£æï¼Œdelegate.parseCustomElement(ele)è´Ÿè´£è‡ªå®šä¹‰æ ‡ç­¾çš„è§£æ</p>
<pre><code>    protected void parseBeanDefinitions(Element root, BeanDefinitionParserDelegate delegate) {
        if (delegate.isDefaultNamespace(root)) {
            NodeList nl = root.getChildNodes();
            for (int i = 0; i &lt; nl.getLength(); i++) {
                Node node = nl.item(i);
                if (node instanceof Element) {
                    Element ele = (Element) node;
                    if (delegate.isDefaultNamespace(ele)) {
                        //é»˜è®¤æ ‡ç­¾è§£æ
                        parseDefaultElement(ele, delegate);
                    }
                    else {
                        //è‡ªå®šä¹‰æ ‡ç­¾è§£æ
                        delegate.parseCustomElement(ele);
                    }
                }
            }
        }
        else {
            delegate.parseCustomElement(root);
        }
    }</code></pre></li>
<li><p>æœ€ç»ˆè§£æçš„æ ‡ç­¾å°è£…æˆBeanDefinitionå¹¶ç¼“å­˜åˆ°å®¹å™¨ä¸­ã€‚</p>
</li>
<li><p>xmlæµç¨‹åˆ†æ</p>
</li>
</ol>
<img src="/blog/2020/04/13/spring%E7%A8%8B%E5%BA%8F%E5%85%A5%E5%8F%A3%E5%92%8Cxml%E8%A7%A3%E6%9E%90/pic1.png" srcset="/blog/img/loading.gif" class>

<h2 id="è‡ªå®šä¹‰æ ‡ç­¾è§£æ"><a href="#è‡ªå®šä¹‰æ ‡ç­¾è§£æ" class="headerlink" title="è‡ªå®šä¹‰æ ‡ç­¾è§£æ"></a>è‡ªå®šä¹‰æ ‡ç­¾è§£æ</h2><ol>
<li><p>é¦–å…ˆè·å–è‡ªå®šä¹‰æ ‡ç­¾å¤´çš„namespaceå‘½åç©ºé—´ï¼Œä¾‹å¦‚ï¼š<code>http://www.springframework.org/schema/context</code>ï¼Œç„¶åé€šè¿‡namespaceè·å–åˆ°NamespaceHandlerå¤„ç†ç±»ï¼Œä¹‹åå†ä½¿ç”¨NamespaceHandlerä¸­çš„è§£æç±»è§£ææ ‡ç­¾è·å¾—BeanDefinitionå¯¹è±¡ã€‚</p>
<pre><code class="java">    public BeanDefinition parseCustomElement(Element ele, @Nullable BeanDefinition containingBd) {
      // è·å–è‡ªå®šä¹‰æ ‡ç­¾çš„å‘½åç©ºé—´
        String namespaceUri = getNamespaceURI(ele);
        if (namespaceUri == null) {
            return null;
        }
    // è¿™é‡Œæœ‰SPIæœåŠ¡å‘ç°çš„æ€æƒ³ï¼Œæ ¹æ®é…ç½®æ–‡ä»¶è·å–namespaceUriå¯¹åº”çš„å¤„ç†ç±»
        NamespaceHandler handler = this.readerContext.getNamespaceHandlerResolver().resolve(namespaceUri);
        if (handler == null) {
            error(&quot;Unable to locate Spring NamespaceHandler for XML schema namespace [&quot; + namespaceUri + &quot;]&quot;, ele);
            return null;
        }
        return handler.parse(ele, new ParserContext(this.readerContext, this, containingBd));
    }</code></pre>
</li>
<li><p>è·å–namespaceä¸NamespaceHandlerå®ä¾‹çš„æ˜ å°„å…³ç³»ï¼Œç„¶åé€šè¿‡åå°„åˆ›å»ºå®ä¾‹ï¼Œå¹¶è°ƒç”¨NamespaceHandlerçš„init()æ–¹æ³•å®Œæˆè§£æç±»çš„æ³¨å†Œã€‚</p>
<pre><code class="java">    public NamespaceHandler resolve(String namespaceUri) {
        //è·å–springä¸­æ‰€æœ‰jaråŒ…é‡Œé¢çš„ &quot;META-INF/spring.handlers&quot;æ–‡ä»¶ï¼Œå¹¶ä¸”å»ºç«‹æ˜ å°„å…³ç³»
        Map&lt;String, Object&gt; handlerMappings = getHandlerMappings();

        //æ ¹æ®namespaceUriï¼šhttp://www.springframework.org/schema/pï¼Œè·å–åˆ°è¿™ä¸ªå‘½åç©ºé—´çš„å¤„ç†ç±»
        Object handlerOrClassName = handlerMappings.get(namespaceUri);
        if (handlerOrClassName == null) {
            return null;
        }
        else if (handlerOrClassName instanceof NamespaceHandler) {
            return (NamespaceHandler) handlerOrClassName;
        }
        else {
            String className = (String) handlerOrClassName;
            try {
                Class&lt;?&gt; handlerClass = ClassUtils.forName(className, this.classLoader);
                if (!NamespaceHandler.class.isAssignableFrom(handlerClass)) {
                    throw new FatalBeanException(&quot;Class [&quot; + className + &quot;] for namespace [&quot; + namespaceUri +
                            &quot;] does not implement the [&quot; + NamespaceHandler.class.getName() + &quot;] interface&quot;);
                }
                NamespaceHandler namespaceHandler = (NamespaceHandler) BeanUtils.instantiateClass(handlerClass);

                //è°ƒç”¨å¤„ç†ç±»çš„initæ–¹æ³•ï¼Œåœ¨initæ–¹æ³•ä¸­å®Œæˆæ ‡ç­¾å…ƒç´ è§£æç±»çš„æ³¨å†Œ
                namespaceHandler.init();
                handlerMappings.put(namespaceUri, namespaceHandler);
                return namespaceHandler;
            }
            catch (ClassNotFoundException ex) {
                throw new FatalBeanException(&quot;Could not find NamespaceHandler class [&quot; + className +
                        &quot;] for namespace [&quot; + namespaceUri + &quot;]&quot;, ex);
            }
            catch (LinkageError err) {
                throw new FatalBeanException(&quot;Unresolvable class definition for NamespaceHandler class [&quot; +
                        className + &quot;] for namespace [&quot; + namespaceUri + &quot;]&quot;, err);
            }
        }
    }</code></pre>
</li>
<li><p>è·å–namespaceè·ŸNamespaceHandleræ˜ å°„å…³ç³»çš„è¯¦ç»†è¿‡ç¨‹ã€‚springåœ¨jaråŒ…çš„META-INF/spring.handlersæ–‡ä»¶ä¸­ï¼Œå·²ç»ä¿å­˜äº†NamespaceUriå’ŒNamepsaceHandlerä¹‹é—´çš„æ˜ å°„ã€‚æ­¤å¤„ä¼šåŠ è½½spring.handlersä¸­çš„æ‰€æœ‰å†…å®¹å¹¶ä¿å­˜åœ¨mapä¸­ã€‚</p>
<pre><code class="java">    private Map&lt;String, Object&gt; getHandlerMappings() {
        Map&lt;String, Object&gt; handlerMappings = this.handlerMappings;
        if (handlerMappings == null) {
            synchronized (this) {
                handlerMappings = this.handlerMappings;
                if (handlerMappings == null) {
                    if (logger.isTraceEnabled()) {
                        logger.trace(&quot;Loading NamespaceHandler mappings from [&quot; + this.handlerMappingsLocation + &quot;]&quot;);
                    }
                    try {
                        //åŠ è½½&quot;META-INF/spring.handlers&quot;æ–‡ä»¶è¿‡ç¨‹
                        Properties mappings =
                                PropertiesLoaderUtils.loadAllProperties(this.handlerMappingsLocation, this.classLoader);
                        if (logger.isTraceEnabled()) {
                            logger.trace(&quot;Loaded NamespaceHandler mappings: &quot; + mappings);
                        }

                        //æ‰€æœ‰&quot;META-INF/spring.handlers&quot;æ–‡ä»¶é‡Œé¢çš„å†…å®¹å»ºç«‹æ˜ å°„å…³ç³»
                        handlerMappings = new ConcurrentHashMap&lt;&gt;(mappings.size());
                        CollectionUtils.mergePropertiesIntoMap(mappings, handlerMappings);
                        this.handlerMappings = handlerMappings;
                    }
                    catch (IOException ex) {
                        throw new IllegalStateException(
                                &quot;Unable to load NamespaceHandler mappings from location [&quot; + this.handlerMappingsLocation + &quot;]&quot;, ex);
                    }
                }
            }
        }
        return handlerMappings;
    }</code></pre>
</li>
</ol>
<h2 id="é»˜è®¤æ ‡ç­¾çš„è§£æ"><a href="#é»˜è®¤æ ‡ç­¾çš„è§£æ" class="headerlink" title="é»˜è®¤æ ‡ç­¾çš„è§£æ"></a>é»˜è®¤æ ‡ç­¾çš„è§£æ</h2><ol>
<li><p>é»˜è®¤æ ‡ç­¾åˆ†ä¸ºå››ç§ï¼Œimportã€aliasã€beanã€beansï¼Œè¿™é‡Œä¸»è¦çœ‹beanæ ‡ç­¾çš„è§£æã€‚</p>
<pre><code class="java">    private void parseDefaultElement(Element ele, BeanDefinitionParserDelegate delegate) {
        //importæ ‡ç­¾è§£æ  é‡è¦ç¨‹åº¦ 1 ï¼Œå¯çœ‹å¯ä¸çœ‹
        if (delegate.nodeNameEquals(ele, IMPORT_ELEMENT)) {
            importBeanDefinitionResource(ele);
        }
        //aliasæ ‡ç­¾è§£æ åˆ«åæ ‡ç­¾  é‡è¦ç¨‹åº¦ 1 ï¼Œå¯çœ‹å¯ä¸çœ‹
        else if (delegate.nodeNameEquals(ele, ALIAS_ELEMENT)) {
            processAliasRegistration(ele);
        }
        //beanæ ‡ç­¾ï¼Œé‡è¦ç¨‹åº¦  5ï¼Œå¿…é¡»çœ‹
        else if (delegate.nodeNameEquals(ele, BEAN_ELEMENT)) {
            processBeanDefinition(ele, delegate);
        }
        else if (delegate.nodeNameEquals(ele, NESTED_BEANS_ELEMENT)) {
            // recurse
            doRegisterBeanDefinitions(ele);
        }
    }</code></pre>
</li>
<li><p>å…ˆè°ƒç”¨parseBeanDefinitionElement(ele)æ–¹æ³•é¦–å…ˆè§£æèŠ‚ç‚¹å±æ€§å°è£…ä¸ºBeanDefinitionHolderå¯¹è±¡ï¼Œä¹‹åå†è§£æBeanDefinitionHolderå¯¹è±¡ä¸­çš„è‡ªå®šä¹‰å±æ€§ï¼Œå¹¶ä½¿ç”¨è£…é¥°è€…æ¨¡å¼å°†è§£æåçš„å±æ€§è®¾ç½®åˆ°BeanDefinitionHolderä¸­ï¼Œç„¶åå¯¹BeanDefinitionHolderè¿›è¡Œæ³¨å†Œã€‚</p>
<pre><code class="java">    protected void processBeanDefinition(Element ele, BeanDefinitionParserDelegate delegate) {
        //é‡ç‚¹çœ‹è¿™ä¸ªæ–¹æ³•ï¼Œé‡è¦ç¨‹åº¦ 5 ï¼Œè§£æeleï¼Œå°è£…æˆBeanDefinition
        BeanDefinitionHolder bdHolder = delegate.parseBeanDefinitionElement(ele);
        if (bdHolder != null) {

            //è¯¥æ–¹æ³•åŠŸèƒ½ä¸é‡è¦ï¼Œè®¾è®¡æ¨¡å¼é‡ç‚¹çœ‹ä¸€ä¸‹ï¼Œè£…é¥°è€…è®¾è®¡æ¨¡å¼ï¼ŒåŠ ä¸ŠSPIè®¾è®¡æ€æƒ³
            bdHolder = delegate.decorateBeanDefinitionIfRequired(ele, bdHolder);
            try {

                //å®Œæˆdocumentåˆ°BeanDefinitionå¯¹è±¡è½¬æ¢åï¼Œå¯¹BeanDefinitionå¯¹è±¡è¿›è¡Œç¼“å­˜æ³¨å†Œ
                // Register the final decorated instance.
                //æ³¨å†Œè¿‡ç¨‹ï¼Œé‡è¦ç¨‹åº¦5
                BeanDefinitionReaderUtils.registerBeanDefinition(bdHolder, getReaderContext().getRegistry());
            }
            catch (BeanDefinitionStoreException ex) {
                getReaderContext().error(&quot;Failed to register bean definition with name &#39;&quot; +
                        bdHolder.getBeanName() + &quot;&#39;&quot;, ele, ex);
            }
            // Send registration event.
            getReaderContext().fireComponentRegistered(new BeanComponentDefinition(bdHolder));
        }
    }</code></pre>
</li>
<li><p>åˆæ¬¡è§£ææ ‡ç­¾çš„è¿‡ç¨‹ã€‚è¿™é‡Œè§£æå®Œæˆåä¼šè¿”å›åˆ°ä¸Šå±‚æ–¹æ³•ï¼Œä¸Šå±‚æ–¹æ³•ä¼šå°†BeanDefinitionã€beannameã€aliasesï¼ˆåˆ«åï¼‰å°è£…ä¸ºBeanDefinitionHolderå¹¶è¿”å›ã€‚</p>
<pre><code class="java">    public AbstractBeanDefinition parseBeanDefinitionElement(
            Element ele, String beanName, @Nullable BeanDefinition containingBean) {

        this.parseState.push(new BeanEntry(beanName));

        String className = null;
        if (ele.hasAttribute(CLASS_ATTRIBUTE)) {
            className = ele.getAttribute(CLASS_ATTRIBUTE).trim();
        }
        String parent = null;
        if (ele.hasAttribute(PARENT_ATTRIBUTE)) {
            parent = ele.getAttribute(PARENT_ATTRIBUTE);
        }

        try {
            //åˆ›å»ºGenericBeanDefinitionå¯¹è±¡
            AbstractBeanDefinition bd = createBeanDefinition(className, parent);

            //è§£æbeanæ ‡ç­¾çš„å±æ€§ï¼Œå¹¶æŠŠè§£æå‡ºæ¥çš„å±æ€§è®¾ç½®åˆ°BeanDefinitionå¯¹è±¡ä¸­
            parseBeanDefinitionAttributes(ele, beanName, containingBean, bd);
            bd.setDescription(DomUtils.getChildElementValueByTagName(ele, DESCRIPTION_ELEMENT));

            //è§£æbeanä¸­çš„metaæ ‡ç­¾
            parseMetaElements(ele, bd);

            //è§£æbeanä¸­çš„lookup-methodæ ‡ç­¾  é‡è¦ç¨‹åº¦ï¼š2ï¼Œå¯çœ‹å¯ä¸çœ‹
            parseLookupOverrideSubElements(ele, bd.getMethodOverrides());

            //è§£æbeanä¸­çš„replaced-methodæ ‡ç­¾  é‡è¦ç¨‹åº¦ï¼š2ï¼Œå¯çœ‹å¯ä¸çœ‹
            parseReplacedMethodSubElements(ele, bd.getMethodOverrides());

            //è§£æbeanä¸­çš„constructor-argæ ‡ç­¾  é‡è¦ç¨‹åº¦ï¼š2ï¼Œå¯çœ‹å¯ä¸çœ‹
            parseConstructorArgElements(ele, bd);

            //è§£æbeanä¸­çš„propertyæ ‡ç­¾  é‡è¦ç¨‹åº¦ï¼š2ï¼Œå¯çœ‹å¯ä¸çœ‹
            parsePropertyElements(ele, bd);

            //å¯ä»¥ä¸çœ‹ï¼Œç”¨ä¸åˆ°
            parseQualifierElements(ele, bd);

            bd.setResource(this.readerContext.getResource());
            bd.setSource(extractSource(ele));

            return bd;
        }</code></pre>
</li>
<li><p>å¯¹æ ‡ç­¾ä¸­çš„è‡ªå®šä¹‰å±æ€§å†æ¬¡è¿›è¡Œè§£æï¼Œæ­¤å¤„ç”¨åˆ°çš„SPIæ€æƒ³è·Ÿè£…é¥°è€…æ¨¡å¼ï¼Œé€šè¿‡SPIæ€æƒ³è·å–å¤„ç†ç±»çš„æ–¹å¼ä¸è‡ªå®šä¹‰æ ‡ç­¾è§£æä¸­çš„æ–¹å¼ç›¸åŒï¼Œæ­¤å¤„ä¸å†èµ˜è¿°ã€‚</p>
<pre><code class="java">    public BeanDefinitionHolder decorateIfRequired(
            Node node, BeanDefinitionHolder originalDef, @Nullable BeanDefinition containingBd) {

        //æ ¹æ®nodeè·å–åˆ°nodeçš„å‘½åç©ºé—´ï¼Œå½¢å¦‚ï¼šhttp://www.springframework.org/schema/p
        String namespaceUri = getNamespaceURI(node);
        if (namespaceUri != null &amp;&amp; !isDefaultNamespace(namespaceUri)) {

            //è¿™é‡Œæœ‰SPIæœåŠ¡å‘ç°çš„æ€æƒ³ï¼Œæ ¹æ®é…ç½®æ–‡ä»¶è·å–namespaceUriå¯¹åº”çš„å¤„ç†ç±»
            NamespaceHandler handler = this.readerContext.getNamespaceHandlerResolver().resolve(namespaceUri);
            if (handler != null) {

                //è°ƒç”¨NamespaceHandlerå¤„ç†ç±»çš„decorateæ–¹æ³•ï¼Œå¼€å§‹å…·ä½“è£…é¥°è¿‡ç¨‹ï¼Œå¹¶è¿”å›è£…é¥°å®Œçš„å¯¹è±¡
                BeanDefinitionHolder decorated =
                        handler.decorate(node, originalDef, new ParserContext(this.readerContext, this, containingBd));
                if (decorated != null) {
                    return decorated;
                }
            }
            else if (namespaceUri.startsWith(&quot;http://www.springframework.org/&quot;)) {
                error(&quot;Unable to locate Spring NamespaceHandler for XML schema namespace [&quot; + namespaceUri + &quot;]&quot;, node);
            }
            else {
                // A custom namespace, not to be handled by Spring - maybe &quot;xml:...&quot;.
                if (logger.isDebugEnabled()) {
                    logger.debug(&quot;No Spring NamespaceHandler found for XML schema namespace [&quot; + namespaceUri + &quot;]&quot;);
                }
            }
        }
        return originalDef;
    }</code></pre>
</li>
<li><p>æ³¨å†Œè¿‡ç¨‹ï¼Œæ­¤å¤„å®Œæˆå®ŒæˆBeanDefinitionçš„æ³¨å†Œåä¼šå°†beannameä¸aliaseså»ºç«‹è”ç³»ã€‚</p>
<pre><code class="java">    public static void registerBeanDefinition(
            BeanDefinitionHolder definitionHolder, BeanDefinitionRegistry registry)
            throws BeanDefinitionStoreException {

        // Register bean definition under primary name.
        String beanName = definitionHolder.getBeanName();

        //å®ŒæˆBeanDefinitionçš„æ³¨å†Œï¼Œé‡ç‚¹çœ‹ï¼Œé‡è¦ç¨‹åº¦ 5
        registry.registerBeanDefinition(beanName, definitionHolder.getBeanDefinition());

        //å»ºç«‹åˆ«åå’Œ idçš„æ˜ å°„ï¼Œè¿™æ ·å°±å¯ä»¥æ ¹æ®åˆ«åè·å–åˆ°id
        // Register aliases for bean name, if any.
        String[] aliases = definitionHolder.getAliases();
        if (aliases != null) {
            for (String alias : aliases) {
                registry.registerAlias(beanName, alias);
            }
        }
    }</code></pre>
</li>
<li><p>BeanDefinitionçš„æ³¨å†Œè¯¦ç»†è¿‡ç¨‹ã€‚å°†beannameä¸beanDefinitionç¼“å­˜åˆ°mapä¸­ã€beanNameæ”¾åˆ°beanDefinitionNamesä¸­ï¼Œä¹‹åå°†é€šè¿‡beanDefinitionNameså®ä¾‹åŒ–bean</p>
<pre><code class="java">    public void registerBeanDefinition(String beanName, BeanDefinition beanDefinition)
            throws BeanDefinitionStoreException {

        Assert.hasText(beanName, &quot;Bean name must not be empty&quot;);
        Assert.notNull(beanDefinition, &quot;BeanDefinition must not be null&quot;);

        if (beanDefinition instanceof AbstractBeanDefinition) {
            try {
                ((AbstractBeanDefinition) beanDefinition).validate();
            }
            catch (BeanDefinitionValidationException ex) {
                throw new BeanDefinitionStoreException(beanDefinition.getResourceDescription(), beanName,
                        &quot;Validation of bean definition failed&quot;, ex);
            }
        }

        //å…ˆåˆ¤æ–­BeanDefinitionæ˜¯å¦å·²ç»æ³¨å†Œ
        BeanDefinition existingDefinition = this.beanDefinitionMap.get(beanName);
        if (existingDefinition != null) {
            if (!isAllowBeanDefinitionOverriding()) {
                throw new BeanDefinitionOverrideException(beanName, beanDefinition, existingDefinition);
            }
            else if (existingDefinition.getRole() &lt; beanDefinition.getRole()) {
                // e.g. was ROLE_APPLICATION, now overriding with ROLE_SUPPORT or ROLE_INFRASTRUCTURE
                if (logger.isInfoEnabled()) {
                    logger.info(&quot;Overriding user-defined bean definition for bean &#39;&quot; + beanName +
                            &quot;&#39; with a framework-generated bean definition: replacing [&quot; +
                            existingDefinition + &quot;] with [&quot; + beanDefinition + &quot;]&quot;);
                }
            }
            else if (!beanDefinition.equals(existingDefinition)) {
                if (logger.isDebugEnabled()) {
                    logger.debug(&quot;Overriding bean definition for bean &#39;&quot; + beanName +
                            &quot;&#39; with a different definition: replacing [&quot; + existingDefinition +
                            &quot;] with [&quot; + beanDefinition + &quot;]&quot;);
                }
            }
            else {
                if (logger.isTraceEnabled()) {
                    logger.trace(&quot;Overriding bean definition for bean &#39;&quot; + beanName +
                            &quot;&#39; with an equivalent definition: replacing [&quot; + existingDefinition +
                            &quot;] with [&quot; + beanDefinition + &quot;]&quot;);
                }
            }
            this.beanDefinitionMap.put(beanName, beanDefinition);
        }
        else {
            if (hasBeanCreationStarted()) {
                // Cannot modify startup-time collection elements anymore (for stable iteration)
                synchronized (this.beanDefinitionMap) {
                    this.beanDefinitionMap.put(beanName, beanDefinition);
                    List&lt;String&gt; updatedDefinitions = new ArrayList&lt;&gt;(this.beanDefinitionNames.size() + 1);
                    updatedDefinitions.addAll(this.beanDefinitionNames);
                    updatedDefinitions.add(beanName);
                    this.beanDefinitionNames = updatedDefinitions;
                    if (this.manualSingletonNames.contains(beanName)) {
                        Set&lt;String&gt; updatedSingletons = new LinkedHashSet&lt;&gt;(this.manualSingletonNames);
                        updatedSingletons.remove(beanName);
                        this.manualSingletonNames = updatedSingletons;
                    }
                }
            }
            else {
                //æŠŠbeanDefinitionç¼“å­˜åˆ°mapä¸­
                // Still in startup registration phase
                this.beanDefinitionMap.put(beanName, beanDefinition);

                //æŠŠbeanNameæ”¾åˆ°beanDefinitionNames listä¸­
                this.beanDefinitionNames.add(beanName);
                this.manualSingletonNames.remove(beanName);
            }
            this.frozenBeanDefinitionNames = null;
        }

        if (existingDefinition != null || containsSingleton(beanName)) {
            resetBeanDefinition(beanName);
        }
    }</code></pre>
</li>
</ol>
<h2 id="è®¾è®¡æ¨¡å¼2-å§”æ‰˜æ¨¡å¼"><a href="#è®¾è®¡æ¨¡å¼2-å§”æ‰˜æ¨¡å¼" class="headerlink" title="è®¾è®¡æ¨¡å¼2-å§”æ‰˜æ¨¡å¼"></a>è®¾è®¡æ¨¡å¼2-å§”æ‰˜æ¨¡å¼</h2><p>ä¸å±äº23ç§è®¾è®¡æ¨¡å¼ä¹‹ä¸€ï¼Œæ˜¯é¢å‘å¯¹è±¡è®¾è®¡æ¨¡å¼ä¸­å¸¸ç”¨çš„ä¸€ç§æ¨¡å¼ï¼Œå¯ä»¥ç†è§£ä¸ºé™æ€ä»£ç†å’Œç­–ç•¥æ¨¡å¼çš„ä¸€ç§ç‰¹æ®Šçš„ç»„åˆã€‚ç®€å•æ¥è¯´å°±æ˜¯æ¥å—è¯·æ±‚çš„å¯¹è±¡å°†è¯·æ±‚å§”æ‰˜ç»™å¦ä¸€ä¸ªå¯¹è±¡æ¥å¤„ç†ï¼Œåœ¨springä¸­æ¯”è¾ƒå¸¸è§ã€‚</p>
<pre><code class="java">public interface Company{
    void product();
}</code></pre>
<pre><code class="java">public class Sum implements Company{
  @Override
  public void product(){
    System.out.println(&quot;sum product&quot;);
  }
}</code></pre>
<pre><code class="java">public class Boss implemets Company{
    Sun sun = new Sun();

    @Override
    public void product(){
        sun.product();
    }
}</code></pre>
<h2 id="è®¾è®¡æ¨¡å¼3-è£…é¥°æ¨¡å¼"><a href="#è®¾è®¡æ¨¡å¼3-è£…é¥°æ¨¡å¼" class="headerlink" title="è®¾è®¡æ¨¡å¼3-è£…é¥°æ¨¡å¼"></a>è®¾è®¡æ¨¡å¼3-è£…é¥°æ¨¡å¼</h2><p>è£…é¥°æ¨¡å¼é€šè¿‡åˆ›å»ºä¸€ä¸ªåŒ…è£…å¯¹è±¡ï¼ŒåŒ…è£…å¯¹è±¡ä¸­é€šå¸¸æŒæœ‰çœŸå®å¯¹è±¡çš„å¼•ç”¨ï¼Œé€šå¸¸ä¸è£…é¥°å¯¹è±¡æœ‰ç›¸åŒçš„æ¥å£ï¼Œæä¾›ä¸çœŸå®å¯¹è±¡ç›¸åŒçš„äº¤äº’æ–¹å¼ã€‚è£…é¥°å¯¹è±¡åœ¨æ¥æ”¶è¯·æ±‚æ—¶ä¼šå°†è¯·æ±‚è½¬å‘ç»™çœŸå®å¯¹è±¡ï¼Œå¹¶åœ¨è½¬å‘å‰åå¢åŠ ä¸€äº›é™„åŠ åŠŸèƒ½ã€‚è¿™æ ·å°±å¯ä»¥åœ¨ä¸æ”¹å˜çœŸå®å¯¹è±¡çš„å‰æä¸‹ï¼ŒåŠ¨æ€æ‰©å±•çœŸå®å¯¹è±¡çš„åŠŸèƒ½ã€‚</p>
<p>åˆ›å»ºè£…é¥°çš„å…¬å…±æ¥å£</p>
<pre><code class="java">public interface Person {
    void desc();
}</code></pre>
<p>åˆ›å»ºè¢«è£…é¥°ç±»</p>
<pre><code class="java">public class FeiZhai implements Person {
    @Override
    public void desc() {
        System.out.println(&quot;è¿™æ˜¯ä¸€ä¸ªå¿«ä¹è‚¥å®…&quot;);
    }
}</code></pre>
<p>åˆ›å»ºè£…é¥°å™¨</p>
<pre><code class="java">public class Decorator implements Person {
    Person person;
    public PersonDecorator(Person person) {
        this.person = person;
    }

    @Override
    public void desc() {
        person.desc();
    }
}</code></pre>
<p>åˆ›å»ºè£…é¥°å­ç±»ï¼š</p>
<pre><code class="java">public class DecoratorDnfPlayer extends PersonDecorator {
    public HighPerson(Person person) {
        super(person);
    }

    @Override
    public void desc() {
        super.desc();
        System.out.println(&quot;DNFç©å®¶ï¼Œå…«ç™¾ä¸‡å‹‡å£«ä¹‹ä¸€ï¼ï¼ï¼&quot;);
    }
}</code></pre>
<p>å…·ä½“ä½¿ç”¨</p>
<pre><code class="java">public class DecorationTest {
    @Test
    public void test(){
        System.out.println(&quot;åˆ›å»ºä¸€ä¸ªè‚¥å®…&quot;);
        Person person = new FeiZhai();
        person.desc();
        System.out.println(&quot;ä½¿ç”¨è£…é¥°å™¨ï¼Œè£…é¥°è‚¥å®…&quot;);
        person = new DecoratorDnfPlayer(persion);
        person.desc();
    }
}</code></pre>
<h2 id="è®¾è®¡æ¨¡å¼4ç­–ç•¥æ¨¡å¼"><a href="#è®¾è®¡æ¨¡å¼4ç­–ç•¥æ¨¡å¼" class="headerlink" title="è®¾è®¡æ¨¡å¼4ç­–ç•¥æ¨¡å¼"></a>è®¾è®¡æ¨¡å¼4ç­–ç•¥æ¨¡å¼</h2><p>ç®€å•æ¥è¯´å°±æ˜¯åˆ›å»ºä¸åŒçš„å¤„ç†é€»è¾‘ï¼Œç„¶åæ ¹æ®æ¡ä»¶å»é€‰æ‹©å¤„ç†é€»è¾‘ã€‚å½“ä»£ç ä¸­å‡ºç°å¤§é‡çš„ifæ—¶ï¼Œä¸ºäº†é¿å…ä¿®æ”¹æ ¸å¿ƒä»£ç ï¼Œä»¥åŠå¢åŠ æ‹“å±•æ€§å°±ç»å¸¸éœ€è¦ä½¿ç”¨ç­–ç•¥æ¨¡å¼ã€‚</p>
<p>æ¯”å¦‚ï¼Œæœ‰çœä»½ä¸åŒçœä»½åšä¸åŒå¤„ç†çš„éœ€æ±‚æ—¶ï¼š</p>
<p>å…ˆåˆ›å»ºä¸€ä¸ªæ¥å£</p>
<pre><code class="java">public interface Province {
    public boolean support(String flag);
    public String handler();
}</code></pre>
<p>æ¹–åŒ—çš„å¤„ç†ç­–ç•¥</p>
<pre><code class="java">@Component
public class HN implements Province{
    private static String flag = &quot;HN&quot;;

    @Override
    public boolean support(String flag) {
        return HN.flag.equalsIgnoreCase(flag);
    }

    @Override
    public String handler() {
        System.out.println(&quot;======HNå¤„ç†ç±»å¤„ç†&quot;);
        return null;
    }
}</code></pre>
<p>æ¹–å—çš„å¤„ç†ç­–ç•¥</p>
<pre><code class="java">@Component
public class HN implements Province{

    private static String flag = &quot;HN&quot;;

    @Override
    public boolean support(String flag) {
        return HN.flag.equalsIgnoreCase(flag);
    }

    @Override
    public String handler() {
        System.out.println(&quot;======HNå¤„ç†ç±»å¤„ç†&quot;);
        return null;
    }
}</code></pre>
<p>å…·ä½“çš„ä½¿ç”¨</p>
<pre><code class="java">public void test1() {

    String flag = &quot;CQ&quot;;

    Map&lt;String, Province&gt; beansOfType = applicationContext.getBeansOfType(Province.class);

    beansOfType.forEach((k,v) -&gt; {
        if(v.support(flag)) {
            v.handler();
        }
    });
}</code></pre>
<h2 id="è®¾è®¡æ¨¡å¼5å»ºé€ è€…æ¨¡å¼"><a href="#è®¾è®¡æ¨¡å¼5å»ºé€ è€…æ¨¡å¼" class="headerlink" title="è®¾è®¡æ¨¡å¼5å»ºé€ è€…æ¨¡å¼"></a>è®¾è®¡æ¨¡å¼5å»ºé€ è€…æ¨¡å¼</h2><p>å½“ç±»çš„å±æ€§è¿‡äºå¤æ‚æ—¶ï¼Œä½¿ç”¨æ„é€ æ–¹æ³•æˆ–set()æ–¹æ³•è®¾ç½®ä¼šè®©ä»£ç å˜çš„æ··ä¹±ï¼Œè¿™æ—¶å°±å¯ä»¥é€šè¿‡å»ºé€ è€…æ¨¡å¼å¯¹ç±»è¿›è¡Œè£…é…ã€‚</p>
<pre><code class="java">public class BuilderClass {

    private final int servingSize;
    private final int servings;
    private final int calories;
    private final int fat;
    private final int sodium;
    private final int carbohydrate;

    public static class Builder {
        // å¿…è¦å‚æ•°
        private final int servingSize;
        private final int servings;

        // å¯é€‰å‚æ•°
        private int calories = 0;
        private int fat = 0;
        private int carbohydrate = 0;
        private int sodium = 0;

        public Builder(int servingSize, int servings) {
            this.servingSize = servingSize;
            this.servings = servings;
        }

        public Builder calories(int val) {
            calories = val;
            return this;
        }

        public Builder fat(int val) {
            fat = val;
            return this;
        }

        public Builder carbohydrate(int val) {
            carbohydrate = val;
            return this;
        }

        public Builder sodium(int val) {
            sodium = val;
            return this;
        }

        public BuilderClass build() {
            return new BuilderClass(this);
        }
    }

    private BuilderClass(Builder builder) {
        servingSize = builder.servingSize;
        servings = builder.servings;
        calories = builder.calories;
        fat = builder.fat;
        sodium = builder.sodium;
        carbohydrate = builder.carbohydrate;
    }

    public static void main(String[] args) {
        BuilderClass cocaCola = new BuilderClass.Builder(240, 8)
                .calories(100).sodium(35).carbohydrate(27).build();
    }
}</code></pre>
<h2 id="component-scanæ ‡ç­¾çš„è§£æ"><a href="#component-scanæ ‡ç­¾çš„è§£æ" class="headerlink" title="component-scanæ ‡ç­¾çš„è§£æ"></a>component-scanæ ‡ç­¾çš„è§£æ</h2><ol>
<li><p>contextå±äºè‡ªå®šä¹‰æ ‡ç­¾ï¼Œæ‰€ä»¥éœ€è¦å…ˆé€šè¿‡namespaceå‘½åç©ºé—´åœ¨spring.handlersæ–‡ä»¶ä¸­è·å–åˆ°å¯¹åº”çš„NamepsaceHandlerå¤„ç†ç±»ä¹‹åå†è°ƒç”¨init()æ–¹æ³•æ³¨å†ŒBeanDefinitionParserè§£æç±»ï¼Œç„¶åå†è·å–scanå¯¹åº”çš„BeanDefinitionParserè§£æç±»è¿›è¡Œè§£æã€‚</p>
<pre><code>http\://www.springframework.org/schema/context=org.springframework.context.config.ContextNamespaceHandler
http\://www.springframework.org/schema/jee=org.springframework.ejb.config.JeeNamespaceHandler
http\://www.springframework.org/schema/lang=org.springframework.scripting.config.LangNamespaceHandler
http\://www.springframework.org/schema/task=org.springframework.scheduling.config.TaskNamespaceHandler
http\://www.springframework.org/schema/cache=org.springframework.cache.config.CacheNamespaceHandler</code></pre></li>
<li><p>è°ƒç”¨ContextNamespaceHandlerçš„init()æ–¹æ³•æ³¨å†ŒBeanDefinitionParserè§£æç±»ã€‚</p>
<pre><code class="java">    @Override
    public void init() {
        registerBeanDefinitionParser(&quot;property-placeholder&quot;, new PropertyPlaceholderBeanDefinitionParser());
        registerBeanDefinitionParser(&quot;property-override&quot;, new PropertyOverrideBeanDefinitionParser());
        registerBeanDefinitionParser(&quot;annotation-config&quot;, new AnnotationConfigBeanDefinitionParser());
        registerBeanDefinitionParser(&quot;component-scan&quot;, new ComponentScanBeanDefinitionParser());
        registerBeanDefinitionParser(&quot;load-time-weaver&quot;, new LoadTimeWeaverBeanDefinitionParser());
        registerBeanDefinitionParser(&quot;spring-configured&quot;, new SpringConfiguredBeanDefinitionParser());
        registerBeanDefinitionParser(&quot;mbean-export&quot;, new MBeanExportBeanDefinitionParser());
        registerBeanDefinitionParser(&quot;mbean-server&quot;, new MBeanServerBeanDefinitionParser());
    }</code></pre>
</li>
<li><p>BeanDefinitionParserçš„parser()æ–¹æ³•ä¸­çš„é€»è¾‘ã€‚åœ¨è¿™é‡Œå°†åˆ›å»ºæ‰«æå™¨å¯¹åŸºç¡€åŒ…è·¯å¾„ä¸‹çš„ç±»è¿›è¡Œæ‰«æï¼Œå¹¶åˆ›å»ºä¸ºBeanDefinitonå¯¹è±¡ï¼Œç„¶åé€šè¿‡registerComponents()æ–¹æ³•æ³¨å†ŒBeanPostProcessorã€‚BeanPostProcessorä¸»è¦æ˜¯æ”¯æ’‘ç±»ä¸­å…¶ä»–æ³¨è§£çš„åŠŸèƒ½ï¼Œå¦‚@Autowiredã€@PostConstructã€@PreDestoryç­‰ã€‚</p>
<pre><code class="java">    public BeanDefinition parse(Element element, ParserContext parserContext) {
        //è·å–basePackageå±æ€§
        String basePackage = element.getAttribute(BASE_PACKAGE_ATTRIBUTE);
        basePackage = parserContext.getReaderContext().getEnvironment().resolvePlaceholders(basePackage);
        //å¯ä»¥ç”¨é€—å·åˆ†å¼€
        String[] basePackages = StringUtils.tokenizeToStringArray(basePackage,
                ConfigurableApplicationContext.CONFIG_LOCATION_DELIMITERS);

        //åˆ›å»ºæ³¨è§£æ‰«æå™¨
        // Actually scan for bean definitions and register them.
        ClassPathBeanDefinitionScanner scanner = configureScanner(parserContext, element);
        //æ‰«æå¹¶æŠŠæ‰«æçš„ç±»å°è£…æˆbeanDefinitionå¯¹è±¡  æ ¸å¿ƒæ–¹æ³•ï¼Œé‡è¦ç¨‹åº¦ 5
        Set&lt;BeanDefinitionHolder&gt; beanDefinitions = scanner.doScan(basePackages);
    //æ³¨å†ŒBeanPostProcessor
        registerComponents(parserContext.getReaderContext(), beanDefinitions, element);

        return null;
    }</code></pre>
</li>
<li><p>doScan()æ–¹æ³•ä¸­ä¼šæ‰«æåˆ°æœ‰æ³¨è§£çš„ç±»å¹¶å°è£…æˆBeanDefinitionHolderå¯¹è±¡ã€‚åœ¨é€šè¿‡findCandidateComponents()è·å–åˆ°BeanDefinitionä¹‹åï¼Œä¼šæ ¹æ®ScopeMetadataå¯¹BeanDefinitionHolderçš„å±æ€§å†æ¬¡è¿›è¡Œè®¾ç½®ï¼Œå¹¶åˆ›å»ºBeanDefinitionHolderå¯¹è±¡ï¼Œæœ€åæ³¨å†ŒBeanDefinitonHolderã€‚æ³¨å†Œè¿‡ç¨‹ä¸é»˜è®¤å®ä¾‹åŒ–ä¸­ç›¸åŒï¼Œæ­¤å¤„ä¸å†èµ˜è¿°ã€‚</p>
<pre><code class="java">    protected Set&lt;BeanDefinitionHolder&gt; doScan(String... basePackages) {
        Assert.notEmpty(basePackages, &quot;At least one base package must be specified&quot;);
        Set&lt;BeanDefinitionHolder&gt; beanDefinitions = new LinkedHashSet&lt;&gt;();
        for (String basePackage : basePackages) {
            //æ‰«æåˆ°æœ‰æ³¨è§£çš„ç±»å¹¶å°è£…æˆBeanDefinitionå¯¹è±¡
            Set&lt;BeanDefinition&gt; candidates = findCandidateComponents(basePackage);
            for (BeanDefinition candidate : candidates) {
                ScopeMetadata scopeMetadata = this.scopeMetadataResolver.resolveScopeMetadata(candidate);
                candidate.setScope(scopeMetadata.getScopeName());
                String beanName = this.beanNameGenerator.generateBeanName(candidate, this.registry);
                if (candidate instanceof AbstractBeanDefinition) {
                    postProcessBeanDefinition((AbstractBeanDefinition) candidate, beanName);
                }
                if (candidate instanceof AnnotatedBeanDefinition) {
                    //æ”¯æŒäº†@Lazy @DependOnæ³¨è§£
                    AnnotationConfigUtils.processCommonDefinitionAnnotations((AnnotatedBeanDefinition) candidate);
                }
                if (checkCandidate(beanName, candidate)) {
                    BeanDefinitionHolder definitionHolder = new BeanDefinitionHolder(candidate, beanName);
                    //è¿™é‡Œä¸çœ‹
                    definitionHolder =
                            AnnotationConfigUtils.applyScopedProxyMode(scopeMetadata, definitionHolder, this.registry);
                    beanDefinitions.add(definitionHolder);

                    //BeanDefinitionæ³¨å†Œ
                    registerBeanDefinition(definitionHolder, this.registry);
                }
            }
        }
        return beanDefinitions;
    }</code></pre>
</li>
<li><p>findCandidateComponents()ä¼šé€’å¯»æ‰¾åŒ…è·¯å¾„ä¸‹æ–‡ä»¶ï¼Œç„¶åå°†æ–‡ä»¶å°è£…ä¸ºMetadataReaderå¯¹è±¡ï¼Œä¹‹åå†æ ¹æ®MetadataReaderä¸­çš„ç±»æ³¨è§£åˆ¤æ–­æ˜¯å¦è¿›è¡Œå®ä¾‹åŒ–ã€‚è¿›è¡Œå¤„ç†å¹¶å°è£…ä¸ºBeanDefinitionã€‚MetadataReaderä¸­æŒæœ‰ä¸€ä¸ªClassMetadataï¼ŒClassMetadataå¯¹è±¡ä¸­å‡ ä¹åŒ…æ‹¬ç±»çš„æ‰€æœ‰ä¿¡æ¯ã€‚</p>
<pre><code class="java">    private Set&lt;BeanDefinition&gt; scanCandidateComponents(String basePackage) {
        Set&lt;BeanDefinition&gt; candidates = new LinkedHashSet&lt;&gt;();
        try {
            String packageSearchPath = ResourcePatternResolver.CLASSPATH_ALL_URL_PREFIX +
                    resolveBasePackage(basePackage) + &#39;/&#39; + this.resourcePattern;

            //è¿™é‡Œé€’å½’å¯»æ‰¾æ–‡ä»¶
            Resource[] resources = getResourcePatternResolver().getResources(packageSearchPath);
            boolean traceEnabled = logger.isTraceEnabled();
            boolean debugEnabled = logger.isDebugEnabled();
            for (Resource resource : resources) {
                if (traceEnabled) {
                    logger.trace(&quot;Scanning &quot; + resource);
                }
                if (resource.isReadable()) {
                    try {
                        //å°†æ–‡ä»¶ä¿¡æ¯åŒ…è£…ä¸ºç±»åŸºæœ¬ä¿¡æ¯çš„å¯¹è±¡
                        MetadataReader metadataReader = getMetadataReaderFactory().getMetadataReader(resource);
                        //å¦‚æœç±»ä¸Šé¢æœ‰includeFiltersä¸­çš„æ³¨è§£
                        if (isCandidateComponent(metadataReader)) {
                            ScannedGenericBeanDefinition sbd = new ScannedGenericBeanDefinition(metadataReader);
                            sbd.setResource(resource);
                            sbd.setSource(resource);
                            if (isCandidateComponent(sbd)) {
                                if (debugEnabled) {
                                    logger.debug(&quot;Identified candidate component class: &quot; + resource);
                                }
                                candidates.add(sbd);
                            }
                            else {
                                if (debugEnabled) {
                                    logger.debug(&quot;Ignored because not a concrete top-level class: &quot; + resource);
                                }
                            }
                        }
                        else {
                            if (traceEnabled) {
                                logger.trace(&quot;Ignored because not matching any filter: &quot; + resource);
                            }
                        }
                    }
                    catch (Throwable ex) {
                        throw new BeanDefinitionStoreException(
                                &quot;Failed to read candidate component class: &quot; + resource, ex);
                    }
                }
                else {
                    if (traceEnabled) {
                        logger.trace(&quot;Ignored because not readable: &quot; + resource);
                    }
                }
            }
        }
        catch (IOException ex) {
            throw new BeanDefinitionStoreException(&quot;I/O failure during classpath scanning&quot;, ex);
        }
        return candidates;
    }</code></pre>
</li>
<li><p>é€’å½’å¯»æ‰¾æ–‡ä»¶çš„ä¸»è¦æ–¹æ³•</p>
<pre><code class="java">    protected void doRetrieveMatchingFiles(String fullPattern, File dir, Set&lt;File&gt; result) throws IOException {
        if (logger.isTraceEnabled()) {
            logger.trace(&quot;Searching directory [&quot; + dir.getAbsolutePath() +
                    &quot;] for files matching pattern [&quot; + fullPattern + &quot;]&quot;);
        }
        for (File content : listDirectory(dir)) {
            String currPath = StringUtils.replace(content.getAbsolutePath(), File.separator, &quot;/&quot;);
            //å¦‚æœæ˜¯ä¸€ä¸ªæ–‡ä»¶å¤¹ï¼Œåˆ™é€’å½’
            if (content.isDirectory() &amp;&amp; getPathMatcher().matchStart(fullPattern, currPath + &quot;/&quot;)) {
                if (!content.canRead()) {
                    if (logger.isDebugEnabled()) {
                        logger.debug(&quot;Skipping subdirectory [&quot; + dir.getAbsolutePath() +
                                &quot;] because the application is not allowed to read the directory&quot;);
                    }
                }
                else {
                    doRetrieveMatchingFiles(fullPattern, content, result);
                }
            }

            //å¦‚æœæ˜¯ä¸€ä¸ªæ–‡ä»¶ï¼Œåˆ™åŠ å…¥åˆ°å®¹å™¨
            if (getPathMatcher().match(fullPattern, currPath)) {
                result.add(content);
            }
        }
    }</code></pre>
</li>
<li><p>æ³¨å†ŒBeanPostProcessorè¿‡ç¨‹</p>
<pre><code class="java">    public static Set&lt;BeanDefinitionHolder&gt; registerAnnotationConfigProcessors(
            BeanDefinitionRegistry registry, @Nullable Object source) {

        DefaultListableBeanFactory beanFactory = unwrapDefaultListableBeanFactory(registry);
        if (beanFactory != null) {
            if (!(beanFactory.getDependencyComparator() instanceof AnnotationAwareOrderComparator)) {
                beanFactory.setDependencyComparator(AnnotationAwareOrderComparator.INSTANCE);
            }
            if (!(beanFactory.getAutowireCandidateResolver() instanceof ContextAnnotationAutowireCandidateResolver)) {
                beanFactory.setAutowireCandidateResolver(new ContextAnnotationAutowireCandidateResolver());
            }
        }

        Set&lt;BeanDefinitionHolder&gt; beanDefs = new LinkedHashSet&lt;&gt;(8);

        if (!registry.containsBeanDefinition(CONFIGURATION_ANNOTATION_PROCESSOR_BEAN_NAME)) {
            RootBeanDefinition def = new RootBeanDefinition(ConfigurationClassPostProcessor.class);
            def.setSource(source);
            beanDefs.add(registerPostProcessor(registry, def, CONFIGURATION_ANNOTATION_PROCESSOR_BEAN_NAME));
        }

        if (!registry.containsBeanDefinition(AUTOWIRED_ANNOTATION_PROCESSOR_BEAN_NAME)) {
            RootBeanDefinition def = new RootBeanDefinition(AutowiredAnnotationBeanPostProcessor.class);
            def.setSource(source);
            beanDefs.add(registerPostProcessor(registry, def, AUTOWIRED_ANNOTATION_PROCESSOR_BEAN_NAME));
        }

        // Check for JSR-250 support, and if present add the CommonAnnotationBeanPostProcessor.
        if (jsr250Present &amp;&amp; !registry.containsBeanDefinition(COMMON_ANNOTATION_PROCESSOR_BEAN_NAME)) {
            RootBeanDefinition def = new RootBeanDefinition(CommonAnnotationBeanPostProcessor.class);
            def.setSource(source);
            beanDefs.add(registerPostProcessor(registry, def, COMMON_ANNOTATION_PROCESSOR_BEAN_NAME));
        }

        // Check for JPA support, and if present add the PersistenceAnnotationBeanPostProcessor.
        if (jpaPresent &amp;&amp; !registry.containsBeanDefinition(PERSISTENCE_ANNOTATION_PROCESSOR_BEAN_NAME)) {
            RootBeanDefinition def = new RootBeanDefinition();
            try {
                def.setBeanClass(ClassUtils.forName(PERSISTENCE_ANNOTATION_PROCESSOR_CLASS_NAME,
                        AnnotationConfigUtils.class.getClassLoader()));
            }
            catch (ClassNotFoundException ex) {
                throw new IllegalStateException(
                        &quot;Cannot load optional framework class: &quot; + PERSISTENCE_ANNOTATION_PROCESSOR_CLASS_NAME, ex);
            }
            def.setSource(source);
            beanDefs.add(registerPostProcessor(registry, def, PERSISTENCE_ANNOTATION_PROCESSOR_BEAN_NAME));
        }

        if (!registry.containsBeanDefinition(EVENT_LISTENER_PROCESSOR_BEAN_NAME)) {
            RootBeanDefinition def = new RootBeanDefinition(EventListenerMethodProcessor.class);
            def.setSource(source);
            beanDefs.add(registerPostProcessor(registry, def, EVENT_LISTENER_PROCESSOR_BEAN_NAME));
        }

        if (!registry.containsBeanDefinition(EVENT_LISTENER_FACTORY_BEAN_NAME)) {
            RootBeanDefinition def = new RootBeanDefinition(DefaultEventListenerFactory.class);
            def.setSource(source);
            beanDefs.add(registerPostProcessor(registry, def, EVENT_LISTENER_FACTORY_BEAN_NAME));
        }

        return beanDefs;
    }</code></pre>
</li>
</ol>
<h2 id="ç®€å•ä¸Šæ‰‹"><a href="#ç®€å•ä¸Šæ‰‹" class="headerlink" title="ç®€å•ä¸Šæ‰‹"></a>ç®€å•ä¸Šæ‰‹</h2><h3 id="ä½¿ç”¨è‡ªå®šä¹‰æ ‡ç­¾è¿æ¥redis"><a href="#ä½¿ç”¨è‡ªå®šä¹‰æ ‡ç­¾è¿æ¥redis" class="headerlink" title="ä½¿ç”¨è‡ªå®šä¹‰æ ‡ç­¾è¿æ¥redis"></a>ä½¿ç”¨è‡ªå®šä¹‰æ ‡ç­¾è¿æ¥redis</h3><ol>
<li>åˆ›å»ºè‡ªå®šä¹‰æ ‡ç­¾çº¦æŸæ–‡ä»¶myMags.xsdï¼Œä½ç½®ä¸ºåœ¨resources/META-INF/</li>
</ol>
<pre><code class="xml">&lt;?xml version=&quot;1.0&quot; encoding=&quot;UTF-8&quot;?&gt;
&lt;xsd:schema xmlns=&quot;http://www.test.com/schema/mytags&quot;
            xmlns:xsd=&quot;http://www.w3.org/2001/XMLSchema&quot; targetNamespace=&quot;http://www.test.com/schema/mytags&quot;
            elementFormDefault=&quot;qualified&quot; attributeFormDefault=&quot;unqualified&quot;&gt;
    &lt;xsd:element name=&quot;redis&quot;&gt;
        &lt;xsd:complexType&gt;
            &lt;xsd:attribute name=&quot;id&quot; type=&quot;xsd:string&quot;&gt;&lt;/xsd:attribute&gt;
            &lt;xsd:attribute name=&quot;ip&quot; type=&quot;xsd:string&quot;&gt;&lt;/xsd:attribute&gt;
            &lt;xsd:attribute name=&quot;port&quot; type=&quot;xsd:string&quot;&gt;&lt;/xsd:attribute&gt;
        &lt;/xsd:complexType&gt;
    &lt;/xsd:element&gt;
&lt;/xsd:schema&gt;</code></pre>
<ol start="2">
<li>åœ¨ç›¸åŒä½ç½®ä¸ºxsdæ–‡ä»¶åˆ›å»ºæ˜ å°„æ–‡ä»¶spring.schemas</li>
</ol>
<pre><code class="scheme">http\://www.test.com/schema/mytags.xsd=META-INF/myTags.xsd</code></pre>
<ol start="3">
<li>åœ¨ç›¸åŒä½ç½®ä¸‹åˆ›å»ºspring.handlersæ–‡ä»¶</li>
</ol>
<pre><code>http\://www.test.com/schema/mytags=org.example.tag.TagsNamespaceHandler</code></pre><ol start="4">
<li>åˆ›å»ºRedisBeanDefinitionParserç±»</li>
</ol>
<pre><code class="java">public class RedisBeanDefinitionParser extends AbstractSingleBeanDefinitionParser {
    @Override
    protected Class&lt;?&gt; getBeanClass(Element element) {
        return Jedis.class;
    }

    @Override
    protected void doParse(Element element, BeanDefinitionBuilder builder) {
        String ip = element.getAttribute(&quot;ip&quot;);
        String port = element.getAttribute(&quot;port&quot;);

        builder.addConstructorArgValue(ip);
        builder.addConstructorArgValue(Integer.parseInt(port));
    }
}</code></pre>
<ol start="5">
<li>åˆ›å»ºTagsNamespaceHandlerç±»</li>
</ol>
<pre><code class="java">public class TagsNamespaceHandler extends NamespaceHandlerSupport {
    @Override
    public void init() {
        this.registerBeanDefinitionParser(&quot;redis&quot;,new RedisBeanDefinitionParser());
    }

    @Override
    public BeanDefinitionHolder decorate(Node node, BeanDefinitionHolder definition, ParserContext parserContext) {
        return super.decorate(node, definition, parserContext);
    }
}</code></pre>
<ol start="6">
<li>åœ¨spring.xmlä¸­ä½¿ç”¨è‡ªå®šä¹‰æ ‡ç­¾</li>
</ol>
<pre><code class="xml">&lt;beans xmlns=&quot;http://www.springframework.org/schema/beans&quot;
       xmlns:xsi=&quot;http://www.w3.org/2001/XMLSchema-instance&quot; xmlns:my=&quot;http://www.test.com/schema/mytags&quot;
       xsi:schemaLocation=&quot;http://www.springframework.org/schema/beans
       http://www.springframework.org/schema/beans/spring-beans.xsd
       http://www.test.com/schema/mytags
       http://www.test.com/schema/mytags.xsd&quot;
       default-lazy-init=&quot;false&quot;&gt;
    &lt;!--è‡ªå®šä¹‰æ ‡ç­¾--&gt;
    &lt;my:redis id=&quot;redis&quot; ip=&quot;localhost&quot; port=&quot;6379&quot;/&gt;
&lt;/beans&gt;</code></pre>
<ol start="7">
<li>æµ‹è¯•ç±»</li>
</ol>
<pre><code class="java">@RunWith(SpringJUnit4ClassRunner.class)
@ContextConfiguration(locations = {&quot;classpath:spring.xml&quot;})
public class MyTest {
    @Autowired
    private Jedis jedis;

    @Test
    public void myTag() {
        jedis.set(&quot;tag&quot;,&quot;test&quot;);
        System.out.println(jedis.get(&quot;tag&quot;));
    }
}</code></pre>
<h3 id="ä½¿ç”¨è‡ªå®šä¹‰æ³¨è§£åˆ›å»ºBeanå¯¹è±¡"><a href="#ä½¿ç”¨è‡ªå®šä¹‰æ³¨è§£åˆ›å»ºBeanå¯¹è±¡" class="headerlink" title="ä½¿ç”¨è‡ªå®šä¹‰æ³¨è§£åˆ›å»ºBeanå¯¹è±¡"></a>ä½¿ç”¨è‡ªå®šä¹‰æ³¨è§£åˆ›å»ºBeanå¯¹è±¡</h3><ol>
<li>åˆ›å»ºMyBeanDefinitionRegistryPostProcessor</li>
</ol>
<pre><code class="java">public class MyBeanDefinitionRegistryPostProcessor implements BeanDefinitionRegistryPostProcessor {

    @Override
    public void postProcessBeanDefinitionRegistry(BeanDefinitionRegistry registry) throws BeansException {
        GenericBeanDefinition genericBeanDefinition = new GenericBeanDefinition();
        genericBeanDefinition.setBeanClass(BeanClass.class);

        MutablePropertyValues propertyValues = genericBeanDefinition.getPropertyValues();
        propertyValues.addPropertyValue(&quot;username&quot;,&quot;test&quot;);

        registry.registerBeanDefinition(&quot;beanClass&quot;,genericBeanDefinition);

        ClassPathBeanDefinitionScanner scanner = new ClassPathBeanDefinitionScanner(registry);
        scanner.addIncludeFilter(new AnnotationTypeFilter(MyService.class));
        scanner.scan(&quot;org.example.beanDefinition&quot;);
    }

    @Override
    public void postProcessBeanFactory(ConfigurableListableBeanFactory beanFactory) throws BeansException {

    }
}</code></pre>
<ol start="2">
<li>åˆ›å»ºBeanClass</li>
</ol>
<pre><code class="java">public class BeanClass {
    private String username;

    public String getUsername() {
        return username;
    }

    public void setUsername(String username) {
        this.username = username;
    }
}</code></pre>
<ol start="3">
<li>åˆ›å»º</li>
</ol>
<pre><code class="java">@Target({ElementType.TYPE})
@Retention(RetentionPolicy.RUNTIME)
@Documented
public @interface MyService {ÃŸÃŸ
    String value() default &quot;&quot;;
}</code></pre>
<ol start="4">
<li>æµ‹è¯•ç±»</li>
</ol>
<pre><code class="java">@RunWith(SpringJUnit4ClassRunner.class)
@ContextConfiguration(locations = {&quot;classpath:spring.xml&quot;})
public class MyTest {
    @Autowired
    private Jedis jedis;

    @Test
    public void myTag() {
        jedis.set(&quot;tag&quot;,&quot;test&quot;);
        System.out.println(jedis.get(&quot;tag&quot;));
    }

    @Autowired
    private BeanClass beanClass;

    @Test
    public void beanDefinition(){
        System.out.println(beanClass.getUsername());
    }
}</code></pre>

            </div>
            <hr>
            <div>
              <p>
                
                  <span>
                <i class="iconfont icon-inbox"></i>
                    
                      <a class="hover-with-bg" href="/blog/categories/Spring%E6%BA%90%E7%A0%81%E8%A7%A3%E6%9E%90/">Springæºç è§£æ</a>
                      &nbsp;
                    
                  </span>&nbsp;&nbsp;
                
                
                  <span>
                <i class="iconfont icon-tag"></i>
                    
                      <a class="hover-with-bg" href="/blog/tags/%E6%BA%90%E7%A0%81%E8%A7%A3%E6%9E%90/">æºç è§£æ</a>
                    
                      <a class="hover-with-bg" href="/blog/tags/spring/">spring</a>
                    
                  </span>
                
              </p>
              
                <p class="note note-warning">æœ¬åšå®¢æ‰€æœ‰æ–‡ç« é™¤ç‰¹åˆ«å£°æ˜å¤–ï¼Œå‡é‡‡ç”¨ <a href="https://zh.wikipedia.org/wiki/Wikipedia:CC_BY-SA_3.0%E5%8D%8F%E8%AE%AE%E6%96%87%E6%9C%AC" target="_blank" rel="nofollow noopener noopener">CC BY-SA 3.0åè®®</a> ã€‚è½¬è½½è¯·æ³¨æ˜å‡ºå¤„ï¼</p>
              
              
                <div class="post-prevnext row">
                  <div class="post-prev col-6">
                    
                    
                      <a href="/blog/2020/04/15/spring%E5%AE%9E%E4%BE%8B%E5%8C%96bean%E7%9A%84%E8%BF%87%E7%A8%8B/">
                        <i class="fa fa-chevron-left"></i>
                        <span class="hidden-mobile">springå®ä¾‹åŒ–beançš„è¿‡ç¨‹</span>
                        <span class="visible-mobile">ä¸Šä¸€ç¯‡</span>
                      </a>
                    
                  </div>
                  <div class="post-next col-6">
                    
                    
                      <a href="/blog/2020/04/03/MySQL%E7%9A%84%E7%B4%A2%E5%BC%95%E4%B8%8E%E6%89%A7%E8%A1%8C%E8%AE%A1%E5%88%92/">
                        <span class="hidden-mobile">MySQLçš„ç´¢å¼•ä¸æ‰§è¡Œè®¡åˆ’</span>
                        <span class="visible-mobile">ä¸‹ä¸€ç¯‡</span>
                        <i class="fa fa-chevron-right"></i>
                      </a>
                    
                  </div>
                </div>
              
            </div>

              
                <!-- Comments -->
                <div class="comments" id="comments">
                  
                  

                </div>
              
          </div>
        </div>
      </div>
    </div>
    
      <div class="d-none d-lg-block col-lg-2 toc-container" id="toc-ctn">
        <div id="toc-start"></div>
<div id="toc">
  <p class="h5"><i class="far fa-list-alt"></i>&nbsp;ç›®å½•</p>
  <div id="tocbot"></div>
</div>

      </div>
    
  </div>
</div>

<!-- Custom -->


    
  </main>

  
    <a class="z-depth-1" id="scroll-top-button" href="#" role="button">
      <i class="fa fa-chevron-up scroll-top-arrow" aria-hidden="true"></i>
    </a>
  

  
    <div class="modal fade" id="modalSearch" tabindex="-1" role="dialog" aria-labelledby="ModalLabel"
     aria-hidden="true">
  <div class="modal-dialog modal-dialog-scrollable modal-lg" role="document">
    <div class="modal-content">
      <div class="modal-header text-center">
        <h4 class="modal-title w-100 font-weight-bold">æœç´¢</h4>
        <button type="button" id="local-search-close" class="close" data-dismiss="modal" aria-label="Close">
          <span aria-hidden="true">&times;</span>
        </button>
      </div>
      <div class="modal-body mx-3">
        <div class="md-form mb-5">
          <input type="text" id="local-search-input" class="form-control validate">
          <label data-error="x" data-success="v"
                 for="local-search-input">å…³é”®è¯</label>
        </div>
        <div class="list-group" id="local-search-result"></div>
      </div>
    </div>
  </div>
</div>
  

  

  

  <footer class="mt-5">
  <div class="text-center py-3">
    <div>
      <a href="https://hexo.io" target="_blank" rel="nofollow noopener"><b>Hexo</b></a>
      <i class="iconfont icon-love"></i>
      <a href="https://github.com/fluid-dev/hexo-theme-fluid" target="_blank" rel="nofollow noopener"> <b>Fluid</b></a>
    </div>
    
  <div>
    
      <!-- ä¸è’œå­ç»Ÿè®¡PV -->
      
      <span id="busuanzi_container_site_pv" style="display: none">
      æ€»è®¿é—®é‡ <span id="busuanzi_value_site_pv"></span> æ¬¡
    </span>
    
    
      <!-- ä¸è’œå­ç»Ÿè®¡UV -->
      
      <span id="busuanzi_container_site_uv" style="display: none">
      æ€»è®¿å®¢æ•° <span id="busuanzi_value_site_uv"></span> äºº
    </span>
    
  </div>


    

    
  </div>
</footer>

<!-- SCRIPTS -->
<script  src="https://cdn.staticfile.org/jquery/3.4.1/jquery.min.js" ></script>
<script  src="https://cdn.staticfile.org/popper.js/1.16.1/umd/popper.min.js" ></script>
<script  src="https://cdn.staticfile.org/twitter-bootstrap/4.4.1/js/bootstrap.min.js" ></script>
<script  src="https://cdn.staticfile.org/mdbootstrap/4.13.0/js/mdb.min.js" ></script>
<script  src="/blog/js/main.js" ></script>


  <script  src="/blog/js/lazyload.js" ></script>



  
  <script  src="https://cdn.staticfile.org/tocbot/4.10.0/tocbot.min.js" ></script>
  <script>
    $(document).ready(function () {
      var navHeight = $('#navbar').height();
      var toc = $('#toc');
      var boardCtn = $('#board-ctn');
      var boardTop = boardCtn.offset().top;
      var tocLimMax = 2 * boardTop + boardCtn.height();

      $(window).scroll(function () {
        var tocLimMin = $('#toc-start').offset().top - navHeight;
        var scroH = document.body.scrollTop + document.documentElement.scrollTop;

        if (tocLimMin <= scroH && scroH <= tocLimMax) {
          toc.css({
            'display': 'block',
            'position': 'fixed',
            'top': navHeight,
          });
        } else if (scroH <= tocLimMin) {
          toc.css({
            'position': '',
            'top': '',
          });
        } else if (scroH > tocLimMax) {
          toc.css('display', 'none');
        }
      });
      tocbot.init({
        tocSelector: '#tocbot',
        contentSelector: '.post-content',
        headingSelector: 'h1,h2,h3,h4,h5,h6',
        linkClass: 'tocbot-link',
        activeLinkClass: 'tocbot-active-link',
        listClass: 'tocbot-list',
        isCollapsedClass: 'tocbot-is-collapsed',
        collapsibleClass: 'tocbot-is-collapsible',
        scrollSmooth: true,
        headingsOffset: -boardTop
      });
      if ($('.toc-list-item').length > 0) {
        $('#toc > p').css('visibility', 'visible');
      }
      var offset = boardCtn.css('margin-right')
      $('#toc-ctn').css({
        'right': offset
      })
    });
  </script>





  <script defer src="https://cdn.staticfile.org/clipboard.js/2.0.6/clipboard.min.js" ></script>
  <script  src="/blog/js/clipboard-use.js" ></script>



  <script defer src="https://cdn.staticfile.org/smoothscroll/1.4.10/SmoothScroll.min.js" ></script>



  <script defer src="https://busuanzi.ibruce.info/busuanzi/2.3/busuanzi.pure.mini.js" ></script>




<!-- Plugins -->


  

  

  

  

  

  



  <script  src="https://cdn.staticfile.org/prettify/188.0.0/prettify.min.js" ></script>
  <script>
    $(document).ready(function () {
      $('pre').addClass('prettyprint  linenums');
      prettyPrint();
    })
  </script>



  <script  src="https://cdn.staticfile.org/typed.js/2.0.11/typed.min.js" ></script>
  <script>
    var typed = new Typed('#subtitle', {
      strings: [
        '  ',
        "springç¨‹åºå…¥å£å’Œxmlè§£æ&nbsp;",
      ],
      cursorChar: "_",
      typeSpeed: 70,
      loop: false,
    });
    typed.stop();
    $(document).ready(function () {
      $(".typed-cursor").addClass("h2");
      typed.start();
    });
  </script>



  <script  src="https://cdn.staticfile.org/anchor-js/4.2.2/anchor.min.js" ></script>
  <script>
    anchors.options = {
      placement: "right",
      visible: "hover",
      
    };
    var el = "h1,h2,h3,h4,h5,h6".split(",");
    var res = [];
    for (item of el) {
      res.push(".markdown-body > " + item)
    }
    anchors.add(res.join(", "))
  </script>



  <script  src="/blog/js/local-search.js" ></script>
  <script>
    var path = "/blog/local-search.xml";
    var inputArea = document.querySelector("#local-search-input");
    inputArea.onclick = function () {
      getSearchFile(path);
      this.onclick = null
    }
  </script>



  <script defer src="https://cdn.staticfile.org/fancybox/3.5.7/jquery.fancybox.min.js" ></script>
  <script>
    $("#post img:not(.no-zoom img, img[no-zoom])").each(
      function () {
        var element = document.createElement("a");
        $(element).attr("data-fancybox", "images");
        $(element).attr("href", $(this).attr("src"));
        $(this).wrap(element);
      }
    );
  </script>





  
  
    <script type="text/javascript">
      //å®šä¹‰è·å–è¯è¯­ä¸‹æ ‡
      var a_idx = 0;
      jQuery(document).ready(function ($) {
        //ç‚¹å‡»bodyæ—¶è§¦å‘äº‹ä»¶
        $("body").click(function (e) {
          //éœ€è¦æ˜¾ç¤ºçš„è¯è¯­
          var a = new Array("å¯Œå¼º", "æ°‘ä¸»", "æ–‡æ˜", "å’Œè°", "è‡ªç”±", "å¹³ç­‰", "å…¬æ­£", "æ³•æ²»", "çˆ±å›½", "æ•¬ä¸š", "è¯šä¿¡", "å‹å–„");
          //è®¾ç½®è¯è¯­ç»™spanæ ‡ç­¾
          var $i = $("<span/>").text(a[a_idx]);
          //ä¸‹æ ‡ç­‰äºåŸæ¥ä¸‹æ ‡+1  ä½™ è¯è¯­æ€»æ•°
          a_idx = (a_idx + 1) % a.length;
          //è·å–é¼ æ ‡æŒ‡é’ˆçš„ä½ç½®ï¼Œåˆ†åˆ«ç›¸å¯¹äºæ–‡æ¡£çš„å·¦å’Œå³è¾¹ç¼˜ã€‚
          //è·å–xå’Œyçš„æŒ‡é’ˆåæ ‡
          var x = e.pageX, y = e.pageY;
          //åœ¨é¼ æ ‡çš„æŒ‡é’ˆçš„ä½ç½®ç»™$iå®šä¹‰çš„spanæ ‡ç­¾æ·»åŠ cssæ ·å¼
          $i.css({
            "z-index": 999,
            "top": y - 20,
            "left": x,
            "position": "absolute",
            "font-weight": "bold",
            "color": rand_color()
          });
          // éšæœºé¢œè‰²
          function rand_color() {
            return "rgb(" + ~~(255 * Math.random()) + "," + ~~(255 * Math.random()) + "," + ~~(255 * Math.random()) + ")"
          }
          //åœ¨bodyæ·»åŠ è¿™ä¸ªæ ‡ç­¾
          $("body").append($i);
          //animate() æ–¹æ³•æ‰§è¡Œ CSS å±æ€§é›†çš„è‡ªå®šä¹‰åŠ¨ç”»ã€‚
          //è¯¥æ–¹æ³•é€šè¿‡CSSæ ·å¼å°†å…ƒç´ ä»ä¸€ä¸ªçŠ¶æ€æ”¹å˜ä¸ºå¦ä¸€ä¸ªçŠ¶æ€ã€‚CSSå±æ€§å€¼æ˜¯é€æ¸æ”¹å˜çš„ï¼Œè¿™æ ·å°±å¯ä»¥åˆ›å»ºåŠ¨ç”»æ•ˆæœã€‚
          //è¯¦æƒ…è¯·çœ‹http://www.w3school.com.cn/jquery/effect_animate.asp
          $i.animate({
            //å°†åŸæ¥çš„ä½ç½®å‘ä¸Šç§»åŠ¨180
            "top": y - 180,
            "opacity": 0
            //1500åŠ¨ç”»çš„é€Ÿåº¦
          }, 1500, function () {
            //æ—¶é—´åˆ°äº†è‡ªåŠ¨åˆ é™¤
            $i.remove();
          });
        });
      })
      ;
    </script>
  








</body>
</html>
