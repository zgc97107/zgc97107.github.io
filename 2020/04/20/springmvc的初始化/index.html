<!DOCTYPE html>
<html lang="zh-CN">





<head>
  <meta charset="UTF-8">
  <link rel="apple-touch-icon" sizes="76x76" href="/img/apple-touch-icon.png">
  <link rel="icon" type="image/png" href="/img/favicon.png">
  <meta name="viewport"
        content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no, shrink-to-fit=no">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  
  <meta name="theme-color" content="#2f4154">
  <meta name="description" content="">
  <meta name="author" content="">
  <meta name="keywords" content="">
  <title>springmvcçš„åˆå§‹åŒ– - ğŸğŸŠ&#39;s blog</title>

  <link  rel="stylesheet" href="https://cdn.staticfile.org/font-awesome/5.12.1/css/all.min.css" />
<link  rel="stylesheet" href="https://cdn.staticfile.org/twitter-bootstrap/4.4.1/css/bootstrap.min.css" />
<link  rel="stylesheet" href="https://cdn.staticfile.org/mdbootstrap/4.13.0/css/mdb.min.css" />
<link  rel="stylesheet" href="https://cdn.staticfile.org/github-markdown-css/3.0.1/github-markdown.min.css" />

<link rel="stylesheet" href="//at.alicdn.com/t/font_1067060_qzomjdt8bmp.css">



  <link  rel="stylesheet" href="/lib/prettify/tomorrow-night-eighties.min.css" />

<link  rel="stylesheet" href="/css/main.css" />


  <link defer rel="stylesheet" href="https://cdn.staticfile.org/fancybox/3.5.7/jquery.fancybox.min.css" />


<!-- è‡ªå®šä¹‰æ ·å¼ä¿æŒåœ¨æœ€åº•éƒ¨ -->


<meta name="generator" content="Hexo 4.2.1"></head>


<body>
  <header style="height: 70vh;">
    <nav id="navbar" class="navbar fixed-top  navbar-expand-lg navbar-dark scrolling-navbar">
  <div class="container">
    <a class="navbar-brand"
       href="/">&nbsp;<strong>ğŸğŸŠ's blog</strong>&nbsp;</a>

    <button id="navbar-toggler-btn" class="navbar-toggler" type="button" data-toggle="collapse"
            data-target="#navbarSupportedContent"
            aria-controls="navbarSupportedContent" aria-expanded="false" aria-label="Toggle navigation">
      <div class="animated-icon"><span></span><span></span><span></span></div>
    </button>

    <!-- Collapsible content -->
    <div class="collapse navbar-collapse" id="navbarSupportedContent">
      <ul class="navbar-nav ml-auto text-center">
        
          
          
          
          
          <li class="nav-item">
            <a class="nav-link" href="/">é¦–é¡µ</a>
          </li>
        
          
          
          
          
          <li class="nav-item">
            <a class="nav-link" href="/archives/">å½’æ¡£</a>
          </li>
        
          
          
          
          
          <li class="nav-item">
            <a class="nav-link" href="/categories/">åˆ†ç±»</a>
          </li>
        
          
          
          
          
          <li class="nav-item">
            <a class="nav-link" href="/tags/">æ ‡ç­¾</a>
          </li>
        
          
          
          
          
          <li class="nav-item">
            <a class="nav-link" href="/about">å…³äº</a>
          </li>
        
        
          <li class="nav-item" id="search-btn">
            <a class="nav-link" data-toggle="modal" data-target="#modalSearch">&nbsp;&nbsp;<i
                class="iconfont icon-search"></i>&nbsp;&nbsp;</a>
          </li>
        
      </ul>
    </div>
  </div>
</nav>

    <div class="view intro-2" id="background" parallax=true
         style="background: url('/img/default.png') no-repeat center center;
           background-size: cover;">
      <div class="full-bg-img">
        <div class="mask rgba-black-light flex-center">
          <div class="container text-center white-text fadeInUp">
            <span class="h2" id="subtitle">
              
            </span>

            
              
                <p class="mt-3 post-meta">
                  <i class="fas fa-calendar-alt" aria-hidden="true"></i>
                  æ˜ŸæœŸä¸€, å››æœˆ 20æ—¥ 2020, 8:10 æ™šä¸Š
                </p>
              

              <p class="mt-1">
                
                  
                  <span class="post-meta">
                    <i class="far fa-chart-bar"></i>
                    3.2k å­—
                  </span>
                

                
                  
                  <span class="post-meta">
                      <i class="far fa-clock"></i>
                      15 åˆ†é’Ÿ
                  </span>
                

                
                  <!-- ä¸è’œå­ç»Ÿè®¡æ–‡ç« PV -->
                  
                  <span id="busuanzi_container_page_pv" class="post-meta" style="display: none">
                    <i class="far fa-eye" aria-hidden="true"></i>
                    <span id="busuanzi_value_page_pv"></span> æ¬¡
                  </span>
                
              </p>
            
          </div>

          
        </div>
      </div>
    </div>
  </header>

  <main>
    
      

<div class="container-fluid">
  <div class="row">
    <div class="d-none d-lg-block col-lg-2"></div>
    <div class="col-lg-8 nopadding-md">
      <div class="container nopadding-md" id="board-ctn">
        <div class="py-5 z-depth-3" id="board">
          <div class="post-content mx-auto" id="post">
            
              <p
                class="note note-warning">æœ¬æ–‡æœ€åæ›´æ–°äºï¼šæ˜ŸæœŸæ—¥, äº”æœˆ 24æ—¥ 2020, 8:29 æ™šä¸Š</p>
            
            <div class="markdown-body">
              <h2 id="åˆå§‹åŒ–å…¥å£"><a href="#åˆå§‹åŒ–å…¥å£" class="headerlink" title="åˆå§‹åŒ–å…¥å£"></a>åˆå§‹åŒ–å…¥å£</h2><p>springmvcæ˜¯åŸºäºservletè§„èŒƒæ¥å®Œæˆçš„ä¸€ä¸ªè¯·æ±‚å“åº”æ¨¡å—ï¼Œä¹Ÿæ˜¯springä¸­æ¯”è¾ƒå¤§çš„ä¸€ä¸ªæ¨¡å—ï¼Œç°åœ¨å·²ç»æ”¯æŒé›¶é…ç½®çš„æ–¹å¼æ•´åˆï¼Œä¸å†éœ€è¦web.xmlå’Œspringmvc.xmlæ–‡ä»¶ã€‚</p>
<h3 id="web-xmlçš„æ›¿æ¢"><a href="#web-xmlçš„æ›¿æ¢" class="headerlink" title="web.xmlçš„æ›¿æ¢"></a>web.xmlçš„æ›¿æ¢</h3><p>servletè§„èŒƒä¸­è§„å®šå½“servletå®¹å™¨å¯åŠ¨çš„æ—¶ä¼šåŠ è½½META-INF/services/javax.servlet.ServletContainerInitializeræ–‡ä»¶ä¸­çš„ç±»ã€‚è¿™ä¸ªç±»å¿…é¡»å®ç°javax.servlet.ServletContainerInitializeræ¥å£ï¼Œservletå®¹å™¨åœ¨å¯åŠ¨åä¼šæ”¶é›†å®ç°@HandlesTypesæ³¨è§£ä¸­çš„æ¥å£çš„å®ç°ç±»ï¼Œç„¶åä¼ é€’ç»™onStartup()æ–¹æ³•ã€‚springmvcå°±æ˜¯é€šè¿‡è¿™ä¸ªè§„èŒƒå®Œæˆå®¹å™¨åˆå§‹åŒ–ã€‚</p>
<pre><code class="xml">org.springframework.web.SpringServletContainerInitializer</code></pre>
<p>springä¸­å®šä¹‰ä¸€ä¸ªäº†WebApplicationInitializeræ¥å£ï¼Œç„¶ååœ¨onStartup()æ–¹æ³•ä¸­é€šè¿‡åå°„è°ƒç”¨onStart()æ–¹æ³•ã€‚è¿™é‡Œæˆ‘ä»¬ç€é‡åˆ†æä¸‹è¿™ä¸ªæ¥å£çš„å®ç°ç±»AbstractContextLoaderInitializerè·ŸAbstractDispatcherServletInitializerç±»ã€‚</p>
<pre><code class="java">@HandlesTypes(WebApplicationInitializer.class)
public class SpringServletContainerInitializer implements ServletContainerInitializer {

    @Override
    public void onStartup(@Nullable Set&lt;Class&lt;?&gt;&gt; webAppInitializerClasses, ServletContext servletContext)
            throws ServletException {

        List&lt;WebApplicationInitializer&gt; initializers = new LinkedList&lt;&gt;();

        if (webAppInitializerClasses != null) {
            for (Class&lt;?&gt; waiClass : webAppInitializerClasses) {
                // Be defensive: Some servlet containers provide us with invalid classes,
                // no matter what @HandlesTypes says...
                if (!waiClass.isInterface() &amp;&amp; !Modifier.isAbstract(waiClass.getModifiers()) &amp;&amp;
                        WebApplicationInitializer.class.isAssignableFrom(waiClass)) {
                    try {
                        initializers.add((WebApplicationInitializer)
                                ReflectionUtils.accessibleConstructor(waiClass).newInstance());
                    }
                    catch (Throwable ex) {
                        throw new ServletException(&quot;Failed to instantiate WebApplicationInitializer class&quot;, ex);
                    }
                }
            }
        }

        if (initializers.isEmpty()) {
            servletContext.log(&quot;No Spring WebApplicationInitializer types detected on classpath&quot;);
            return;
        }

        servletContext.log(initializers.size() + &quot; Spring WebApplicationInitializers detected on classpath&quot;);
        AnnotationAwareOrderComparator.sort(initializers);
        for (WebApplicationInitializer initializer : initializers) {
            initializer.onStartup(servletContext);
        }
    }
}</code></pre>
<h4 id="AbstractContextLoaderInitializerç±»"><a href="#AbstractContextLoaderInitializerç±»" class="headerlink" title="AbstractContextLoaderInitializerç±»"></a>AbstractContextLoaderInitializerç±»</h4><p>AbstractContextLoaderInitializerä¸­çš„onStartup()æ–¹æ³•ä¼šè°ƒç”¨registerContextLoaderListener()æ–¹æ³•ï¼Œè¯¥æ–¹æ³•ä¸­ä¼šè°ƒç”¨createRootApplicationContext()æ–¹æ³•åˆ›å»ºspringä¸Šä¸‹æ–‡ï¼Œå¹¶æ³¨å†ŒContextLoaderListenerã€‚springä¸Šä¸‹æ–‡çš„refresh()æ–¹æ³•å°†ç”±ContextLoaderListeneræ¥è°ƒç”¨</p>
<pre><code class="java">public abstract class AbstractContextLoaderInitializer implements WebApplicationInitializer {

    /** Logger available to subclasses. */
    protected final Log logger = LogFactory.getLog(getClass());


    @Override
    public void onStartup(ServletContext servletContext) throws ServletException {
        registerContextLoaderListener(servletContext);
    }

    protected void registerContextLoaderListener(ServletContext servletContext) {

        //åˆ›å»ºspringä¸Šä¸‹æ–‡ï¼Œæ³¨å†Œäº†SpringContainer
        WebApplicationContext rootAppContext = createRootApplicationContext();
        if (rootAppContext != null) {
            //åˆ›å»ºç›‘å¬å™¨
            /*
                å½¢å¦‚è¿™ç§é…ç½®
            * &lt;listener&gt;
                  &lt;listener-class&gt;org.springframework.web.context.ContextLoaderListener&lt;/listener-class&gt;
                &lt;!--&lt;listener-class&gt;org.springframework.web.context.request.RequestContextListener&lt;/listener-class&gt;--&gt;
              &lt;/listener&gt;
            *
            * */
            ContextLoaderListener listener = new ContextLoaderListener(rootAppContext);
            listener.setContextInitializers(getRootApplicationContextInitializers());
            servletContext.addListener(listener);
        }
        else {
            logger.debug(&quot;No ContextLoaderListener registered, as &quot; +
                    &quot;createRootApplicationContext() did not return an application context&quot;);
        }
    }

    @Nullable
    protected abstract WebApplicationContext createRootApplicationContext();

    @Nullable
    protected ApplicationContextInitializer&lt;?&gt;[] getRootApplicationContextInitializers() {
        return null;
    }
}</code></pre>
<p>AbstractAnnotationConfigDispatcherServletInitializerä¸­çš„createRootApplicationContext()æ–¹æ³•ä¼šè°ƒç”¨getRootConfigClasses()æ–¹æ³•è·å–ä¸€ä¸ªconfigClasseså¯¹è±¡ï¼Œç„¶ååˆ›å»ºä¸€ä¸ªAnnotationConfigWebApplicationContextä¸Šä¸‹æ–‡å¯¹è±¡ï¼Œå¹¶å‘è¿™ä¸ªä¸Šä¸‹æ–‡å¯¹è±¡ä¸­æ³¨å†ŒconfigClasseså¯¹è±¡ã€‚è¿™ä¸ªè¿‡ç¨‹ç±»ä¼¼äºä¸æ³¨è§£å¯åŠ¨springå®¹å™¨è¿‡ç¨‹ç›¸åŒã€‚getRootConfigClasses()æ–¹æ³•ä¼šç”±å¼€å‘è€…è‡ªå·±å®ç°ï¼Œä¸»è¦ä½œç”¨æ˜¯å°†æœ‰@CompoentScanæ³¨è§£çš„ç±»ä¼ é€’ç»™springç”¨æ¥åˆ›å»ºä¸Šä¸‹æ–‡ã€‚è¦æ³¨æ„çš„æ˜¯è¿™ä¸ªä¸Šä¸‹æ–‡å¯¹è±¡æ˜¯springçš„ä¸Šä¸‹æ–‡å¯¹è±¡ï¼Œä¸æ˜¯sprngmvcçš„ä¸Šä¸‹æ–‡ï¼Œæ‰€ä»¥åº”è¯¥æ’é™¤controllerå¯¹è±¡ã€‚</p>
<pre><code class="java">public abstract class AbstractAnnotationConfigDispatcherServletInitializer
        extends AbstractDispatcherServletInitializer {

    @Override
    @Nullable
    protected WebApplicationContext createRootApplicationContext() {
        Class&lt;?&gt;[] configClasses = getRootConfigClasses();
        if (!ObjectUtils.isEmpty(configClasses)) {
            AnnotationConfigWebApplicationContext context = new AnnotationConfigWebApplicationContext();
            context.register(configClasses);
            return context;
        }
        else {
            return null;
        }
    }

    @Override
    protected WebApplicationContext createServletApplicationContext() {
        AnnotationConfigWebApplicationContext context = new AnnotationConfigWebApplicationContext();
        Class&lt;?&gt;[] configClasses = getServletConfigClasses();
        if (!ObjectUtils.isEmpty(configClasses)) {
            context.register(configClasses);
        }
        return context;
    }

    @Nullable
    protected abstract Class&lt;?&gt;[] getRootConfigClasses();

    @Nullable
    protected abstract Class&lt;?&gt;[] getServletConfigClasses();

}</code></pre>
<p>ContextLoaderListenerçš„contextInitialized()æ–¹æ³•ä¼šåœ¨servletå®¹å™¨å¯åŠ¨æ—¶è°ƒç”¨ã€‚contextInitialized()å°†è°ƒç”¨initWebApplicationContext()è°ƒç”¨springä¸Šä¸‹æ–‡åŠ è½½çš„æ ¸å¿ƒæ–¹æ³•refresh()ã€‚</p>
<pre><code class="java">public class ContextLoaderListener extends ContextLoader implements ServletContextListener {

    public ContextLoaderListener() {
    }

    public ContextLoaderListener(WebApplicationContext context) {
        super(context);
    }

    @Override
    public void contextInitialized(ServletContextEvent event) {
        initWebApplicationContext(event.getServletContext());
    }

    @Override
    public void contextDestroyed(ServletContextEvent event) {
        closeWebApplicationContext(event.getServletContext());
        ContextCleanupListener.cleanupAttributes(event.getServletContext());
    }
}</code></pre>
<h4 id="AbstractDispatcherServletInitializerç±»"><a href="#AbstractDispatcherServletInitializerç±»" class="headerlink" title="AbstractDispatcherServletInitializerç±»"></a>AbstractDispatcherServletInitializerç±»</h4><p>AbstractDispatcherServletInitializerçš„onStartup()æ–¹æ³•ä¸­ï¼Œä¼šåˆ›å»ºsprngmvcçš„ä¸Šä¸‹æ–‡å¯¹è±¡è·ŸDispatcherServletå¯¹è±¡ã€‚Serlvetå®¹å™¨åœ¨å¯åŠ¨æ—¶ä¼šè°ƒç”¨DispatcherServletçš„init()æ–¹æ³•ï¼Œè¯¥æ–¹æ³•ç»§æ‰¿è‡ªçˆ¶ç±»HttpServletBeanï¼Œinit()æ–¹æ³•æœ€ç»ˆä¼šè°ƒç”¨åˆ°springmvcä¸Šä¸‹æ–‡çš„refresh()æ–¹æ³•ã€‚springmvcä¸Šä¸‹æ–‡å¯¹è±¡åˆå§‹åŒ–æ—¶ä¼šå…ˆè·å–springçš„ä¸Šä¸‹æ–‡å¯¹è±¡ï¼Œç„¶åå°†å…¶è®¾ç½®ä¸ºçˆ¶å®¹å™¨ï¼Œä¹‹ågetBean()æ“ä½œä¸­ä¼šä¼˜å…ˆä»çˆ¶å®¹å™¨ä¸­è·å–beanã€‚</p>
<pre><code class="java">public abstract class AbstractDispatcherServletInitializer extends AbstractContextLoaderInitializer {

   public static final String DEFAULT_SERVLET_NAME = &quot;dispatcher&quot;;

   @Override
   public void onStartup(ServletContext servletContext) throws ServletException {
      super.onStartup(servletContext);
      //æ³¨å†ŒDispatcherServlet
      registerDispatcherServlet(servletContext);
   }

   protected void registerDispatcherServlet(ServletContext servletContext) {
      String servletName = getServletName();
      Assert.hasLength(servletName, &quot;getServletName() must not return null or empty&quot;);

      //åˆ›å»ºspringmvcçš„ä¸Šä¸‹æ–‡ï¼Œæ³¨å†Œäº†MvcContainerç±»
      WebApplicationContext servletAppContext = createServletApplicationContext();
      Assert.notNull(servletAppContext, &quot;createServletApplicationContext() must not return null&quot;);

      //åˆ›å»ºDispatcherServlet
      FrameworkServlet dispatcherServlet = createDispatcherServlet(servletAppContext);
      Assert.notNull(dispatcherServlet, &quot;createDispatcherServlet(WebApplicationContext) must not return null&quot;);
      dispatcherServlet.setContextInitializers(getServletApplicationContextInitializers());

      ServletRegistration.Dynamic registration = servletContext.addServlet(servletName, dispatcherServlet);
      if (registration == null) {
         throw new IllegalStateException(&quot;Failed to register servlet with name &#39;&quot; + servletName + &quot;&#39;. &quot; +
               &quot;Check if there is another servlet registered under the same name.&quot;);
      }

      /*
      * å¦‚æœè¯¥å…ƒç´ çš„å€¼ä¸ºè´Ÿæ•°æˆ–è€…æ²¡æœ‰è®¾ç½®ï¼Œåˆ™å®¹å™¨ä¼šå½“Servletè¢«è¯·æ±‚æ—¶å†åŠ è½½ã€‚
         å¦‚æœå€¼ä¸ºæ­£æ•´æ•°æˆ–è€…0æ—¶ï¼Œè¡¨ç¤ºå®¹å™¨åœ¨åº”ç”¨å¯åŠ¨æ—¶å°±åŠ è½½å¹¶åˆå§‹åŒ–è¿™ä¸ªservletï¼Œ
         å€¼è¶Šå°ï¼Œservletçš„ä¼˜å…ˆçº§è¶Šé«˜ï¼Œå°±è¶Šå…ˆè¢«åŠ è½½
      * */
      registration.setLoadOnStartup(1);
      registration.addMapping(getServletMappings());
      registration.setAsyncSupported(isAsyncSupported());

      Filter[] filters = getServletFilters();
      if (!ObjectUtils.isEmpty(filters)) {
         for (Filter filter : filters) {
            registerServletFilter(servletContext, filter);
         }
      }

      customizeRegistration(registration);
   }

   protected String getServletName() {
      return DEFAULT_SERVLET_NAME;
   }

   protected abstract WebApplicationContext createServletApplicationContext();

   protected FrameworkServlet createDispatcherServlet(WebApplicationContext servletAppContext) {
      return new DispatcherServlet(servletAppContext);
   }

   @Nullable
   protected ApplicationContextInitializer&lt;?&gt;[] getServletApplicationContextInitializers() {
      return null;
   }

   protected abstract String[] getServletMappings();

   @Nullable
   protected Filter[] getServletFilters() {
      return null;
   }

   protected FilterRegistration.Dynamic registerServletFilter(ServletContext servletContext, Filter filter) {
      String filterName = Conventions.getVariableName(filter);
      Dynamic registration = servletContext.addFilter(filterName, filter);

      if (registration == null) {
         int counter = 0;
         while (registration == null) {
            if (counter == 100) {
               throw new IllegalStateException(&quot;Failed to register filter with name &#39;&quot; + filterName + &quot;&#39;. &quot; +
                     &quot;Check if there is another filter registered under the same name.&quot;);
            }
            registration = servletContext.addFilter(filterName + &quot;#&quot; + counter, filter);
            counter++;
         }
      }

      registration.setAsyncSupported(isAsyncSupported());
      registration.addMappingForServletNames(getDispatcherTypes(), false, getServletName());
      return registration;
   }

   private EnumSet&lt;DispatcherType&gt; getDispatcherTypes() {
      return (isAsyncSupported() ?
            EnumSet.of(DispatcherType.REQUEST, DispatcherType.FORWARD, DispatcherType.INCLUDE, DispatcherType.ASYNC) :
            EnumSet.of(DispatcherType.REQUEST, DispatcherType.FORWARD, DispatcherType.INCLUDE));
   }

   protected boolean isAsyncSupported() {
      return true;
   }

   protected void customizeRegistration(ServletRegistration.Dynamic registration) {
   }
}</code></pre>
<h3 id="springmvc-xmlçš„æ›¿æ¢"><a href="#springmvc-xmlçš„æ›¿æ¢" class="headerlink" title="springmvc.xmlçš„æ›¿æ¢"></a>springmvc.xmlçš„æ›¿æ¢</h3><pre><code class="xml">&lt;mvc:annotation-driven&gt;
    &lt;mvc:message-converters register-defaults=&quot;true&quot;&gt;
        &lt;bean class=&quot;org.springframework.http.converter.StringHttpMessageConverter&quot;&gt;
            &lt;property name=&quot;supportedMediaTypes&quot; value = &quot;text/plain;charset=UTF-8&quot; /&gt;
        &lt;/bean&gt;
    &lt;/mvc:message-converters&gt;
&lt;/mvc:annotation-driven&gt;</code></pre>
<p>è¿™ä¸ªæ ‡ç­¾æ€»è¿‡åšäº†ä¸‰ä»¶äº‹æƒ…ï¼š</p>
<ol>
<li>åˆ›å»ºHandlerMappingå¯¹è±¡</li>
<li>åˆ›å»ºHandlerAdapterå¯¹è±¡</li>
<li>åˆ›å»ºæ¶ˆæ¯è½¬æ¢å™¨åŠ å…¥åˆ°HandlerAdapterä¸­</li>
</ol>
<p>@EnableWebMvcæ ‡ç­¾å¯ä»¥å®Œæˆspringmvc.xmlä¸­çš„æ‰€æœ‰å·¥ä½œã€‚</p>
<p>è¯¥æ³¨è§£ä¸­ä¼šå¼•å…¥DelegatingWebMvcConfigurationç±»ï¼Œè¯¥ç±»ä¼šé€šè¿‡@Autowiredè·å–åˆ°æ‰€æœ‰WebMvcConfigureræ¥å£çš„å®ç°ç±»ã€‚è¯¥ç±»çš„çˆ¶ç±»WebMvcConfigurationSupportç±»å°±æ˜¯æ¯”è¾ƒæ ¸å¿ƒçš„ç±»ï¼Œä¼šæ›¿ä»£xmlè¿›è¡Œå®Œæˆæ‰€æœ‰ç»„ä»¶çš„æ³¨å†Œã€‚è¯¥ç±»ååˆ†åºå¤§ï¼Œä¸»è¦æ˜¯é€šè¿‡@Beançš„æ–¹å¼å°†ç»„ä»¶æ³¨å†Œåˆ°ä¸Šä¸‹æ–‡å¯¹è±¡ä¸­ã€‚æ­¤å¤„æˆ‘ä»¬åªåˆ†æRequestMappingHandlerMappingçš„æ³¨å†Œï¼Œå…¶ä»–ç»„ä»¶çš„æ³¨å†Œçš„æµç¨‹ä¹ŸåŸºæœ¬ç›¸åŒã€‚</p>
<p>è¯¥ç±»çš„requestMappingHandleMapping()æ–¹æ³•è¿›è¡ŒRequestMappingHandlerMappingçš„æ³¨å†Œï¼Œè¯¥æ–¹æ³•ä¼šé€šè¿‡è°ƒç”¨getInterceptors()æ–¹æ³•è·å–æ‹¦æˆªå™¨ï¼Œç„¶åè®¾ç½®è¿›å»ï¼Œä¹‹åè®¾ç½®çš„å±æ€§è¿˜åŒ…æ‹¬è·¨åŸŸç­‰å±æ€§ï¼Œè¿™é‡Œç€é‡åˆ†ægetInterceptors()æ–¹æ³•ï¼Œå…¶ä»–å±æ€§çš„è·å–æ–¹å¼ä¹ŸåŸºæœ¬ç›¸åŒã€‚</p>
<pre><code class="java">@Bean
public RequestMappingHandlerMapping requestMappingHandlerMapping() {
   RequestMappingHandlerMapping mapping = createRequestMappingHandlerMapping();
   mapping.setOrder(0);
   mapping.setInterceptors(getInterceptors());
   mapping.setContentNegotiationManager(mvcContentNegotiationManager());
   mapping.setCorsConfigurations(getCorsConfigurations());

   PathMatchConfigurer configurer = getPathMatchConfigurer();

   Boolean useSuffixPatternMatch = configurer.isUseSuffixPatternMatch();
   if (useSuffixPatternMatch != null) {
      mapping.setUseSuffixPatternMatch(useSuffixPatternMatch);
   }
   Boolean useRegisteredSuffixPatternMatch = configurer.isUseRegisteredSuffixPatternMatch();
   if (useRegisteredSuffixPatternMatch != null) {
      mapping.setUseRegisteredSuffixPatternMatch(useRegisteredSuffixPatternMatch);
   }
   Boolean useTrailingSlashMatch = configurer.isUseTrailingSlashMatch();
   if (useTrailingSlashMatch != null) {
      mapping.setUseTrailingSlashMatch(useTrailingSlashMatch);
   }

   UrlPathHelper pathHelper = configurer.getUrlPathHelper();
   if (pathHelper != null) {
      mapping.setUrlPathHelper(pathHelper);
   }
   PathMatcher pathMatcher = configurer.getPathMatcher();
   if (pathMatcher != null) {
      mapping.setPathMatcher(pathMatcher);
   }
   Map&lt;String, Predicate&lt;Class&lt;?&gt;&gt;&gt; pathPrefixes = configurer.getPathPrefixes();
   if (pathPrefixes != null) {
      mapping.setPathPrefixes(pathPrefixes);
   }

   return mapping;
}</code></pre>
<p>getInterceptors()æ–¹æ³•</p>
<p>è¯¥æ–¹æ³•ä¼šè°ƒç”¨å­ç±»DelegatingWebMvcConfigurationçš„addInterceptors()æ–¹æ³•ï¼Œè¯¥ç±»ä¸­ä¼šé€šè¿‡ä¾èµ–æ³¨å…¥çš„æ–¹å¼è·å–åˆ°æ‰€æœ‰å®ç°WebMvcConfigureræ¥å£çš„ç±»ï¼Œç„¶åè°ƒç”¨å…¶addInterceptors()æ–¹æ³•æŠŠæˆ‘ä»¬è‡ªå·±å®šä¹‰çš„Interceptorä¼ é€’è¿›å»ã€‚</p>
<pre><code class="java">@Autowired(required = false)
public void setConfigurers(List&lt;WebMvcConfigurer&gt; configurers) {
   if (!CollectionUtils.isEmpty(configurers)) {
      this.configurers.addWebMvcConfigurers(configurers);
   }
}

protected void addInterceptors(InterceptorRegistry registry) {
   this.configurers.addInterceptors(registry);
}</code></pre>
<h2 id="DispatcherServletä¸­çš„ç»„ä»¶åˆå§‹åŒ–"><a href="#DispatcherServletä¸­çš„ç»„ä»¶åˆå§‹åŒ–" class="headerlink" title="DispatcherServletä¸­çš„ç»„ä»¶åˆå§‹åŒ–"></a>DispatcherServletä¸­çš„ç»„ä»¶åˆå§‹åŒ–</h2><p>DispatcherServletçš„çˆ¶ç±»FrameworkServletä¸­æœ‰ä¸€ä¸ªç§æœ‰ç±»ContextRefreshListenerï¼Œè¿™ä¸ªç§æœ‰ç±»ç»§æ‰¿äº†springçš„ç›‘å¬å™¨ApplicationListener&lt;ContextRefreshedEvent&gt;ï¼Œspringå®Œæˆåˆå§‹åŒ–ä¼šå‘å¸ƒä¸€ä¸ªContextRefreshedEventç±»å‹çš„äº‹ä»¶æ¥è§¦å‘è¿™ä¸ªç›‘å¬å™¨ï¼Œç›‘å¬å™¨ç›‘å¬åˆ°è¿™ä¸ªäº‹ä»¶åä¼šåœ¨çº¿ç¨‹ä¸­è°ƒç”¨ç§æœ‰ç±»çš„onApplicationEvent()æ–¹æ³•ã€‚</p>
<p>onApplicationEvent()æ–¹æ³•ä¼šå†è°ƒç”¨FrameworkServletç±»ä¸­çš„onApplicationEvent()æ–¹æ³•ï¼Œåœ¨è¿™ä¸ªæ–¹æ³•ä¸­ä¼šè°ƒç”¨onRefresh()æ–¹æ³•ã€‚</p>
<pre><code class="java">private class ContextRefreshListener implements ApplicationListener&lt;ContextRefreshedEvent&gt; {

   @Override
   public void onApplicationEvent(ContextRefreshedEvent event) {
      FrameworkServlet.this.onApplicationEvent(event);
   }
}</code></pre>
<p>onRefresh()æ–¹æ³•ä¼šè°ƒç”¨åˆ°å­ç±»DispatcherServletä¸­çš„æ–¹æ³•ï¼Œæœ€ç»ˆè°ƒç”¨åˆ°initStrategies()æ–¹æ³•ã€‚å®ŒæˆDispatcherServletç»„ä»¶çš„è®¾ç½®ã€‚</p>
<pre><code class="java">protected void initStrategies(ApplicationContext context) {
   initMultipartResolver(context);
   initLocaleResolver(context);
   initThemeResolver(context);
   initHandlerMappings(context);
   initHandlerAdapters(context);
   initHandlerExceptionResolvers(context);
   initRequestToViewNameTranslator(context);
   initViewResolvers(context);
   initFlashMapManager(context);
}</code></pre>
<p>initHandlerMappings()æ–¹æ³•ä¼šä»ä¸Šä¸‹æ–‡ä¸­è·å–åˆ°HandlerMappingå¯¹è±¡ï¼Œç„¶åè¿›è¡Œæ’åºã€‚å¦‚æœæ²¡æœ‰é…ç½®HandlerMappingå¯¹è±¡ï¼Œå°±ä¼šåŠ è½½é»˜è®¤çš„HandlerMappinigå¯¹è±¡ã€‚æœ€åè®¾ç½®åˆ°handlerMappingså±æ€§ä¸­ã€‚</p>
<pre><code class="java">private void initHandlerMappings(ApplicationContext context) {
   this.handlerMappings = null;

   if (this.detectAllHandlerMappings) {
      // Find all HandlerMappings in the ApplicationContext, including ancestor contexts.
      Map&lt;String, HandlerMapping&gt; matchingBeans =
            BeanFactoryUtils.beansOfTypeIncludingAncestors(context, HandlerMapping.class, true, false);
      if (!matchingBeans.isEmpty()) {
         this.handlerMappings = new ArrayList&lt;&gt;(matchingBeans.values());
         // We keep HandlerMappings in sorted order.
         AnnotationAwareOrderComparator.sort(this.handlerMappings);
      }
   }
   else {
      try {
         HandlerMapping hm = context.getBean(HANDLER_MAPPING_BEAN_NAME, HandlerMapping.class);
         this.handlerMappings = Collections.singletonList(hm);
      }
      catch (NoSuchBeanDefinitionException ex) {
         // Ignore, we&#39;ll add a default HandlerMapping later.
      }
   }

   // Ensure we have at least one HandlerMapping, by registering
   // a default HandlerMapping if no other mappings are found.
   if (this.handlerMappings == null) {
      this.handlerMappings = getDefaultStrategies(context, HandlerMapping.class);
      if (logger.isTraceEnabled()) {
         logger.trace(&quot;No HandlerMappings declared for servlet &#39;&quot; + getServletName() +
               &quot;&#39;: using default strategies from DispatcherServlet.properties&quot;);
      }
   }
}</code></pre>
<h2 id="å»ºç«‹è·¯å¾„ä¸æ–¹æ³•çš„æ˜ å°„å…³ç³»"><a href="#å»ºç«‹è·¯å¾„ä¸æ–¹æ³•çš„æ˜ å°„å…³ç³»" class="headerlink" title="å»ºç«‹è·¯å¾„ä¸æ–¹æ³•çš„æ˜ å°„å…³ç³»"></a>å»ºç«‹è·¯å¾„ä¸æ–¹æ³•çš„æ˜ å°„å…³ç³»</h2><p>springmvcä¼šåœ¨åˆå§‹åŒ–æ—¶å®Œæˆè·¯å¾„ä¸æ–¹æ³•çš„æ˜ å°„ï¼Œå…·ä½“æ˜¯é€šè¿‡AbstractHandlerMethodMappingç±»çš„initHandlerMethods()æ–¹æ³•æ¥å®Œæˆã€‚AbstractHandlerMethodMappingç±»å®ç°äº†InitializingBeanæ¥å£ï¼Œspringåœ¨Beanå®ä¾‹åŒ–å¹¶å®ŒæˆIOCã€DIä¹‹åè°ƒç”¨è¿™ä¸ªæ¥å£çš„afterPropertiesSet()æ–¹æ³•ã€‚AbstractHandlerMethodMappingç±»çš„afterPropertiesSet()æ–¹æ³•ä¸­è°ƒç”¨äº†initHandlerMethods()æ–¹æ³•ã€‚initHandlerMethods()æ–¹æ³•ä¼šè°ƒç”¨processCandidateBean()æ–¹æ³•åˆ›å»ºurlè·Ÿmethodçš„æ˜ å°„å…³ç³»ã€‚</p>
<pre><code class="java">protected void initHandlerMethods() {
   for (String beanName : getCandidateBeanNames()) {
      if (!beanName.startsWith(SCOPED_TARGET_NAME_PREFIX)) {
         processCandidateBean(beanName);
      }
   }
   handlerMethodsInitialized(getHandlerMethods());
}</code></pre>
<p>processCandidateBean()æ–¹æ³•ä¼šåˆ¤æ–­ç±»ä¸Šé¢æ˜¯å¦æœ‰@Controllerã€@RequestMappingæ³¨è§£ï¼Œå¦‚æœæœ‰ä¼šè°ƒç”¨detectHandlerMethods()æ–¹æ³•å»ºç«‹urlè·Ÿmethodçš„æ˜ å°„å…³ç³»ã€‚</p>
<pre><code class="java">protected void processCandidateBean(String beanName) {
   Class&lt;?&gt; beanType = null;
   try {
      beanType = obtainApplicationContext().getType(beanName);
   }
   catch (Throwable ex) {
      // An unresolvable bean type, probably from a lazy bean - let&#39;s ignore it.
      if (logger.isTraceEnabled()) {
         logger.trace(&quot;Could not resolve type for bean &#39;&quot; + beanName + &quot;&#39;&quot;, ex);
      }
   }
   //å¦‚æœç±»ä¸Šé¢æœ‰@Controlleræ³¨è§£æˆ–è€…@RequestMappingæ³¨è§£
   if (beanType != null &amp;&amp; isHandler(beanType)) {
      //å»ºç«‹uriå’Œmethodçš„æ˜ å°„å…³ç³»
      detectHandlerMethods(beanName);
   }
}</code></pre>
<p>detectHandlerMethods()æ–¹æ³•é¦–å…ˆä¼šè·å–æ–¹æ³•å¯¹è±¡å’Œæ–¹æ³•ä¸Šçš„@RequestMappingæ³¨è§£å±æ€§ï¼Œç„¶åå‘selectMethods()æ–¹æ³•ä¸­ä¼ å…¥getMappingForMethod()æ–¹æ³•ç”¨æ¥å°è£…æ˜ å°„å…³ç³»ï¼ŒMap&lt;Method, T&gt;ä¸­çš„Tå°±æ˜¯å±æ€§çš„å°è£…å¯¹è±¡ã€‚æœ€åè°ƒç”¨registerHandlerMethod()æ–¹æ³•å»ºç«‹æ˜ å°„å…³ç³»ã€‚</p>
<pre><code class="java">protected void detectHandlerMethods(Object handler) {
   Class&lt;?&gt; handlerType = (handler instanceof String ?
         obtainApplicationContext().getType((String) handler) : handler.getClass());

   if (handlerType != null) {
      Class&lt;?&gt; userType = ClassUtils.getUserClass(handlerType);

      //è·å–æ–¹æ³•å¯¹è±¡å’Œæ–¹æ³•ä¸Šé¢çš„@RequestMappingæ³¨è§£å±æ€§å°è£…å¯¹è±¡çš„æ˜ å°„å…³ç³»
      Map&lt;Method, T&gt; methods = MethodIntrospector.selectMethods(userType,
            (MethodIntrospector.MetadataLookup&lt;T&gt;) method -&gt; {
               try {
                  return getMappingForMethod(method, userType);
               }
               catch (Throwable ex) {
                  throw new IllegalStateException(&quot;Invalid mapping on handler class [&quot; +
                        userType.getName() + &quot;]: &quot; + method, ex);
               }
            });
      if (logger.isTraceEnabled()) {
         logger.trace(formatMappings(userType, methods));
      }
      methods.forEach((method, mapping) -&gt; {
         Method invocableMethod = AopUtils.selectInvocableMethod(method, userType);
         //å»ºç«‹uriå’Œæ–¹æ³•çš„å„ç§æ˜ å°„å…³ç³»ï¼Œåæ­£ä¸€æ¡ï¼Œæ ¹æ®uriè¦èƒ½å¤Ÿæ‰¾åˆ°methodå¯¹è±¡
         registerHandlerMethod(handler, invocableMethod, mapping);
      });
   }
}</code></pre>
<p>selectMethods()æ–¹æ³•é¦–å…ˆä¼šè·å–ç±»ä¸Šçš„æ‰€æœ‰methodï¼Œç„¶ååˆ¤æ–­methodä¸Šé¢æ˜¯å¦æœ‰@RequestMappingæ³¨è§£ï¼Œå¦‚æœæœ‰è°ƒç”¨å¤–å±‚ä¼ å…¥çš„getMappingForMethod()æ–¹æ³•å°è£…æˆå¯¹è±¡è¿”å›ã€‚</p>
<pre><code class="java">public static &lt;T&gt; Map&lt;Method, T&gt; selectMethods(Class&lt;?&gt; targetType, final MetadataLookup&lt;T&gt; metadataLookup) {
   final Map&lt;Method, T&gt; methodMap = new LinkedHashMap&lt;&gt;();
   Set&lt;Class&lt;?&gt;&gt; handlerTypes = new LinkedHashSet&lt;&gt;();
   Class&lt;?&gt; specificHandlerType = null;

   if (!Proxy.isProxyClass(targetType)) {
      specificHandlerType = ClassUtils.getUserClass(targetType);
      handlerTypes.add(specificHandlerType);
   }
   handlerTypes.addAll(ClassUtils.getAllInterfacesForClassAsSet(targetType));

   for (Class&lt;?&gt; currentHandlerType : handlerTypes) {
      final Class&lt;?&gt; targetClass = (specificHandlerType != null ? specificHandlerType : currentHandlerType);

      //å¾ªç¯currentHandlerTypeç±»çš„æ‰€æœ‰æ–¹æ³•
      ReflectionUtils.doWithMethods(currentHandlerType, method -&gt; {
         Method specificMethod = ClassUtils.getMostSpecificMethod(method, targetClass);
         //åˆ¤æ–­æ–¹æ³•ä¸Šé¢æ˜¯å¦æœ‰@RequestMappingæ³¨è§£ï¼Œå¦‚æœæœ‰å°è£…å¯¹è±¡è¿”å›
         T result = metadataLookup.inspect(specificMethod);
         if (result != null) {
            Method bridgedMethod = BridgeMethodResolver.findBridgedMethod(specificMethod);
            if (bridgedMethod == specificMethod || metadataLookup.inspect(bridgedMethod) == null) {
               //å»ºç«‹æ–¹æ³•å¯¹è±¡å’Œæ³¨è§£å°è£…å¯¹è±¡çš„æ˜ å°„å…³ç³»
               methodMap.put(specificMethod, result);
            }
         }
      }, ReflectionUtils.USER_DECLARED_METHODS);
   }

   return methodMap;
}</code></pre>
<p>getMappingForMethod()æ–¹æ³•é¦–å…ˆä¼šè°ƒç”¨createRequestMappingInfo()æ–¹æ³•å°è£…æ³¨è§£ä¿¡æ¯ï¼Œç„¶åå°†ç±»ä¸Šçš„@RequestMappingæ³¨è§£ä¹Ÿå°è£…æˆå¯¹è±¡ï¼Œæœ€åå°†ä¸¤ä¸ªå¯¹è±¡ç»“åˆåè¿”å›ã€‚</p>
<pre><code class="java">protected RequestMappingInfo getMappingForMethod(Method method, Class&lt;?&gt; handlerType) {
   //å¯»æ‰¾æœ‰@RequestMappingæ³¨è§£çš„æ–¹æ³•ï¼Œç„¶åæ³¨è§£é‡Œé¢çš„å†…å®¹å°è£…æˆå¯¹è±¡
   RequestMappingInfo info = createRequestMappingInfo(method);
   if (info != null) {
      //ç±»ä¸Šé¢çš„@RequestMappingæ³¨è§£ä¹Ÿå°è£…æˆå¯¹è±¡
      RequestMappingInfo typeInfo = createRequestMappingInfo(handlerType);
      if (typeInfo != null) {
         //æŠŠæ–¹æ³•ä¸Šé¢çš„æ³¨è§£å±æ€§ç»“åˆåˆ°ç±»ä¸Šé¢çš„RequestMappingInfoå¯¹è±¡ä¸­
         info = typeInfo.combine(info);
      }
      String prefix = getPathPrefix(handlerType);
      if (prefix != null) {
         info = RequestMappingInfo.paths(prefix).build().combine(info);
      }
   }
   return info;
}</code></pre>
<p>registerHandlerMethod()æ–¹æ³•ä¸­çš„ä¸»è¦æ–¹æ³•æ˜¯register()ï¼Œè¯¥æ–¹æ³•é¦–å…ˆä¼šè°ƒç”¨createHandlerMethod()æ–¹æ³•åˆ›å»ºHandlerMethodå¯¹è±¡ï¼Œè¯¥å¯¹è±¡ä¸­å°è£…äº†ç±»è·Ÿæ–¹æ³•ä¿¡æ¯ï¼Œå¦‚æœæ­¤æ—¶ç±»è¿˜æ²¡æœ‰è¢«å®ä¾‹åŒ–ï¼Œå°±ä¼šå°†beanNameè·ŸbeanFactoryä¸€èµ·å°è£…è¿›å»ï¼Œå¦‚æœç±»å·²ç»å®ä¾‹åŒ–å°±åªä¼šå°è£…å®ä¾‹åŒ–ä¹‹åçš„beanã€‚ç„¶åå°†uriè·ŸHandlerMethodæ”¾åˆ°mappingLookupä¸­ï¼Œurlè·ŸRequestMappingInfoä¿¡æ¯æ”¾å…¥urlLookupä¸­ã€‚</p>
<pre><code class="java">public void register(T mapping, Object handler, Method method) {
   this.readWriteLock.writeLock().lock();
   try {
      //åˆ›å»ºHandlerMethodå¯¹è±¡ï¼Œå…¶å®
      HandlerMethod handlerMethod = createHandlerMethod(handler, method);
      //æ£€éªŒæ˜¯å¦å”¯ä¸€
      assertUniqueMethodMapping(handlerMethod, mapping);
      //å»ºç«‹RequestMappingInfoå¯¹è±¡å’ŒhandlerMethodçš„æ˜ å°„å…³ç³»
      this.mappingLookup.put(mapping, handlerMethod);

      List&lt;String&gt; directUrls = getDirectUrls(mapping);
      for (String url : directUrls) {
         //å»ºç«‹urlå’ŒRequestMappingInfoæ˜ å°„å…³ç³»
         this.urlLookup.add(url, mapping);
      }

      String name = null;
      if (getNamingStrategy() != null) {
         name = getNamingStrategy().getName(handlerMethod, mapping);
         addMappingName(name, handlerMethod);
      }

      //åˆ¤æ–­methodä¸Šæ˜¯å¦æœ‰CrossOriginæ³¨è§£ï¼ŒæŠŠæ³¨è§£é‡Œé¢çš„å±æ€§å°è£…æˆCorsConfigurationï¼Œè¿™ä¸ªæ˜¯åšè·¨åŸŸè®¿é—®æ§åˆ¶çš„
      CorsConfiguration corsConfig = initCorsConfiguration(handler, method, mapping);
      if (corsConfig != null) {
         //å»ºç«‹æ˜ å°„å…³ç³»
         this.corsLookup.put(handlerMethod, corsConfig);
      }

      this.registry.put(mapping, new MappingRegistration&lt;&gt;(mapping, handlerMethod, directUrls, name));
   }
   finally {
      this.readWriteLock.writeLock().unlock();
   }
}</code></pre>

            </div>
            <hr>
            <div>
              <p>
                
                  <span>
                <i class="iconfont icon-inbox"></i>
                    
                      <a class="hover-with-bg" href="/categories/Spring%E6%BA%90%E7%A0%81%E8%A7%A3%E6%9E%90/">Springæºç è§£æ</a>
                      &nbsp;
                    
                  </span>&nbsp;&nbsp;
                
                
                  <span>
                <i class="iconfont icon-tag"></i>
                    
                      <a class="hover-with-bg" href="/tags/%E6%BA%90%E7%A0%81%E8%A7%A3%E6%9E%90/">æºç è§£æ</a>
                    
                      <a class="hover-with-bg" href="/tags/spring/">spring</a>
                    
                      <a class="hover-with-bg" href="/tags/springmvc/">springmvc</a>
                    
                  </span>
                
              </p>
              
                <p class="note note-warning">æœ¬åšå®¢æ‰€æœ‰æ–‡ç« é™¤ç‰¹åˆ«å£°æ˜å¤–ï¼Œå‡é‡‡ç”¨ <a href="https://zh.wikipedia.org/wiki/Wikipedia:CC_BY-SA_3.0%E5%8D%8F%E8%AE%AE%E6%96%87%E6%9C%AC" target="_blank" rel="nofollow noopener noopener">CC BY-SA 3.0åè®®</a> ã€‚è½¬è½½è¯·æ³¨æ˜å‡ºå¤„ï¼</p>
              
              
                <div class="post-prevnext row">
                  <div class="post-prev col-6">
                    
                    
                      <a href="/2020/04/21/springmvc%E7%9A%84%E8%AF%B7%E6%B1%82%E5%93%8D%E5%BA%94/">
                        <i class="fa fa-chevron-left"></i>
                        <span class="hidden-mobile">springmvcçš„è¯·æ±‚å“åº”</span>
                        <span class="visible-mobile">ä¸Šä¸€ç¯‡</span>
                      </a>
                    
                  </div>
                  <div class="post-next col-6">
                    
                    
                      <a href="/2020/04/20/spring%E7%9A%84%E7%BC%93%E5%AD%98%E5%88%87%E9%9D%A2%E5%92%8C%E5%BC%82%E6%AD%A5%E5%88%87%E9%9D%A2/">
                        <span class="hidden-mobile">springçš„ç¼“å­˜åˆ‡é¢å’Œå¼‚æ­¥åˆ‡é¢</span>
                        <span class="visible-mobile">ä¸‹ä¸€ç¯‡</span>
                        <i class="fa fa-chevron-right"></i>
                      </a>
                    
                  </div>
                </div>
              
            </div>

              
                <!-- Comments -->
                <div class="comments" id="comments">
                  
                  

                </div>
              
          </div>
        </div>
      </div>
    </div>
    
      <div class="d-none d-lg-block col-lg-2 toc-container" id="toc-ctn">
        <div id="toc-start"></div>
<div id="toc">
  <p class="h5"><i class="far fa-list-alt"></i>&nbsp;ç›®å½•</p>
  <div id="tocbot"></div>
</div>

      </div>
    
  </div>
</div>

<!-- Custom -->


    
  </main>

  
    <a class="z-depth-1" id="scroll-top-button" href="#" role="button">
      <i class="fa fa-chevron-up scroll-top-arrow" aria-hidden="true"></i>
    </a>
  

  
    <div class="modal fade" id="modalSearch" tabindex="-1" role="dialog" aria-labelledby="ModalLabel"
     aria-hidden="true">
  <div class="modal-dialog modal-dialog-scrollable modal-lg" role="document">
    <div class="modal-content">
      <div class="modal-header text-center">
        <h4 class="modal-title w-100 font-weight-bold">æœç´¢</h4>
        <button type="button" id="local-search-close" class="close" data-dismiss="modal" aria-label="Close">
          <span aria-hidden="true">&times;</span>
        </button>
      </div>
      <div class="modal-body mx-3">
        <div class="md-form mb-5">
          <input type="text" id="local-search-input" class="form-control validate">
          <label data-error="x" data-success="v"
                 for="local-search-input">å…³é”®è¯</label>
        </div>
        <div class="list-group" id="local-search-result"></div>
      </div>
    </div>
  </div>
</div>
  

  

  

  <footer class="mt-5">
  <div class="text-center py-3">
    <div>
      <a href="https://hexo.io" target="_blank" rel="nofollow noopener"><b>Hexo</b></a>
      <i class="iconfont icon-love"></i>
      <a href="https://github.com/fluid-dev/hexo-theme-fluid" target="_blank" rel="nofollow noopener"> <b>Fluid</b></a>
    </div>
    
  <div>
    
      <!-- ä¸è’œå­ç»Ÿè®¡PV -->
      
      <span id="busuanzi_container_site_pv" style="display: none">
      æ€»è®¿é—®é‡ <span id="busuanzi_value_site_pv"></span> æ¬¡
    </span>
    
    
      <!-- ä¸è’œå­ç»Ÿè®¡UV -->
      
      <span id="busuanzi_container_site_uv" style="display: none">
      æ€»è®¿å®¢æ•° <span id="busuanzi_value_site_uv"></span> äºº
    </span>
    
  </div>


    

    
  </div>
</footer>

<!-- SCRIPTS -->
<script  src="https://cdn.staticfile.org/jquery/3.4.1/jquery.min.js" ></script>
<script  src="https://cdn.staticfile.org/popper.js/1.16.1/umd/popper.min.js" ></script>
<script  src="https://cdn.staticfile.org/twitter-bootstrap/4.4.1/js/bootstrap.min.js" ></script>
<script  src="https://cdn.staticfile.org/mdbootstrap/4.13.0/js/mdb.min.js" ></script>
<script  src="/js/main.js" ></script>


  <script  src="/js/lazyload.js" ></script>



  
  <script  src="https://cdn.staticfile.org/tocbot/4.10.0/tocbot.min.js" ></script>
  <script>
    $(document).ready(function () {
      var navHeight = $('#navbar').height();
      var toc = $('#toc');
      var boardCtn = $('#board-ctn');
      var boardTop = boardCtn.offset().top;
      var tocLimMax = 2 * boardTop + boardCtn.height();

      $(window).scroll(function () {
        var tocLimMin = $('#toc-start').offset().top - navHeight;
        var scroH = document.body.scrollTop + document.documentElement.scrollTop;

        if (tocLimMin <= scroH && scroH <= tocLimMax) {
          toc.css({
            'display': 'block',
            'position': 'fixed',
            'top': navHeight,
          });
        } else if (scroH <= tocLimMin) {
          toc.css({
            'position': '',
            'top': '',
          });
        } else if (scroH > tocLimMax) {
          toc.css('display', 'none');
        }
      });
      tocbot.init({
        tocSelector: '#tocbot',
        contentSelector: '.post-content',
        headingSelector: 'h1,h2,h3,h4,h5,h6',
        linkClass: 'tocbot-link',
        activeLinkClass: 'tocbot-active-link',
        listClass: 'tocbot-list',
        isCollapsedClass: 'tocbot-is-collapsed',
        collapsibleClass: 'tocbot-is-collapsible',
        scrollSmooth: true,
        headingsOffset: -boardTop
      });
      if ($('.toc-list-item').length > 0) {
        $('#toc > p').css('visibility', 'visible');
      }
      var offset = boardCtn.css('margin-right')
      $('#toc-ctn').css({
        'right': offset
      })
    });
  </script>





  <script defer src="https://cdn.staticfile.org/clipboard.js/2.0.6/clipboard.min.js" ></script>
  <script  src="/js/clipboard-use.js" ></script>



  <script defer src="https://cdn.staticfile.org/smoothscroll/1.4.10/SmoothScroll.min.js" ></script>



  <script defer src="https://busuanzi.ibruce.info/busuanzi/2.3/busuanzi.pure.mini.js" ></script>




<!-- Plugins -->


  

  

  

  

  

  



  <script  src="https://cdn.staticfile.org/prettify/188.0.0/prettify.min.js" ></script>
  <script>
    $(document).ready(function () {
      $('pre').addClass('prettyprint  linenums');
      prettyPrint();
    })
  </script>



  <script  src="https://cdn.staticfile.org/typed.js/2.0.11/typed.min.js" ></script>
  <script>
    var typed = new Typed('#subtitle', {
      strings: [
        '  ',
        "springmvcçš„åˆå§‹åŒ–&nbsp;",
      ],
      cursorChar: "_",
      typeSpeed: 70,
      loop: false,
    });
    typed.stop();
    $(document).ready(function () {
      $(".typed-cursor").addClass("h2");
      typed.start();
    });
  </script>



  <script  src="https://cdn.staticfile.org/anchor-js/4.2.2/anchor.min.js" ></script>
  <script>
    anchors.options = {
      placement: "right",
      visible: "hover",
      
    };
    var el = "h1,h2,h3,h4,h5,h6".split(",");
    var res = [];
    for (item of el) {
      res.push(".markdown-body > " + item)
    }
    anchors.add(res.join(", "))
  </script>



  <script  src="/js/local-search.js" ></script>
  <script>
    var path = "/local-search.xml";
    var inputArea = document.querySelector("#local-search-input");
    inputArea.onclick = function () {
      getSearchFile(path);
      this.onclick = null
    }
  </script>



  <script defer src="https://cdn.staticfile.org/fancybox/3.5.7/jquery.fancybox.min.js" ></script>
  <script>
    $("#post img:not(.no-zoom img, img[no-zoom])").each(
      function () {
        var element = document.createElement("a");
        $(element).attr("data-fancybox", "images");
        $(element).attr("href", $(this).attr("src"));
        $(this).wrap(element);
      }
    );
  </script>





  
  
    <script type="text/javascript">
      //å®šä¹‰è·å–è¯è¯­ä¸‹æ ‡
      var a_idx = 0;
      jQuery(document).ready(function ($) {
        //ç‚¹å‡»bodyæ—¶è§¦å‘äº‹ä»¶
        $("body").click(function (e) {
          //éœ€è¦æ˜¾ç¤ºçš„è¯è¯­
          var a = new Array("å¯Œå¼º", "æ°‘ä¸»", "æ–‡æ˜", "å’Œè°", "è‡ªç”±", "å¹³ç­‰", "å…¬æ­£", "æ³•æ²»", "çˆ±å›½", "æ•¬ä¸š", "è¯šä¿¡", "å‹å–„");
          //è®¾ç½®è¯è¯­ç»™spanæ ‡ç­¾
          var $i = $("<span/>").text(a[a_idx]);
          //ä¸‹æ ‡ç­‰äºåŸæ¥ä¸‹æ ‡+1  ä½™ è¯è¯­æ€»æ•°
          a_idx = (a_idx + 1) % a.length;
          //è·å–é¼ æ ‡æŒ‡é’ˆçš„ä½ç½®ï¼Œåˆ†åˆ«ç›¸å¯¹äºæ–‡æ¡£çš„å·¦å’Œå³è¾¹ç¼˜ã€‚
          //è·å–xå’Œyçš„æŒ‡é’ˆåæ ‡
          var x = e.pageX, y = e.pageY;
          //åœ¨é¼ æ ‡çš„æŒ‡é’ˆçš„ä½ç½®ç»™$iå®šä¹‰çš„spanæ ‡ç­¾æ·»åŠ cssæ ·å¼
          $i.css({
            "z-index": 999,
            "top": y - 20,
            "left": x,
            "position": "absolute",
            "font-weight": "bold",
            "color": rand_color()
          });
          // éšæœºé¢œè‰²
          function rand_color() {
            return "rgb(" + ~~(255 * Math.random()) + "," + ~~(255 * Math.random()) + "," + ~~(255 * Math.random()) + ")"
          }
          //åœ¨bodyæ·»åŠ è¿™ä¸ªæ ‡ç­¾
          $("body").append($i);
          //animate() æ–¹æ³•æ‰§è¡Œ CSS å±æ€§é›†çš„è‡ªå®šä¹‰åŠ¨ç”»ã€‚
          //è¯¥æ–¹æ³•é€šè¿‡CSSæ ·å¼å°†å…ƒç´ ä»ä¸€ä¸ªçŠ¶æ€æ”¹å˜ä¸ºå¦ä¸€ä¸ªçŠ¶æ€ã€‚CSSå±æ€§å€¼æ˜¯é€æ¸æ”¹å˜çš„ï¼Œè¿™æ ·å°±å¯ä»¥åˆ›å»ºåŠ¨ç”»æ•ˆæœã€‚
          //è¯¦æƒ…è¯·çœ‹http://www.w3school.com.cn/jquery/effect_animate.asp
          $i.animate({
            //å°†åŸæ¥çš„ä½ç½®å‘ä¸Šç§»åŠ¨180
            "top": y - 180,
            "opacity": 0
            //1500åŠ¨ç”»çš„é€Ÿåº¦
          }, 1500, function () {
            //æ—¶é—´åˆ°äº†è‡ªåŠ¨åˆ é™¤
            $i.remove();
          });
        });
      })
      ;
    </script>
  








</body>
</html>
