<!DOCTYPE html>
<html lang="zh-CN">





<head>
  <meta charset="UTF-8">
  <link rel="apple-touch-icon" sizes="76x76" href="/img/apple-touch-icon.png">
  <link rel="icon" type="image/png" href="/img/favicon.png">
  <meta name="viewport"
        content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no, shrink-to-fit=no">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  
  <meta name="theme-color" content="#2f4154">
  <meta name="description" content="">
  <meta name="author" content="">
  <meta name="keywords" content="">
  <title>springmvcçš„è¯·æ±‚å“åº” - ğŸğŸŠ&#39;s blog</title>

  <link  rel="stylesheet" href="https://cdn.staticfile.org/font-awesome/5.12.1/css/all.min.css" />
<link  rel="stylesheet" href="https://cdn.staticfile.org/twitter-bootstrap/4.4.1/css/bootstrap.min.css" />
<link  rel="stylesheet" href="https://cdn.staticfile.org/mdbootstrap/4.13.0/css/mdb.min.css" />
<link  rel="stylesheet" href="https://cdn.staticfile.org/github-markdown-css/3.0.1/github-markdown.min.css" />

<link rel="stylesheet" href="//at.alicdn.com/t/font_1067060_qzomjdt8bmp.css">



  <link  rel="stylesheet" href="/lib/prettify/tomorrow-night-eighties.min.css" />

<link  rel="stylesheet" href="/css/main.css" />


  <link defer rel="stylesheet" href="https://cdn.staticfile.org/fancybox/3.5.7/jquery.fancybox.min.css" />


<!-- è‡ªå®šä¹‰æ ·å¼ä¿æŒåœ¨æœ€åº•éƒ¨ -->


<meta name="generator" content="Hexo 4.2.1"></head>


<body>
  <header style="height: 70vh;">
    <nav id="navbar" class="navbar fixed-top  navbar-expand-lg navbar-dark scrolling-navbar">
  <div class="container">
    <a class="navbar-brand"
       href="/">&nbsp;<strong>ğŸğŸŠ's blog</strong>&nbsp;</a>

    <button id="navbar-toggler-btn" class="navbar-toggler" type="button" data-toggle="collapse"
            data-target="#navbarSupportedContent"
            aria-controls="navbarSupportedContent" aria-expanded="false" aria-label="Toggle navigation">
      <div class="animated-icon"><span></span><span></span><span></span></div>
    </button>

    <!-- Collapsible content -->
    <div class="collapse navbar-collapse" id="navbarSupportedContent">
      <ul class="navbar-nav ml-auto text-center">
        
          
          
          
          
          <li class="nav-item">
            <a class="nav-link" href="/">é¦–é¡µ</a>
          </li>
        
          
          
          
          
          <li class="nav-item">
            <a class="nav-link" href="/archives/">å½’æ¡£</a>
          </li>
        
          
          
          
          
          <li class="nav-item">
            <a class="nav-link" href="/categories/">åˆ†ç±»</a>
          </li>
        
          
          
          
          
          <li class="nav-item">
            <a class="nav-link" href="/tags/">æ ‡ç­¾</a>
          </li>
        
          
          
          
          
          <li class="nav-item">
            <a class="nav-link" href="/about">å…³äº</a>
          </li>
        
        
          <li class="nav-item" id="search-btn">
            <a class="nav-link" data-toggle="modal" data-target="#modalSearch">&nbsp;&nbsp;<i
                class="iconfont icon-search"></i>&nbsp;&nbsp;</a>
          </li>
        
      </ul>
    </div>
  </div>
</nav>

    <div class="view intro-2" id="background" parallax=true
         style="background: url('/img/default.png') no-repeat center center;
           background-size: cover;">
      <div class="full-bg-img">
        <div class="mask rgba-black-light flex-center">
          <div class="container text-center white-text fadeInUp">
            <span class="h2" id="subtitle">
              
            </span>

            
              
                <p class="mt-3 post-meta">
                  <i class="fas fa-calendar-alt" aria-hidden="true"></i>
                  æ˜ŸæœŸäºŒ, å››æœˆ 21æ—¥ 2020, 2:50 ä¸‹åˆ
                </p>
              

              <p class="mt-1">
                
                  
                  <span class="post-meta">
                    <i class="far fa-chart-bar"></i>
                    3.2k å­—
                  </span>
                

                
                  
                  <span class="post-meta">
                      <i class="far fa-clock"></i>
                      16 åˆ†é’Ÿ
                  </span>
                

                
                  <!-- ä¸è’œå­ç»Ÿè®¡æ–‡ç« PV -->
                  
                  <span id="busuanzi_container_page_pv" class="post-meta" style="display: none">
                    <i class="far fa-eye" aria-hidden="true"></i>
                    <span id="busuanzi_value_page_pv"></span> æ¬¡
                  </span>
                
              </p>
            
          </div>

          
        </div>
      </div>
    </div>
  </header>

  <main>
    
      

<div class="container-fluid">
  <div class="row">
    <div class="d-none d-lg-block col-lg-2"></div>
    <div class="col-lg-8 nopadding-md">
      <div class="container nopadding-md" id="board-ctn">
        <div class="py-5 z-depth-3" id="board">
          <div class="post-content mx-auto" id="post">
            
              <p
                class="note note-warning">æœ¬æ–‡æœ€åæ›´æ–°äºï¼šæ˜ŸæœŸæ—¥, äº”æœˆ 24æ—¥ 2020, 8:07 æ™šä¸Š</p>
            
            <div class="markdown-body">
              <h2 id="æ ¸å¿ƒæ–¹æ³•çš„å…¥å£"><a href="#æ ¸å¿ƒæ–¹æ³•çš„å…¥å£" class="headerlink" title="æ ¸å¿ƒæ–¹æ³•çš„å…¥å£"></a>æ ¸å¿ƒæ–¹æ³•çš„å…¥å£</h2><p>åœ¨servletè§„èŒƒä¸­ï¼Œå½“è¯·æ±‚åˆ°è¾¾servletæ—¶é¦–å…ˆä¼šè°ƒç”¨service()æ–¹æ³•ï¼Œæ­¤æ–¹æ³•ä¼šæ ¹æ®è¯·æ±‚çš„è¯·æ±‚å¤´è°ƒç”¨ä¸åŒçš„æ–¹æ³•ã€‚</p>
<p>DispatcherServletçˆ¶ç±»FrameworkServletä¸­çš„service()æ–¹æ³•æœ€ç»ˆéƒ½ä¼šè°ƒç”¨åˆ°processRequest()æ–¹æ³•ã€‚é€šè¿‡super.service()æ–¹å¼ä¼šè°ƒç”¨doPost()æˆ–è€…doGet()æ–¹æ³•ã€‚æœ¬ç±»ä¸­çš„doGet()ã€doPost()æ–¹æ³•ä¹Ÿä¼šè°ƒç”¨åˆ°processRequest()æ–¹æ³•ã€‚</p>
<pre><code class="java">   protected void service(HttpServletRequest request, HttpServletResponse response)
      throws ServletException, IOException {

   HttpMethod httpMethod = HttpMethod.resolve(request.getMethod());
   if (httpMethod == HttpMethod.PATCH || httpMethod == null) {
      processRequest(request, response);
   }
   else {
      super.service(request, response);
   }
}

    @Override
    protected final void doGet(HttpServletRequest request, HttpServletResponse response)
            throws ServletException, IOException {

        processRequest(request, response);
    }

    @Override
    protected final void doPost(HttpServletRequest request, HttpServletResponse response)
            throws ServletException, IOException {

        processRequest(request, response);
    }</code></pre>
<p>processRequest()æ–¹æ³•ï¼Œä¸»è¦é€»è¾‘ä¸ºè°ƒç”¨doService()æ–¹æ³•ã€‚</p>
<pre><code class="java">protected final void processRequest(HttpServletRequest request, HttpServletResponse response)
      throws ServletException, IOException {

   long startTime = System.currentTimeMillis();
   Throwable failureCause = null;

   LocaleContext previousLocaleContext = LocaleContextHolder.getLocaleContext();
   LocaleContext localeContext = buildLocaleContext(request);

   RequestAttributes previousAttributes = RequestContextHolder.getRequestAttributes();
   ServletRequestAttributes requestAttributes = buildRequestAttributes(request, response, previousAttributes);

   WebAsyncManager asyncManager = WebAsyncUtils.getAsyncManager(request);
   asyncManager.registerCallableInterceptor(FrameworkServlet.class.getName(), new RequestBindingInterceptor());

   initContextHolders(request, localeContext, requestAttributes);

   try {
      doService(request, response);
   }
   catch (ServletException | IOException ex) {
      failureCause = ex;
      throw ex;
   }
   catch (Throwable ex) {
      failureCause = ex;
      throw new NestedServletException(&quot;Request processing failed&quot;, ex);
   }

   finally {
      resetContextHolders(request, previousLocaleContext, previousAttributes);
      if (requestAttributes != null) {
         requestAttributes.requestCompleted();
      }
      logResult(request, response, failureCause, asyncManager);
      publishRequestHandledEvent(request, response, startTime, failureCause);
   }
}</code></pre>
<p>doService()æ–¹æ³•ï¼Œè¯¥æ–¹æ³•åœ¨DispatcherServletä¸­å®ç°ï¼Œåœ¨è¿›è¡Œä¸€äº›å±æ€§çš„è®¾ç½®åå›åˆ°ç”¨åˆ°æ ¸å¿ƒæ–¹æ³•doDispatch()ã€‚</p>
<pre><code class="java">@Override
protected void doService(HttpServletRequest request, HttpServletResponse response) throws Exception {
   logRequest(request);

   // Keep a snapshot of the request attributes in case of an include,
   // to be able to restore the original attributes after the include.
   Map&lt;String, Object&gt; attributesSnapshot = null;
   if (WebUtils.isIncludeRequest(request)) {
      attributesSnapshot = new HashMap&lt;&gt;();
      Enumeration&lt;?&gt; attrNames = request.getAttributeNames();
      while (attrNames.hasMoreElements()) {
         String attrName = (String) attrNames.nextElement();
         if (this.cleanupAfterInclude || attrName.startsWith(DEFAULT_STRATEGIES_PREFIX)) {
            attributesSnapshot.put(attrName, request.getAttribute(attrName));
         }
      }
   }

   // Make framework objects available to handlers and view objects.
   request.setAttribute(WEB_APPLICATION_CONTEXT_ATTRIBUTE, getWebApplicationContext());
   request.setAttribute(LOCALE_RESOLVER_ATTRIBUTE, this.localeResolver);
   request.setAttribute(THEME_RESOLVER_ATTRIBUTE, this.themeResolver);
   request.setAttribute(THEME_SOURCE_ATTRIBUTE, getThemeSource());

   if (this.flashMapManager != null) {
      FlashMap inputFlashMap = this.flashMapManager.retrieveAndUpdate(request, response);
      if (inputFlashMap != null) {
         request.setAttribute(INPUT_FLASH_MAP_ATTRIBUTE, Collections.unmodifiableMap(inputFlashMap));
      }
      request.setAttribute(OUTPUT_FLASH_MAP_ATTRIBUTE, new FlashMap());
      request.setAttribute(FLASH_MAP_MANAGER_ATTRIBUTE, this.flashMapManager);
   }

   try {
      //è°ƒç”¨åˆ°æ ¸å¿ƒæµç¨‹
      doDispatch(request, response);
   }
   finally {
      if (!WebAsyncUtils.getAsyncManager(request).isConcurrentHandlingStarted()) {
         // Restore the original attribute snapshot, in case of an include.
         if (attributesSnapshot != null) {
            restoreAttributesAfterInclude(request, attributesSnapshot);
         }
      }
   }
}</code></pre>
<h2 id="æ ¸å¿ƒæ–¹æ³•-doDispatch"><a href="#æ ¸å¿ƒæ–¹æ³•-doDispatch" class="headerlink" title="æ ¸å¿ƒæ–¹æ³•-doDispatch()"></a>æ ¸å¿ƒæ–¹æ³•-doDispatch()</h2><p>springmvcçš„è°ƒç”¨å…±åˆ†ä¸ƒä¸ªæ­¥éª¤</p>
<ol>
<li>é€šè¿‡getHandler()æ–¹æ³•è·å–åˆ°HandlerExecutionChainå¯¹è±¡ã€‚</li>
<li>è°ƒç”¨getHanlderAdapter()æ–¹æ³•æ ¹æ®HandlerExecutionChainå¯¹è±¡è·å–åˆ°HandlerAdapterå¯¹è±¡ã€‚</li>
<li>è°ƒç”¨applyPreHandle()æ–¹æ³•è¿›è¡Œå‰ç½®è¿‡æ»¤å™¨æ ¡éªŒï¼Œå¦‚æœä¸ºfalseç›´æ¥è¿”å›ã€‚</li>
<li>handle()æ–¹æ³•è¿›è¡Œå…·ä½“çš„ä¸šåŠ¡é€»è¾‘è°ƒç”¨ã€‚</li>
<li>è°ƒç”¨applyPostHandle()æ–¹æ³•æ‰§è¡Œä¸­ç½®è¿‡æ»¤å™¨æ–¹æ³•ã€‚</li>
<li>è°ƒç”¨processDispatchResult()è¿›è¡Œè§†å›¾æ¸²æŸ“ã€‚</li>
<li>è°ƒç”¨åç½®æ‹¦æˆªå™¨è¿›è¡Œæœ€åçš„æ”¶å°¾å·¥ä½œï¼Œä¸€èˆ¬æ˜¯èµ„æºé‡Šæ”¾ã€‚</li>
</ol>
<pre><code class="java">protected void doDispatch(HttpServletRequest request, HttpServletResponse response) throws Exception {
   HttpServletRequest processedRequest = request;
   HandlerExecutionChain mappedHandler = null;
   boolean multipartRequestParsed = false;

   //å¼‚æ­¥ç®¡ç†
   WebAsyncManager asyncManager = WebAsyncUtils.getAsyncManager(request);

   try {
      ModelAndView mv = null;
      Exception dispatchException = null;

      try {
         //æ–‡ä»¶ä¸Šä¼ 
         processedRequest = checkMultipart(request);
         multipartRequestParsed = (processedRequest != request);

         //è¿™ä¸ªæ–¹æ³•å¾ˆé‡è¦ï¼Œé‡ç‚¹çœ‹
         // Determine handler for the current request.
         mappedHandler = getHandler(processedRequest);
         if (mappedHandler == null) {
            noHandlerFound(processedRequest, response);
            return;
         }

         //è·å–è·ŸHandlerMethodåŒ¹é…çš„HandlerAdapterå¯¹è±¡
         // Determine handler adapter for the current request.
         HandlerAdapter ha = getHandlerAdapter(mappedHandler.getHandler());

         // Process last-modified header, if supported by the handler.
         String method = request.getMethod();
         boolean isGet = &quot;GET&quot;.equals(method);
         if (isGet || &quot;HEAD&quot;.equals(method)) {
            long lastModified = ha.getLastModified(request, mappedHandler.getHandler());
            if (new ServletWebRequest(request, response).checkNotModified(lastModified) &amp;&amp; isGet) {
               return;
            }
         }

         //å‰ç½®è¿‡æ»¤å™¨ï¼Œå¦‚æœä¸ºfalseåˆ™ç›´æ¥è¿”å›
         if (!mappedHandler.applyPreHandle(processedRequest, response)) {
            return;
         }

         //è°ƒç”¨åˆ°Controllerå…·ä½“æ–¹æ³•ï¼Œæ ¸å¿ƒæ–¹æ³•è°ƒç”¨ï¼Œé‡ç‚¹çœ‹çœ‹
         // Actually invoke the handler.
         mv = ha.handle(processedRequest, response, mappedHandler.getHandler());

         if (asyncManager.isConcurrentHandlingStarted()) {
            return;
         }

         applyDefaultViewName(processedRequest, mv);
        //ä¸­ç½®è¿‡æ»¤å™¨
         mappedHandler.applyPostHandle(processedRequest, response, mv);
      }
      catch (Exception ex) {
         dispatchException = ex;
      }
      catch (Throwable err) {
         // As of 4.3, we&#39;re processing Errors thrown from handler methods as well,
         // making them available for @ExceptionHandler methods and other scenarios.
         dispatchException = new NestedServletException(&quot;Handler dispatch failed&quot;, err);
      }
     //è§†å›¾æ¸²æŸ“
      processDispatchResult(processedRequest, response, mappedHandler, mv, dispatchException);
   }
   catch (Exception ex) {
      triggerAfterCompletion(processedRequest, response, mappedHandler, ex);
   }
   catch (Throwable err) {
      triggerAfterCompletion(processedRequest, response, mappedHandler,
            new NestedServletException(&quot;Handler processing failed&quot;, err));
   }
   finally {
      if (asyncManager.isConcurrentHandlingStarted()) {
         // Instead of postHandle and afterCompletion
         if (mappedHandler != null) {
            mappedHandler.applyAfterConcurrentHandlingStarted(processedRequest, response);
         }
      }
      else {
         // Clean up any resources used by a multipart request.
         if (multipartRequestParsed) {
            cleanupMultipart(processedRequest);
         }
      }
   }
}</code></pre>
<h3 id="getHandler-æ–¹æ³•"><a href="#getHandler-æ–¹æ³•" class="headerlink" title="getHandler()æ–¹æ³•"></a>getHandler()æ–¹æ³•</h3><p>è¯¥æ–¹æ³•é¦–å…ˆä¼šé€šè¿‡getHandlerInternal()æ–¹æ³•è·å–åˆ°HandlerMethodå¯¹è±¡ï¼Œç„¶åè°ƒç”¨getHandlerExecutionChain()æ–¹æ³•åŒ¹é…æ‹¦æˆªå™¨å¹¶å°†åŒ¹é…åˆ°çš„æ‹¦æˆªå™¨è·ŸHandlerMethodå¯¹è±¡å°è£…ä¸ºHandlerExecutionChainå¯¹è±¡å¹¶è¿”å›ã€‚</p>
<pre><code class="java">public final HandlerExecutionChain getHandler(HttpServletRequest request) throws Exception {
   //æ ¹æ®è¯·æ±‚çš„uriæ‹¿åˆ°å¯¹åº”çš„HandlerMethodå¯¹è±¡
   Object handler = getHandlerInternal(request);
   if (handler == null) {
      handler = getDefaultHandler();
   }
   if (handler == null) {
      return null;
   }
   // Bean name or resolved handler?
   if (handler instanceof String) {
      String handlerName = (String) handler;
      handler = obtainApplicationContext().getBean(handlerName);
   }

   //è·å–HandlerMethodå’Œè¿‡æ»¤å™¨é“¾çš„åŒ…è£…ç±»
   HandlerExecutionChain executionChain = getHandlerExecutionChain(handler, request);

   if (logger.isTraceEnabled()) {
      logger.trace(&quot;Mapped to &quot; + handler);
   }
   else if (logger.isDebugEnabled() &amp;&amp; !request.getDispatcherType().equals(DispatcherType.ASYNC)) {
      logger.debug(&quot;Mapped to &quot; + executionChain.getHandler());
   }

   //æ˜¯å¦æ˜¯è·¨åŸŸè¯·æ±‚,å°±æ˜¯æŸ¥çœ‹requestè¯·æ±‚å¤´ä¸­æ˜¯å¦æœ‰Originå±æ€§
   if (CorsUtils.isCorsRequest(request)) {
      CorsConfiguration globalConfig = this.corsConfigurationSource.getCorsConfiguration(request);
      CorsConfiguration handlerConfig = getCorsConfiguration(handler, request);
      CorsConfiguration config = (globalConfig != null ? globalConfig.combine(handlerConfig) : handlerConfig);
      executionChain = getCorsHandlerExecutionChain(request, executionChain, config);
   }

   return executionChain;
}</code></pre>
<h4 id="getHandlerInternal-æ–¹æ³•"><a href="#getHandlerInternal-æ–¹æ³•" class="headerlink" title="getHandlerInternal()æ–¹æ³•"></a>getHandlerInternal()æ–¹æ³•</h4><p>getHandlerInternal()æ–¹æ³•é¦–å…ˆä¼šä»è¯·æ±‚ä¸­è·å–uriï¼Œç„¶åè°ƒç”¨lookupHandlerMethod()æ–¹æ³•è·å–åˆ°HandlerMethodå¯¹è±¡ã€‚ç„¶åè°ƒç”¨createWithResolvedBean()æ–¹æ³•åˆ›å»ºHandlerMethodä¸­çš„beanã€‚</p>
<pre><code class="java">protected HandlerMethod getHandlerInternal(HttpServletRequest request) throws Exception {
   //ä»requestå¯¹è±¡ä¸­è·å–uriï¼Œ/common/query2
   String lookupPath = getUrlPathHelper().getLookupPathForRequest(request);
   this.mappingRegistry.acquireReadLock();
   try {
      //æ ¹æ®uriä»æ˜ å°„å…³ç³»ä¸­æ‰¾åˆ°å¯¹åº”çš„HandlerMethodå¯¹è±¡
      HandlerMethod handlerMethod = lookupHandlerMethod(lookupPath, request);
      //æŠŠControllerç±»å®ä¾‹åŒ–
      return (handlerMethod != null ? handlerMethod.createWithResolvedBean() : null);
   }
   finally {
      this.mappingRegistry.releaseReadLock();
   }
}</code></pre>
<h5 id="lookupHandlerMethod-æ–¹æ³•"><a href="#lookupHandlerMethod-æ–¹æ³•" class="headerlink" title="lookupHandlerMethod()æ–¹æ³•"></a>lookupHandlerMethod()æ–¹æ³•</h5><p>è¯¥æ–¹æ³•ä¼šæ ¹æ®uriä»urlLookupä¸­è·å–åˆ°RequestMappingInfoçš„Listï¼Œç„¶åè°ƒç”¨addMatchingMappings()æ–¹æ³•æ ¹æ®requestçš„ä¿¡æ¯è·Ÿ@ReqeustMapingä¸­çš„ä¿¡æ¯å¯¹HandlerMethodè¿›è¡ŒåŒ¹é…ï¼Œæœ€åå°†åŒ¹é…åçš„RequestMappingInfoå¯¹è±¡å’ŒåŒ¹é…åˆ°çš„HandlerMethodå¯¹è±¡å°è£…åˆ°Matchå¯¹è±¡ä¸­ã€‚æœ€åè¿”å›HandlerMethodå¯¹è±¡ã€‚</p>
<pre><code class="java">protected HandlerMethod lookupHandlerMethod(String lookupPath, HttpServletRequest request) throws Exception {
   List&lt;Match&gt; matches = new ArrayList&lt;&gt;();
   List&lt;T&gt; directPathMatches = this.mappingRegistry.getMappingsByUrl(lookupPath);
   if (directPathMatches != null) {
      addMatchingMappings(directPathMatches, matches, request);
   }
   if (matches.isEmpty()) {
      // No choice but to go through all mappings...
      addMatchingMappings(this.mappingRegistry.getMappings().keySet(), matches, request);
   }

   if (!matches.isEmpty()) {
      Comparator&lt;Match&gt; comparator = new MatchComparator(getMappingComparator(request));
      matches.sort(comparator);
      Match bestMatch = matches.get(0);
      if (matches.size() &gt; 1) {
         if (logger.isTraceEnabled()) {
            logger.trace(matches.size() + &quot; matching mappings: &quot; + matches);
         }
         if (CorsUtils.isPreFlightRequest(request)) {
            return PREFLIGHT_AMBIGUOUS_MATCH;
         }
         Match secondBestMatch = matches.get(1);
         //å¦‚æœä¸¤ä¸ªRequestMappinginfoä»€ä¹ˆéƒ½ç›¸åŒï¼ŒæŠ¥é”™
         if (comparator.compare(bestMatch, secondBestMatch) == 0) {
            Method m1 = bestMatch.handlerMethod.getMethod();
            Method m2 = secondBestMatch.handlerMethod.getMethod();
            String uri = request.getRequestURI();
            throw new IllegalStateException(
                  &quot;Ambiguous handler methods mapped for &#39;&quot; + uri + &quot;&#39;: {&quot; + m1 + &quot;, &quot; + m2 + &quot;}&quot;);
         }
      }
      request.setAttribute(BEST_MATCHING_HANDLER_ATTRIBUTE, bestMatch.handlerMethod);
      handleMatch(bestMatch.mapping, lookupPath, request);
      return bestMatch.handlerMethod;
   }
   else {
      return handleNoMatch(this.mappingRegistry.getMappings().keySet(), lookupPath, request);
   }
}</code></pre>
<h5 id="createWithResolvedBean-æ–¹æ³•"><a href="#createWithResolvedBean-æ–¹æ³•" class="headerlink" title="createWithResolvedBean()æ–¹æ³•"></a>createWithResolvedBean()æ–¹æ³•</h5><p>æ³¨æ„ï¼šæ­¤æ–¹æ³•ä¼šé‡æ–°åˆ›å»ºä¸€ä¸ªHandlerMethodå¯¹è±¡è¿”å›ï¼ŒåŸæœ‰å¯¹è±¡ä¸ä¼šè¿›è¡Œä¿®æ”¹ã€‚</p>
<pre><code class="java">public HandlerMethod createWithResolvedBean() {
    Object handler = this.bean;
    if (this.bean instanceof String) {
        Assert.state(this.beanFactory != null, &quot;Cannot resolve bean name without BeanFactory&quot;);
        String beanName = (String)this.bean;
        handler = this.beanFactory.getBean(beanName);
    }

    return new HandlerMethod(this, handler);
}</code></pre>
<h4 id="getHandlerExecutionChain-æ–¹æ³•"><a href="#getHandlerExecutionChain-æ–¹æ³•" class="headerlink" title="getHandlerExecutionChain()æ–¹æ³•"></a>getHandlerExecutionChain()æ–¹æ³•</h4><p>è¯¥æ–¹æ³•é¦–å…ˆä¼šå°†HandlerMethodå¯¹è±¡åŒ…è£…åˆ°HandlerExecutionChainå¯¹è±¡ä¸­ï¼Œç„¶åæ ¹æ®uriè·å–åˆ°åŒ¹é…çš„æ‹¦æˆªå™¨åŠ å…¥åˆ°HandlerExecutionChainå¯¹è±¡ä¸­ã€‚</p>
<pre><code class="java">protected HandlerExecutionChain getHandlerExecutionChain(Object handler, HttpServletRequest request) {
   //æŠŠHandlerMethodå¯¹è±¡åŒ…è£…åˆ°HandlerExecutionChainå¯¹è±¡ä¸­ï¼Œè¿™ä¸ªå¯¹è±¡ä¸­æœ‰è¿‡æ»¤å™¨å¯¹è±¡
   HandlerExecutionChain chain = (handler instanceof HandlerExecutionChain ?
         (HandlerExecutionChain) handler : new HandlerExecutionChain(handler));

   //è·å–uri
   String lookupPath = this.urlPathHelper.getLookupPathForRequest(request);

   //æ˜¯å¦æœ‰è¿‡æ»¤å™¨
   for (HandlerInterceptor interceptor : this.adaptedInterceptors) {
      if (interceptor instanceof MappedInterceptor) {
         MappedInterceptor mappedInterceptor = (MappedInterceptor) interceptor;
         if (mappedInterceptor.matches(lookupPath, this.pathMatcher)) {
            chain.addInterceptor(mappedInterceptor.getInterceptor());
         }
      }
      else {
         chain.addInterceptor(interceptor);
      }
   }
   return chain;
}</code></pre>
<p>æ ¹æ®requestå¯¹è±¡è·å–handlerMappingå¯¹è±¡ï¼Œç„¶åæ ¹æ®handlerMappingå¯¹è±¡è·å–åŒ¹é…çš„HandlerAdapterå¯¹è±¡ï¼ŒpreHandleè¿‡æ»¤å™¨ï¼Œç„¶åhandleræ–¹æ³•ä¼šè°ƒç”¨åˆ°controllerä¸­çš„å…·ä½“æ–¹æ³•ï¼Œç„¶åä¸­ç½®postHandlerè¿‡æ»¤å™¨ï¼Œè¯•å›¾æ¸²æŸ“ï¼Œrendlerï¼ŒafterCompletionåç½®è¿‡æ»¤å™¨ã€‚</p>
<h3 id="getHandlerAdapter-æ–¹æ³•"><a href="#getHandlerAdapter-æ–¹æ³•" class="headerlink" title="getHandlerAdapter()æ–¹æ³•"></a>getHandlerAdapter()æ–¹æ³•</h3><p>ä¼šå¾ªç¯HandlerExecutionChainå¯¹è±¡ï¼Œæ‰¾åˆ°åˆé€‚çš„HandlerAdapterå¯¹è±¡ï¼Œè¿™é‡Œç”¨åˆ°äº†ç­–ç•¥æ¨¡å¼ã€‚</p>
<pre><code class="java">protected HandlerAdapter getHandlerAdapter(Object handler) throws ServletException {
   //æ ¹æ®handlerMethodå¯¹è±¡ï¼Œæ‰¾åˆ°åˆé€‚çš„HandlerAdapterå¯¹è±¡ï¼Œè¿™é‡Œç”¨åˆ°äº†ç­–ç•¥æ¨¡å¼
   if (this.handlerAdapters != null) {
      for (HandlerAdapter adapter : this.handlerAdapters) {
         if (adapter.supports(handler)) {
            return adapter;
         }
      }
   }
   throw new ServletException(&quot;No adapter for handler [&quot; + handler +
         &quot;]: The DispatcherServlet configuration needs to include a HandlerAdapter that supports this handler&quot;);
}</code></pre>
<h3 id="applyPreHandle-æ–¹æ³•"><a href="#applyPreHandle-æ–¹æ³•" class="headerlink" title="applyPreHandle()æ–¹æ³•"></a>applyPreHandle()æ–¹æ³•</h3><p>è¯¥æ–¹æ³•ä¼šè°ƒç”¨HandlerExecutionChainä¸­æ‰€æœ‰æ‹¦æˆªå™¨çš„preHandle()æ–¹æ³•ï¼Œå¦‚æœä¸ºfalseç›´æ¥è¿”å›ï¼Œè°ƒç”¨è¿‡ç¨‹ä¸­ä¼šä½¿ç”¨interceptorIndexè®°å½•æ‹¦æˆªå™¨çš„ä¸‹æ ‡ã€‚å¸¸ç”¨æ¥è¿›è¡Œä¸€äº›æƒé™æ ¡éªŒæ“ä½œã€‚</p>
<pre><code>boolean applyPreHandle(HttpServletRequest request, HttpServletResponse response) throws Exception {
   HandlerInterceptor[] interceptors = getInterceptors();
   if (!ObjectUtils.isEmpty(interceptors)) {
      for (int i = 0; i &lt; interceptors.length; i++) {
         HandlerInterceptor interceptor = interceptors[i];
         if (!interceptor.preHandle(request, response, this.handler)) {
            triggerAfterCompletion(request, response, null);
            return false;
         }
         this.interceptorIndex = i;
      }
   }
   return true;
}</code></pre><h3 id="handle-æ–¹æ³•"><a href="#handle-æ–¹æ³•" class="headerlink" title="handle()æ–¹æ³•"></a>handle()æ–¹æ³•</h3><p>æœ€ç»ˆä¼šè°ƒç”¨åˆ°invokeHandlerMethod()æ–¹æ³•ï¼Œè¿™é‡Œæˆ‘ä»¬é‡ç‚¹å…³æ³¨invokeAndHandle()æ–¹æ³•ã€‚ä½†è¦æ³¨æ„ï¼Œæœ¬æ–¹æ³•ä¸­æ¯æ¬¡åˆ›å»ºä¸€ä¸ªModelAndViewContainerå¯¹è±¡ï¼Œè¿™ä¸ªå¯¹è±¡ç”¨äºå¯¹@ModelAttributeæ³¨è§£æ–¹æ³•çš„å¤„ç†ï¼Œå¹¶æŠŠæ–¹æ³•è¿”å›å€¼ä¼ å…¥åˆ°ModelAndViewContainerçš„Mapä¸­ï¼Œç”¨äºæ¥æ¥ä¸‹è¿›è¡Œçš„å‚æ•°åˆ—è¡¨è§£æã€‚æœ€åä¼šè°ƒç”¨åˆ°getModelAndView()æ–¹æ³•è·å–åˆ°ModelAndViewå¯¹è±¡å¹¶è¿”å›ã€‚</p>
<pre><code class="java">protected ModelAndView invokeHandlerMethod(HttpServletRequest request,
      HttpServletResponse response, HandlerMethod handlerMethod) throws Exception {

   ServletWebRequest webRequest = new ServletWebRequest(request, response);
   try {
      //è·å–æ•°æ®ç»‘å®šå·¥å‚
      WebDataBinderFactory binderFactory = getDataBinderFactory(handlerMethod);
      //Modelå·¥å‚
      ModelFactory modelFactory = getModelFactory(handlerMethod, binderFactory);

      //å¯è°ƒç”¨çš„æ–¹æ³•å¯¹è±¡
      ServletInvocableHandlerMethod invocableMethod = createInvocableHandlerMethod(handlerMethod);
      if (this.argumentResolvers != null) {
         //è®¾ç½®å‚æ•°è§£æå™¨
         invocableMethod.setHandlerMethodArgumentResolvers(this.argumentResolvers);
      }
      if (this.returnValueHandlers != null) {
         //è®¾ç½®è¿”å›å€¼è§£æå™¨
         invocableMethod.setHandlerMethodReturnValueHandlers(this.returnValueHandlers);
      }
      //è®¾ç½®å‚æ•°ç»‘å®šå·¥å‚
      invocableMethod.setDataBinderFactory(binderFactory);
      //è®¾ç½®å‚æ•°åç§°è§£æç±»
      invocableMethod.setParameterNameDiscoverer(this.parameterNameDiscoverer);

      ModelAndViewContainer mavContainer = new ModelAndViewContainer();
      mavContainer.addAllAttributes(RequestContextUtils.getInputFlashMap(request));
      //è°ƒç”¨æœ‰@ModelAttributeæ³¨è§£çš„æ–¹æ³•
      modelFactory.initModel(webRequest, mavContainer, invocableMethod);
      mavContainer.setIgnoreDefaultModelOnRedirect(this.ignoreDefaultModelOnRedirect);

      AsyncWebRequest asyncWebRequest = WebAsyncUtils.createAsyncWebRequest(request, response);
      asyncWebRequest.setTimeout(this.asyncRequestTimeout);

      //å¼‚æ­¥å¤„ç†
      WebAsyncManager asyncManager = WebAsyncUtils.getAsyncManager(request);
      asyncManager.setTaskExecutor(this.taskExecutor);
      asyncManager.setAsyncWebRequest(asyncWebRequest);
      asyncManager.registerCallableInterceptors(this.callableInterceptors);
      asyncManager.registerDeferredResultInterceptors(this.deferredResultInterceptors);

      if (asyncManager.hasConcurrentResult()) {
         Object result = asyncManager.getConcurrentResult();
         mavContainer = (ModelAndViewContainer) asyncManager.getConcurrentResultContext()[0];
         asyncManager.clearConcurrentResult();
         LogFormatUtils.traceDebug(logger, traceOn -&gt; {
            String formatted = LogFormatUtils.formatValue(result, !traceOn);
            return &quot;Resume with async result [&quot; + formatted + &quot;]&quot;;
         });
         invocableMethod = invocableMethod.wrapConcurrentResult(result);
      }

      //Controlleræ–¹æ³•è°ƒç”¨ï¼Œé‡ç‚¹çœ‹çœ‹
      invocableMethod.invokeAndHandle(webRequest, mavContainer);
      if (asyncManager.isConcurrentHandlingStarted()) {
         return null;
      }

      return getModelAndView(mavContainer, modelFactory, webRequest);
   }
   finally {
      webRequest.requestCompleted();
   }
}</code></pre>
<p>invokeAndHandle()æ–¹æ³•</p>
<p>è¯¥æ–¹æ³•ä¼šè°ƒç”¨invokeForRequest()æ–¹æ³•è·å–åˆ°è¿”å›å€¼ï¼Œç„¶åä½¿ç”¨handleReturnValue()æ–¹æ³•å¯¹è¿”å›å€¼è¿›è¡Œå¤„ç†ã€‚å¤„ç†æ–¹å¼ä¸å…¥å‚çš„å¤„ç†åŸºæœ¬ç›¸åŒã€‚å¦‚æœä¸ºè§†å›¾å°±ä¼šå°†viewNameè®¾ç½®åˆ°mavContainerå®¹å™¨ä¸­ï¼Œå¹¶å°†requestHandledå±æ€§è®¾ç½®ä¸ºtrueã€‚å¦‚æœè¿”å›å‚æ•°è¢«@ResponseBodyæ³¨è§£ä¿®é¥°ï¼Œå°±ä¸ä¼šè®¾ç½®requestHandledå€¼ï¼ŒrequestHandledé»˜è®¤å€¼ä¸ºfalseã€‚</p>
<pre><code class="java">public void invokeAndHandle(ServletWebRequest webRequest, ModelAndViewContainer mavContainer,
      Object... providedArgs) throws Exception {

   //å…·ä½“è°ƒç”¨é€»è¾‘ï¼Œé‡ç‚¹çœ‹
   Object returnValue = invokeForRequest(webRequest, mavContainer, providedArgs);
   setResponseStatus(webRequest);

   if (returnValue == null) {
      if (isRequestNotModified(webRequest) || getResponseStatus() != null || mavContainer.isRequestHandled()) {
         mavContainer.setRequestHandled(true);
         return;
      }
   }
   else if (StringUtils.hasText(getResponseStatusReason())) {
      mavContainer.setRequestHandled(true);
      return;
   }

   mavContainer.setRequestHandled(false);
   Assert.state(this.returnValueHandlers != null, &quot;No return value handlers&quot;);
   try {
      this.returnValueHandlers.handleReturnValue(
            returnValue, getReturnValueType(returnValue), mavContainer, webRequest);
   }
   catch (Exception ex) {
      if (logger.isTraceEnabled()) {
         logger.trace(formatErrorForReturnValue(returnValue), ex);
      }
      throw ex;
   }
}</code></pre>
<p>invokeForRequest()æ–¹æ³•</p>
<p>è¯¥æ–¹æ³•é¦–å…ˆé€šè¿‡getMethodArgumentValues()æ–¹æ³•è·å–å‚æ•°æ•°ç»„ï¼Œç„¶åä½¿ç”¨åå°„è°ƒç”¨å¹¶å°†è¿”å›å€¼è¿”å›ã€‚</p>
<pre><code class="java">public Object invokeForRequest(NativeWebRequest request, @Nullable ModelAndViewContainer mavContainer,
      Object... providedArgs) throws Exception {

   //è·å–å‚æ•°æ•°ç»„,é‡ç‚¹çœ‹
   Object[] args = getMethodArgumentValues(request, mavContainer, providedArgs);
   if (logger.isTraceEnabled()) {
      logger.trace(&quot;Arguments: &quot; + Arrays.toString(args));
   }
   return doInvoke(args);
}</code></pre>
<p>getMethodArgumentValues()æ–¹æ³•</p>
<p>è¯¥æ–¹æ³•ä¼šå¾ªç¯å¤„ç†å‚æ•°ï¼Œé¦–å…ˆä¼šæ³•åˆ¤æ–­å‚æ•°æ˜¯å¦æœ‰å¯¹åº”çš„å¤„ç†ç±»ï¼Œåˆ¤æ–­æ–¹æ³•ä¸ºå¾ªç¯è°ƒç”¨æ‰€æœ‰çš„HandlerMethodArgumentResolverå¤„ç†ç±»å¹¶è°ƒç”¨supportsParameter()åˆ¤æ–­æ˜¯å¦æ”¯æŒå¤„ç†è¯¥å‚æ•°ã€‚ç„¶åè°ƒç”¨resolveArgument()æ–¹æ³•è·å–åˆ°å¯¹åº”çš„å¤„ç†ç±»ï¼Œå¹¶è°ƒç”¨resolveArgument()æ–¹æ³•å¯¹å‚æ•°è¿›è¡Œå¤„ç†å¹¶åŒ…è£…ä¸ºMethodParameterå¯¹è±¡ã€‚</p>
<pre><code class="java">protected Object[] getMethodArgumentValues(NativeWebRequest request, @Nullable ModelAndViewContainer mavContainer,
      Object... providedArgs) throws Exception {

   if (ObjectUtils.isEmpty(getMethodParameters())) {
      return EMPTY_ARGS;
   }
   //å…¥å‚çš„åŒ…è£…ç±»ï¼Œé‡Œé¢åŒ…è£…äº†å‚æ•°ç±»å‹ï¼Œå‚æ•°åç§°ï¼Œå‚æ•°æ³¨è§£ç­‰ç­‰ä¿¡æ¯
   MethodParameter[] parameters = getMethodParameters();
   Object[] args = new Object[parameters.length];
   for (int i = 0; i &lt; parameters.length; i++) {
      MethodParameter parameter = parameters[i];
      //è®¾ç½®å‚æ•°åç§°è§£æå™¨
      parameter.initParameterNameDiscovery(this.parameterNameDiscoverer);
      args[i] = findProvidedArgument(parameter, providedArgs);
      if (args[i] != null) {
         continue;
      }
      //å…¸å‹çš„ç­–ç•¥æ¨¡å¼ï¼Œæ ¹æ®parameterèƒ½å¦æ‰¾åˆ°å¯¹åº”å‚æ•°çš„å¤„ç†ç±»ï¼Œèƒ½æ‰¾åˆ°å°±è¿”å›true
      if (!this.resolvers.supportsParameter(parameter)) {
         throw new IllegalStateException(formatArgumentError(parameter, &quot;No suitable resolver&quot;));
      }
      try {
         //å…·ä½“å‚æ•°å€¼è§£æè¿‡ç¨‹,é‡ç‚¹çœ‹çœ‹
         args[i] = this.resolvers.resolveArgument(parameter, mavContainer, request, this.dataBinderFactory);
      }
      catch (Exception ex) {
         // Leave stack trace for later, exception may actually be resolved and handled..
         if (logger.isDebugEnabled()) {
            String error = ex.getMessage();
            if (error != null &amp;&amp; !error.contains(parameter.getExecutable().toGenericString())) {
               logger.debug(formatArgumentError(parameter, error));
            }
         }
         throw ex;
      }
   }
   return args;
}</code></pre>
<p>getModelAndView()æ–¹æ³•</p>
<p>è¯¥æ–¹æ³•é¦–å…ˆä¼šåˆ¤æ–­requestHandledå±æ€§ï¼Œå¦‚æœå±æ€§ä¸ºfalseå°±ç›´æ¥è¿”å›ã€‚</p>
<pre><code class="java">private ModelAndView getModelAndView(ModelAndViewContainer mavContainer,
      ModelFactory modelFactory, NativeWebRequest webRequest) throws Exception {

   modelFactory.updateModel(webRequest, mavContainer);
   if (mavContainer.isRequestHandled()) {
      return null;
   }
   ModelMap model = mavContainer.getModel();
   ModelAndView mav = new ModelAndView(mavContainer.getViewName(), model, mavContainer.getStatus());
   if (!mavContainer.isViewReference()) {
      mav.setView((View) mavContainer.getView());
   }
   if (model instanceof RedirectAttributes) {
      Map&lt;String, ?&gt; flashAttributes = ((RedirectAttributes) model).getFlashAttributes();
      HttpServletRequest request = webRequest.getNativeRequest(HttpServletRequest.class);
      if (request != null) {
         RequestContextUtils.getOutputFlashMap(request).putAll(flashAttributes);
      }
   }
   return mav;
}</code></pre>
<h3 id="applyPostHandle-æ–¹æ³•"><a href="#applyPostHandle-æ–¹æ³•" class="headerlink" title="applyPostHandle()æ–¹æ³•"></a>applyPostHandle()æ–¹æ³•</h3><p>ä¸å‰ç½®è¿‡æ»¤å™¨çš„è°ƒç”¨æ–¹æ³•åŸºæœ¬ç›¸åŒï¼Œä¸åŒçš„æ˜¯ä»–ä¸éœ€è¦è¿›è¡Œåˆ¤æ–­ï¼Œä¸”ä¸å‰ç½®è¿‡æ»¤å™¨ä¸åŒçš„æ˜¯ï¼Œå®ƒçš„éå†æ—¶å€’åºéå†ã€‚æ³¨æ„ï¼šä¸­ç½®è¿‡æ»¤å™¨ä¸­æœ‰ModelAndViewå…¥å‚å¯ä»¥å¯¹å…¶è¿›è¡Œå¤„ç†ã€‚</p>
<pre><code class="java">void applyPostHandle(HttpServletRequest request, HttpServletResponse response, @Nullable ModelAndView mv)
      throws Exception {

   HandlerInterceptor[] interceptors = getInterceptors();
   if (!ObjectUtils.isEmpty(interceptors)) {
      for (int i = interceptors.length - 1; i &gt;= 0; i--) {
         HandlerInterceptor interceptor = interceptors[i];
         interceptor.postHandle(request, response, this.handler, mv);
      }
   }
}</code></pre>
<h3 id="processDispatchResult-æ–¹æ³•"><a href="#processDispatchResult-æ–¹æ³•" class="headerlink" title="processDispatchResult()æ–¹æ³•"></a>processDispatchResult()æ–¹æ³•</h3><p>è¯¥æ–¹æ³•æœ€ç»ˆä¼šè½å…¥renderMergedOutputModel()æ–¹æ³•ä¸­ï¼Œè¿™é‡Œåªç€é‡åˆ†æè¿™ä¸ªæ–¹æ³•ã€‚</p>
<p>æ³¨æ„ï¼Œå¦‚æœModelAndViewä¸ºç©ºå°±ä¼šä»¥æµçš„æ–¹å¼å“åº”jsonæ•°æ®ï¼Œä¸ä¼šè¿›å…¥è¿™ä¸ªæ–¹æ³•ã€‚é¦–å…ˆä¼šè°ƒç”¨exposeModelAsRequestAttributes()æ–¹æ³•ï¼Œå°†modelä¸­çš„å¯¹è±¡è®¾ç½®åˆ°requestä¸­ã€‚ç„¶åè·å–åˆ°è·³è½¬åœ°å€ï¼Œå°†åœ°å€è½¬ä¸ºRequestDispatcherå¯¹è±¡ï¼Œæœ€åè°ƒç”¨RequestDispatcher.forward()è¿›è¡Œè½¬å‘ã€‚</p>
<pre><code class="java">    protected void renderMergedOutputModel(
            Map&lt;String, Object&gt; model, HttpServletRequest request, HttpServletResponse response) throws Exception {
    // æŠŠå“åº”æ•°æ®è®¾ç½®åˆ°reqeustå¯¹è±¡ä¸­
        // Expose the model object as request attributes.
        exposeModelAsRequestAttributes(model, request);

        // Expose helpers as request attributes, if any.
        exposeHelpers(request);

    //è·å–åˆ°è·³è½¬åœ°å€
        // Determine the path for the request dispatcher.
        String dispatcherPath = prepareForRendering(request, response);

        // Obtain a RequestDispatcher for the target resource (typically a JSP).
        RequestDispatcher rd = getRequestDispatcher(request, dispatcherPath);
        if (rd == null) {
            throw new ServletException(&quot;Could not get RequestDispatcher for [&quot; + getUrl() +
                    &quot;]: Check that the corresponding file exists within your web application archive!&quot;);
        }

        // If already included or response already committed, perform include, else forward.
        if (useInclude(request, response)) {
            response.setContentType(getContentType());
            if (logger.isDebugEnabled()) {
                logger.debug(&quot;Including [&quot; + getUrl() + &quot;]&quot;);
            }
            rd.include(request, response);
        }

        else {
            // Note: The forwarded resource is supposed to determine the content type itself.
            if (logger.isDebugEnabled()) {
                logger.debug(&quot;Forwarding to [&quot; + getUrl() + &quot;]&quot;);
            }
            rd.forward(request, response);
        }
    }</code></pre>

            </div>
            <hr>
            <div>
              <p>
                
                  <span>
                <i class="iconfont icon-inbox"></i>
                    
                      <a class="hover-with-bg" href="/categories/Spring%E6%BA%90%E7%A0%81%E8%A7%A3%E6%9E%90/">Springæºç è§£æ</a>
                      &nbsp;
                    
                  </span>&nbsp;&nbsp;
                
                
                  <span>
                <i class="iconfont icon-tag"></i>
                    
                      <a class="hover-with-bg" href="/tags/%E6%BA%90%E7%A0%81%E8%A7%A3%E6%9E%90/">æºç è§£æ</a>
                    
                      <a class="hover-with-bg" href="/tags/spring/">spring</a>
                    
                      <a class="hover-with-bg" href="/tags/springmvc/">springmvc</a>
                    
                  </span>
                
              </p>
              
                <p class="note note-warning">æœ¬åšå®¢æ‰€æœ‰æ–‡ç« é™¤ç‰¹åˆ«å£°æ˜å¤–ï¼Œå‡é‡‡ç”¨ <a href="https://zh.wikipedia.org/wiki/Wikipedia:CC_BY-SA_3.0%E5%8D%8F%E8%AE%AE%E6%96%87%E6%9C%AC" target="_blank" rel="nofollow noopener noopener">CC BY-SA 3.0åè®®</a> ã€‚è½¬è½½è¯·æ³¨æ˜å‡ºå¤„ï¼</p>
              
              
                <div class="post-prevnext row">
                  <div class="post-prev col-6">
                    
                    
                      <a href="/2020/04/22/springboot%E5%90%84%E7%A7%8D%E7%BB%84%E4%BB%B6%E7%9A%84%E6%95%B4%E5%90%88/">
                        <i class="fa fa-chevron-left"></i>
                        <span class="hidden-mobile">springbootå„ç§ç»„ä»¶çš„æ•´åˆ</span>
                        <span class="visible-mobile">ä¸Šä¸€ç¯‡</span>
                      </a>
                    
                  </div>
                  <div class="post-next col-6">
                    
                    
                      <a href="/2020/04/20/springmvc%E7%9A%84%E5%88%9D%E5%A7%8B%E5%8C%96/">
                        <span class="hidden-mobile">springmvcçš„åˆå§‹åŒ–</span>
                        <span class="visible-mobile">ä¸‹ä¸€ç¯‡</span>
                        <i class="fa fa-chevron-right"></i>
                      </a>
                    
                  </div>
                </div>
              
            </div>

              
                <!-- Comments -->
                <div class="comments" id="comments">
                  
                  

                </div>
              
          </div>
        </div>
      </div>
    </div>
    
      <div class="d-none d-lg-block col-lg-2 toc-container" id="toc-ctn">
        <div id="toc-start"></div>
<div id="toc">
  <p class="h5"><i class="far fa-list-alt"></i>&nbsp;ç›®å½•</p>
  <div id="tocbot"></div>
</div>

      </div>
    
  </div>
</div>

<!-- Custom -->


    
  </main>

  
    <a class="z-depth-1" id="scroll-top-button" href="#" role="button">
      <i class="fa fa-chevron-up scroll-top-arrow" aria-hidden="true"></i>
    </a>
  

  
    <div class="modal fade" id="modalSearch" tabindex="-1" role="dialog" aria-labelledby="ModalLabel"
     aria-hidden="true">
  <div class="modal-dialog modal-dialog-scrollable modal-lg" role="document">
    <div class="modal-content">
      <div class="modal-header text-center">
        <h4 class="modal-title w-100 font-weight-bold">æœç´¢</h4>
        <button type="button" id="local-search-close" class="close" data-dismiss="modal" aria-label="Close">
          <span aria-hidden="true">&times;</span>
        </button>
      </div>
      <div class="modal-body mx-3">
        <div class="md-form mb-5">
          <input type="text" id="local-search-input" class="form-control validate">
          <label data-error="x" data-success="v"
                 for="local-search-input">å…³é”®è¯</label>
        </div>
        <div class="list-group" id="local-search-result"></div>
      </div>
    </div>
  </div>
</div>
  

  

  

  <footer class="mt-5">
  <div class="text-center py-3">
    <div>
      <a href="https://hexo.io" target="_blank" rel="nofollow noopener"><b>Hexo</b></a>
      <i class="iconfont icon-love"></i>
      <a href="https://github.com/fluid-dev/hexo-theme-fluid" target="_blank" rel="nofollow noopener"> <b>Fluid</b></a>
    </div>
    
  <div>
    
      <!-- ä¸è’œå­ç»Ÿè®¡PV -->
      
      <span id="busuanzi_container_site_pv" style="display: none">
      æ€»è®¿é—®é‡ <span id="busuanzi_value_site_pv"></span> æ¬¡
    </span>
    
    
      <!-- ä¸è’œå­ç»Ÿè®¡UV -->
      
      <span id="busuanzi_container_site_uv" style="display: none">
      æ€»è®¿å®¢æ•° <span id="busuanzi_value_site_uv"></span> äºº
    </span>
    
  </div>


    

    
  </div>
</footer>

<!-- SCRIPTS -->
<script  src="https://cdn.staticfile.org/jquery/3.4.1/jquery.min.js" ></script>
<script  src="https://cdn.staticfile.org/popper.js/1.16.1/umd/popper.min.js" ></script>
<script  src="https://cdn.staticfile.org/twitter-bootstrap/4.4.1/js/bootstrap.min.js" ></script>
<script  src="https://cdn.staticfile.org/mdbootstrap/4.13.0/js/mdb.min.js" ></script>
<script  src="/js/main.js" ></script>


  <script  src="/js/lazyload.js" ></script>



  
  <script  src="https://cdn.staticfile.org/tocbot/4.10.0/tocbot.min.js" ></script>
  <script>
    $(document).ready(function () {
      var navHeight = $('#navbar').height();
      var toc = $('#toc');
      var boardCtn = $('#board-ctn');
      var boardTop = boardCtn.offset().top;
      var tocLimMax = 2 * boardTop + boardCtn.height();

      $(window).scroll(function () {
        var tocLimMin = $('#toc-start').offset().top - navHeight;
        var scroH = document.body.scrollTop + document.documentElement.scrollTop;

        if (tocLimMin <= scroH && scroH <= tocLimMax) {
          toc.css({
            'display': 'block',
            'position': 'fixed',
            'top': navHeight,
          });
        } else if (scroH <= tocLimMin) {
          toc.css({
            'position': '',
            'top': '',
          });
        } else if (scroH > tocLimMax) {
          toc.css('display', 'none');
        }
      });
      tocbot.init({
        tocSelector: '#tocbot',
        contentSelector: '.post-content',
        headingSelector: 'h1,h2,h3,h4,h5,h6',
        linkClass: 'tocbot-link',
        activeLinkClass: 'tocbot-active-link',
        listClass: 'tocbot-list',
        isCollapsedClass: 'tocbot-is-collapsed',
        collapsibleClass: 'tocbot-is-collapsible',
        scrollSmooth: true,
        headingsOffset: -boardTop
      });
      if ($('.toc-list-item').length > 0) {
        $('#toc > p').css('visibility', 'visible');
      }
      var offset = boardCtn.css('margin-right')
      $('#toc-ctn').css({
        'right': offset
      })
    });
  </script>





  <script defer src="https://cdn.staticfile.org/clipboard.js/2.0.6/clipboard.min.js" ></script>
  <script  src="/js/clipboard-use.js" ></script>



  <script defer src="https://cdn.staticfile.org/smoothscroll/1.4.10/SmoothScroll.min.js" ></script>



  <script defer src="https://busuanzi.ibruce.info/busuanzi/2.3/busuanzi.pure.mini.js" ></script>




<!-- Plugins -->


  

  

  

  

  

  



  <script  src="https://cdn.staticfile.org/prettify/188.0.0/prettify.min.js" ></script>
  <script>
    $(document).ready(function () {
      $('pre').addClass('prettyprint  linenums');
      prettyPrint();
    })
  </script>



  <script  src="https://cdn.staticfile.org/typed.js/2.0.11/typed.min.js" ></script>
  <script>
    var typed = new Typed('#subtitle', {
      strings: [
        '  ',
        "springmvcçš„è¯·æ±‚å“åº”&nbsp;",
      ],
      cursorChar: "_",
      typeSpeed: 70,
      loop: false,
    });
    typed.stop();
    $(document).ready(function () {
      $(".typed-cursor").addClass("h2");
      typed.start();
    });
  </script>



  <script  src="https://cdn.staticfile.org/anchor-js/4.2.2/anchor.min.js" ></script>
  <script>
    anchors.options = {
      placement: "right",
      visible: "hover",
      
    };
    var el = "h1,h2,h3,h4,h5,h6".split(",");
    var res = [];
    for (item of el) {
      res.push(".markdown-body > " + item)
    }
    anchors.add(res.join(", "))
  </script>



  <script  src="/js/local-search.js" ></script>
  <script>
    var path = "/local-search.xml";
    var inputArea = document.querySelector("#local-search-input");
    inputArea.onclick = function () {
      getSearchFile(path);
      this.onclick = null
    }
  </script>



  <script defer src="https://cdn.staticfile.org/fancybox/3.5.7/jquery.fancybox.min.js" ></script>
  <script>
    $("#post img:not(.no-zoom img, img[no-zoom])").each(
      function () {
        var element = document.createElement("a");
        $(element).attr("data-fancybox", "images");
        $(element).attr("href", $(this).attr("src"));
        $(this).wrap(element);
      }
    );
  </script>





  
  
    <script type="text/javascript">
      //å®šä¹‰è·å–è¯è¯­ä¸‹æ ‡
      var a_idx = 0;
      jQuery(document).ready(function ($) {
        //ç‚¹å‡»bodyæ—¶è§¦å‘äº‹ä»¶
        $("body").click(function (e) {
          //éœ€è¦æ˜¾ç¤ºçš„è¯è¯­
          var a = new Array("å¯Œå¼º", "æ°‘ä¸»", "æ–‡æ˜", "å’Œè°", "è‡ªç”±", "å¹³ç­‰", "å…¬æ­£", "æ³•æ²»", "çˆ±å›½", "æ•¬ä¸š", "è¯šä¿¡", "å‹å–„");
          //è®¾ç½®è¯è¯­ç»™spanæ ‡ç­¾
          var $i = $("<span/>").text(a[a_idx]);
          //ä¸‹æ ‡ç­‰äºåŸæ¥ä¸‹æ ‡+1  ä½™ è¯è¯­æ€»æ•°
          a_idx = (a_idx + 1) % a.length;
          //è·å–é¼ æ ‡æŒ‡é’ˆçš„ä½ç½®ï¼Œåˆ†åˆ«ç›¸å¯¹äºæ–‡æ¡£çš„å·¦å’Œå³è¾¹ç¼˜ã€‚
          //è·å–xå’Œyçš„æŒ‡é’ˆåæ ‡
          var x = e.pageX, y = e.pageY;
          //åœ¨é¼ æ ‡çš„æŒ‡é’ˆçš„ä½ç½®ç»™$iå®šä¹‰çš„spanæ ‡ç­¾æ·»åŠ cssæ ·å¼
          $i.css({
            "z-index": 999,
            "top": y - 20,
            "left": x,
            "position": "absolute",
            "font-weight": "bold",
            "color": rand_color()
          });
          // éšæœºé¢œè‰²
          function rand_color() {
            return "rgb(" + ~~(255 * Math.random()) + "," + ~~(255 * Math.random()) + "," + ~~(255 * Math.random()) + ")"
          }
          //åœ¨bodyæ·»åŠ è¿™ä¸ªæ ‡ç­¾
          $("body").append($i);
          //animate() æ–¹æ³•æ‰§è¡Œ CSS å±æ€§é›†çš„è‡ªå®šä¹‰åŠ¨ç”»ã€‚
          //è¯¥æ–¹æ³•é€šè¿‡CSSæ ·å¼å°†å…ƒç´ ä»ä¸€ä¸ªçŠ¶æ€æ”¹å˜ä¸ºå¦ä¸€ä¸ªçŠ¶æ€ã€‚CSSå±æ€§å€¼æ˜¯é€æ¸æ”¹å˜çš„ï¼Œè¿™æ ·å°±å¯ä»¥åˆ›å»ºåŠ¨ç”»æ•ˆæœã€‚
          //è¯¦æƒ…è¯·çœ‹http://www.w3school.com.cn/jquery/effect_animate.asp
          $i.animate({
            //å°†åŸæ¥çš„ä½ç½®å‘ä¸Šç§»åŠ¨180
            "top": y - 180,
            "opacity": 0
            //1500åŠ¨ç”»çš„é€Ÿåº¦
          }, 1500, function () {
            //æ—¶é—´åˆ°äº†è‡ªåŠ¨åˆ é™¤
            $i.remove();
          });
        });
      })
      ;
    </script>
  








</body>
</html>
