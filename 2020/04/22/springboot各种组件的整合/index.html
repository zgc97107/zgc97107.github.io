<!DOCTYPE html>
<html lang="zh-CN">





<head>
  <meta charset="UTF-8">
  <link rel="apple-touch-icon" sizes="76x76" href="/img/apple-touch-icon.png">
  <link rel="icon" type="image/png" href="/img/favicon.png">
  <meta name="viewport"
        content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no, shrink-to-fit=no">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  
  <meta name="theme-color" content="#2f4154">
  <meta name="description" content="">
  <meta name="author" content="">
  <meta name="keywords" content="">
  <title>springboot各种组件的整合 - zgcheng&#39;s blog</title>

  <link  rel="stylesheet" href="https://cdn.staticfile.org/font-awesome/5.12.1/css/all.min.css" />
<link  rel="stylesheet" href="https://cdn.staticfile.org/twitter-bootstrap/4.4.1/css/bootstrap.min.css" />
<link  rel="stylesheet" href="https://cdn.staticfile.org/mdbootstrap/4.13.0/css/mdb.min.css" />
<link  rel="stylesheet" href="https://cdn.staticfile.org/github-markdown-css/3.0.1/github-markdown.min.css" />

<link rel="stylesheet" href="//at.alicdn.com/t/font_1067060_qzomjdt8bmp.css">



  <link  rel="stylesheet" href="/lib/prettify/tomorrow-night-eighties.min.css" />

<link  rel="stylesheet" href="/css/main.css" />


  <link defer rel="stylesheet" href="https://cdn.staticfile.org/fancybox/3.5.7/jquery.fancybox.min.css" />


<!-- 自定义样式保持在最底部 -->


<meta name="generator" content="Hexo 4.1.1"></head>


<body>
  <header style="height: 70vh;">
    <nav id="navbar" class="navbar fixed-top  navbar-expand-lg navbar-dark scrolling-navbar">
  <div class="container">
    <a class="navbar-brand"
       href="/">&nbsp;<strong>zgcheng's blog</strong>&nbsp;</a>

    <button id="navbar-toggler-btn" class="navbar-toggler" type="button" data-toggle="collapse"
            data-target="#navbarSupportedContent"
            aria-controls="navbarSupportedContent" aria-expanded="false" aria-label="Toggle navigation">
      <div class="animated-icon"><span></span><span></span><span></span></div>
    </button>

    <!-- Collapsible content -->
    <div class="collapse navbar-collapse" id="navbarSupportedContent">
      <ul class="navbar-nav ml-auto text-center">
        
          
          
          
          
          <li class="nav-item">
            <a class="nav-link" href="/">首页</a>
          </li>
        
          
          
          
          
          <li class="nav-item">
            <a class="nav-link" href="/archives/">归档</a>
          </li>
        
          
          
          
          
          <li class="nav-item">
            <a class="nav-link" href="/categories/">分类</a>
          </li>
        
          
          
          
          
          <li class="nav-item">
            <a class="nav-link" href="/tags/">标签</a>
          </li>
        
          
          
          
          
          <li class="nav-item">
            <a class="nav-link" href="/about">关于</a>
          </li>
        
        
          <li class="nav-item" id="search-btn">
            <a class="nav-link" data-toggle="modal" data-target="#modalSearch">&nbsp;&nbsp;<i
                class="iconfont icon-search"></i>&nbsp;&nbsp;</a>
          </li>
        
      </ul>
    </div>
  </div>
</nav>

    <div class="view intro-2" id="background" parallax=true
         style="background: url('/img/default.png') no-repeat center center;
           background-size: cover;">
      <div class="full-bg-img">
        <div class="mask rgba-black-light flex-center">
          <div class="container text-center white-text fadeInUp">
            <span class="h2" id="subtitle">
              
            </span>

            
              
                <p class="mt-3 post-meta">
                  <i class="fas fa-calendar-alt" aria-hidden="true"></i>
                  星期三, 四月 22日 2020, 1:17 下午
                </p>
              

              <p class="mt-1">
                
                  
                  <span class="post-meta">
                    <i class="far fa-chart-bar"></i>
                    4.8k 字
                  </span>
                

                
                  
                  <span class="post-meta">
                      <i class="far fa-clock"></i>
                      24 分钟
                  </span>
                

                
                  <!-- 不蒜子统计文章PV -->
                  
                  <span id="busuanzi_container_page_pv" class="post-meta" style="display: none">
                    <i class="far fa-eye" aria-hidden="true"></i>
                    <span id="busuanzi_value_page_pv"></span> 次
                  </span>
                
              </p>
            
          </div>

          
        </div>
      </div>
    </div>
  </header>

  <main>
    
      

<div class="container-fluid">
  <div class="row">
    <div class="d-none d-lg-block col-lg-2"></div>
    <div class="col-lg-8 nopadding-md">
      <div class="container nopadding-md" id="board-ctn">
        <div class="py-5 z-depth-3" id="board">
          <div class="post-content mx-auto" id="post">
            
              <p
                class="note note-warning">本文最后更新于：星期三, 四月 22日 2020, 8:22 晚上</p>
            
            <div class="markdown-body">
              <h2 id="springboot工程搭建"><a href="#springboot工程搭建" class="headerlink" title="springboot工程搭建"></a>springboot工程搭建</h2><p>springboot工程的搭建十分简单</p>
<ol>
<li>继承父工程</li>
</ol>
<pre><code class="xml">    &lt;parent&gt;
        &lt;groupId&gt;org.springframework.boot&lt;/groupId&gt;
        &lt;artifactId&gt;spring-boot-starter-parent&lt;/artifactId&gt;
        &lt;version&gt;2.2.6.RELEASE&lt;/version&gt;
        &lt;relativePath/&gt; &lt;!-- lookup parent from repository --&gt;
    &lt;/parent&gt;</code></pre>
<ol start="2">
<li>导入web启动器</li>
</ol>
<pre><code class="xml">        &lt;dependency&gt;
            &lt;groupId&gt;org.springframework.boot&lt;/groupId&gt;
            &lt;artifactId&gt;spring-boot-starter-web&lt;/artifactId&gt;
        &lt;/dependency&gt;</code></pre>
<ol start="3">
<li>启动类</li>
</ol>
<pre><code class="java">@SpringBootApplication(scanBasePackages = {&quot;com.demo.springboot&quot;})
public class SpringbootTest extends SpringBootServletInitializer {

    /*
     * 1、完成Spring容器的启动
     * 2、把项目部署到tomcat
     * */
    public static void main(String[] args) {
        ConfigurableApplicationContext applicationContext = SpringApplication.run(SpringbootTest.class,
                args);
    }

    @Override
    protected SpringApplicationBuilder configure(SpringApplicationBuilder builder) {
        return builder.sources(SpringBootTest.class);
    }
}</code></pre>
<h2 id="Servlet、Filter、Listener的整合"><a href="#Servlet、Filter、Listener的整合" class="headerlink" title="Servlet、Filter、Listener的整合"></a>Servlet、Filter、Listener的整合</h2><p>只需要在启动类上加入<code>@ServletComponentScan(basePackages = {&quot;com.demo.springboot&quot;})</code>注解，然后在Servlet、Filter、Listener上加入相应的@WebFilter、@WebListener、@WebServlet注解即可，spring就会在初始化时扫描这些注解并把Servlet、Filter、Listener加入到spring容器中。</p>
<pre><code class="java">@WebFilter(urlPatterns = &quot;/*&quot;,filterName = &quot;myFilter&quot;)
public class MyFilter implements Filter {
    @Override
    public void doFilter(ServletRequest request, ServletResponse response, FilterChain chain) throws IOException, ServletException {
        System.out.println(&quot;--------MyFilter----------&quot;);
        chain.doFilter(request,response);
    }
}</code></pre>
<pre><code class="java">@WebListener
public class MyListener implements ServletContextListener {

    @Override
    public void contextDestroyed(ServletContextEvent contextEvent) {
        System.out.println(&quot;contextDestroyed&quot;); }
    @Override
    public void contextInitialized(ServletContextEvent contextEvent) {
        System.out.println(&quot;contextInitialized&quot;); }
}</code></pre>
<pre><code class="java">@WebServlet(urlPatterns = &quot;/jack/*&quot;)
public class MyServlet extends HttpServlet {
    private static final long serialVersionUID = 1L;

    public JackServlet() {
        super();
    }

    protected void doGet(HttpServletRequest request,
            HttpServletResponse response) throws ServletException, IOException {
        System.out.println(&quot;-----------------doGet-----------------------&quot;);
    }

    protected void doPost(HttpServletRequest request,
            HttpServletResponse response) throws ServletException, IOException {
        System.out.println(&quot;------------------doPost----------------------&quot;);
    }

}</code></pre>
<h2 id="druid多数据源及数据监控的整合"><a href="#druid多数据源及数据监控的整合" class="headerlink" title="druid多数据源及数据监控的整合"></a>druid多数据源及数据监控的整合</h2><p>Druid对数据库连接的管理比较优秀，而且还提供了可以实时监控数据库连接对象和数据库操作记录的监控界面。通过以下配置后就可以动态的切换数据源，使用方法为在方法上加入<code>@TargetDataSource</code>注解，如切换为ds2数据源<code>@TargetDataSource(name=&quot;ds2&quot;)</code>。durid监控界面的地址为{ip}:{port}/{contextPath}/druid/index.html</p>
<p>maven中引入jar包</p>
<pre><code class="xml">        &lt;dependency&gt;
            &lt;groupId&gt;com.alibaba&lt;/groupId&gt;
            &lt;artifactId&gt;druid&lt;/artifactId&gt;
            &lt;version&gt;1.0.26&lt;/version&gt;
        &lt;/dependency&gt;
        &lt;dependency&gt;
            &lt;groupId&gt;org.springframework.boot&lt;/groupId&gt;
            &lt;artifactId&gt;spring-boot-starter-jdbc&lt;/artifactId&gt;
        &lt;/dependency&gt;
        &lt;dependency&gt;
            &lt;groupId&gt;org.springframework.boot&lt;/groupId&gt;
            &lt;artifactId&gt;spring-boot-starter-aop&lt;/artifactId&gt;
        &lt;/dependency&gt;
        &lt;dependency&gt;
            &lt;groupId&gt;com.mchange&lt;/groupId&gt;
            &lt;artifactId&gt;c3p0&lt;/artifactId&gt;
            &lt;version&gt;0.9.5.2&lt;/version&gt;
        &lt;/dependency&gt;
        &lt;dependency&gt;
            &lt;groupId&gt;mysql&lt;/groupId&gt;
            &lt;artifactId&gt;mysql-connector-java&lt;/artifactId&gt;
            &lt;version&gt;5.1.41&lt;/version&gt;
        &lt;/dependency&gt;</code></pre>
<h3 id="druid配置文件"><a href="#druid配置文件" class="headerlink" title="druid配置文件"></a>druid配置文件</h3><p><code>@ConfigurationProperties(prefix = &quot;spring.druid&quot;,ignoreInvalidFields = true)</code>的作用为读取默认的配置文件application.properties配置，以spring.druid作为前缀读取变量名对应的属性。要使用这个注解必须使用<code>@EnableConfigurationProperties(DruidConfig.class)</code>开启配置文件读取功能</p>
<p>需要注意默认是读取的application.properties配置文件，配置文件不在默认文件中需要在类中引入配置文件例如：<code>@PropertySource(value = &quot;classpath:druid.properties&quot;)</code></p>
<pre><code class="java">@Data
@Configuration
@ConfigurationProperties(prefix = &quot;spring.druid&quot;, ignoreInvalidFields = true)
public class DruidConfig {
    private String driverClassName;
    private String jdbcUrl1;
    private String jdbcUrl2;
    private String username1;
    private String password1;
    private String username2;
    private String password2;
    private int maxActive;
    private int minIdle;
    private int initialSize;
    private Long timeBetweenEvictionRunsMillis;
    private Long minEvictableIdleTimeMillis;
    private String validationQuery;
    private boolean testWhileIdle;
    private boolean testOnBorrow;
    private boolean testOnReturn;
    private boolean poolPreparedStatements;
    private Integer maxPoolPreparedStatementPerConnectionSize;
    private String filters;
    private String connectionProperties;

    @Bean(destroyMethod = &quot;close&quot;, initMethod = &quot;init&quot;)
    public DataSource getDs1() {
        DruidDataSource druidDataSource = new DruidDataSource();
        druidDataSource.setDriverClassName(driverClassName);
        druidDataSource.setUrl(jdbcUrl1);
        druidDataSource.setUsername(username1);
        druidDataSource.setPassword(password1);
        druidDataSource.setMaxActive(maxActive);
        druidDataSource.setInitialSize(initialSize);
        druidDataSource.setTimeBetweenConnectErrorMillis(timeBetweenEvictionRunsMillis);
        druidDataSource.setMinEvictableIdleTimeMillis(minEvictableIdleTimeMillis);
        druidDataSource.setValidationQuery(validationQuery);
        druidDataSource.setTestWhileIdle(testWhileIdle);
        druidDataSource.setTestOnBorrow(testOnBorrow);
        druidDataSource.setTestOnReturn(testOnReturn);
        druidDataSource.setPoolPreparedStatements(poolPreparedStatements);
        druidDataSource.setMaxPoolPreparedStatementPerConnectionSize(maxPoolPreparedStatementPerConnectionSize);
        try {
            druidDataSource.setFilters(filters);
        } catch (SQLException e) {
            e.printStackTrace();
        }

        return druidDataSource;
    }

    @Bean(destroyMethod = &quot;close&quot;, initMethod = &quot;init&quot;)
    public DataSource getDs2() {
        DruidDataSource druidDataSource = new DruidDataSource();
        druidDataSource.setDriverClassName(driverClassName);
        druidDataSource.setUrl(jdbcUrl2);
        druidDataSource.setUsername(username2);
        druidDataSource.setPassword(password2);
        druidDataSource.setMaxActive(maxActive);
        druidDataSource.setInitialSize(initialSize);
        druidDataSource.setTimeBetweenConnectErrorMillis(timeBetweenEvictionRunsMillis);
        druidDataSource.setMinEvictableIdleTimeMillis(minEvictableIdleTimeMillis);
        druidDataSource.setValidationQuery(validationQuery);
        druidDataSource.setTestWhileIdle(testWhileIdle);
        druidDataSource.setTestOnBorrow(testOnBorrow);
        druidDataSource.setTestOnReturn(testOnReturn);
        druidDataSource.setPoolPreparedStatements(poolPreparedStatements);
        druidDataSource.setMaxPoolPreparedStatementPerConnectionSize(maxPoolPreparedStatementPerConnectionSize);
        try {
            druidDataSource.setFilters(filters);
        } catch (SQLException e) {
            e.printStackTrace();
        }

        return druidDataSource;
    }

    @Bean
    public DataSource dynamicDataSource() {
        Map&lt;Object, Object&gt; targetDataSources = new HashMap&lt;&gt;();
        DataSource ds1 = getDs1();
        targetDataSources.put(&quot;ds1&quot;, ds1);
        targetDataSources.put(&quot;ds2&quot;, getDs2());
        DynamicDataSource dynamicDataSource = new DynamicDataSource();
        dynamicDataSource.setTargetDataSources(targetDataSources);
        dynamicDataSource.setDefaultTargetDataSource(ds1);
        DynamicDataSourceContextHolder.dataSourceIds.add(&quot;ds1&quot;);
        DynamicDataSourceContextHolder.dataSourceIds.add(&quot;ds2&quot;);
        return dynamicDataSource;
    }

    /**
     * 配置访问druid监控
     *
     * @return
     */
    @Bean
    public ServletRegistrationBean druidStateViewServlet() {
        ServletRegistrationBean servletRegistrationBean = new ServletRegistrationBean(new StatViewServlet(), &quot;/druid/*&quot;);
        //初始化参数initParams
        //添加白名单
        servletRegistrationBean.addInitParameter(&quot;allow&quot;, &quot;&quot;);
        //添加ip黑名单
        servletRegistrationBean.addInitParameter(&quot;deny&quot;, &quot;192.168.16.111&quot;);
        //登录查看信息的账号密码
        servletRegistrationBean.addInitParameter(&quot;loginUsername&quot;, &quot;admin&quot;);
        servletRegistrationBean.addInitParameter(&quot;loginPassword&quot;, &quot;123&quot;);
        //是否能够重置数据
        servletRegistrationBean.addInitParameter(&quot;resetEnable&quot;, &quot;false&quot;);
        return servletRegistrationBean;
    }

    /**
     * 过滤不需要监控的后缀
     *
     * @return
     */
    @Bean
    public FilterRegistrationBean druidStatFilter() {
        FilterRegistrationBean filterRegistrationBean = new FilterRegistrationBean(new WebStatFilter());
        //添加过滤规则
        filterRegistrationBean.addUrlPatterns(&quot;/*&quot;);
        //添加不需要忽略的格式信息
        filterRegistrationBean.addInitParameter(&quot;exclusions&quot;, &quot;*.js,*.gif,*.jpg,*.png,*.css,*.ico,/druid/*&quot;);
        return filterRegistrationBean;
    }
}
</code></pre>
<h3 id="application-properties"><a href="#application-properties" class="headerlink" title="application.properties"></a>application.properties</h3><pre><code class="properties">spring.druid.jdbcUrl1=jdbc:mysql://localhost/test
spring.druid.jdbcUrl2=jdbc:mysql://localhost/test
spring.druid.username1=
spring.druid.password1=
spring.druid.username2=
spring.druid.password2=
spring.druid.initialSize=2
spring.druid.minIdle=2
spring.druid.maxActive=2
spring.druid.maxWait=60000
spring.druid.timeBetweenEvictionRunsMillis=60000
spring.druid.minEvictableIdleTimeMillis=300000
spring.druid.validationQuery=SELECT 1 FROM DUAL
spring.druid.testWhileIdle=true
spring.druid.testOnBorrow=false
spring.druid.testOnReturn=false
spring.druid.poolPreparedStatements=true
spring.druid.maxPoolPreparedStatementPerConnectionSize=20
spring.druid.filters=stat,wall
spring.druid.connectionProperties=druid.stat.mergeSql=true;druid.stat.slowSqlMillis=5000</code></pre>
<h3 id="多数据源切面"><a href="#多数据源切面" class="headerlink" title="多数据源切面"></a>多数据源切面</h3><pre><code class="java">public class DynamicDataSource extends AbstractRoutingDataSource {
    @Override
    protected Object determineCurrentLookupKey() {
        try {
            Field targetF = this.getClass().getSuperclass().getDeclaredField(&quot;targetDataSources&quot;);
            targetF.setAccessible(true);
            Map&lt;Object, Object&gt; targetV = (Map&lt;Object, Object&gt;) targetF.get(this);
            String ds = DynamicDataSourceContextHolder.getDataSourceType();
            if (ds != null) {
                System.out.println(&quot;操作的数据源是： &quot;
                        + ds + &quot;-&gt;url:&quot; + ((DruidDataSource) targetV.get(ds)).getUrl());
            }
            return DynamicDataSourceContextHolder.getDataSourceType();
        } catch (NoSuchFieldException e) {
            e.printStackTrace();
        } catch (IllegalAccessException e) {
            e.printStackTrace();
        }
        return &quot;ds1&quot;;
    }
}</code></pre>
<pre><code class="java">@Aspect
@Order(-1)
@Component
public class DynamicDataSourceAspect {
    private static final Logger logger = LoggerFactory.getLogger(DynamicDataSourceAspect.class);

    @Before(&quot;@annotation(ds)&quot;)
    public void changeDataSource(JoinPoint point, TargetDataSource ds) {
        //这个就是数据源标识
        String dsId = ds.name();
        if (!DynamicDataSourceContextHolder.containsDataSource(dsId)) {
            logger.error(&quot;数据源[{}]不存在，使用默认数据源 &gt; {}&quot;, ds.name(),
                    point.getSignature());
        } else {
            logger.debug(&quot;使用数据源[{}] &gt; {}&quot;, ds.name(), point.getSignature());
            //如果容器中有数据源，那么就把数据源标识设置到ThreadLocal中
            DynamicDataSourceContextHolder.setDataSourceType(dsId);
        }
    }

    @After(&quot;@annotation(ds)&quot;)
    public void releaseLocal(JoinPoint point, TargetDataSource ds) {
        logger.info(&quot;释放ds：&quot; + ds.name() + &quot;的ThreadLocal绑定&quot;);
        if (DynamicDataSourceContextHolder.getDataSourceType() != null) {
            DynamicDataSourceContextHolder.getContextHolder().remove();
        }
    }
}</code></pre>
<pre><code class="java">public class DynamicDataSourceContextHolder {

    private static final ThreadLocal&lt;String&gt; contextHolder = new ThreadLocal&lt;String&gt;();

    public static ThreadLocal&lt;String&gt; getContextHolder() {
        return contextHolder;
    }

    public static List&lt;String&gt; dataSourceIds = new ArrayList&lt;String&gt;();

    public static void setDataSourceType(String dataSourceType) {
        contextHolder.set(dataSourceType);
    }

    public static String getDataSourceType() {
        return contextHolder.get();
    }

    public static boolean containsDataSource(String dataSourceId) {
        return dataSourceIds.contains(dataSourceId);
    }
}</code></pre>
<pre><code class="java">@Target({ElementType.METHOD, ElementType.TYPE})
@Retention(RetentionPolicy.RUNTIME)
@Documented
public @interface TargetDataSource {
    String name();
}</code></pre>
<p>如果要使用但数据源也很简单，只要去掉切面注解、dynamicDataSource()方法上的@Bean即可。</p>
<h2 id="整合ORM框架"><a href="#整合ORM框架" class="headerlink" title="整合ORM框架"></a>整合ORM框架</h2><h3 id="mybatis"><a href="#mybatis" class="headerlink" title="mybatis"></a>mybatis</h3><p>pom文件中引入</p>
<pre><code class="xml">&lt;dependency&gt;
    &lt;groupId&gt;org.mybatis.spring.boot&lt;/groupId&gt;
    &lt;artifactId&gt;mybatis-spring-boot-starter&lt;/artifactId&gt;
    &lt;version&gt;RELEASE&lt;/version&gt;
&lt;/dependency&gt;</code></pre>
<p>在启动类添加扫描注解<code>@MapperScan(&quot;com.demo.springboot&quot;)</code></p>
<p>application.properties</p>
<pre><code class="properties">#配置该包下的bean别名
mybatis.typeAliasesPackage=com.demo.mybatis.bean
#解析该路径下的xm建立接口映射关系
mybatis.mapperLocations=classpath:mapper/*Mapper.xml</code></pre>
<p>注：如果出现xml找不到的情况可以在pom文件的build标签中加入以下内容</p>
<pre><code class="xml">&lt;resources&gt;
    &lt;resource&gt;
        &lt;directory&gt;src/main/java&lt;/directory&gt;
        &lt;includes&gt;
            &lt;include&gt;**/*.properties&lt;/include&gt;
            &lt;include&gt;**/*.xml&lt;/include&gt;
        &lt;/includes&gt;
        &lt;filtering&gt;false&lt;/filtering&gt;
    &lt;/resource&gt;
    &lt;resource&gt;
        &lt;directory&gt;src/main/resources&lt;/directory&gt;
        &lt;includes&gt;
            &lt;include&gt;**/*.properties&lt;/include&gt;
            &lt;include&gt;**/*.xml&lt;/include&gt;
            &lt;include&gt;**/*.txt&lt;/include&gt;
            &lt;include&gt;**/*.keystore&lt;/include&gt;
        &lt;/includes&gt;
        &lt;filtering&gt;false&lt;/filtering&gt;
    &lt;/resource&gt;
&lt;/resources&gt;</code></pre>
<h3 id="JPA"><a href="#JPA" class="headerlink" title="JPA"></a>JPA</h3><p>pom文件中加入</p>
<pre><code class="xml">        &lt;dependency&gt;
            &lt;groupId&gt;org.springframework.boot&lt;/groupId&gt;
            &lt;artifactId&gt;spring-boot-starter-data-jpa&lt;/artifactId&gt;
        &lt;/dependency&gt;</code></pre>
<p>application.properties</p>
<pre><code class="properties">#设置为create时会自动创建表 
spring.jpa.hibernate.ddl-auto=update
#打印sql语句
spring.jpa.show-sql=true</code></pre>
<p>entity</p>
<pre><code class="java">@Data
@Entity
@Table(name = &quot;studnet&quot;)
public class Student {
    @Id
    @GeneratedValue(strategy = GenerationType.IDENTITY)
    private Integer id;
    @Column(name = &quot;name&quot;)
    private String name;
    @Column(name = &quot;card_num&quot;)
    private String cardNum;
}</code></pre>
<p>dao</p>
<pre><code class="java">public interface StudentDao extends JpaRepository&lt;Student,Integer&gt; {
}</code></pre>
<p>业务代码中的使用</p>
<pre><code class="java">@Service
public class StudentServiceImpl implements StudentService {
    @Autowired
    private StudentDao studentDao;

    @Override
    public void save() {
        Student s = new Student();
        s.setId(1);
        s.setName(&quot;name&quot;);
        s.setCardNum(&quot;123123123&quot;);
        studentDao.save(s);
    }

    @Override
    public List&lt;Student&gt; getAll() {
        return studentDao.findAll();
    }
}</code></pre>
<h2 id="整合Atomikos"><a href="#整合Atomikos" class="headerlink" title="整合Atomikos"></a>整合Atomikos</h2><p> Atomikos是一个基于XA协议的分布式事务解决管理框架，其核心思想就是两段提交，一般使用在涉及到的对多个数据源的操作的业务方法中，保证对两个数据源的同时提交和同时回滚。</p>
<img src="/2020/04/22/springboot%E5%90%84%E7%A7%8D%E7%BB%84%E4%BB%B6%E7%9A%84%E6%95%B4%E5%90%88/pic1.png" srcset="/img/loading.gif" class="">

<p>Atomikos就是图中的事务协调器的角色，负责对两个数据源的管理，同时提交或同时回滚。 就是在真正提交之前有一个预提交的过程，就是检测两个数据源是否能够提交， 如果有一个返回 No，那么这个事务就不能提交。</p>
<p>pom中引入</p>
<pre><code class="xml">&lt;dependency&gt;
    &lt;groupId&gt;org.springframework.boot&lt;/groupId&gt;
    &lt;artifactId&gt;spring-boot-starter-jta-atomikos&lt;/artifactId&gt;
&lt;/dependency&gt;</code></pre>
<p>application.properties文件中</p>
<pre><code class="properties"># Mysql 1
mysql.datasource.test1.url = jdbc:mysql://localhost:3307/test?useUnicode=true&amp;characterEncoding=utf-8
mysql.datasource.test1.username = 
mysql.datasource.test1.password = 
mysql.datasource.test1.minPoolSize = 3
mysql.datasource.test1.maxPoolSize = 25
mysql.datasource.test1.maxLifetime = 20000
mysql.datasource.test1.borrowConnectionTimeout = 30
mysql.datasource.test1.loginTimeout = 30
mysql.datasource.test1.maintenanceInterval = 60
mysql.datasource.test1.maxIdleTime = 60

# Mysql 2
mysql.datasource.test2.url =jdbc:mysql://localhost:3306/test?useUnicode=true&amp;characterEncoding=utf-8
mysql.datasource.test2.username =
mysql.datasource.test2.password =
mysql.datasource.test2.minPoolSize = 3
mysql.datasource.test2.maxPoolSize = 25
mysql.datasource.test2.maxLifetime = 20000
mysql.datasource.test2.borrowConnectionTimeout = 30
mysql.datasource.test2.loginTimeout = 30
mysql.datasource.test2.maintenanceInterval = 60
mysql.datasource.test2.maxIdleTime = 60

logging.level.root=info
#logging.level.org.springframework.*=debug

logging.level.com.xiangxue.atomikos.db1.dao=debug
logging.level.com.xiangxue.atomikos.db2.dao=debug

spring.devtools.restart.enabled=true
spring.devtools.restart.additional-paths=src/main/java

spring.devtools.restart.exclude=WEB-INF/**</code></pre>
<p>数据源创建，这里只列举一个数据源的创建，另一个创建方式与这个相同。</p>
<pre><code class="java">@Configuration
@MapperScan(basePackages = &quot;com.demo.atomikos.db1.dao&quot;, sqlSessionFactoryRef = &quot;test1SqlSessionFactory&quot;,sqlSessionTemplateRef=&quot;test1SqlSessionTemplate&quot;)
public class Db1Config {

    @Autowired
    DBConfig1 testConfig;

    @Bean(name = &quot;test1DataSource&quot;)
    public DataSource testDataSource() {
        MysqlXADataSource mysqlXaDataSource = new MysqlXADataSource();
        mysqlXaDataSource.setUrl(testConfig.getUrl());
        mysqlXaDataSource.setPinGlobalTxToPhysicalConnection(true);
        mysqlXaDataSource.setPassword(testConfig.getPassword());
        mysqlXaDataSource.setUser(testConfig.getUsername());
        mysqlXaDataSource.setPinGlobalTxToPhysicalConnection(true);

        AtomikosDataSourceBean xaDataSource = new AtomikosDataSourceBean();
        xaDataSource.setXaDataSource(mysqlXaDataSource);
        xaDataSource.setUniqueResourceName(&quot;test1DataSource&quot;);
        xaDataSource.setMinPoolSize(testConfig.getMinPoolSize());
        xaDataSource.setMaxPoolSize(testConfig.getMaxPoolSize());
        xaDataSource.setMaxLifetime(testConfig.getMaxLifetime());
        xaDataSource.setBorrowConnectionTimeout(testConfig.getBorrowConnectionTimeout());
        try {
            xaDataSource.setLoginTimeout(testConfig.getLoginTimeout());
        } catch (SQLException e) {
            e.printStackTrace();
        }
        xaDataSource.setMaintenanceInterval(testConfig.getMaintenanceInterval());
        xaDataSource.setMaxIdleTime(testConfig.getMaxIdleTime());
        xaDataSource.setTestQuery(testConfig.getTestQuery());
        return xaDataSource;
    }

    @Bean(name = &quot;test1SqlSessionFactory&quot;)
    public SqlSessionFactory testSqlSessionFactory(@Qualifier(&quot;test1DataSource&quot;) DataSource dataSource)
            throws Exception {
        SqlSessionFactoryBean bean = new SqlSessionFactoryBean();
        bean.setDataSource(dataSource);
        return bean.getObject();
    }

    @Bean(name = &quot;test1SqlSessionTemplate&quot;)
    public SqlSessionTemplate testSqlSessionTemplate(
            @Qualifier(&quot;test1SqlSessionFactory&quot;) SqlSessionFactory sqlSessionFactory) throws Exception {
        return new SqlSessionTemplate(sqlSessionFactory);
    }
}</code></pre>
<p>具体使用</p>
<pre><code class="java">@Service
public class AreaServiceImpl implements AreaService {

    @Autowired
    private CommonMapper1 commonMapper1;

    @Autowired
    private CommonMapper2 commonMapper2;

    @Autowired
    TransactionManager transactionManager;

    @Transactional
    public int saveArea(ConsultConfigArea area) {
        System.out.println(transactionManager);
        JtaTransactionManager jtaTransactionManager = (JtaTransactionManager)transactionManager;
        System.out.println(jtaTransactionManager.getUserTransaction());
        UserTransaction userTransaction = jtaTransactionManager.getUserTransaction();
        int count = commonMapper1.addArea(area);
        int count1 = commonMapper2.addArea(area);
        if(true) throw new RuntimeException(&quot;xx&quot;);
        return count;
    }
}</code></pre>
<p>这里 spring 事务已经交给 atomikos 来管理了，其实就是由 atomikos 中的 JtaTransationManager 来管理事务，重写了 commit 和 Rollback 和 getTransaction 方法，只是 commit 和 Rollback 是对两个数据源的操作而已。</p>
<h2 id="整合redis"><a href="#整合redis" class="headerlink" title="整合redis"></a>整合redis</h2><p>pom文件</p>
<pre><code class="xml">&lt;dependency&gt;
    &lt;groupId&gt;org.springframework.boot&lt;/groupId&gt;
    &lt;artifactId&gt;spring-boot-starter-data-redis&lt;/artifactId&gt;
&lt;/dependency&gt;</code></pre>
<p>application.prperties文件</p>
<pre><code class="properties">spring.redis.database=0
spring.redis.host=192.168.0.1
spring.redis.port=6379
spring.redis.password=
spring.redis.pool.max-active=8
spring.redis.pool.max-wait=-1
spring.redis.pool.max-idle=8
spring.redis.pool.min-idle=0
spring.redis.timeout=0</code></pre>
<p>redis.config</p>
<pre><code class="java">@Configuration
@EnableCaching
public class RedisConfig {

    //缓存管理器
    @Bean
    public CacheManager cacheManager(RedisConnectionFactory redisConnectionFactory) {
        RedisCacheConfiguration redisCacheConfiguration = RedisCacheConfiguration.defaultCacheConfig()
                .entryTtl(Duration.ofHours(1)); // 设置缓存有效期一小时
        return RedisCacheManager
                .builder(RedisCacheWriter.nonLockingRedisCacheWriter(redisConnectionFactory))
                .cacheDefaults(redisCacheConfiguration).build();
    }

    @Bean
    public RedisTemplate&lt;String, Object&gt; redisTemplate(RedisConnectionFactory factory) {
        RedisTemplate&lt;String, Object&gt; template = new RedisTemplate&lt;&gt;();
        // 配置连接工厂
        template.setConnectionFactory(factory);
        //使用Jackson2JsonRedisSerializer来序列化和反序列化redis的value值（默认使用JDK的序列化方式）
        Jackson2JsonRedisSerializer jacksonSeial = new Jackson2JsonRedisSerializer(Object.class);
        ObjectMapper om = new ObjectMapper();
        // 指定要序列化的域，field,get和set,以及修饰符范围，ANY是都有包括private和public
        om.setVisibility(PropertyAccessor.ALL, JsonAutoDetect.Visibility.ANY);
        // 指定序列化输入的类型，类必须是非final修饰的，final修饰的类，比如String,Integer等会跑出异常
        om.enableDefaultTyping(ObjectMapper.DefaultTyping.NON_FINAL);
        jacksonSeial.setObjectMapper(om);
        // 值采用json序列化
        template.setValueSerializer(jacksonSeial);
        //使用StringRedisSerializer来序列化和反序列化redis的key值
        template.setKeySerializer(new StringRedisSerializer());
        // 设置hash key 和value序列化模式
        template.setHashKeySerializer(new StringRedisSerializer());
        template.setHashValueSerializer(jacksonSeial);
        template.afterPropertiesSet();
        return template;
    }
}</code></pre>
<p>在业务代码中只要在方法上面加上@Cacheable@CachePut 注解就可以了，spring就会把业务代码的返回结果存到redis中。还可以通过直接注入RedisTemplate来使用。</p>
<h2 id="整合mongodb"><a href="#整合mongodb" class="headerlink" title="整合mongodb"></a>整合mongodb</h2><p>pom文件</p>
<pre><code class="xml">&lt;dependency&gt;
    &lt;groupId&gt;org.springframework.boot&lt;/groupId&gt;
    &lt;artifactId&gt;spring-boot-starter-data-mongodb&lt;/artifactId&gt;
&lt;/dependency&gt;</code></pre>
<p>application.properteis</p>
<pre><code class="properties">spring.data.mongodb.uri=mongodb://192.168.0.1:27017/xx_db</code></pre>
<p>代码案例</p>
<pre><code class="java">@Service
public class MongoServiceImpl implements MongoService&lt;User&gt; {

    @Autowired
    private MongoTemplate mongoTemplate;

    @Override
    public String save(User obj) {
        mongoTemplate.save(obj);
        return &quot;1&quot;;
    }
}</code></pre>
<p>mongoTemplate对象同样可以通过依赖注入获取到。</p>
<h2 id="springboot整合JAX-RS规范"><a href="#springboot整合JAX-RS规范" class="headerlink" title="springboot整合JAX-RS规范"></a>springboot整合JAX-RS规范</h2><p>JAX-RS是JAVAEE6引入的一个新技术。JAX-RS即JavaAPIforRESTfulWebServices，是一个Java编程语言的应用程序接口，支持按照表述性状态转移(REST)架构风格创建Web服务。JAX-RS使用了JavaSE5引入的Java注解来简化Web服务的客户端和服务端的开发和部署。springcloud中就是用了JAX-RS规范，其实就是类似于Servlet规范来接收用户请求的一个规范。</p>
<p>pom文件</p>
<pre><code class="xml">&lt;dependency&gt;
    &lt;groupId&gt;org.springframework.boot&lt;/groupId&gt;
    &lt;artifactId&gt;spring-boot-starter-jersey&lt;/artifactId&gt;
&lt;/dependency&gt;</code></pre>
<p>代码配置</p>
<pre><code class="java">@Configuration
public class JerseyConfig {
    @Bean
    public ServletRegistrationBean jerseyServlet() {
        //设置拦截路径
        ServletRegistrationBean registrationBean = new ServletRegistrationBean(new ServletContainer(), &quot;/rest/*&quot;);
        //注册controller
        registrationBean.addInitParameter(ServletProperties.JAXRS_APPLICATION_CLASS, JerseyResourceConfig.class.getName());
        return registrationBean;
    }
}</code></pre>
<pre><code class="java">public class JerseyResourceConfig extends ResourceConfig {
    public JerseyResourceConfig() {
        // 扫描某个类
        register(RequestContextFilter.class);
        // 扫描包下的所有类
        packages(&quot;com.demo.jersey&quot;);
    }
}</code></pre>
<p>具体使用</p>
<pre><code class="java">@Path(&quot;/jersey/&quot;)
public class JerseyController {
    @Path(&quot;{id}&quot;)
    @GET
    @Produces(MediaType.APPLICATION_JSON)
    public String hello(@PathParam(&quot;id&quot;) Long id) {
        return &quot;hello&quot;;
    }
}</code></pre>
<h2 id="整合jsp"><a href="#整合jsp" class="headerlink" title="整合jsp"></a>整合jsp</h2><p>pom文件</p>
<pre><code class="xml">&lt;dependency&gt;
    &lt;groupId&gt;org.apache.tomcat.embed&lt;/groupId&gt;
    &lt;artifactId&gt;tomcat-embed-jasper&lt;/artifactId&gt;
    &lt;scope&gt;provided&lt;/scope&gt;
&lt;/dependency&gt;
&lt;dependency&gt;
    &lt;groupId&gt;javax.servlet&lt;/groupId&gt;
    &lt;artifactId&gt;jstl&lt;/artifactId&gt;
&lt;/dependency&gt;</code></pre>
<p>application.properties</p>
<pre><code class="properties">spring.mvc.view.prefix=/WEB-INF/jsp/
spring.mvc.view.suffix=.jsp</code></pre>
<p>创建resources平级目录webapp然后将jsp放入/WEB-INF/jsp/后就可以正常使用。</p>
<h2 id="整合freemarker"><a href="#整合freemarker" class="headerlink" title="整合freemarker"></a>整合freemarker</h2><p>jar包导入</p>
<pre><code class="xml">        &lt;dependency&gt;
            &lt;groupId&gt;org.springframework.boot&lt;/groupId&gt;
            &lt;artifactId&gt;spring-boot-starter-freemarker&lt;/artifactId&gt;
        &lt;/dependency&gt;</code></pre>
<p>application.properties文件</p>
<pre><code class="properties">spring.freemarker.allow-request-override=false
spring.freemarker.cache=true
spring.freemarker.check-template-location=true
spring.freemarker.charset=UTF-8
spring.freemarker.content-type=text/html
spring.freemarker.expose-request-attributes=false
spring.freemarker.expose-session-attributes=false
spring.freemarker.expose-spring-macro-helpers=false</code></pre>
<p>freemarker默认会加载resources下的.ftl后缀文件</p>
<h2 id="整合swagger2"><a href="#整合swagger2" class="headerlink" title="整合swagger2"></a>整合swagger2</h2><p>pom文件</p>
<pre><code class="xml">        &lt;dependency&gt;
            &lt;groupId&gt;io.springfox&lt;/groupId&gt;
            &lt;artifactId&gt;springfox-swagger2&lt;/artifactId&gt;
            &lt;version&gt;2.9.2&lt;/version&gt;
        &lt;/dependency&gt;
        &lt;dependency&gt;
            &lt;groupId&gt;io.springfox&lt;/groupId&gt;
            &lt;artifactId&gt;springfox-swagger-ui&lt;/artifactId&gt;
            &lt;version&gt;2.9.2&lt;/version&gt;
        &lt;/dependency&gt;</code></pre>
<p>代码配置</p>
<pre><code class="java">@Configuration
@EnableSwagger2
public class SwaggerConfig {
    @Bean
    public Docket createRestApi() {
        return new Docket(DocumentationType.SWAGGER_2)
                .pathMapping(&quot;/&quot;)
                .select()
                .apis(RequestHandlerSelectors.basePackage(&quot;com.demo.controller&quot;))
                .paths(PathSelectors.any())
                .build().apiInfo(new ApiInfoBuilder()
                        .title(&quot;xx公司API文档&quot;)
                        .description(&quot;xx公司API文档&quot;)
                        .version(&quot;9.0&quot;)
                        .contact(new Contact(&quot;test&quot;, &quot;blog.csdn.net&quot;, &quot;aaa@gmail.com&quot;))
                        .license(&quot;The Apache License&quot;)
                        .licenseUrl(&quot;http://www.baidu.com&quot;)
                        .build());
    }
}</code></pre>
<p>具体使用</p>
<pre><code class="java">@Controller
@Api(tags = &quot;springboot学习工程相关接口&quot;)
public class JackController {

    private static final Logger logger = LoggerFactory.getLogger(JackController.class);

    @Autowired
    AreaService areaService;

    @Value(&quot;${application.field:default value jack}&quot;)
    private String zhuguangField = &quot;&quot;;

    @ApiOperation(&quot;查询地区接口&quot;)
    @ApiImplicitParams({
            @ApiImplicitParam(name = &quot;param&quot;, value = &quot;地区编码&quot;)
    })
    @RequestMapping(&quot;/queryArea&quot;)
    public @ResponseBody String queryArea(String param) {
        List&lt;ConsultConfigArea&gt; areas = areaService.qryArea(new HashMap());
        for (ConsultConfigArea area : areas) {
            logger.info(area.getAreaCode() + &quot;   &quot; + area.getAreaName() + &quot;   &quot;
                    + area.getState());
        }
        return &quot;OK&quot;;
    }
}</code></pre>
<p>文档地址<code>localhost:8080/swagger-ui.html</code></p>
<h2 id="整合-Actuator监控管理"><a href="#整合-Actuator监控管理" class="headerlink" title="整合 Actuator监控管理"></a>整合 Actuator监控管理</h2><p>Actuator监控是一个用于监控springboot健康状况的工具，可以实时监控的工程的健康和调用情况，通常配合springboot-admin使用。</p>
<p>pom文件中</p>
<pre><code class="xml">&lt;dependency&gt;
    &lt;groupId&gt;org.springframework.boot&lt;/groupId&gt;
    &lt;artifactId&gt;spring-boot-starter-actuator&lt;/artifactId&gt;
&lt;/dependency&gt;</code></pre>
<p>application.properties配置</p>
<pre><code class="properties">#默认只有info、health接口
management.endpoints.web.exposure.include=*</code></pre>
<p>这个监控不需要使用，是自动统计消息的。可以通过一下请求获取到系统信息：</p>
<ul>
<li><p>/health/{component}/{instance}：GET报告程序的健康指标，这些数据由HealthIndicator实现类提供</p>
</li>
<li><p>/info：GET获取程序指定发布的信息，这些信息由配置文件中info打头的属性提供</p>
</li>
<li><p>/configprops：GET描述配置属性(包含默认值)如何注入到bean</p>
</li>
<li><p>/beans：GET描述程序中的bean，及之间的依赖关系</p>
</li>
<li><p>/env：GET获取全部环境属性</p>
</li>
<li><p>/env/{name}：GET根据名称获取指定的环境属性值</p>
</li>
<li><p>/mappings：GET描述全部的URI路径，及和控制器的映射关系</p>
</li>
<li><p>/metrics/{requiredMetricName}：GET统计程序的各种度量信息，如内存用量和请求数</p>
</li>
<li><p>/httptrace：GET提供基本的http请求跟踪信息，如请求头等</p>
</li>
<li><p>/threaddump：GET获取线程活动的快照</p>
</li>
<li><p>/conditions：GET提供自动配置报告，记录哪些自动配置通过，哪些没有通过</p>
</li>
<li><p>/loggers/{name}：GET查看日志配置信息</p>
</li>
<li><p>/auditevents：GET查看系统发布的事件信息</p>
</li>
<li><p>/caches/{cache}：GET/DELETE查看系统的缓存管理器，另可根据缓存管理器名称查询;另DELETE操作</p>
</li>
<li><p>/scheduledtasks：GET查看系统发布的定时任务信息</p>
</li>
<li><p>/features：GET查看Springcloud全家桶组件信息</p>
</li>
<li><p>/refresh：POST重启应用程序，慎用</p>
</li>
<li><p>/shutdown：POST关闭应用程序，慎用</p>
</li>
</ul>
<h2 id="整合https"><a href="#整合https" class="headerlink" title="整合https"></a>整合https</h2><p>进入到jdk的bin目录中，执行生成证书的指令：</p>
<pre><code>keytool -genkey -alias spring -keypass 123456 -keyalg RSA -keysize 1024 -validity 365 -keystore E:/springboot.keystore -storepass 123456</code></pre><p>参数介绍：</p>
<ul>
<li><p>genkey：表示要创建一个新的密钥。</p>
</li>
<li><p>alias：表示keystore的别名。</p>
</li>
<li><p>keyalg：表示使用的加密算法是RSA，一种非对称加密算法。</p>
</li>
<li><p>keysize：表示密钥的长度。</p>
</li>
<li><p>keystore：表示生成的密钥存放位置。validity表示密钥的有效时间，单位为天。</p>
</li>
</ul>
<p>注意：在正式开发过程中，需要申请正式的、能够被浏览器信任的证书。</p>
<p>然后将生成的证书复制到resource目录，在application.properties配置：</p>
<pre><code class="properties">server.port=8881
server.ssl.key-password=123456
server.ssl.key-store=classpath:springboot.keystore
server.ssl.key-alias=spring</code></pre>
<p>这时再使用http的访问方式就会出错。</p>
<h2 id="整合rabbitmq"><a href="#整合rabbitmq" class="headerlink" title="整合rabbitmq"></a>整合rabbitmq</h2><p>pom.xml中</p>
<pre><code class="properties">&lt;dependency&gt;
    &lt;groupId&gt;org.springframework.boot&lt;/groupId&gt;
    &lt;artifactId&gt;spring-boot-starter-amqp&lt;/artifactId&gt;
&lt;/dependency&gt;</code></pre>
<p>application.properties</p>
<pre><code class="properties">spring.rabbitmq.host=192.168.88.139
spring.rabbitmq.port=5672
spring.rabbitmq.username=admin
spring.rabbitmq.password=admin</code></pre>
<p>配置类</p>
<pre><code class="java">@Configuration
@EnableRabbit
public class RabbitmqConfig {
    /**
     * 创建队列Queue
     */
    @Bean(name = &quot;message&quot;)
    public Queue queueMessage(){
        return new Queue(&quot;test.message&quot;);
    }

    /**
     * 创建交换器Exchange
     */
    @Bean
    public TopicExchange exchange(){
        return new TopicExchange(&quot;exchange.message&quot;);
    }

    /**
     * 创建Exchange跟Queue和routeKey的绑定关系bindings
     */
    @Bean
    Binding bindingExchangeMessage(@Qualifier(&quot;message&quot;)Queue queueMessage,TopicExchange exchange){
        return BindingBuilder.bind(queueMessage)
                .to(exchange)
                .with(&quot;test.message.routeKey&quot;);
    }
}</code></pre>
<p>发送消息</p>
<pre><code class="java">    @Autowired
    private AmqpTemplate amqpTemplate;
    public void sendMessage(){
        amqpTemplate.convertAndSend(&quot;exchange.message&quot;,&quot;test.message.routeKey&quot;,&quot;hello&quot;);
    }</code></pre>
<p>接受消息</p>
<pre><code class="java">    @RabbitListener(queues = &quot;test.message&quot;)
    public void process(String message){
        System.out.println(message);
    }</code></pre>
<h2 id="docker化"><a href="#docker化" class="headerlink" title="docker化"></a>docker化</h2><p>pom文件中加入打包插件</p>
<pre><code class="xml">        &lt;plugins&gt;
            &lt;plugin&gt;
                &lt;groupId&gt;org.springframework.boot&lt;/groupId&gt;
                &lt;artifactId&gt;spring-boot-maven-plugin&lt;/artifactId&gt;
            &lt;/plugin&gt;
            &lt;plugin&gt;
                &lt;groupId&gt;com.spotify&lt;/groupId&gt;
                &lt;artifactId&gt;docker-maven-plugin&lt;/artifactId&gt;
                &lt;configuration&gt;
                    &lt;imageName&gt;demo/springboot&lt;/imageName&gt;
                    &lt;dockerDirectory&gt;${project.basedir}&lt;/dockerDirectory&gt;
                    &lt;resources&gt;
                        &lt;resource&gt;
                            &lt;targetPath&gt;/&lt;/targetPath&gt;
                            &lt;directory&gt;${project.build.directory}&lt;/directory&gt;
                            &lt;include&gt;${project.build.finalName}.jar&lt;/include&gt;
                        &lt;/resource&gt;
                    &lt;/resources&gt;
                &lt;/configuration&gt;
            &lt;/plugin&gt;
        &lt;/plugins&gt;</code></pre>
<p>在项目目录中创建Dockerfile文件</p>
<pre><code>FROM java:8
EXPOSE 8080
VOLUME /tmp
ADD [&quot;*.jar&quot;,&quot;app.jar&quot;]
ENTRYPOINT [&quot;java&quot;,&quot;-jar&quot;,&quot;/app.jar&quot;]</code></pre><p>在项目目录下执行指令</p>
<pre><code>mvn package docker:build</code></pre><p>然后根据镜像来启动容器</p>
<pre><code>docker run -ti -d -p 8881:8881 --name springboot test/springboot</code></pre><p>查看容器启动日志</p>
<pre><code>docker logs -f springboot</code></pre>
            </div>
            <hr>
            <div>
              <p>
                
                  <span>
                <i class="iconfont icon-inbox"></i>
                    
                      <a class="hover-with-bg" href="/categories/springboot/">springboot</a>
                      &nbsp;
                    
                  </span>&nbsp;&nbsp;
                
                
                  <span>
                <i class="iconfont icon-tag"></i>
                    
                      <a class="hover-with-bg" href="/tags/springboot/">springboot</a>
                    
                  </span>
                
              </p>
              
                <p class="note note-warning">本博客所有文章除特别声明外，均采用 <a href="https://zh.wikipedia.org/wiki/Wikipedia:CC_BY-SA_3.0%E5%8D%8F%E8%AE%AE%E6%96%87%E6%9C%AC" target="_blank" rel="nofollow noopener noopener">CC BY-SA 3.0协议</a> 。转载请注明出处！</p>
              
              
                <div class="post-prevnext row">
                  <div class="post-prev col-6">
                    
                    
                      <a href="/2020/04/22/springboot%E6%BA%90%E7%A0%81%E8%A7%A3%E6%9E%90/">
                        <i class="fa fa-chevron-left"></i>
                        <span class="hidden-mobile">springboot源码解析</span>
                        <span class="visible-mobile">上一篇</span>
                      </a>
                    
                  </div>
                  <div class="post-next col-6">
                    
                    
                      <a href="/2020/04/21/springmvc%E7%9A%84%E8%AF%B7%E6%B1%82%E5%93%8D%E5%BA%94%E6%A0%B8%E5%BF%83/">
                        <span class="hidden-mobile">springmvc的请求响应核心</span>
                        <span class="visible-mobile">下一篇</span>
                        <i class="fa fa-chevron-right"></i>
                      </a>
                    
                  </div>
                </div>
              
            </div>

              
                <!-- Comments -->
                <div class="comments" id="comments">
                  
                  

                </div>
              
          </div>
        </div>
      </div>
    </div>
    
      <div class="d-none d-lg-block col-lg-2 toc-container" id="toc-ctn">
        <div id="toc-start"></div>
<div id="toc">
  <p class="h5"><i class="far fa-list-alt"></i>&nbsp;目录</p>
  <div id="tocbot"></div>
</div>

      </div>
    
  </div>
</div>

<!-- Custom -->


    
  </main>

  
    <a class="z-depth-1" id="scroll-top-button" href="#" role="button">
      <i class="fa fa-chevron-up scroll-top-arrow" aria-hidden="true"></i>
    </a>
  

  
    <div class="modal fade" id="modalSearch" tabindex="-1" role="dialog" aria-labelledby="ModalLabel"
     aria-hidden="true">
  <div class="modal-dialog modal-dialog-scrollable modal-lg" role="document">
    <div class="modal-content">
      <div class="modal-header text-center">
        <h4 class="modal-title w-100 font-weight-bold">搜索</h4>
        <button type="button" id="local-search-close" class="close" data-dismiss="modal" aria-label="Close">
          <span aria-hidden="true">&times;</span>
        </button>
      </div>
      <div class="modal-body mx-3">
        <div class="md-form mb-5">
          <input type="text" id="local-search-input" class="form-control validate">
          <label data-error="x" data-success="v"
                 for="local-search-input">关键词</label>
        </div>
        <div class="list-group" id="local-search-result"></div>
      </div>
    </div>
  </div>
</div>
  

  

  

  <footer class="mt-5">
  <div class="text-center py-3">
    <div>
      <a href="https://hexo.io" target="_blank" rel="nofollow noopener"><b>Hexo</b></a>
      <i class="iconfont icon-love"></i>
      <a href="https://github.com/fluid-dev/hexo-theme-fluid" target="_blank" rel="nofollow noopener"> <b>Fluid</b></a>
    </div>
    
  <div>
    
      <!-- 不蒜子统计PV -->
      
      <span id="busuanzi_container_site_pv" style="display: none">
      总访问量 <span id="busuanzi_value_site_pv"></span> 次
    </span>
    
    
      <!-- 不蒜子统计UV -->
      
      <span id="busuanzi_container_site_uv" style="display: none">
      总访客数 <span id="busuanzi_value_site_uv"></span> 人
    </span>
    
  </div>


    

    
  </div>
</footer>

<!-- SCRIPTS -->
<script  src="https://cdn.staticfile.org/jquery/3.4.1/jquery.min.js" ></script>
<script  src="https://cdn.staticfile.org/popper.js/1.16.1/umd/popper.min.js" ></script>
<script  src="https://cdn.staticfile.org/twitter-bootstrap/4.4.1/js/bootstrap.min.js" ></script>
<script  src="https://cdn.staticfile.org/mdbootstrap/4.13.0/js/mdb.min.js" ></script>
<script  src="/js/main.js" ></script>


  <script  src="/js/lazyload.js" ></script>



  
  <script  src="https://cdn.staticfile.org/tocbot/4.10.0/tocbot.min.js" ></script>
  <script>
    $(document).ready(function () {
      var navHeight = $('#navbar').height();
      var toc = $('#toc');
      var boardCtn = $('#board-ctn');
      var boardTop = boardCtn.offset().top;
      var tocLimMax = 2 * boardTop + boardCtn.height();

      $(window).scroll(function () {
        var tocLimMin = $('#toc-start').offset().top - navHeight;
        var scroH = document.body.scrollTop + document.documentElement.scrollTop;

        if (tocLimMin <= scroH && scroH <= tocLimMax) {
          toc.css({
            'display': 'block',
            'position': 'fixed',
            'top': navHeight,
          });
        } else if (scroH <= tocLimMin) {
          toc.css({
            'position': '',
            'top': '',
          });
        } else if (scroH > tocLimMax) {
          toc.css('display', 'none');
        }
      });
      tocbot.init({
        tocSelector: '#tocbot',
        contentSelector: '.post-content',
        headingSelector: 'h1,h2,h3,h4,h5,h6',
        linkClass: 'tocbot-link',
        activeLinkClass: 'tocbot-active-link',
        listClass: 'tocbot-list',
        isCollapsedClass: 'tocbot-is-collapsed',
        collapsibleClass: 'tocbot-is-collapsible',
        scrollSmooth: true,
        headingsOffset: -boardTop
      });
      if ($('.toc-list-item').length > 0) {
        $('#toc > p').css('visibility', 'visible');
      }
      var offset = boardCtn.css('margin-right')
      $('#toc-ctn').css({
        'right': offset
      })
    });
  </script>





  <script defer src="https://cdn.staticfile.org/clipboard.js/2.0.6/clipboard.min.js" ></script>
  <script  src="/js/clipboard-use.js" ></script>



  <script defer src="https://cdn.staticfile.org/smoothscroll/1.4.10/SmoothScroll.min.js" ></script>



  <script defer src="https://busuanzi.ibruce.info/busuanzi/2.3/busuanzi.pure.mini.js" ></script>




<!-- Plugins -->


  

  

  

  

  

  



  <script  src="https://cdn.staticfile.org/prettify/188.0.0/prettify.min.js" ></script>
  <script>
    $(document).ready(function () {
      $('pre').addClass('prettyprint  linenums');
      prettyPrint();
    })
  </script>



  <script  src="https://cdn.staticfile.org/typed.js/2.0.11/typed.min.js" ></script>
  <script>
    var typed = new Typed('#subtitle', {
      strings: [
        '  ',
        "springboot各种组件的整合&nbsp;",
      ],
      cursorChar: "_",
      typeSpeed: 70,
      loop: false,
    });
    typed.stop();
    $(document).ready(function () {
      $(".typed-cursor").addClass("h2");
      typed.start();
    });
  </script>



  <script  src="https://cdn.staticfile.org/anchor-js/4.2.2/anchor.min.js" ></script>
  <script>
    anchors.options = {
      placement: "right",
      visible: "hover",
      
    };
    var el = "h1,h2,h3,h4,h5,h6".split(",");
    var res = [];
    for (item of el) {
      res.push(".markdown-body > " + item)
    }
    anchors.add(res.join(", "))
  </script>



  <script  src="/js/local-search.js" ></script>
  <script>
    var path = "/local-search.xml";
    var inputArea = document.querySelector("#local-search-input");
    inputArea.onclick = function () {
      getSearchFile(path);
      this.onclick = null
    }
  </script>



  <script defer src="https://cdn.staticfile.org/fancybox/3.5.7/jquery.fancybox.min.js" ></script>
  <script>
    $("#post img:not(.no-zoom img, img[no-zoom])").each(
      function () {
        var element = document.createElement("a");
        $(element).attr("data-fancybox", "images");
        $(element).attr("href", $(this).attr("src"));
        $(this).wrap(element);
      }
    );
  </script>





  
  
    <script type="text/javascript">
      //定义获取词语下标
      var a_idx = 0;
      jQuery(document).ready(function ($) {
        //点击body时触发事件
        $("body").click(function (e) {
          //需要显示的词语
          var a = new Array("富强", "民主", "文明", "和谐", "自由", "平等", "公正", "法治", "爱国", "敬业", "诚信", "友善");
          //设置词语给span标签
          var $i = $("<span/>").text(a[a_idx]);
          //下标等于原来下标+1  余 词语总数
          a_idx = (a_idx + 1) % a.length;
          //获取鼠标指针的位置，分别相对于文档的左和右边缘。
          //获取x和y的指针坐标
          var x = e.pageX, y = e.pageY;
          //在鼠标的指针的位置给$i定义的span标签添加css样式
          $i.css({
            "z-index": 999,
            "top": y - 20,
            "left": x,
            "position": "absolute",
            "font-weight": "bold",
            "color": rand_color()
          });
          // 随机颜色
          function rand_color() {
            return "rgb(" + ~~(255 * Math.random()) + "," + ~~(255 * Math.random()) + "," + ~~(255 * Math.random()) + ")"
          }
          //在body添加这个标签
          $("body").append($i);
          //animate() 方法执行 CSS 属性集的自定义动画。
          //该方法通过CSS样式将元素从一个状态改变为另一个状态。CSS属性值是逐渐改变的，这样就可以创建动画效果。
          //详情请看http://www.w3school.com.cn/jquery/effect_animate.asp
          $i.animate({
            //将原来的位置向上移动180
            "top": y - 180,
            "opacity": 0
            //1500动画的速度
          }, 1500, function () {
            //时间到了自动删除
            $i.remove();
          });
        });
      })
      ;
    </script>
  








</body>
</html>
