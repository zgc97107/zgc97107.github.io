<!DOCTYPE html>
<html lang="zh-CN">





<head>
  <meta charset="UTF-8">
  <link rel="apple-touch-icon" sizes="76x76" href="/blog/img/apple-touch-icon.png">
  <link rel="icon" type="image/png" href="/blog/img/favicon.png">
  <meta name="viewport"
        content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no, shrink-to-fit=no">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  
  <meta name="theme-color" content="#2f4154">
  <meta name="description" content="">
  <meta name="author" content="">
  <meta name="keywords" content="">
  <title>springbootå„ç§ç»„ä»¶çš„æ•´åˆ - ğŸğŸŠ&#39;s blog</title>

  <link  rel="stylesheet" href="https://cdn.staticfile.org/font-awesome/5.12.1/css/all.min.css" />
<link  rel="stylesheet" href="https://cdn.staticfile.org/twitter-bootstrap/4.4.1/css/bootstrap.min.css" />
<link  rel="stylesheet" href="https://cdn.staticfile.org/mdbootstrap/4.13.0/css/mdb.min.css" />
<link  rel="stylesheet" href="https://cdn.staticfile.org/github-markdown-css/3.0.1/github-markdown.min.css" />

<link rel="stylesheet" href="//at.alicdn.com/t/font_1067060_qzomjdt8bmp.css">



  <link  rel="stylesheet" href="/blog/lib/prettify/tomorrow-night-eighties.min.css" />

<link  rel="stylesheet" href="/blog/css/main.css" />


  <link defer rel="stylesheet" href="https://cdn.staticfile.org/fancybox/3.5.7/jquery.fancybox.min.css" />


<!-- è‡ªå®šä¹‰æ ·å¼ä¿æŒåœ¨æœ€åº•éƒ¨ -->


<meta name="generator" content="Hexo 4.2.1"></head>


<body>
  <header style="height: 70vh;">
    <nav id="navbar" class="navbar fixed-top  navbar-expand-lg navbar-dark scrolling-navbar">
  <div class="container">
    <a class="navbar-brand"
       href="/blog/">&nbsp;<strong>ğŸğŸŠ's blog</strong>&nbsp;</a>

    <button id="navbar-toggler-btn" class="navbar-toggler" type="button" data-toggle="collapse"
            data-target="#navbarSupportedContent"
            aria-controls="navbarSupportedContent" aria-expanded="false" aria-label="Toggle navigation">
      <div class="animated-icon"><span></span><span></span><span></span></div>
    </button>

    <!-- Collapsible content -->
    <div class="collapse navbar-collapse" id="navbarSupportedContent">
      <ul class="navbar-nav ml-auto text-center">
        
          
          
          
          
          <li class="nav-item">
            <a class="nav-link" href="/blog/">é¦–é¡µ</a>
          </li>
        
          
          
          
          
          <li class="nav-item">
            <a class="nav-link" href="/blog/archives/">å½’æ¡£</a>
          </li>
        
          
          
          
          
          <li class="nav-item">
            <a class="nav-link" href="/blog/categories/">åˆ†ç±»</a>
          </li>
        
          
          
          
          
          <li class="nav-item">
            <a class="nav-link" href="/blog/tags/">æ ‡ç­¾</a>
          </li>
        
          
          
          
          
          <li class="nav-item">
            <a class="nav-link" href="/blog/about">å…³äº</a>
          </li>
        
        
          <li class="nav-item" id="search-btn">
            <a class="nav-link" data-toggle="modal" data-target="#modalSearch">&nbsp;&nbsp;<i
                class="iconfont icon-search"></i>&nbsp;&nbsp;</a>
          </li>
        
      </ul>
    </div>
  </div>
</nav>

    <div class="view intro-2" id="background" parallax=true
         style="background: url('/blog/img/default.png') no-repeat center center;
           background-size: cover;">
      <div class="full-bg-img">
        <div class="mask rgba-black-light flex-center">
          <div class="container text-center white-text fadeInUp">
            <span class="h2" id="subtitle">
              
            </span>

            
              
                <p class="mt-3 post-meta">
                  <i class="fas fa-calendar-alt" aria-hidden="true"></i>
                  æ˜ŸæœŸä¸‰, å››æœˆ 22æ—¥ 2020, 1:17 ä¸‹åˆ
                </p>
              

              <p class="mt-1">
                
                  
                  <span class="post-meta">
                    <i class="far fa-chart-bar"></i>
                    4.8k å­—
                  </span>
                

                
                  
                  <span class="post-meta">
                      <i class="far fa-clock"></i>
                      24 åˆ†é’Ÿ
                  </span>
                

                
                  <!-- ä¸è’œå­ç»Ÿè®¡æ–‡ç« PV -->
                  
                  <span id="busuanzi_container_page_pv" class="post-meta" style="display: none">
                    <i class="far fa-eye" aria-hidden="true"></i>
                    <span id="busuanzi_value_page_pv"></span> æ¬¡
                  </span>
                
              </p>
            
          </div>

          
        </div>
      </div>
    </div>
  </header>

  <main>
    
      

<div class="container-fluid">
  <div class="row">
    <div class="d-none d-lg-block col-lg-2"></div>
    <div class="col-lg-8 nopadding-md">
      <div class="container nopadding-md" id="board-ctn">
        <div class="py-5 z-depth-3" id="board">
          <div class="post-content mx-auto" id="post">
            
              <p
                class="note note-warning">æœ¬æ–‡æœ€åæ›´æ–°äºï¼šæ˜ŸæœŸä¸‰, å››æœˆ 22æ—¥ 2020, 8:22 æ™šä¸Š</p>
            
            <div class="markdown-body">
              <h2 id="springbootå·¥ç¨‹æ­å»º"><a href="#springbootå·¥ç¨‹æ­å»º" class="headerlink" title="springbootå·¥ç¨‹æ­å»º"></a>springbootå·¥ç¨‹æ­å»º</h2><p>springbootå·¥ç¨‹çš„æ­å»ºååˆ†ç®€å•</p>
<ol>
<li>ç»§æ‰¿çˆ¶å·¥ç¨‹</li>
</ol>
<pre><code class="xml">    &lt;parent&gt;
        &lt;groupId&gt;org.springframework.boot&lt;/groupId&gt;
        &lt;artifactId&gt;spring-boot-starter-parent&lt;/artifactId&gt;
        &lt;version&gt;2.2.6.RELEASE&lt;/version&gt;
        &lt;relativePath/&gt; &lt;!-- lookup parent from repository --&gt;
    &lt;/parent&gt;</code></pre>
<ol start="2">
<li>å¯¼å…¥webå¯åŠ¨å™¨</li>
</ol>
<pre><code class="xml">        &lt;dependency&gt;
            &lt;groupId&gt;org.springframework.boot&lt;/groupId&gt;
            &lt;artifactId&gt;spring-boot-starter-web&lt;/artifactId&gt;
        &lt;/dependency&gt;</code></pre>
<ol start="3">
<li>å¯åŠ¨ç±»</li>
</ol>
<pre><code class="java">@SpringBootApplication(scanBasePackages = {&quot;com.demo.springboot&quot;})
public class SpringbootTest extends SpringBootServletInitializer {

    /*
     * 1ã€å®ŒæˆSpringå®¹å™¨çš„å¯åŠ¨
     * 2ã€æŠŠé¡¹ç›®éƒ¨ç½²åˆ°tomcat
     * */
    public static void main(String[] args) {
        ConfigurableApplicationContext applicationContext = SpringApplication.run(SpringbootTest.class,
                args);
    }

    @Override
    protected SpringApplicationBuilder configure(SpringApplicationBuilder builder) {
        return builder.sources(SpringBootTest.class);
    }
}</code></pre>
<h2 id="Servletã€Filterã€Listenerçš„æ•´åˆ"><a href="#Servletã€Filterã€Listenerçš„æ•´åˆ" class="headerlink" title="Servletã€Filterã€Listenerçš„æ•´åˆ"></a>Servletã€Filterã€Listenerçš„æ•´åˆ</h2><p>åªéœ€è¦åœ¨å¯åŠ¨ç±»ä¸ŠåŠ å…¥<code>@ServletComponentScan(basePackages = {&quot;com.demo.springboot&quot;})</code>æ³¨è§£ï¼Œç„¶ååœ¨Servletã€Filterã€Listenerä¸ŠåŠ å…¥ç›¸åº”çš„@WebFilterã€@WebListenerã€@WebServletæ³¨è§£å³å¯ï¼Œspringå°±ä¼šåœ¨åˆå§‹åŒ–æ—¶æ‰«æè¿™äº›æ³¨è§£å¹¶æŠŠServletã€Filterã€ListeneråŠ å…¥åˆ°springå®¹å™¨ä¸­ã€‚</p>
<pre><code class="java">@WebFilter(urlPatterns = &quot;/*&quot;,filterName = &quot;myFilter&quot;)
public class MyFilter implements Filter {
    @Override
    public void doFilter(ServletRequest request, ServletResponse response, FilterChain chain) throws IOException, ServletException {
        System.out.println(&quot;--------MyFilter----------&quot;);
        chain.doFilter(request,response);
    }
}</code></pre>
<pre><code class="java">@WebListener
public class MyListener implements ServletContextListener {

    @Override
    public void contextDestroyed(ServletContextEvent contextEvent) {
        System.out.println(&quot;contextDestroyed&quot;); }
    @Override
    public void contextInitialized(ServletContextEvent contextEvent) {
        System.out.println(&quot;contextInitialized&quot;); }
}</code></pre>
<pre><code class="java">@WebServlet(urlPatterns = &quot;/jack/*&quot;)
public class MyServlet extends HttpServlet {
    private static final long serialVersionUID = 1L;

    public JackServlet() {
        super();
    }

    protected void doGet(HttpServletRequest request,
            HttpServletResponse response) throws ServletException, IOException {
        System.out.println(&quot;-----------------doGet-----------------------&quot;);
    }

    protected void doPost(HttpServletRequest request,
            HttpServletResponse response) throws ServletException, IOException {
        System.out.println(&quot;------------------doPost----------------------&quot;);
    }

}</code></pre>
<h2 id="druidå¤šæ•°æ®æºåŠæ•°æ®ç›‘æ§çš„æ•´åˆ"><a href="#druidå¤šæ•°æ®æºåŠæ•°æ®ç›‘æ§çš„æ•´åˆ" class="headerlink" title="druidå¤šæ•°æ®æºåŠæ•°æ®ç›‘æ§çš„æ•´åˆ"></a>druidå¤šæ•°æ®æºåŠæ•°æ®ç›‘æ§çš„æ•´åˆ</h2><p>Druidå¯¹æ•°æ®åº“è¿æ¥çš„ç®¡ç†æ¯”è¾ƒä¼˜ç§€ï¼Œè€Œä¸”è¿˜æä¾›äº†å¯ä»¥å®æ—¶ç›‘æ§æ•°æ®åº“è¿æ¥å¯¹è±¡å’Œæ•°æ®åº“æ“ä½œè®°å½•çš„ç›‘æ§ç•Œé¢ã€‚é€šè¿‡ä»¥ä¸‹é…ç½®åå°±å¯ä»¥åŠ¨æ€çš„åˆ‡æ¢æ•°æ®æºï¼Œä½¿ç”¨æ–¹æ³•ä¸ºåœ¨æ–¹æ³•ä¸ŠåŠ å…¥<code>@TargetDataSource</code>æ³¨è§£ï¼Œå¦‚åˆ‡æ¢ä¸ºds2æ•°æ®æº<code>@TargetDataSource(name=&quot;ds2&quot;)</code>ã€‚duridç›‘æ§ç•Œé¢çš„åœ°å€ä¸º{ip}:{port}/{contextPath}/druid/index.html</p>
<p>mavenä¸­å¼•å…¥jaråŒ…</p>
<pre><code class="xml">        &lt;dependency&gt;
            &lt;groupId&gt;com.alibaba&lt;/groupId&gt;
            &lt;artifactId&gt;druid&lt;/artifactId&gt;
            &lt;version&gt;1.0.26&lt;/version&gt;
        &lt;/dependency&gt;
        &lt;dependency&gt;
            &lt;groupId&gt;org.springframework.boot&lt;/groupId&gt;
            &lt;artifactId&gt;spring-boot-starter-jdbc&lt;/artifactId&gt;
        &lt;/dependency&gt;
        &lt;dependency&gt;
            &lt;groupId&gt;org.springframework.boot&lt;/groupId&gt;
            &lt;artifactId&gt;spring-boot-starter-aop&lt;/artifactId&gt;
        &lt;/dependency&gt;
        &lt;dependency&gt;
            &lt;groupId&gt;com.mchange&lt;/groupId&gt;
            &lt;artifactId&gt;c3p0&lt;/artifactId&gt;
            &lt;version&gt;0.9.5.2&lt;/version&gt;
        &lt;/dependency&gt;
        &lt;dependency&gt;
            &lt;groupId&gt;mysql&lt;/groupId&gt;
            &lt;artifactId&gt;mysql-connector-java&lt;/artifactId&gt;
            &lt;version&gt;5.1.41&lt;/version&gt;
        &lt;/dependency&gt;</code></pre>
<h3 id="druidé…ç½®æ–‡ä»¶"><a href="#druidé…ç½®æ–‡ä»¶" class="headerlink" title="druidé…ç½®æ–‡ä»¶"></a>druidé…ç½®æ–‡ä»¶</h3><p><code>@ConfigurationProperties(prefix = &quot;spring.druid&quot;,ignoreInvalidFields = true)</code>çš„ä½œç”¨ä¸ºè¯»å–é»˜è®¤çš„é…ç½®æ–‡ä»¶application.propertiesé…ç½®ï¼Œä»¥spring.druidä½œä¸ºå‰ç¼€è¯»å–å˜é‡åå¯¹åº”çš„å±æ€§ã€‚è¦ä½¿ç”¨è¿™ä¸ªæ³¨è§£å¿…é¡»ä½¿ç”¨<code>@EnableConfigurationProperties(DruidConfig.class)</code>å¼€å¯é…ç½®æ–‡ä»¶è¯»å–åŠŸèƒ½</p>
<p>éœ€è¦æ³¨æ„é»˜è®¤æ˜¯è¯»å–çš„application.propertiesé…ç½®æ–‡ä»¶ï¼Œé…ç½®æ–‡ä»¶ä¸åœ¨é»˜è®¤æ–‡ä»¶ä¸­éœ€è¦åœ¨ç±»ä¸­å¼•å…¥é…ç½®æ–‡ä»¶ä¾‹å¦‚ï¼š<code>@PropertySource(value = &quot;classpath:druid.properties&quot;)</code></p>
<pre><code class="java">@Data
@Configuration
@ConfigurationProperties(prefix = &quot;spring.druid&quot;, ignoreInvalidFields = true)
public class DruidConfig {
    private String driverClassName;
    private String jdbcUrl1;
    private String jdbcUrl2;
    private String username1;
    private String password1;
    private String username2;
    private String password2;
    private int maxActive;
    private int minIdle;
    private int initialSize;
    private Long timeBetweenEvictionRunsMillis;
    private Long minEvictableIdleTimeMillis;
    private String validationQuery;
    private boolean testWhileIdle;
    private boolean testOnBorrow;
    private boolean testOnReturn;
    private boolean poolPreparedStatements;
    private Integer maxPoolPreparedStatementPerConnectionSize;
    private String filters;
    private String connectionProperties;

    @Bean(destroyMethod = &quot;close&quot;, initMethod = &quot;init&quot;)
    public DataSource getDs1() {
        DruidDataSource druidDataSource = new DruidDataSource();
        druidDataSource.setDriverClassName(driverClassName);
        druidDataSource.setUrl(jdbcUrl1);
        druidDataSource.setUsername(username1);
        druidDataSource.setPassword(password1);
        druidDataSource.setMaxActive(maxActive);
        druidDataSource.setInitialSize(initialSize);
        druidDataSource.setTimeBetweenConnectErrorMillis(timeBetweenEvictionRunsMillis);
        druidDataSource.setMinEvictableIdleTimeMillis(minEvictableIdleTimeMillis);
        druidDataSource.setValidationQuery(validationQuery);
        druidDataSource.setTestWhileIdle(testWhileIdle);
        druidDataSource.setTestOnBorrow(testOnBorrow);
        druidDataSource.setTestOnReturn(testOnReturn);
        druidDataSource.setPoolPreparedStatements(poolPreparedStatements);
        druidDataSource.setMaxPoolPreparedStatementPerConnectionSize(maxPoolPreparedStatementPerConnectionSize);
        try {
            druidDataSource.setFilters(filters);
        } catch (SQLException e) {
            e.printStackTrace();
        }

        return druidDataSource;
    }

    @Bean(destroyMethod = &quot;close&quot;, initMethod = &quot;init&quot;)
    public DataSource getDs2() {
        DruidDataSource druidDataSource = new DruidDataSource();
        druidDataSource.setDriverClassName(driverClassName);
        druidDataSource.setUrl(jdbcUrl2);
        druidDataSource.setUsername(username2);
        druidDataSource.setPassword(password2);
        druidDataSource.setMaxActive(maxActive);
        druidDataSource.setInitialSize(initialSize);
        druidDataSource.setTimeBetweenConnectErrorMillis(timeBetweenEvictionRunsMillis);
        druidDataSource.setMinEvictableIdleTimeMillis(minEvictableIdleTimeMillis);
        druidDataSource.setValidationQuery(validationQuery);
        druidDataSource.setTestWhileIdle(testWhileIdle);
        druidDataSource.setTestOnBorrow(testOnBorrow);
        druidDataSource.setTestOnReturn(testOnReturn);
        druidDataSource.setPoolPreparedStatements(poolPreparedStatements);
        druidDataSource.setMaxPoolPreparedStatementPerConnectionSize(maxPoolPreparedStatementPerConnectionSize);
        try {
            druidDataSource.setFilters(filters);
        } catch (SQLException e) {
            e.printStackTrace();
        }

        return druidDataSource;
    }

    @Bean
    public DataSource dynamicDataSource() {
        Map&lt;Object, Object&gt; targetDataSources = new HashMap&lt;&gt;();
        DataSource ds1 = getDs1();
        targetDataSources.put(&quot;ds1&quot;, ds1);
        targetDataSources.put(&quot;ds2&quot;, getDs2());
        DynamicDataSource dynamicDataSource = new DynamicDataSource();
        dynamicDataSource.setTargetDataSources(targetDataSources);
        dynamicDataSource.setDefaultTargetDataSource(ds1);
        DynamicDataSourceContextHolder.dataSourceIds.add(&quot;ds1&quot;);
        DynamicDataSourceContextHolder.dataSourceIds.add(&quot;ds2&quot;);
        return dynamicDataSource;
    }

    /**
     * é…ç½®è®¿é—®druidç›‘æ§
     *
     * @return
     */
    @Bean
    public ServletRegistrationBean druidStateViewServlet() {
        ServletRegistrationBean servletRegistrationBean = new ServletRegistrationBean(new StatViewServlet(), &quot;/druid/*&quot;);
        //åˆå§‹åŒ–å‚æ•°initParams
        //æ·»åŠ ç™½åå•
        servletRegistrationBean.addInitParameter(&quot;allow&quot;, &quot;&quot;);
        //æ·»åŠ ipé»‘åå•
        servletRegistrationBean.addInitParameter(&quot;deny&quot;, &quot;192.168.16.111&quot;);
        //ç™»å½•æŸ¥çœ‹ä¿¡æ¯çš„è´¦å·å¯†ç 
        servletRegistrationBean.addInitParameter(&quot;loginUsername&quot;, &quot;admin&quot;);
        servletRegistrationBean.addInitParameter(&quot;loginPassword&quot;, &quot;123&quot;);
        //æ˜¯å¦èƒ½å¤Ÿé‡ç½®æ•°æ®
        servletRegistrationBean.addInitParameter(&quot;resetEnable&quot;, &quot;false&quot;);
        return servletRegistrationBean;
    }

    /**
     * è¿‡æ»¤ä¸éœ€è¦ç›‘æ§çš„åç¼€
     *
     * @return
     */
    @Bean
    public FilterRegistrationBean druidStatFilter() {
        FilterRegistrationBean filterRegistrationBean = new FilterRegistrationBean(new WebStatFilter());
        //æ·»åŠ è¿‡æ»¤è§„åˆ™
        filterRegistrationBean.addUrlPatterns(&quot;/*&quot;);
        //æ·»åŠ ä¸éœ€è¦å¿½ç•¥çš„æ ¼å¼ä¿¡æ¯
        filterRegistrationBean.addInitParameter(&quot;exclusions&quot;, &quot;*.js,*.gif,*.jpg,*.png,*.css,*.ico,/druid/*&quot;);
        return filterRegistrationBean;
    }
}
</code></pre>
<h3 id="application-properties"><a href="#application-properties" class="headerlink" title="application.properties"></a>application.properties</h3><pre><code class="properties">spring.druid.jdbcUrl1=jdbc:mysql://localhost/test
spring.druid.jdbcUrl2=jdbc:mysql://localhost/test
spring.druid.username1=
spring.druid.password1=
spring.druid.username2=
spring.druid.password2=
spring.druid.initialSize=2
spring.druid.minIdle=2
spring.druid.maxActive=2
spring.druid.maxWait=60000
spring.druid.timeBetweenEvictionRunsMillis=60000
spring.druid.minEvictableIdleTimeMillis=300000
spring.druid.validationQuery=SELECT 1 FROM DUAL
spring.druid.testWhileIdle=true
spring.druid.testOnBorrow=false
spring.druid.testOnReturn=false
spring.druid.poolPreparedStatements=true
spring.druid.maxPoolPreparedStatementPerConnectionSize=20
spring.druid.filters=stat,wall
spring.druid.connectionProperties=druid.stat.mergeSql=true;druid.stat.slowSqlMillis=5000</code></pre>
<h3 id="å¤šæ•°æ®æºåˆ‡é¢"><a href="#å¤šæ•°æ®æºåˆ‡é¢" class="headerlink" title="å¤šæ•°æ®æºåˆ‡é¢"></a>å¤šæ•°æ®æºåˆ‡é¢</h3><pre><code class="java">public class DynamicDataSource extends AbstractRoutingDataSource {
    @Override
    protected Object determineCurrentLookupKey() {
        try {
            Field targetF = this.getClass().getSuperclass().getDeclaredField(&quot;targetDataSources&quot;);
            targetF.setAccessible(true);
            Map&lt;Object, Object&gt; targetV = (Map&lt;Object, Object&gt;) targetF.get(this);
            String ds = DynamicDataSourceContextHolder.getDataSourceType();
            if (ds != null) {
                System.out.println(&quot;æ“ä½œçš„æ•°æ®æºæ˜¯ï¼š &quot;
                        + ds + &quot;-&gt;url:&quot; + ((DruidDataSource) targetV.get(ds)).getUrl());
            }
            return DynamicDataSourceContextHolder.getDataSourceType();
        } catch (NoSuchFieldException e) {
            e.printStackTrace();
        } catch (IllegalAccessException e) {
            e.printStackTrace();
        }
        return &quot;ds1&quot;;
    }
}</code></pre>
<pre><code class="java">@Aspect
@Order(-1)
@Component
public class DynamicDataSourceAspect {
    private static final Logger logger = LoggerFactory.getLogger(DynamicDataSourceAspect.class);

    @Before(&quot;@annotation(ds)&quot;)
    public void changeDataSource(JoinPoint point, TargetDataSource ds) {
        //è¿™ä¸ªå°±æ˜¯æ•°æ®æºæ ‡è¯†
        String dsId = ds.name();
        if (!DynamicDataSourceContextHolder.containsDataSource(dsId)) {
            logger.error(&quot;æ•°æ®æº[{}]ä¸å­˜åœ¨ï¼Œä½¿ç”¨é»˜è®¤æ•°æ®æº &gt; {}&quot;, ds.name(),
                    point.getSignature());
        } else {
            logger.debug(&quot;ä½¿ç”¨æ•°æ®æº[{}] &gt; {}&quot;, ds.name(), point.getSignature());
            //å¦‚æœå®¹å™¨ä¸­æœ‰æ•°æ®æºï¼Œé‚£ä¹ˆå°±æŠŠæ•°æ®æºæ ‡è¯†è®¾ç½®åˆ°ThreadLocalä¸­
            DynamicDataSourceContextHolder.setDataSourceType(dsId);
        }
    }

    @After(&quot;@annotation(ds)&quot;)
    public void releaseLocal(JoinPoint point, TargetDataSource ds) {
        logger.info(&quot;é‡Šæ”¾dsï¼š&quot; + ds.name() + &quot;çš„ThreadLocalç»‘å®š&quot;);
        if (DynamicDataSourceContextHolder.getDataSourceType() != null) {
            DynamicDataSourceContextHolder.getContextHolder().remove();
        }
    }
}</code></pre>
<pre><code class="java">public class DynamicDataSourceContextHolder {

    private static final ThreadLocal&lt;String&gt; contextHolder = new ThreadLocal&lt;String&gt;();

    public static ThreadLocal&lt;String&gt; getContextHolder() {
        return contextHolder;
    }

    public static List&lt;String&gt; dataSourceIds = new ArrayList&lt;String&gt;();

    public static void setDataSourceType(String dataSourceType) {
        contextHolder.set(dataSourceType);
    }

    public static String getDataSourceType() {
        return contextHolder.get();
    }

    public static boolean containsDataSource(String dataSourceId) {
        return dataSourceIds.contains(dataSourceId);
    }
}</code></pre>
<pre><code class="java">@Target({ElementType.METHOD, ElementType.TYPE})
@Retention(RetentionPolicy.RUNTIME)
@Documented
public @interface TargetDataSource {
    String name();
}</code></pre>
<p>å¦‚æœè¦ä½¿ç”¨ä½†æ•°æ®æºä¹Ÿå¾ˆç®€å•ï¼Œåªè¦å»æ‰åˆ‡é¢æ³¨è§£ã€dynamicDataSource()æ–¹æ³•ä¸Šçš„@Beanå³å¯ã€‚</p>
<h2 id="æ•´åˆORMæ¡†æ¶"><a href="#æ•´åˆORMæ¡†æ¶" class="headerlink" title="æ•´åˆORMæ¡†æ¶"></a>æ•´åˆORMæ¡†æ¶</h2><h3 id="mybatis"><a href="#mybatis" class="headerlink" title="mybatis"></a>mybatis</h3><p>pomæ–‡ä»¶ä¸­å¼•å…¥</p>
<pre><code class="xml">&lt;dependency&gt;
    &lt;groupId&gt;org.mybatis.spring.boot&lt;/groupId&gt;
    &lt;artifactId&gt;mybatis-spring-boot-starter&lt;/artifactId&gt;
    &lt;version&gt;RELEASE&lt;/version&gt;
&lt;/dependency&gt;</code></pre>
<p>åœ¨å¯åŠ¨ç±»æ·»åŠ æ‰«ææ³¨è§£<code>@MapperScan(&quot;com.demo.springboot&quot;)</code></p>
<p>application.properties</p>
<pre><code class="properties">#é…ç½®è¯¥åŒ…ä¸‹çš„beanåˆ«å
mybatis.typeAliasesPackage=com.demo.mybatis.bean
#è§£æè¯¥è·¯å¾„ä¸‹çš„xmå»ºç«‹æ¥å£æ˜ å°„å…³ç³»
mybatis.mapperLocations=classpath:mapper/*Mapper.xml</code></pre>
<p>æ³¨ï¼šå¦‚æœå‡ºç°xmlæ‰¾ä¸åˆ°çš„æƒ…å†µå¯ä»¥åœ¨pomæ–‡ä»¶çš„buildæ ‡ç­¾ä¸­åŠ å…¥ä»¥ä¸‹å†…å®¹</p>
<pre><code class="xml">&lt;resources&gt;
    &lt;resource&gt;
        &lt;directory&gt;src/main/java&lt;/directory&gt;
        &lt;includes&gt;
            &lt;include&gt;**/*.properties&lt;/include&gt;
            &lt;include&gt;**/*.xml&lt;/include&gt;
        &lt;/includes&gt;
        &lt;filtering&gt;false&lt;/filtering&gt;
    &lt;/resource&gt;
    &lt;resource&gt;
        &lt;directory&gt;src/main/resources&lt;/directory&gt;
        &lt;includes&gt;
            &lt;include&gt;**/*.properties&lt;/include&gt;
            &lt;include&gt;**/*.xml&lt;/include&gt;
            &lt;include&gt;**/*.txt&lt;/include&gt;
            &lt;include&gt;**/*.keystore&lt;/include&gt;
        &lt;/includes&gt;
        &lt;filtering&gt;false&lt;/filtering&gt;
    &lt;/resource&gt;
&lt;/resources&gt;</code></pre>
<h3 id="JPA"><a href="#JPA" class="headerlink" title="JPA"></a>JPA</h3><p>pomæ–‡ä»¶ä¸­åŠ å…¥</p>
<pre><code class="xml">        &lt;dependency&gt;
            &lt;groupId&gt;org.springframework.boot&lt;/groupId&gt;
            &lt;artifactId&gt;spring-boot-starter-data-jpa&lt;/artifactId&gt;
        &lt;/dependency&gt;</code></pre>
<p>application.properties</p>
<pre><code class="properties">#è®¾ç½®ä¸ºcreateæ—¶ä¼šè‡ªåŠ¨åˆ›å»ºè¡¨ 
spring.jpa.hibernate.ddl-auto=update
#æ‰“å°sqlè¯­å¥
spring.jpa.show-sql=true</code></pre>
<p>entity</p>
<pre><code class="java">@Data
@Entity
@Table(name = &quot;studnet&quot;)
public class Student {
    @Id
    @GeneratedValue(strategy = GenerationType.IDENTITY)
    private Integer id;
    @Column(name = &quot;name&quot;)
    private String name;
    @Column(name = &quot;card_num&quot;)
    private String cardNum;
}</code></pre>
<p>dao</p>
<pre><code class="java">public interface StudentDao extends JpaRepository&lt;Student,Integer&gt; {
}</code></pre>
<p>ä¸šåŠ¡ä»£ç ä¸­çš„ä½¿ç”¨</p>
<pre><code class="java">@Service
public class StudentServiceImpl implements StudentService {
    @Autowired
    private StudentDao studentDao;

    @Override
    public void save() {
        Student s = new Student();
        s.setId(1);
        s.setName(&quot;name&quot;);
        s.setCardNum(&quot;123123123&quot;);
        studentDao.save(s);
    }

    @Override
    public List&lt;Student&gt; getAll() {
        return studentDao.findAll();
    }
}</code></pre>
<h2 id="æ•´åˆAtomikos"><a href="#æ•´åˆAtomikos" class="headerlink" title="æ•´åˆAtomikos"></a>æ•´åˆAtomikos</h2><p> Atomikosæ˜¯ä¸€ä¸ªåŸºäºXAåè®®çš„åˆ†å¸ƒå¼äº‹åŠ¡è§£å†³ç®¡ç†æ¡†æ¶ï¼Œå…¶æ ¸å¿ƒæ€æƒ³å°±æ˜¯ä¸¤æ®µæäº¤ï¼Œä¸€èˆ¬ä½¿ç”¨åœ¨æ¶‰åŠåˆ°çš„å¯¹å¤šä¸ªæ•°æ®æºçš„æ“ä½œçš„ä¸šåŠ¡æ–¹æ³•ä¸­ï¼Œä¿è¯å¯¹ä¸¤ä¸ªæ•°æ®æºçš„åŒæ—¶æäº¤å’ŒåŒæ—¶å›æ»šã€‚</p>
<img src="/blog/2020/04/22/springboot%E5%90%84%E7%A7%8D%E7%BB%84%E4%BB%B6%E7%9A%84%E6%95%B4%E5%90%88/pic1.png" srcset="/blog/img/loading.gif" class>

<p>Atomikoså°±æ˜¯å›¾ä¸­çš„äº‹åŠ¡åè°ƒå™¨çš„è§’è‰²ï¼Œè´Ÿè´£å¯¹ä¸¤ä¸ªæ•°æ®æºçš„ç®¡ç†ï¼ŒåŒæ—¶æäº¤æˆ–åŒæ—¶å›æ»šã€‚ å°±æ˜¯åœ¨çœŸæ­£æäº¤ä¹‹å‰æœ‰ä¸€ä¸ªé¢„æäº¤çš„è¿‡ç¨‹ï¼Œå°±æ˜¯æ£€æµ‹ä¸¤ä¸ªæ•°æ®æºæ˜¯å¦èƒ½å¤Ÿæäº¤ï¼Œ å¦‚æœæœ‰ä¸€ä¸ªè¿”å› Noï¼Œé‚£ä¹ˆè¿™ä¸ªäº‹åŠ¡å°±ä¸èƒ½æäº¤ã€‚</p>
<p>pomä¸­å¼•å…¥</p>
<pre><code class="xml">&lt;dependency&gt;
    &lt;groupId&gt;org.springframework.boot&lt;/groupId&gt;
    &lt;artifactId&gt;spring-boot-starter-jta-atomikos&lt;/artifactId&gt;
&lt;/dependency&gt;</code></pre>
<p>application.propertiesæ–‡ä»¶ä¸­</p>
<pre><code class="properties"># Mysql 1
mysql.datasource.test1.url = jdbc:mysql://localhost:3307/test?useUnicode=true&amp;characterEncoding=utf-8
mysql.datasource.test1.username = 
mysql.datasource.test1.password = 
mysql.datasource.test1.minPoolSize = 3
mysql.datasource.test1.maxPoolSize = 25
mysql.datasource.test1.maxLifetime = 20000
mysql.datasource.test1.borrowConnectionTimeout = 30
mysql.datasource.test1.loginTimeout = 30
mysql.datasource.test1.maintenanceInterval = 60
mysql.datasource.test1.maxIdleTime = 60

# Mysql 2
mysql.datasource.test2.url =jdbc:mysql://localhost:3306/test?useUnicode=true&amp;characterEncoding=utf-8
mysql.datasource.test2.username =
mysql.datasource.test2.password =
mysql.datasource.test2.minPoolSize = 3
mysql.datasource.test2.maxPoolSize = 25
mysql.datasource.test2.maxLifetime = 20000
mysql.datasource.test2.borrowConnectionTimeout = 30
mysql.datasource.test2.loginTimeout = 30
mysql.datasource.test2.maintenanceInterval = 60
mysql.datasource.test2.maxIdleTime = 60

logging.level.root=info
#logging.level.org.springframework.*=debug

logging.level.com.xiangxue.atomikos.db1.dao=debug
logging.level.com.xiangxue.atomikos.db2.dao=debug

spring.devtools.restart.enabled=true
spring.devtools.restart.additional-paths=src/main/java

spring.devtools.restart.exclude=WEB-INF/**</code></pre>
<p>æ•°æ®æºåˆ›å»ºï¼Œè¿™é‡Œåªåˆ—ä¸¾ä¸€ä¸ªæ•°æ®æºçš„åˆ›å»ºï¼Œå¦ä¸€ä¸ªåˆ›å»ºæ–¹å¼ä¸è¿™ä¸ªç›¸åŒã€‚</p>
<pre><code class="java">@Configuration
@MapperScan(basePackages = &quot;com.demo.atomikos.db1.dao&quot;, sqlSessionFactoryRef = &quot;test1SqlSessionFactory&quot;,sqlSessionTemplateRef=&quot;test1SqlSessionTemplate&quot;)
public class Db1Config {

    @Autowired
    DBConfig1 testConfig;

    @Bean(name = &quot;test1DataSource&quot;)
    public DataSource testDataSource() {
        MysqlXADataSource mysqlXaDataSource = new MysqlXADataSource();
        mysqlXaDataSource.setUrl(testConfig.getUrl());
        mysqlXaDataSource.setPinGlobalTxToPhysicalConnection(true);
        mysqlXaDataSource.setPassword(testConfig.getPassword());
        mysqlXaDataSource.setUser(testConfig.getUsername());
        mysqlXaDataSource.setPinGlobalTxToPhysicalConnection(true);

        AtomikosDataSourceBean xaDataSource = new AtomikosDataSourceBean();
        xaDataSource.setXaDataSource(mysqlXaDataSource);
        xaDataSource.setUniqueResourceName(&quot;test1DataSource&quot;);
        xaDataSource.setMinPoolSize(testConfig.getMinPoolSize());
        xaDataSource.setMaxPoolSize(testConfig.getMaxPoolSize());
        xaDataSource.setMaxLifetime(testConfig.getMaxLifetime());
        xaDataSource.setBorrowConnectionTimeout(testConfig.getBorrowConnectionTimeout());
        try {
            xaDataSource.setLoginTimeout(testConfig.getLoginTimeout());
        } catch (SQLException e) {
            e.printStackTrace();
        }
        xaDataSource.setMaintenanceInterval(testConfig.getMaintenanceInterval());
        xaDataSource.setMaxIdleTime(testConfig.getMaxIdleTime());
        xaDataSource.setTestQuery(testConfig.getTestQuery());
        return xaDataSource;
    }

    @Bean(name = &quot;test1SqlSessionFactory&quot;)
    public SqlSessionFactory testSqlSessionFactory(@Qualifier(&quot;test1DataSource&quot;) DataSource dataSource)
            throws Exception {
        SqlSessionFactoryBean bean = new SqlSessionFactoryBean();
        bean.setDataSource(dataSource);
        return bean.getObject();
    }

    @Bean(name = &quot;test1SqlSessionTemplate&quot;)
    public SqlSessionTemplate testSqlSessionTemplate(
            @Qualifier(&quot;test1SqlSessionFactory&quot;) SqlSessionFactory sqlSessionFactory) throws Exception {
        return new SqlSessionTemplate(sqlSessionFactory);
    }
}</code></pre>
<p>å…·ä½“ä½¿ç”¨</p>
<pre><code class="java">@Service
public class AreaServiceImpl implements AreaService {

    @Autowired
    private CommonMapper1 commonMapper1;

    @Autowired
    private CommonMapper2 commonMapper2;

    @Autowired
    TransactionManager transactionManager;

    @Transactional
    public int saveArea(ConsultConfigArea area) {
        System.out.println(transactionManager);
        JtaTransactionManager jtaTransactionManager = (JtaTransactionManager)transactionManager;
        System.out.println(jtaTransactionManager.getUserTransaction());
        UserTransaction userTransaction = jtaTransactionManager.getUserTransaction();
        int count = commonMapper1.addArea(area);
        int count1 = commonMapper2.addArea(area);
        if(true) throw new RuntimeException(&quot;xx&quot;);
        return count;
    }
}</code></pre>
<p>è¿™é‡Œ spring äº‹åŠ¡å·²ç»äº¤ç»™ atomikos æ¥ç®¡ç†äº†ï¼Œå…¶å®å°±æ˜¯ç”± atomikos ä¸­çš„ JtaTransationManager æ¥ç®¡ç†äº‹åŠ¡ï¼Œé‡å†™äº† commit å’Œ Rollback å’Œ getTransaction æ–¹æ³•ï¼Œåªæ˜¯ commit å’Œ Rollback æ˜¯å¯¹ä¸¤ä¸ªæ•°æ®æºçš„æ“ä½œè€Œå·²ã€‚</p>
<h2 id="æ•´åˆredis"><a href="#æ•´åˆredis" class="headerlink" title="æ•´åˆredis"></a>æ•´åˆredis</h2><p>pomæ–‡ä»¶</p>
<pre><code class="xml">&lt;dependency&gt;
    &lt;groupId&gt;org.springframework.boot&lt;/groupId&gt;
    &lt;artifactId&gt;spring-boot-starter-data-redis&lt;/artifactId&gt;
&lt;/dependency&gt;</code></pre>
<p>application.prpertiesæ–‡ä»¶</p>
<pre><code class="properties">spring.redis.database=0
spring.redis.host=192.168.0.1
spring.redis.port=6379
spring.redis.password=
spring.redis.pool.max-active=8
spring.redis.pool.max-wait=-1
spring.redis.pool.max-idle=8
spring.redis.pool.min-idle=0
spring.redis.timeout=0</code></pre>
<p>redis.config</p>
<pre><code class="java">@Configuration
@EnableCaching
public class RedisConfig {

    //ç¼“å­˜ç®¡ç†å™¨
    @Bean
    public CacheManager cacheManager(RedisConnectionFactory redisConnectionFactory) {
        RedisCacheConfiguration redisCacheConfiguration = RedisCacheConfiguration.defaultCacheConfig()
                .entryTtl(Duration.ofHours(1)); // è®¾ç½®ç¼“å­˜æœ‰æ•ˆæœŸä¸€å°æ—¶
        return RedisCacheManager
                .builder(RedisCacheWriter.nonLockingRedisCacheWriter(redisConnectionFactory))
                .cacheDefaults(redisCacheConfiguration).build();
    }

    @Bean
    public RedisTemplate&lt;String, Object&gt; redisTemplate(RedisConnectionFactory factory) {
        RedisTemplate&lt;String, Object&gt; template = new RedisTemplate&lt;&gt;();
        // é…ç½®è¿æ¥å·¥å‚
        template.setConnectionFactory(factory);
        //ä½¿ç”¨Jackson2JsonRedisSerializeræ¥åºåˆ—åŒ–å’Œååºåˆ—åŒ–redisçš„valueå€¼ï¼ˆé»˜è®¤ä½¿ç”¨JDKçš„åºåˆ—åŒ–æ–¹å¼ï¼‰
        Jackson2JsonRedisSerializer jacksonSeial = new Jackson2JsonRedisSerializer(Object.class);
        ObjectMapper om = new ObjectMapper();
        // æŒ‡å®šè¦åºåˆ—åŒ–çš„åŸŸï¼Œfield,getå’Œset,ä»¥åŠä¿®é¥°ç¬¦èŒƒå›´ï¼ŒANYæ˜¯éƒ½æœ‰åŒ…æ‹¬privateå’Œpublic
        om.setVisibility(PropertyAccessor.ALL, JsonAutoDetect.Visibility.ANY);
        // æŒ‡å®šåºåˆ—åŒ–è¾“å…¥çš„ç±»å‹ï¼Œç±»å¿…é¡»æ˜¯éfinalä¿®é¥°çš„ï¼Œfinalä¿®é¥°çš„ç±»ï¼Œæ¯”å¦‚String,Integerç­‰ä¼šè·‘å‡ºå¼‚å¸¸
        om.enableDefaultTyping(ObjectMapper.DefaultTyping.NON_FINAL);
        jacksonSeial.setObjectMapper(om);
        // å€¼é‡‡ç”¨jsonåºåˆ—åŒ–
        template.setValueSerializer(jacksonSeial);
        //ä½¿ç”¨StringRedisSerializeræ¥åºåˆ—åŒ–å’Œååºåˆ—åŒ–redisçš„keyå€¼
        template.setKeySerializer(new StringRedisSerializer());
        // è®¾ç½®hash key å’Œvalueåºåˆ—åŒ–æ¨¡å¼
        template.setHashKeySerializer(new StringRedisSerializer());
        template.setHashValueSerializer(jacksonSeial);
        template.afterPropertiesSet();
        return template;
    }
}</code></pre>
<p>åœ¨ä¸šåŠ¡ä»£ç ä¸­åªè¦åœ¨æ–¹æ³•ä¸Šé¢åŠ ä¸Š@Cacheable@CachePut æ³¨è§£å°±å¯ä»¥äº†ï¼Œspringå°±ä¼šæŠŠä¸šåŠ¡ä»£ç çš„è¿”å›ç»“æœå­˜åˆ°redisä¸­ã€‚è¿˜å¯ä»¥é€šè¿‡ç›´æ¥æ³¨å…¥RedisTemplateæ¥ä½¿ç”¨ã€‚</p>
<h2 id="æ•´åˆmongodb"><a href="#æ•´åˆmongodb" class="headerlink" title="æ•´åˆmongodb"></a>æ•´åˆmongodb</h2><p>pomæ–‡ä»¶</p>
<pre><code class="xml">&lt;dependency&gt;
    &lt;groupId&gt;org.springframework.boot&lt;/groupId&gt;
    &lt;artifactId&gt;spring-boot-starter-data-mongodb&lt;/artifactId&gt;
&lt;/dependency&gt;</code></pre>
<p>application.properteis</p>
<pre><code class="properties">spring.data.mongodb.uri=mongodb://192.168.0.1:27017/xx_db</code></pre>
<p>ä»£ç æ¡ˆä¾‹</p>
<pre><code class="java">@Service
public class MongoServiceImpl implements MongoService&lt;User&gt; {

    @Autowired
    private MongoTemplate mongoTemplate;

    @Override
    public String save(User obj) {
        mongoTemplate.save(obj);
        return &quot;1&quot;;
    }
}</code></pre>
<p>mongoTemplateå¯¹è±¡åŒæ ·å¯ä»¥é€šè¿‡ä¾èµ–æ³¨å…¥è·å–åˆ°ã€‚</p>
<h2 id="springbootæ•´åˆJAX-RSè§„èŒƒ"><a href="#springbootæ•´åˆJAX-RSè§„èŒƒ" class="headerlink" title="springbootæ•´åˆJAX-RSè§„èŒƒ"></a>springbootæ•´åˆJAX-RSè§„èŒƒ</h2><p>JAX-RSæ˜¯JAVAEE6å¼•å…¥çš„ä¸€ä¸ªæ–°æŠ€æœ¯ã€‚JAX-RSå³JavaAPIforRESTfulWebServicesï¼Œæ˜¯ä¸€ä¸ªJavaç¼–ç¨‹è¯­è¨€çš„åº”ç”¨ç¨‹åºæ¥å£ï¼Œæ”¯æŒæŒ‰ç…§è¡¨è¿°æ€§çŠ¶æ€è½¬ç§»(REST)æ¶æ„é£æ ¼åˆ›å»ºWebæœåŠ¡ã€‚JAX-RSä½¿ç”¨äº†JavaSE5å¼•å…¥çš„Javaæ³¨è§£æ¥ç®€åŒ–WebæœåŠ¡çš„å®¢æˆ·ç«¯å’ŒæœåŠ¡ç«¯çš„å¼€å‘å’Œéƒ¨ç½²ã€‚springcloudä¸­å°±æ˜¯ç”¨äº†JAX-RSè§„èŒƒï¼Œå…¶å®å°±æ˜¯ç±»ä¼¼äºServletè§„èŒƒæ¥æ¥æ”¶ç”¨æˆ·è¯·æ±‚çš„ä¸€ä¸ªè§„èŒƒã€‚</p>
<p>pomæ–‡ä»¶</p>
<pre><code class="xml">&lt;dependency&gt;
    &lt;groupId&gt;org.springframework.boot&lt;/groupId&gt;
    &lt;artifactId&gt;spring-boot-starter-jersey&lt;/artifactId&gt;
&lt;/dependency&gt;</code></pre>
<p>ä»£ç é…ç½®</p>
<pre><code class="java">@Configuration
public class JerseyConfig {
    @Bean
    public ServletRegistrationBean jerseyServlet() {
        //è®¾ç½®æ‹¦æˆªè·¯å¾„
        ServletRegistrationBean registrationBean = new ServletRegistrationBean(new ServletContainer(), &quot;/rest/*&quot;);
        //æ³¨å†Œcontroller
        registrationBean.addInitParameter(ServletProperties.JAXRS_APPLICATION_CLASS, JerseyResourceConfig.class.getName());
        return registrationBean;
    }
}</code></pre>
<pre><code class="java">public class JerseyResourceConfig extends ResourceConfig {
    public JerseyResourceConfig() {
        // æ‰«ææŸä¸ªç±»
        register(RequestContextFilter.class);
        // æ‰«æåŒ…ä¸‹çš„æ‰€æœ‰ç±»
        packages(&quot;com.demo.jersey&quot;);
    }
}</code></pre>
<p>å…·ä½“ä½¿ç”¨</p>
<pre><code class="java">@Path(&quot;/jersey/&quot;)
public class JerseyController {
    @Path(&quot;{id}&quot;)
    @GET
    @Produces(MediaType.APPLICATION_JSON)
    public String hello(@PathParam(&quot;id&quot;) Long id) {
        return &quot;hello&quot;;
    }
}</code></pre>
<h2 id="æ•´åˆjsp"><a href="#æ•´åˆjsp" class="headerlink" title="æ•´åˆjsp"></a>æ•´åˆjsp</h2><p>pomæ–‡ä»¶</p>
<pre><code class="xml">&lt;dependency&gt;
    &lt;groupId&gt;org.apache.tomcat.embed&lt;/groupId&gt;
    &lt;artifactId&gt;tomcat-embed-jasper&lt;/artifactId&gt;
    &lt;scope&gt;provided&lt;/scope&gt;
&lt;/dependency&gt;
&lt;dependency&gt;
    &lt;groupId&gt;javax.servlet&lt;/groupId&gt;
    &lt;artifactId&gt;jstl&lt;/artifactId&gt;
&lt;/dependency&gt;</code></pre>
<p>application.properties</p>
<pre><code class="properties">spring.mvc.view.prefix=/WEB-INF/jsp/
spring.mvc.view.suffix=.jsp</code></pre>
<p>åˆ›å»ºresourceså¹³çº§ç›®å½•webappç„¶åå°†jspæ”¾å…¥/WEB-INF/jsp/åå°±å¯ä»¥æ­£å¸¸ä½¿ç”¨ã€‚</p>
<h2 id="æ•´åˆfreemarker"><a href="#æ•´åˆfreemarker" class="headerlink" title="æ•´åˆfreemarker"></a>æ•´åˆfreemarker</h2><p>jaråŒ…å¯¼å…¥</p>
<pre><code class="xml">        &lt;dependency&gt;
            &lt;groupId&gt;org.springframework.boot&lt;/groupId&gt;
            &lt;artifactId&gt;spring-boot-starter-freemarker&lt;/artifactId&gt;
        &lt;/dependency&gt;</code></pre>
<p>application.propertiesæ–‡ä»¶</p>
<pre><code class="properties">spring.freemarker.allow-request-override=false
spring.freemarker.cache=true
spring.freemarker.check-template-location=true
spring.freemarker.charset=UTF-8
spring.freemarker.content-type=text/html
spring.freemarker.expose-request-attributes=false
spring.freemarker.expose-session-attributes=false
spring.freemarker.expose-spring-macro-helpers=false</code></pre>
<p>freemarkeré»˜è®¤ä¼šåŠ è½½resourcesä¸‹çš„.ftlåç¼€æ–‡ä»¶</p>
<h2 id="æ•´åˆswagger2"><a href="#æ•´åˆswagger2" class="headerlink" title="æ•´åˆswagger2"></a>æ•´åˆswagger2</h2><p>pomæ–‡ä»¶</p>
<pre><code class="xml">        &lt;dependency&gt;
            &lt;groupId&gt;io.springfox&lt;/groupId&gt;
            &lt;artifactId&gt;springfox-swagger2&lt;/artifactId&gt;
            &lt;version&gt;2.9.2&lt;/version&gt;
        &lt;/dependency&gt;
        &lt;dependency&gt;
            &lt;groupId&gt;io.springfox&lt;/groupId&gt;
            &lt;artifactId&gt;springfox-swagger-ui&lt;/artifactId&gt;
            &lt;version&gt;2.9.2&lt;/version&gt;
        &lt;/dependency&gt;</code></pre>
<p>ä»£ç é…ç½®</p>
<pre><code class="java">@Configuration
@EnableSwagger2
public class SwaggerConfig {
    @Bean
    public Docket createRestApi() {
        return new Docket(DocumentationType.SWAGGER_2)
                .pathMapping(&quot;/&quot;)
                .select()
                .apis(RequestHandlerSelectors.basePackage(&quot;com.demo.controller&quot;))
                .paths(PathSelectors.any())
                .build().apiInfo(new ApiInfoBuilder()
                        .title(&quot;xxå…¬å¸APIæ–‡æ¡£&quot;)
                        .description(&quot;xxå…¬å¸APIæ–‡æ¡£&quot;)
                        .version(&quot;9.0&quot;)
                        .contact(new Contact(&quot;test&quot;, &quot;blog.csdn.net&quot;, &quot;aaa@gmail.com&quot;))
                        .license(&quot;The Apache License&quot;)
                        .licenseUrl(&quot;http://www.baidu.com&quot;)
                        .build());
    }
}</code></pre>
<p>å…·ä½“ä½¿ç”¨</p>
<pre><code class="java">@Controller
@Api(tags = &quot;springbootå­¦ä¹ å·¥ç¨‹ç›¸å…³æ¥å£&quot;)
public class JackController {

    private static final Logger logger = LoggerFactory.getLogger(JackController.class);

    @Autowired
    AreaService areaService;

    @Value(&quot;${application.field:default value jack}&quot;)
    private String zhuguangField = &quot;&quot;;

    @ApiOperation(&quot;æŸ¥è¯¢åœ°åŒºæ¥å£&quot;)
    @ApiImplicitParams({
            @ApiImplicitParam(name = &quot;param&quot;, value = &quot;åœ°åŒºç¼–ç &quot;)
    })
    @RequestMapping(&quot;/queryArea&quot;)
    public @ResponseBody String queryArea(String param) {
        List&lt;ConsultConfigArea&gt; areas = areaService.qryArea(new HashMap());
        for (ConsultConfigArea area : areas) {
            logger.info(area.getAreaCode() + &quot;   &quot; + area.getAreaName() + &quot;   &quot;
                    + area.getState());
        }
        return &quot;OK&quot;;
    }
}</code></pre>
<p>æ–‡æ¡£åœ°å€<code>localhost:8080/swagger-ui.html</code></p>
<h2 id="æ•´åˆ-Actuatorç›‘æ§ç®¡ç†"><a href="#æ•´åˆ-Actuatorç›‘æ§ç®¡ç†" class="headerlink" title="æ•´åˆ Actuatorç›‘æ§ç®¡ç†"></a>æ•´åˆ Actuatorç›‘æ§ç®¡ç†</h2><p>Actuatorç›‘æ§æ˜¯ä¸€ä¸ªç”¨äºç›‘æ§springbootå¥åº·çŠ¶å†µçš„å·¥å…·ï¼Œå¯ä»¥å®æ—¶ç›‘æ§çš„å·¥ç¨‹çš„å¥åº·å’Œè°ƒç”¨æƒ…å†µï¼Œé€šå¸¸é…åˆspringboot-adminä½¿ç”¨ã€‚</p>
<p>pomæ–‡ä»¶ä¸­</p>
<pre><code class="xml">&lt;dependency&gt;
    &lt;groupId&gt;org.springframework.boot&lt;/groupId&gt;
    &lt;artifactId&gt;spring-boot-starter-actuator&lt;/artifactId&gt;
&lt;/dependency&gt;</code></pre>
<p>application.propertiesé…ç½®</p>
<pre><code class="properties">#é»˜è®¤åªæœ‰infoã€healthæ¥å£
management.endpoints.web.exposure.include=*</code></pre>
<p>è¿™ä¸ªç›‘æ§ä¸éœ€è¦ä½¿ç”¨ï¼Œæ˜¯è‡ªåŠ¨ç»Ÿè®¡æ¶ˆæ¯çš„ã€‚å¯ä»¥é€šè¿‡ä¸€ä¸‹è¯·æ±‚è·å–åˆ°ç³»ç»Ÿä¿¡æ¯ï¼š</p>
<ul>
<li><p>/health/{component}/{instance}ï¼šGETæŠ¥å‘Šç¨‹åºçš„å¥åº·æŒ‡æ ‡ï¼Œè¿™äº›æ•°æ®ç”±HealthIndicatorå®ç°ç±»æä¾›</p>
</li>
<li><p>/infoï¼šGETè·å–ç¨‹åºæŒ‡å®šå‘å¸ƒçš„ä¿¡æ¯ï¼Œè¿™äº›ä¿¡æ¯ç”±é…ç½®æ–‡ä»¶ä¸­infoæ‰“å¤´çš„å±æ€§æä¾›</p>
</li>
<li><p>/configpropsï¼šGETæè¿°é…ç½®å±æ€§(åŒ…å«é»˜è®¤å€¼)å¦‚ä½•æ³¨å…¥åˆ°bean</p>
</li>
<li><p>/beansï¼šGETæè¿°ç¨‹åºä¸­çš„beanï¼ŒåŠä¹‹é—´çš„ä¾èµ–å…³ç³»</p>
</li>
<li><p>/envï¼šGETè·å–å…¨éƒ¨ç¯å¢ƒå±æ€§</p>
</li>
<li><p>/env/{name}ï¼šGETæ ¹æ®åç§°è·å–æŒ‡å®šçš„ç¯å¢ƒå±æ€§å€¼</p>
</li>
<li><p>/mappingsï¼šGETæè¿°å…¨éƒ¨çš„URIè·¯å¾„ï¼ŒåŠå’Œæ§åˆ¶å™¨çš„æ˜ å°„å…³ç³»</p>
</li>
<li><p>/metrics/{requiredMetricName}ï¼šGETç»Ÿè®¡ç¨‹åºçš„å„ç§åº¦é‡ä¿¡æ¯ï¼Œå¦‚å†…å­˜ç”¨é‡å’Œè¯·æ±‚æ•°</p>
</li>
<li><p>/httptraceï¼šGETæä¾›åŸºæœ¬çš„httpè¯·æ±‚è·Ÿè¸ªä¿¡æ¯ï¼Œå¦‚è¯·æ±‚å¤´ç­‰</p>
</li>
<li><p>/threaddumpï¼šGETè·å–çº¿ç¨‹æ´»åŠ¨çš„å¿«ç…§</p>
</li>
<li><p>/conditionsï¼šGETæä¾›è‡ªåŠ¨é…ç½®æŠ¥å‘Šï¼Œè®°å½•å“ªäº›è‡ªåŠ¨é…ç½®é€šè¿‡ï¼Œå“ªäº›æ²¡æœ‰é€šè¿‡</p>
</li>
<li><p>/loggers/{name}ï¼šGETæŸ¥çœ‹æ—¥å¿—é…ç½®ä¿¡æ¯</p>
</li>
<li><p>/auditeventsï¼šGETæŸ¥çœ‹ç³»ç»Ÿå‘å¸ƒçš„äº‹ä»¶ä¿¡æ¯</p>
</li>
<li><p>/caches/{cache}ï¼šGET/DELETEæŸ¥çœ‹ç³»ç»Ÿçš„ç¼“å­˜ç®¡ç†å™¨ï¼Œå¦å¯æ ¹æ®ç¼“å­˜ç®¡ç†å™¨åç§°æŸ¥è¯¢;å¦DELETEæ“ä½œ</p>
</li>
<li><p>/scheduledtasksï¼šGETæŸ¥çœ‹ç³»ç»Ÿå‘å¸ƒçš„å®šæ—¶ä»»åŠ¡ä¿¡æ¯</p>
</li>
<li><p>/featuresï¼šGETæŸ¥çœ‹Springcloudå…¨å®¶æ¡¶ç»„ä»¶ä¿¡æ¯</p>
</li>
<li><p>/refreshï¼šPOSTé‡å¯åº”ç”¨ç¨‹åºï¼Œæ…ç”¨</p>
</li>
<li><p>/shutdownï¼šPOSTå…³é—­åº”ç”¨ç¨‹åºï¼Œæ…ç”¨</p>
</li>
</ul>
<h2 id="æ•´åˆhttps"><a href="#æ•´åˆhttps" class="headerlink" title="æ•´åˆhttps"></a>æ•´åˆhttps</h2><p>è¿›å…¥åˆ°jdkçš„binç›®å½•ä¸­ï¼Œæ‰§è¡Œç”Ÿæˆè¯ä¹¦çš„æŒ‡ä»¤ï¼š</p>
<pre><code>keytool -genkey -alias spring -keypass 123456 -keyalg RSA -keysize 1024 -validity 365 -keystore E:/springboot.keystore -storepass 123456</code></pre><p>å‚æ•°ä»‹ç»ï¼š</p>
<ul>
<li><p>genkeyï¼šè¡¨ç¤ºè¦åˆ›å»ºä¸€ä¸ªæ–°çš„å¯†é’¥ã€‚</p>
</li>
<li><p>aliasï¼šè¡¨ç¤ºkeystoreçš„åˆ«åã€‚</p>
</li>
<li><p>keyalgï¼šè¡¨ç¤ºä½¿ç”¨çš„åŠ å¯†ç®—æ³•æ˜¯RSAï¼Œä¸€ç§éå¯¹ç§°åŠ å¯†ç®—æ³•ã€‚</p>
</li>
<li><p>keysizeï¼šè¡¨ç¤ºå¯†é’¥çš„é•¿åº¦ã€‚</p>
</li>
<li><p>keystoreï¼šè¡¨ç¤ºç”Ÿæˆçš„å¯†é’¥å­˜æ”¾ä½ç½®ã€‚validityè¡¨ç¤ºå¯†é’¥çš„æœ‰æ•ˆæ—¶é—´ï¼Œå•ä½ä¸ºå¤©ã€‚</p>
</li>
</ul>
<p>æ³¨æ„ï¼šåœ¨æ­£å¼å¼€å‘è¿‡ç¨‹ä¸­ï¼Œéœ€è¦ç”³è¯·æ­£å¼çš„ã€èƒ½å¤Ÿè¢«æµè§ˆå™¨ä¿¡ä»»çš„è¯ä¹¦ã€‚</p>
<p>ç„¶åå°†ç”Ÿæˆçš„è¯ä¹¦å¤åˆ¶åˆ°resourceç›®å½•ï¼Œåœ¨application.propertiesé…ç½®ï¼š</p>
<pre><code class="properties">server.port=8881
server.ssl.key-password=123456
server.ssl.key-store=classpath:springboot.keystore
server.ssl.key-alias=spring</code></pre>
<p>è¿™æ—¶å†ä½¿ç”¨httpçš„è®¿é—®æ–¹å¼å°±ä¼šå‡ºé”™ã€‚</p>
<h2 id="æ•´åˆrabbitmq"><a href="#æ•´åˆrabbitmq" class="headerlink" title="æ•´åˆrabbitmq"></a>æ•´åˆrabbitmq</h2><p>pom.xmlä¸­</p>
<pre><code class="properties">&lt;dependency&gt;
    &lt;groupId&gt;org.springframework.boot&lt;/groupId&gt;
    &lt;artifactId&gt;spring-boot-starter-amqp&lt;/artifactId&gt;
&lt;/dependency&gt;</code></pre>
<p>application.properties</p>
<pre><code class="properties">spring.rabbitmq.host=192.168.88.139
spring.rabbitmq.port=5672
spring.rabbitmq.username=admin
spring.rabbitmq.password=admin</code></pre>
<p>é…ç½®ç±»</p>
<pre><code class="java">@Configuration
@EnableRabbit
public class RabbitmqConfig {
    /**
     * åˆ›å»ºé˜Ÿåˆ—Queue
     */
    @Bean(name = &quot;message&quot;)
    public Queue queueMessage(){
        return new Queue(&quot;test.message&quot;);
    }

    /**
     * åˆ›å»ºäº¤æ¢å™¨Exchange
     */
    @Bean
    public TopicExchange exchange(){
        return new TopicExchange(&quot;exchange.message&quot;);
    }

    /**
     * åˆ›å»ºExchangeè·ŸQueueå’ŒrouteKeyçš„ç»‘å®šå…³ç³»bindings
     */
    @Bean
    Binding bindingExchangeMessage(@Qualifier(&quot;message&quot;)Queue queueMessage,TopicExchange exchange){
        return BindingBuilder.bind(queueMessage)
                .to(exchange)
                .with(&quot;test.message.routeKey&quot;);
    }
}</code></pre>
<p>å‘é€æ¶ˆæ¯</p>
<pre><code class="java">    @Autowired
    private AmqpTemplate amqpTemplate;
    public void sendMessage(){
        amqpTemplate.convertAndSend(&quot;exchange.message&quot;,&quot;test.message.routeKey&quot;,&quot;hello&quot;);
    }</code></pre>
<p>æ¥å—æ¶ˆæ¯</p>
<pre><code class="java">    @RabbitListener(queues = &quot;test.message&quot;)
    public void process(String message){
        System.out.println(message);
    }</code></pre>
<h2 id="dockeråŒ–"><a href="#dockeråŒ–" class="headerlink" title="dockeråŒ–"></a>dockeråŒ–</h2><p>pomæ–‡ä»¶ä¸­åŠ å…¥æ‰“åŒ…æ’ä»¶</p>
<pre><code class="xml">        &lt;plugins&gt;
            &lt;plugin&gt;
                &lt;groupId&gt;org.springframework.boot&lt;/groupId&gt;
                &lt;artifactId&gt;spring-boot-maven-plugin&lt;/artifactId&gt;
            &lt;/plugin&gt;
            &lt;plugin&gt;
                &lt;groupId&gt;com.spotify&lt;/groupId&gt;
                &lt;artifactId&gt;docker-maven-plugin&lt;/artifactId&gt;
                &lt;configuration&gt;
                    &lt;imageName&gt;demo/springboot&lt;/imageName&gt;
                    &lt;dockerDirectory&gt;${project.basedir}&lt;/dockerDirectory&gt;
                    &lt;resources&gt;
                        &lt;resource&gt;
                            &lt;targetPath&gt;/&lt;/targetPath&gt;
                            &lt;directory&gt;${project.build.directory}&lt;/directory&gt;
                            &lt;include&gt;${project.build.finalName}.jar&lt;/include&gt;
                        &lt;/resource&gt;
                    &lt;/resources&gt;
                &lt;/configuration&gt;
            &lt;/plugin&gt;
        &lt;/plugins&gt;</code></pre>
<p>åœ¨é¡¹ç›®ç›®å½•ä¸­åˆ›å»ºDockerfileæ–‡ä»¶</p>
<pre><code>FROM java:8
EXPOSE 8080
VOLUME /tmp
ADD [&quot;*.jar&quot;,&quot;app.jar&quot;]
ENTRYPOINT [&quot;java&quot;,&quot;-jar&quot;,&quot;/app.jar&quot;]</code></pre><p>åœ¨é¡¹ç›®ç›®å½•ä¸‹æ‰§è¡ŒæŒ‡ä»¤</p>
<pre><code>mvn package docker:build</code></pre><p>ç„¶åæ ¹æ®é•œåƒæ¥å¯åŠ¨å®¹å™¨</p>
<pre><code>docker run -ti -d -p 8881:8881 --name springboot test/springboot</code></pre><p>æŸ¥çœ‹å®¹å™¨å¯åŠ¨æ—¥å¿—</p>
<pre><code>docker logs -f springboot</code></pre>
            </div>
            <hr>
            <div>
              <p>
                
                  <span>
                <i class="iconfont icon-inbox"></i>
                    
                      <a class="hover-with-bg" href="/blog/categories/springboot/">springboot</a>
                      &nbsp;
                    
                  </span>&nbsp;&nbsp;
                
                
                  <span>
                <i class="iconfont icon-tag"></i>
                    
                      <a class="hover-with-bg" href="/blog/tags/springboot/">springboot</a>
                    
                  </span>
                
              </p>
              
                <p class="note note-warning">æœ¬åšå®¢æ‰€æœ‰æ–‡ç« é™¤ç‰¹åˆ«å£°æ˜å¤–ï¼Œå‡é‡‡ç”¨ <a href="https://zh.wikipedia.org/wiki/Wikipedia:CC_BY-SA_3.0%E5%8D%8F%E8%AE%AE%E6%96%87%E6%9C%AC" target="_blank" rel="nofollow noopener noopener">CC BY-SA 3.0åè®®</a> ã€‚è½¬è½½è¯·æ³¨æ˜å‡ºå¤„ï¼</p>
              
              
                <div class="post-prevnext row">
                  <div class="post-prev col-6">
                    
                    
                      <a href="/blog/2020/04/22/springboot%E6%BA%90%E7%A0%81%E8%A7%A3%E6%9E%90/">
                        <i class="fa fa-chevron-left"></i>
                        <span class="hidden-mobile">springbootæºç è§£æ</span>
                        <span class="visible-mobile">ä¸Šä¸€ç¯‡</span>
                      </a>
                    
                  </div>
                  <div class="post-next col-6">
                    
                    
                      <a href="/blog/2020/04/21/springmvc%E7%9A%84%E8%AF%B7%E6%B1%82%E5%93%8D%E5%BA%94/">
                        <span class="hidden-mobile">springmvcçš„è¯·æ±‚å“åº”</span>
                        <span class="visible-mobile">ä¸‹ä¸€ç¯‡</span>
                        <i class="fa fa-chevron-right"></i>
                      </a>
                    
                  </div>
                </div>
              
            </div>

              
                <!-- Comments -->
                <div class="comments" id="comments">
                  
                  

                </div>
              
          </div>
        </div>
      </div>
    </div>
    
      <div class="d-none d-lg-block col-lg-2 toc-container" id="toc-ctn">
        <div id="toc-start"></div>
<div id="toc">
  <p class="h5"><i class="far fa-list-alt"></i>&nbsp;ç›®å½•</p>
  <div id="tocbot"></div>
</div>

      </div>
    
  </div>
</div>

<!-- Custom -->


    
  </main>

  
    <a class="z-depth-1" id="scroll-top-button" href="#" role="button">
      <i class="fa fa-chevron-up scroll-top-arrow" aria-hidden="true"></i>
    </a>
  

  
    <div class="modal fade" id="modalSearch" tabindex="-1" role="dialog" aria-labelledby="ModalLabel"
     aria-hidden="true">
  <div class="modal-dialog modal-dialog-scrollable modal-lg" role="document">
    <div class="modal-content">
      <div class="modal-header text-center">
        <h4 class="modal-title w-100 font-weight-bold">æœç´¢</h4>
        <button type="button" id="local-search-close" class="close" data-dismiss="modal" aria-label="Close">
          <span aria-hidden="true">&times;</span>
        </button>
      </div>
      <div class="modal-body mx-3">
        <div class="md-form mb-5">
          <input type="text" id="local-search-input" class="form-control validate">
          <label data-error="x" data-success="v"
                 for="local-search-input">å…³é”®è¯</label>
        </div>
        <div class="list-group" id="local-search-result"></div>
      </div>
    </div>
  </div>
</div>
  

  

  

  <footer class="mt-5">
  <div class="text-center py-3">
    <div>
      <a href="https://hexo.io" target="_blank" rel="nofollow noopener"><b>Hexo</b></a>
      <i class="iconfont icon-love"></i>
      <a href="https://github.com/fluid-dev/hexo-theme-fluid" target="_blank" rel="nofollow noopener"> <b>Fluid</b></a>
    </div>
    
  <div>
    
      <!-- ä¸è’œå­ç»Ÿè®¡PV -->
      
      <span id="busuanzi_container_site_pv" style="display: none">
      æ€»è®¿é—®é‡ <span id="busuanzi_value_site_pv"></span> æ¬¡
    </span>
    
    
      <!-- ä¸è’œå­ç»Ÿè®¡UV -->
      
      <span id="busuanzi_container_site_uv" style="display: none">
      æ€»è®¿å®¢æ•° <span id="busuanzi_value_site_uv"></span> äºº
    </span>
    
  </div>


    

    
  </div>
</footer>

<!-- SCRIPTS -->
<script  src="https://cdn.staticfile.org/jquery/3.4.1/jquery.min.js" ></script>
<script  src="https://cdn.staticfile.org/popper.js/1.16.1/umd/popper.min.js" ></script>
<script  src="https://cdn.staticfile.org/twitter-bootstrap/4.4.1/js/bootstrap.min.js" ></script>
<script  src="https://cdn.staticfile.org/mdbootstrap/4.13.0/js/mdb.min.js" ></script>
<script  src="/blog/js/main.js" ></script>


  <script  src="/blog/js/lazyload.js" ></script>



  
  <script  src="https://cdn.staticfile.org/tocbot/4.10.0/tocbot.min.js" ></script>
  <script>
    $(document).ready(function () {
      var navHeight = $('#navbar').height();
      var toc = $('#toc');
      var boardCtn = $('#board-ctn');
      var boardTop = boardCtn.offset().top;
      var tocLimMax = 2 * boardTop + boardCtn.height();

      $(window).scroll(function () {
        var tocLimMin = $('#toc-start').offset().top - navHeight;
        var scroH = document.body.scrollTop + document.documentElement.scrollTop;

        if (tocLimMin <= scroH && scroH <= tocLimMax) {
          toc.css({
            'display': 'block',
            'position': 'fixed',
            'top': navHeight,
          });
        } else if (scroH <= tocLimMin) {
          toc.css({
            'position': '',
            'top': '',
          });
        } else if (scroH > tocLimMax) {
          toc.css('display', 'none');
        }
      });
      tocbot.init({
        tocSelector: '#tocbot',
        contentSelector: '.post-content',
        headingSelector: 'h1,h2,h3,h4,h5,h6',
        linkClass: 'tocbot-link',
        activeLinkClass: 'tocbot-active-link',
        listClass: 'tocbot-list',
        isCollapsedClass: 'tocbot-is-collapsed',
        collapsibleClass: 'tocbot-is-collapsible',
        scrollSmooth: true,
        headingsOffset: -boardTop
      });
      if ($('.toc-list-item').length > 0) {
        $('#toc > p').css('visibility', 'visible');
      }
      var offset = boardCtn.css('margin-right')
      $('#toc-ctn').css({
        'right': offset
      })
    });
  </script>





  <script defer src="https://cdn.staticfile.org/clipboard.js/2.0.6/clipboard.min.js" ></script>
  <script  src="/blog/js/clipboard-use.js" ></script>



  <script defer src="https://cdn.staticfile.org/smoothscroll/1.4.10/SmoothScroll.min.js" ></script>



  <script defer src="https://busuanzi.ibruce.info/busuanzi/2.3/busuanzi.pure.mini.js" ></script>




<!-- Plugins -->


  

  

  

  

  

  



  <script  src="https://cdn.staticfile.org/prettify/188.0.0/prettify.min.js" ></script>
  <script>
    $(document).ready(function () {
      $('pre').addClass('prettyprint  linenums');
      prettyPrint();
    })
  </script>



  <script  src="https://cdn.staticfile.org/typed.js/2.0.11/typed.min.js" ></script>
  <script>
    var typed = new Typed('#subtitle', {
      strings: [
        '  ',
        "springbootå„ç§ç»„ä»¶çš„æ•´åˆ&nbsp;",
      ],
      cursorChar: "_",
      typeSpeed: 70,
      loop: false,
    });
    typed.stop();
    $(document).ready(function () {
      $(".typed-cursor").addClass("h2");
      typed.start();
    });
  </script>



  <script  src="https://cdn.staticfile.org/anchor-js/4.2.2/anchor.min.js" ></script>
  <script>
    anchors.options = {
      placement: "right",
      visible: "hover",
      
    };
    var el = "h1,h2,h3,h4,h5,h6".split(",");
    var res = [];
    for (item of el) {
      res.push(".markdown-body > " + item)
    }
    anchors.add(res.join(", "))
  </script>



  <script  src="/blog/js/local-search.js" ></script>
  <script>
    var path = "/blog/local-search.xml";
    var inputArea = document.querySelector("#local-search-input");
    inputArea.onclick = function () {
      getSearchFile(path);
      this.onclick = null
    }
  </script>



  <script defer src="https://cdn.staticfile.org/fancybox/3.5.7/jquery.fancybox.min.js" ></script>
  <script>
    $("#post img:not(.no-zoom img, img[no-zoom])").each(
      function () {
        var element = document.createElement("a");
        $(element).attr("data-fancybox", "images");
        $(element).attr("href", $(this).attr("src"));
        $(this).wrap(element);
      }
    );
  </script>





  
  
    <script type="text/javascript">
      //å®šä¹‰è·å–è¯è¯­ä¸‹æ ‡
      var a_idx = 0;
      jQuery(document).ready(function ($) {
        //ç‚¹å‡»bodyæ—¶è§¦å‘äº‹ä»¶
        $("body").click(function (e) {
          //éœ€è¦æ˜¾ç¤ºçš„è¯è¯­
          var a = new Array("å¯Œå¼º", "æ°‘ä¸»", "æ–‡æ˜", "å’Œè°", "è‡ªç”±", "å¹³ç­‰", "å…¬æ­£", "æ³•æ²»", "çˆ±å›½", "æ•¬ä¸š", "è¯šä¿¡", "å‹å–„");
          //è®¾ç½®è¯è¯­ç»™spanæ ‡ç­¾
          var $i = $("<span/>").text(a[a_idx]);
          //ä¸‹æ ‡ç­‰äºåŸæ¥ä¸‹æ ‡+1  ä½™ è¯è¯­æ€»æ•°
          a_idx = (a_idx + 1) % a.length;
          //è·å–é¼ æ ‡æŒ‡é’ˆçš„ä½ç½®ï¼Œåˆ†åˆ«ç›¸å¯¹äºæ–‡æ¡£çš„å·¦å’Œå³è¾¹ç¼˜ã€‚
          //è·å–xå’Œyçš„æŒ‡é’ˆåæ ‡
          var x = e.pageX, y = e.pageY;
          //åœ¨é¼ æ ‡çš„æŒ‡é’ˆçš„ä½ç½®ç»™$iå®šä¹‰çš„spanæ ‡ç­¾æ·»åŠ cssæ ·å¼
          $i.css({
            "z-index": 999,
            "top": y - 20,
            "left": x,
            "position": "absolute",
            "font-weight": "bold",
            "color": rand_color()
          });
          // éšæœºé¢œè‰²
          function rand_color() {
            return "rgb(" + ~~(255 * Math.random()) + "," + ~~(255 * Math.random()) + "," + ~~(255 * Math.random()) + ")"
          }
          //åœ¨bodyæ·»åŠ è¿™ä¸ªæ ‡ç­¾
          $("body").append($i);
          //animate() æ–¹æ³•æ‰§è¡Œ CSS å±æ€§é›†çš„è‡ªå®šä¹‰åŠ¨ç”»ã€‚
          //è¯¥æ–¹æ³•é€šè¿‡CSSæ ·å¼å°†å…ƒç´ ä»ä¸€ä¸ªçŠ¶æ€æ”¹å˜ä¸ºå¦ä¸€ä¸ªçŠ¶æ€ã€‚CSSå±æ€§å€¼æ˜¯é€æ¸æ”¹å˜çš„ï¼Œè¿™æ ·å°±å¯ä»¥åˆ›å»ºåŠ¨ç”»æ•ˆæœã€‚
          //è¯¦æƒ…è¯·çœ‹http://www.w3school.com.cn/jquery/effect_animate.asp
          $i.animate({
            //å°†åŸæ¥çš„ä½ç½®å‘ä¸Šç§»åŠ¨180
            "top": y - 180,
            "opacity": 0
            //1500åŠ¨ç”»çš„é€Ÿåº¦
          }, 1500, function () {
            //æ—¶é—´åˆ°äº†è‡ªåŠ¨åˆ é™¤
            $i.remove();
          });
        });
      })
      ;
    </script>
  








</body>
</html>
