<!DOCTYPE html>
<html lang="zh-CN">





<head>
  <meta charset="UTF-8">
  <link rel="apple-touch-icon" sizes="76x76" href="/blog/img/apple-touch-icon.png">
  <link rel="icon" type="image/png" href="/blog/img/favicon.png">
  <meta name="viewport"
        content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no, shrink-to-fit=no">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  
  <meta name="theme-color" content="#2f4154">
  <meta name="description" content="">
  <meta name="author" content="">
  <meta name="keywords" content="">
  <title>springåŸºäºæ³¨è§£çš„å¯åŠ¨æ–¹å¼è§£æå’ŒBeançš„ä½œç”¨åŸŸ - ğŸğŸŠ&#39;s blog</title>

  <link  rel="stylesheet" href="https://cdn.staticfile.org/font-awesome/5.12.1/css/all.min.css" />
<link  rel="stylesheet" href="https://cdn.staticfile.org/twitter-bootstrap/4.4.1/css/bootstrap.min.css" />
<link  rel="stylesheet" href="https://cdn.staticfile.org/mdbootstrap/4.13.0/css/mdb.min.css" />
<link  rel="stylesheet" href="https://cdn.staticfile.org/github-markdown-css/3.0.1/github-markdown.min.css" />

<link rel="stylesheet" href="//at.alicdn.com/t/font_1067060_qzomjdt8bmp.css">



  <link  rel="stylesheet" href="/blog/lib/prettify/tomorrow-night-eighties.min.css" />

<link  rel="stylesheet" href="/blog/css/main.css" />


  <link defer rel="stylesheet" href="https://cdn.staticfile.org/fancybox/3.5.7/jquery.fancybox.min.css" />


<!-- è‡ªå®šä¹‰æ ·å¼ä¿æŒåœ¨æœ€åº•éƒ¨ -->


<meta name="generator" content="Hexo 4.2.1"></head>


<body>
  <header style="height: 70vh;">
    <nav id="navbar" class="navbar fixed-top  navbar-expand-lg navbar-dark scrolling-navbar">
  <div class="container">
    <a class="navbar-brand"
       href="/blog/">&nbsp;<strong>ğŸğŸŠ's blog</strong>&nbsp;</a>

    <button id="navbar-toggler-btn" class="navbar-toggler" type="button" data-toggle="collapse"
            data-target="#navbarSupportedContent"
            aria-controls="navbarSupportedContent" aria-expanded="false" aria-label="Toggle navigation">
      <div class="animated-icon"><span></span><span></span><span></span></div>
    </button>

    <!-- Collapsible content -->
    <div class="collapse navbar-collapse" id="navbarSupportedContent">
      <ul class="navbar-nav ml-auto text-center">
        
          
          
          
          
          <li class="nav-item">
            <a class="nav-link" href="/blog/">é¦–é¡µ</a>
          </li>
        
          
          
          
          
          <li class="nav-item">
            <a class="nav-link" href="/blog/archives/">å½’æ¡£</a>
          </li>
        
          
          
          
          
          <li class="nav-item">
            <a class="nav-link" href="/blog/categories/">åˆ†ç±»</a>
          </li>
        
          
          
          
          
          <li class="nav-item">
            <a class="nav-link" href="/blog/tags/">æ ‡ç­¾</a>
          </li>
        
          
          
          
          
          <li class="nav-item">
            <a class="nav-link" href="/blog/about">å…³äº</a>
          </li>
        
        
          <li class="nav-item" id="search-btn">
            <a class="nav-link" data-toggle="modal" data-target="#modalSearch">&nbsp;&nbsp;<i
                class="iconfont icon-search"></i>&nbsp;&nbsp;</a>
          </li>
        
      </ul>
    </div>
  </div>
</nav>

    <div class="view intro-2" id="background" parallax=true
         style="background: url('/blog/img/default.png') no-repeat center center;
           background-size: cover;">
      <div class="full-bg-img">
        <div class="mask rgba-black-light flex-center">
          <div class="container text-center white-text fadeInUp">
            <span class="h2" id="subtitle">
              
            </span>

            
              
                <p class="mt-3 post-meta">
                  <i class="fas fa-calendar-alt" aria-hidden="true"></i>
                  æ˜ŸæœŸå…­, å››æœˆ 18æ—¥ 2020, 11:47 ä¸­åˆ
                </p>
              

              <p class="mt-1">
                
                  
                  <span class="post-meta">
                    <i class="far fa-chart-bar"></i>
                    3.4k å­—
                  </span>
                

                
                  
                  <span class="post-meta">
                      <i class="far fa-clock"></i>
                      17 åˆ†é’Ÿ
                  </span>
                

                
                  <!-- ä¸è’œå­ç»Ÿè®¡æ–‡ç« PV -->
                  
                  <span id="busuanzi_container_page_pv" class="post-meta" style="display: none">
                    <i class="far fa-eye" aria-hidden="true"></i>
                    <span id="busuanzi_value_page_pv"></span> æ¬¡
                  </span>
                
              </p>
            
          </div>

          
        </div>
      </div>
    </div>
  </header>

  <main>
    
      

<div class="container-fluid">
  <div class="row">
    <div class="d-none d-lg-block col-lg-2"></div>
    <div class="col-lg-8 nopadding-md">
      <div class="container nopadding-md" id="board-ctn">
        <div class="py-5 z-depth-3" id="board">
          <div class="post-content mx-auto" id="post">
            
              <p
                class="note note-warning">æœ¬æ–‡æœ€åæ›´æ–°äºï¼šæ˜ŸæœŸæ—¥, å››æœˆ 26æ—¥ 2020, 12:07 ä¸­åˆ</p>
            
            <div class="markdown-body">
              <h2 id="Beançš„ä½œç”¨åŸŸ"><a href="#Beançš„ä½œç”¨åŸŸ" class="headerlink" title="Beançš„ä½œç”¨åŸŸ"></a>Beançš„ä½œç”¨åŸŸ</h2><p>@Scopeæ³¨è§£å¯ä»¥è®¾ç½®beançš„ä½œç”¨åŸŸï¼Œä¸åŒçš„ä½œç”¨åŸŸå¯¹beanå¯¹è±¡çš„è·å–æ–¹å¼ä¸åŒï¼Œspringä¹Ÿå…è®¸å¼€å‘è€…æ³¨å†Œè‡ªå·±çš„ä½œç”¨åŸŸï¼Œå®ç°å¯¹å¯¹è±¡ä½œç”¨åŸŸçš„æ§åˆ¶ã€‚</p>
<h3 id="doGetBean-çš„å†åˆ†æ"><a href="#doGetBean-çš„å†åˆ†æ" class="headerlink" title="doGetBean()çš„å†åˆ†æ"></a>doGetBean()çš„å†åˆ†æ</h3><p>å¦‚æœç¼“å­˜ä¸­è·å–ä¸åˆ°å®ä¾‹ä¸”å®ä¾‹ä½œç”¨åŸŸä¸æ˜¯å•ä¾‹æ—¶ï¼Œspringå°±ä¼šè·å–åˆ°beançš„ä½œç”¨åŸŸå¯¹è±¡ï¼Œå¹¶è°ƒç”¨ä½œç”¨åŸŸå¯¹è±¡çš„get()æ–¹æ³•åˆ›å»ºå®ä¾‹ã€‚</p>
<pre><code class="java">protected &lt;T&gt; T doGetBean(final String name, @Nullable final Class&lt;T&gt; requiredType,
            @Nullable final Object[] args, boolean typeCheckOnly) throws BeansException {    

  final String beanName = transformedBeanName(name);
    Object bean;

    //ä»ç¼“å­˜ä¸­æ‹¿å®ä¾‹
    // Eagerly check singleton cache for manually registered singletons.
    Object sharedInstance = getSingleton(beanName);
    //å¦‚æœç¼“å­˜é‡Œé¢èƒ½æ‹¿åˆ°å®ä¾‹
    if (sharedInstance != null &amp;&amp; args == null) {
        if (logger.isTraceEnabled()) {
            if (isSingletonCurrentlyInCreation(beanName)) {
                logger.trace(&quot;Returning eagerly cached instance of singleton bean &#39;&quot; + beanName +
                        &quot;&#39; that is not fully initialized yet - a consequence of a circular reference&quot;);
            }
            else {
                logger.trace(&quot;Returning cached instance of singleton bean &#39;&quot; + beanName + &quot;&#39;&quot;);
            }
        }
        //æ”¹æ–¹æ³•æ˜¯FactoryBeanæ¥å£çš„è°ƒç”¨å…¥å£
        bean = getObjectForBeanInstance(sharedInstance, name, beanName, null);
    }

    else {

        //å¦‚æœsingletonObjectsç¼“å­˜é‡Œé¢æ²¡æœ‰ï¼Œåˆ™èµ°ä¸‹æ¥
        // Fail if we&#39;re already creating this bean instance:
        // We&#39;re assumably within a circular reference.

        //å¦‚æœæ˜¯scope æ˜¯Prototypeçš„ï¼Œæ ¡éªŒæ˜¯å¦æœ‰å‡ºç°å¾ªç¯ä¾èµ–ï¼Œå¦‚æœæœ‰åˆ™ç›´æ¥æŠ¥é”™
        if (isPrototypeCurrentlyInCreation(beanName)) {
            throw new BeanCurrentlyInCreationException(beanName);
        }

        // Check if bean definition exists in this factory.
        BeanFactory parentBeanFactory = getParentBeanFactory();
        if (parentBeanFactory != null &amp;&amp; !containsBeanDefinition(beanName)) {
            // Not found -&gt; check parent.
            String nameToLookup = originalBeanName(name);
            if (parentBeanFactory instanceof AbstractBeanFactory) {
                return ((AbstractBeanFactory) parentBeanFactory).doGetBean(
                        nameToLookup, requiredType, args, typeCheckOnly);
            }
            else if (args != null) {
                // Delegation to parent with explicit args.
                return (T) parentBeanFactory.getBean(nameToLookup, args);
            }
            else if (requiredType != null) {
                // No args -&gt; delegate to standard getBean method.
                return parentBeanFactory.getBean(nameToLookup, requiredType);
            }
            else {
                return (T) parentBeanFactory.getBean(nameToLookup);
            }
        }

        if (!typeCheckOnly) {
            markBeanAsCreated(beanName);
        }

        try {
            //çˆ¶å­BeanDefinitionåˆå¹¶
            final RootBeanDefinition mbd = getMergedLocalBeanDefinition(beanName);
            checkMergedBeanDefinition(mbd, beanName, args);

            //è·å–ä¾èµ–å¯¹è±¡å±æ€§ï¼Œä¾èµ–å¯¹è±¡è¦å…ˆå®ä¾‹åŒ–
            // Guarantee initialization of beans that the current bean depends on.
            String[] dependsOn = mbd.getDependsOn();
            if (dependsOn != null) {
                for (String dep : dependsOn) {
                    if (isDependent(beanName, dep)) {
                        throw new BeanCreationException(mbd.getResourceDescription(), beanName,
                                &quot;Circular depends-on relationship between &#39;&quot; + beanName + &quot;&#39; and &#39;&quot; + dep + &quot;&#39;&quot;);
                    }
                    registerDependentBean(dep, beanName);
                    try {
                        //å®ä¾‹åŒ–
                        getBean(dep);
                }
                    catch (NoSuchBeanDefinitionException ex) {
                        throw new BeanCreationException(mbd.getResourceDescription(), beanName,
                                &quot;&#39;&quot; + beanName + &quot;&#39; depends on missing bean &#39;&quot; + dep + &quot;&#39;&quot;, ex);
                    }
                }
            }

            //ä½œç”¨åŸŸä¸ºå•ä¾‹æ—¶çš„å®ä¾‹åŒ–
            // Create bean instance.
            if (mbd.isSingleton()) {
                sharedInstance = getSingleton(beanName, () -&gt; {
                    try {
                        return createBean(beanName, mbd, args);
                    }
                    catch (BeansException ex) {
                        // Explicitly remove instance from singleton cache: It might have been put there
                        // eagerly by the creation process, to allow for circular reference resolution.
                        // Also remove any beans that received a temporary reference to the bean.
                        destroySingleton(beanName);
                        throw ex;
                    }
                });
                //è¯¥æ–¹æ³•æ˜¯FactoryBeanæ¥å£çš„è°ƒç”¨å…¥å£
                bean = getObjectForBeanInstance(sharedInstance, name, beanName, mbd);
            }

            else if (mbd.isPrototype()) {
                // It&#39;s a prototype -&gt; create a new instance.
                Object prototypeInstance = null;
                try {
                    beforePrototypeCreation(beanName);
                    prototypeInstance = createBean(beanName, mbd, args);
                }
                finally {
                    afterPrototypeCreation(beanName);
                }
                //è¯¥æ–¹æ³•æ˜¯FactoryBeanæ¥å£çš„è°ƒç”¨å…¥å£
                bean = getObjectForBeanInstance(prototypeInstance, name, beanName, mbd);
            }
      //å…¶ä»–ä½œç”¨åŸŸï¼Œå¦‚è‡ªå®šä¹‰ä½œç”¨åŸŸ
            else {
                String scopeName = mbd.getScope();
                final Scope scope = this.scopes.get(scopeName);
                if (scope == null) {
                    throw new IllegalStateException(&quot;No Scope registered for scope name &#39;&quot; + scopeName + &quot;&#39;&quot;);
                }
                try {
                    Object scopedInstance = scope.get(beanName, () -&gt; {
                        beforePrototypeCreation(beanName);
                        try {
                            return createBean(beanName, mbd, args);
                        }
                        finally {
                            afterPrototypeCreation(beanName);
                        }
                    });
                    //æ”¹æ–¹æ³•æ˜¯FactoryBeanæ¥å£çš„è°ƒç”¨å…¥å£
                    bean = getObjectForBeanInstance(scopedInstance, name, beanName, mbd);
                }
                catch (IllegalStateException ex) {
                    throw new BeanCreationException(beanName,
                            &quot;Scope &#39;&quot; + scopeName + &quot;&#39; is not active for the current thread; consider &quot; +
                            &quot;defining a scoped proxy for this bean if you intend to refer to it from a singleton&quot;,
                            ex);
                }
            }
        }
        catch (BeansException ex) {
            cleanupAfterBeanCreationFailure(beanName);
            throw ex;
        }
    }

    // Check if required type matches the type of the actual bean instance.
    if (requiredType != null &amp;&amp; !requiredType.isInstance(bean)) {
        try {
            T convertedBean = getTypeConverter().convertIfNecessary(bean, requiredType);
            if (convertedBean == null) {
                throw new BeanNotOfRequiredTypeException(name, requiredType, bean.getClass());
            }
            return convertedBean;
        }
        catch (TypeMismatchException ex) {
            if (logger.isTraceEnabled()) {
                logger.trace(&quot;Failed to convert bean &#39;&quot; + name + &quot;&#39; to required type &#39;&quot; +
                        ClassUtils.getQualifiedName(requiredType) + &quot;&#39;&quot;, ex);
            }
            throw new BeanNotOfRequiredTypeException(name, requiredType, bean.getClass());
        }
    }
    return (T) bean;
}</code></pre>
<h3 id="è‡ªå®šä¹‰ä½œç”¨åŸŸçš„å®ç°"><a href="#è‡ªå®šä¹‰ä½œç”¨åŸŸçš„å®ç°" class="headerlink" title="è‡ªå®šä¹‰ä½œç”¨åŸŸçš„å®ç°"></a>è‡ªå®šä¹‰ä½œç”¨åŸŸçš„å®ç°</h3><p>springåœ¨å®ŒæˆBeanDefinitionçš„å®ä¾‹åŒ–åŠIOCã€DIåï¼Œä¼šè°ƒç”¨BeanFactoryPostProcessoræ¥å£çš„postProcessBeanFactory()æ–¹æ³•å¹¶å°†beanFactoryä¼ é€’è¿›å»ï¼Œæˆ‘ä»¬å¯ä»¥åœ¨è¿™ä¸ªæ–¹æ³•ä¸­è°ƒç”¨beanFactoryçš„regtsterScope()æ–¹æ³•å°†è‡ªå®šä¹‰ä½œç”¨åŸŸæ·»åŠ åˆ°springå®¹å™¨ä¸­ã€‚</p>
<pre><code class="java">@Component
public class ThreadScopeRegistry implements BeanDefinitionRegistryPostProcessor {

    private BeanDefinitionRegistry beanDefinitionRegistry;

    @Override
    public void postProcessBeanDefinitionRegistry(BeanDefinitionRegistry registry) throws BeansException {
        this.beanDefinitionRegistry = registry;
    }

    @Override
    public void postProcessBeanFactory(ConfigurableListableBeanFactory beanFactory) throws BeansException {
        beanFactory.registerScope(&quot;refresh&quot;,new ThreadScope());
    }
}</code></pre>
<p>åœ¨åˆ›å»ºå®ä¾‹æ—¶ä¼šè°ƒç”¨åˆ°Scopeå¯¹è±¡çš„get()æ–¹æ³•ï¼Œ å¹¶å‘get()æ–¹æ³•ä¸­ä¼ é€’beanNameè·Ÿåˆ›å»ºæ–¹æ³•factory.getObject()ã€‚æ‰€ä»¥æˆ‘ä»¬å¯ä»¥åœ¨Scopeä¸­ç²¾å‡†çš„æ§åˆ¶beanå¯¹è±¡çš„ä½œç”¨åŸŸã€‚æ¯”å¦‚åˆ›å»ºä¸€ä¸ªçº¿ç¨‹é—´å…±äº«çš„ä½œç”¨åŸŸã€‚</p>
<pre><code class="java">public class ThreadScope implements Scope {
    private ThreadLocal local = new ThreadLocal();

    @Override
    public Object get(String name, ObjectFactory&lt;?&gt; objectFactory) {
        if (local.get()!=null) {
            return local.get();
        }
        Object bean = objectFactory.getObject();
        local.set(bean);
        return bean;
    }
}</code></pre>
<h3 id="springçš„ä½œç”¨åŸŸ"><a href="#springçš„ä½œç”¨åŸŸ" class="headerlink" title="springçš„ä½œç”¨åŸŸ"></a>springçš„ä½œç”¨åŸŸ</h3><p>singletonï¼šspringçš„é»˜è®¤ä½œç”¨åŸŸï¼Œåœ¨springå®¹å™¨ä¸­ä»…å­˜åœ¨ä¸€ä¸ªBeanå®ä¾‹ï¼Œåœ¨å¯åŠ¨æ—¶ä¼šå®ä¾‹åŒ–å¹¶æ”¾å…¥ä¸€çº§ç¼“å­˜ä¸­ï¼Œä¹‹åéƒ½æ˜¯ä»ä¸€çº§ç¼“å­˜ä¸­è·å–ã€‚</p>
<p>prototypeï¼šå¤šå®ä¾‹æ¯æ¬¡getBean()æ“ä½œæ—¶éƒ½ä¼šé‡æ–°åˆ›å»ºã€‚å¯åŠ¨æ—¶ä¸ä¼šåˆå§‹åŒ–ï¼Œåªæœ‰åœ¨getBean()æ—¶æ‰ä¼šå®ä¾‹åŒ–ï¼Œè€Œä¸”åœ¨å®ä¾‹è¯æ—¶ä¸ä¼šæ”¾å…¥ä¸€çº§ç¼“å­˜ï¼Œä½†ä¼šæ”¾å…¥singletonsCurrentlyInCreationå®¹å™¨ï¼Œé˜»æ–­å¾ªç¯ä¾èµ–ã€‚</p>
<p>requestï¼šæ¯æ¬¡httpè¯·æ±‚éƒ½åˆ›å»ºä¸€ä¸ªå®ä¾‹ï¼Œä»…åœ¨webå®¹å™¨ä¸­å­˜åœ¨ã€‚å¦‚æœä»¥xmlæ–‡ä»¶çš„æ–¹å¼å¯åŠ¨ä¼šç›´æ¥æŠ¥é”™ã€‚åŸç†å°±æ˜¯å°†åˆ›å»ºåçš„Beanå®ä¾‹æ”¾åœ¨requestä¸­ã€‚</p>
<p>sessionï¼šä¸requeståŸºæœ¬ç›¸åŒï¼Œä¸åŒçš„æ˜¯Beanå®ä¾‹ä¼šæ”¾åœ¨Sessionä¸­ã€‚</p>
<h2 id="åŸºäºæ³¨è§£çš„å¯åŠ¨æ–¹å¼è§£æ"><a href="#åŸºäºæ³¨è§£çš„å¯åŠ¨æ–¹å¼è§£æ" class="headerlink" title="åŸºäºæ³¨è§£çš„å¯åŠ¨æ–¹å¼è§£æ"></a>åŸºäºæ³¨è§£çš„å¯åŠ¨æ–¹å¼è§£æ</h2><h3 id="AnnotationConfigApplicaitonContextç±»è§£æ"><a href="#AnnotationConfigApplicaitonContextç±»è§£æ" class="headerlink" title="AnnotationConfigApplicaitonContextç±»è§£æ"></a>AnnotationConfigApplicaitonContextç±»è§£æ</h3><p>å…¶æ„é€ å‡½æ•°ä¸­ä¼šåˆ›å»ºä¸€ä¸ªAnnotatedBeanDefinitionReaderå¯¹è±¡ï¼Œç„¶åå°†annotatedClasseså¯¹è±¡äº¤ç»™register()æ–¹æ³•å®Œæˆè§£æ</p>
<pre><code class="java">    public AnnotationConfigApplicationContext(Class&lt;?&gt;... annotatedClasses) {
        this();
        register(annotatedClasses);
        refresh();
    }</code></pre>
<h4 id="register-æ–¹æ³•"><a href="#register-æ–¹æ³•" class="headerlink" title="register()æ–¹æ³•"></a>register()æ–¹æ³•</h4><p>register()æ–¹æ³•ä¼šè°ƒç”¨åˆ°AnnotatedBeanDefinitionReaderçš„register()æ–¹æ³•å¾ªç¯annotatedClasseså¹¶è°ƒç”¨registerBean()æ–¹æ³•è¿›è¡ŒBeanDefinitionçš„æ³¨å†Œã€‚</p>
<p>doRegisterBean()æ˜¯registerBean()çš„ä¸»è¦æ–¹æ³•ã€‚doRegisterBean()æ–¹æ³•é¦–ä¼šåˆ›å»ºä¸€ä¸ªBeanDefinitionå¯¹è±¡ï¼Œç„¶åå°†æ”¶é›†annotatedClassçš„ä¿¡æ¯å¹¶åŒ…è£…ä¸ºMetadataå¯¹è±¡ï¼Œä¹‹åä½¿ç”¨AnnotationConfigUtils.processCommonDefinitionAnnotations()å¯¹Metadataå¯¹è±¡çš„æ³¨è§£å’Œå¤„ç†å¹¶è®¾ç½®åˆ°BeanDefinitionå¯¹è±¡ä¸­ï¼Œä¹‹åå°†BeanDefinitionå¯¹è±¡å°è£…ä¸ºBeanDefinitionHolderå¹¶æ³¨å†Œã€‚</p>
<pre><code class="java">    &lt;T&gt; void doRegisterBean(Class&lt;T&gt; annotatedClass, @Nullable Supplier&lt;T&gt; instanceSupplier, @Nullable String name,
            @Nullable Class&lt;? extends Annotation&gt;[] qualifiers, BeanDefinitionCustomizer... definitionCustomizers) {

        AnnotatedGenericBeanDefinition abd = new AnnotatedGenericBeanDefinition(annotatedClass);
        if (this.conditionEvaluator.shouldSkip(abd.getMetadata())) {
            return;
        }

        abd.setInstanceSupplier(instanceSupplier);
        ScopeMetadata scopeMetadata = this.scopeMetadataResolver.resolveScopeMetadata(abd);
        abd.setScope(scopeMetadata.getScopeName());
        String beanName = (name != null ? name : this.beanNameGenerator.generateBeanName(abd, this.registry));
    //å¯¹æ³¨è§£è¿›è¡Œæ”¶é›†
        AnnotationConfigUtils.processCommonDefinitionAnnotations(abd);
        if (qualifiers != null) {
            for (Class&lt;? extends Annotation&gt; qualifier : qualifiers) {
                if (Primary.class == qualifier) {
                    abd.setPrimary(true);
                }
                else if (Lazy.class == qualifier) {
                    abd.setLazyInit(true);
                }
                else {
                    abd.addQualifier(new AutowireCandidateQualifier(qualifier));
                }
            }
        }
        for (BeanDefinitionCustomizer customizer : definitionCustomizers) {
            customizer.customize(abd);
        }
    //å°è£…å¹¶åˆ›å»ºBeanDefinitionHolderå¯¹è±¡
        BeanDefinitionHolder definitionHolder = new BeanDefinitionHolder(abd, beanName);
        definitionHolder = AnnotationConfigUtils.applyScopedProxyMode(scopeMetadata, definitionHolder, this.registry);
        BeanDefinitionReaderUtils.registerBeanDefinition(definitionHolder, this.registry);
    }</code></pre>
<h5 id="processCommonDefinitionAnnotations-æ–¹æ³•"><a href="#processCommonDefinitionAnnotations-æ–¹æ³•" class="headerlink" title="processCommonDefinitionAnnotations()æ–¹æ³•"></a>processCommonDefinitionAnnotations()æ–¹æ³•</h5><p>è¯¥æ–¹æ³•ä¼šå¯¹æ³¨è§£è¿›è¡Œæ”¶é›†å¹¶æ”¾åˆ°BeanDefinitionä¸­ã€‚</p>
<pre><code class="java">static void processCommonDefinitionAnnotations(AnnotatedBeanDefinition abd, AnnotatedTypeMetadata metadata) {
   //å¯¹@Lazyæ³¨è§£æ”¯æŒ
   AnnotationAttributes lazy = attributesFor(metadata, Lazy.class);
   if (lazy != null) {
      abd.setLazyInit(lazy.getBoolean(&quot;value&quot;));
   }
   else if (abd.getMetadata() != metadata) {
      lazy = attributesFor(abd.getMetadata(), Lazy.class);
      if (lazy != null) {
         abd.setLazyInit(lazy.getBoolean(&quot;value&quot;));
      }
   }

   if (metadata.isAnnotated(Primary.class.getName())) {
      abd.setPrimary(true);
   }
   //å¯¹@DependsOnæ³¨è§£æ”¯æŒ
   AnnotationAttributes dependsOn = attributesFor(metadata, DependsOn.class);
   if (dependsOn != null) {
      abd.setDependsOn(dependsOn.getStringArray(&quot;value&quot;));
   }

   AnnotationAttributes role = attributesFor(metadata, Role.class);
   if (role != null) {
      abd.setRole(role.getNumber(&quot;value&quot;).intValue());
   }
   AnnotationAttributes description = attributesFor(metadata, Description.class);
   if (description != null) {
      abd.setDescription(description.getString(&quot;value&quot;));
   }
}</code></pre>
<h3 id="AnnotatedBeanDefinitionReaderè§£æ"><a href="#AnnotatedBeanDefinitionReaderè§£æ" class="headerlink" title="AnnotatedBeanDefinitionReaderè§£æ"></a>AnnotatedBeanDefinitionReaderè§£æ</h3><p>å…¶æ„é€ å‡½æ•°ä¸­ä¼šè°ƒç”¨AnnotationConfigUtils.registerAnnotationConfigProcessors()æ–¹æ³•ã€‚</p>
<pre><code class="java">    public AnnotatedBeanDefinitionReader(BeanDefinitionRegistry registry, Environment environment) {
        Assert.notNull(registry, &quot;BeanDefinitionRegistry must not be null&quot;);
        Assert.notNull(environment, &quot;Environment must not be null&quot;);
        this.registry = registry;
        this.conditionEvaluator = new ConditionEvaluator(registry, environment, null);
        AnnotationConfigUtils.registerAnnotationConfigProcessors(this.registry);
    }</code></pre>
<h4 id="registerAnnotationConfigProcessors-æ–¹æ³•"><a href="#registerAnnotationConfigProcessors-æ–¹æ³•" class="headerlink" title="registerAnnotationConfigProcessors()æ–¹æ³•"></a>registerAnnotationConfigProcessors()æ–¹æ³•</h4><p>æ­¤æ–¹æ³•ä¼šåˆ›å»ºä¸€äº›BeanDefinitionRegistryPostProcessorç±»ï¼Œç”¨äºåœ¨Beanå®ä¾‹åŒ–ä¹‹å‰å¯¹BeanDefinitionè¿›è¡Œæ“ä½œã€‚BeanDefinitionRegistryPostProcessorç±»ç»§æ‰¿äº†BeanFactoryPostProcessorç±»ï¼Œåœ¨springä¼šåœ¨å®ä¾‹åŒ–Beanä¹‹å‰åˆ›å»ºBeanFactoryPostProcessorå¯¹è±¡ï¼Œå¹¶è°ƒç”¨postProcessBeanDefinitionRegistry()æ–¹æ³•ã€‚</p>
<pre><code class="java">    public static Set&lt;BeanDefinitionHolder&gt; registerAnnotationConfigProcessors(
            BeanDefinitionRegistry registry, @Nullable Object source) {

        DefaultListableBeanFactory beanFactory = unwrapDefaultListableBeanFactory(registry);
        if (beanFactory != null) {
            if (!(beanFactory.getDependencyComparator() instanceof AnnotationAwareOrderComparator)) {
                beanFactory.setDependencyComparator(AnnotationAwareOrderComparator.INSTANCE);
            }
            if (!(beanFactory.getAutowireCandidateResolver() instanceof ContextAnnotationAutowireCandidateResolver)) {
                beanFactory.setAutowireCandidateResolver(new ContextAnnotationAutowireCandidateResolver());
            }
        }

        Set&lt;BeanDefinitionHolder&gt; beanDefs = new LinkedHashSet&lt;&gt;(8);

        if (!registry.containsBeanDefinition(CONFIGURATION_ANNOTATION_PROCESSOR_BEAN_NAME)) {
      // é‡ç‚¹å…³æ³¨è¿™è¡Œä»£ç ä¸­çš„ConfigurationClassPostProcessorç±»
            RootBeanDefinition def = new RootBeanDefinition(ConfigurationClassPostProcessor.class);
            def.setSource(source);
            beanDefs.add(registerPostProcessor(registry, def, CONFIGURATION_ANNOTATION_PROCESSOR_BEAN_NAME));
        }

        if (!registry.containsBeanDefinition(AUTOWIRED_ANNOTATION_PROCESSOR_BEAN_NAME)) {
            RootBeanDefinition def = new RootBeanDefinition(AutowiredAnnotationBeanPostProcessor.class);
            def.setSource(source);
            beanDefs.add(registerPostProcessor(registry, def, AUTOWIRED_ANNOTATION_PROCESSOR_BEAN_NAME));
        }

        // Check for JSR-250 support, and if present add the CommonAnnotationBeanPostProcessor.
        if (jsr250Present &amp;&amp; !registry.containsBeanDefinition(COMMON_ANNOTATION_PROCESSOR_BEAN_NAME)) {
            RootBeanDefinition def = new RootBeanDefinition(CommonAnnotationBeanPostProcessor.class);
            def.setSource(source);
            beanDefs.add(registerPostProcessor(registry, def, COMMON_ANNOTATION_PROCESSOR_BEAN_NAME));
        }

        // Check for JPA support, and if present add the PersistenceAnnotationBeanPostProcessor.
        if (jpaPresent &amp;&amp; !registry.containsBeanDefinition(PERSISTENCE_ANNOTATION_PROCESSOR_BEAN_NAME)) {
            RootBeanDefinition def = new RootBeanDefinition();
            try {
                def.setBeanClass(ClassUtils.forName(PERSISTENCE_ANNOTATION_PROCESSOR_CLASS_NAME,
                        AnnotationConfigUtils.class.getClassLoader()));
            }
            catch (ClassNotFoundException ex) {
                throw new IllegalStateException(
                        &quot;Cannot load optional framework class: &quot; + PERSISTENCE_ANNOTATION_PROCESSOR_CLASS_NAME, ex);
            }
            def.setSource(source);
            beanDefs.add(registerPostProcessor(registry, def, PERSISTENCE_ANNOTATION_PROCESSOR_BEAN_NAME));
        }

        if (!registry.containsBeanDefinition(EVENT_LISTENER_PROCESSOR_BEAN_NAME)) {
            RootBeanDefinition def = new RootBeanDefinition(EventListenerMethodProcessor.class);
            def.setSource(source);
            beanDefs.add(registerPostProcessor(registry, def, EVENT_LISTENER_PROCESSOR_BEAN_NAME));
        }

        if (!registry.containsBeanDefinition(EVENT_LISTENER_FACTORY_BEAN_NAME)) {
            RootBeanDefinition def = new RootBeanDefinition(DefaultEventListenerFactory.class);
            def.setSource(source);
            beanDefs.add(registerPostProcessor(registry, def, EVENT_LISTENER_FACTORY_BEAN_NAME));
        }

        return beanDefs;
  }</code></pre>
<h3 id="ConfigurationClassPostProcessorç±»è§£æ"><a href="#ConfigurationClassPostProcessorç±»è§£æ" class="headerlink" title="ConfigurationClassPostProcessorç±»è§£æ"></a>ConfigurationClassPostProcessorç±»è§£æ</h3><p>ConfigurationClassPostProcessorç±»æ˜¯registerAnnotationConfigProcessors()æ–¹æ³•æ³¨å†Œçš„BeanDefinitionRegistryPostProcessorä¹‹ä¸€ã€‚</p>
<h4 id="processConfigBeanDefinitions-æ–¹æ³•"><a href="#processConfigBeanDefinitions-æ–¹æ³•" class="headerlink" title="processConfigBeanDefinitions()æ–¹æ³•"></a>processConfigBeanDefinitions()æ–¹æ³•</h4><p>è¯¥æ–¹æ³•é¦–å…ˆä¼šè°ƒç”¨ConfigurationClassUtils.checkConfigurationClassCandidate()æ–¹æ³•å°†å…·æœ‰æŸäº›æ³¨è§£çš„BeanDefinationå¯¹è±¡æ”¾å…¥configCandidateså®¹å™¨ä¸­ï¼Œç„¶åå¯¹configCandidateså®¹å™¨è¿›è¡Œæ’åºï¼Œå†ä½¿ç”¨parse()æ–¹æ³•å¯¹æ³¨è§£è¿›è¡Œå¤„ç†ï¼Œæœ€åä½¿ç”¨loadBeanDefinitions()å®Œæˆæ³¨å†Œã€‚</p>
<pre><code class="java">    public void processConfigBeanDefinitions(BeanDefinitionRegistry registry) {
        List&lt;BeanDefinitionHolder&gt; configCandidates = new ArrayList&lt;&gt;();
        String[] candidateNames = registry.getBeanDefinitionNames();

        for (String beanName : candidateNames) {
            BeanDefinition beanDef = registry.getBeanDefinition(beanName);
            if (ConfigurationClassUtils.isFullConfigurationClass(beanDef) ||
                    ConfigurationClassUtils.isLiteConfigurationClass(beanDef)) {
                if (logger.isDebugEnabled()) {
                    logger.debug(&quot;Bean definition has already been processed as a configuration class: &quot; + beanDef);
                }
            }
            //åˆ¤æ–­æ˜¯ç±»ä¸Šæˆ–æ–¹æ³•ä¸Šçš„æ³¨è§£ï¼Œ
            else if (ConfigurationClassUtils.checkConfigurationClassCandidate(beanDef, this.metadataReaderFactory)) {
                configCandidates.add(new BeanDefinitionHolder(beanDef, beanName));
            }
        }

        // Return immediately if no @Configuration classes were found
        if (configCandidates.isEmpty()) {
            return;
        }

    //æ’åº
        // Sort by previously determined @Order value, if applicable
        configCandidates.sort((bd1, bd2) -&gt; {
            int i1 = ConfigurationClassUtils.getOrder(bd1.getBeanDefinition());
            int i2 = ConfigurationClassUtils.getOrder(bd2.getBeanDefinition());
            return Integer.compare(i1, i2);
        });

        // Detect any custom bean name generation strategy supplied through the enclosing application context
        SingletonBeanRegistry sbr = null;
        if (registry instanceof SingletonBeanRegistry) {
            sbr = (SingletonBeanRegistry) registry;
            if (!this.localBeanNameGeneratorSet) {
                BeanNameGenerator generator = (BeanNameGenerator) sbr.getSingleton(CONFIGURATION_BEAN_NAME_GENERATOR);
                if (generator != null) {
                    this.componentScanBeanNameGenerator = generator;
                    this.importBeanNameGenerator = generator;
                }
            }
        }

        if (this.environment == null) {
            this.environment = new StandardEnvironment();
        }

        //è¿™ä¸ªç±»å¾ˆé‡è¦ï¼Œ@ComponentScan @Configurationæ”¯æŒ
        // Parse each @Configuration class
        ConfigurationClassParser parser = new ConfigurationClassParser(
                this.metadataReaderFactory, this.problemReporter, this.environment,
                this.resourceLoader, this.componentScanBeanNameGenerator, registry);

        Set&lt;BeanDefinitionHolder&gt; candidates = new LinkedHashSet&lt;&gt;(configCandidates);
        Set&lt;ConfigurationClass&gt; alreadyParsed = new HashSet&lt;&gt;(configCandidates.size());
        do {
            parser.parse(candidates);
            parser.validate();

            Set&lt;ConfigurationClass&gt; configClasses = new LinkedHashSet&lt;&gt;(parser.getConfigurationClasses());
            configClasses.removeAll(alreadyParsed);

            // Read the model and create bean definitions based on its content
            if (this.reader == null) {
                this.reader = new ConfigurationClassBeanDefinitionReader(
                        registry, this.sourceExtractor, this.resourceLoader, this.environment,
                        this.importBeanNameGenerator, parser.getImportRegistry());
            }
            //è®¾ç½®beanDefinitionçš„å±æ€§å€¼,é‡ç‚¹çœ‹ï¼Œå…·ä½“æ‰§è¡Œ import importSource @Beançš„é€»è¾‘
            this.reader.loadBeanDefinitions(configClasses);
            alreadyParsed.addAll(configClasses);

            candidates.clear();
            if (registry.getBeanDefinitionCount() &gt; candidateNames.length) {
                String[] newCandidateNames = registry.getBeanDefinitionNames();
                Set&lt;String&gt; oldCandidateNames = new HashSet&lt;&gt;(Arrays.asList(candidateNames));
                Set&lt;String&gt; alreadyParsedClasses = new HashSet&lt;&gt;();
                for (ConfigurationClass configurationClass : alreadyParsed) {
                    alreadyParsedClasses.add(configurationClass.getMetadata().getClassName());
                }
                for (String candidateName : newCandidateNames) {
                    if (!oldCandidateNames.contains(candidateName)) {
                        BeanDefinition bd = registry.getBeanDefinition(candidateName);
                        if (ConfigurationClassUtils.checkConfigurationClassCandidate(bd, this.metadataReaderFactory) &amp;&amp;
                                !alreadyParsedClasses.contains(bd.getBeanClassName())) {
                            candidates.add(new BeanDefinitionHolder(bd, candidateName));
                        }
                    }
                }
                candidateNames = newCandidateNames;
            }
        }
        while (!candidates.isEmpty());

        // Register the ImportRegistry as a bean in order to support ImportAware @Configuration classes
        if (sbr != null &amp;&amp; !sbr.containsSingleton(IMPORT_REGISTRY_BEAN_NAME)) {
            sbr.registerSingleton(IMPORT_REGISTRY_BEAN_NAME, parser.getImportRegistry());
        }

        if (this.metadataReaderFactory instanceof CachingMetadataReaderFactory) {
            // Clear cache in externally provided MetadataReaderFactory; this is a no-op
            // for a shared cache since it&#39;ll be cleared by the ApplicationContext.
            ((CachingMetadataReaderFactory) this.metadataReaderFactory).clearCache();
        }
    }</code></pre>
<h5 id="checkConfigurationClassCandidate-æ–¹æ³•"><a href="#checkConfigurationClassCandidate-æ–¹æ³•" class="headerlink" title="checkConfigurationClassCandidate()æ–¹æ³•"></a>checkConfigurationClassCandidate()æ–¹æ³•</h5><p>è¯¥æ–¹æ³•ä¼šæ£€æŸ¥ç±»ä¸Šæ˜¯å¦æœ‰@Componentã€@ComponentScanã€@Importã€@ImportResourceã€@Configurationæ³¨è§£æˆ–è€…æ–¹æ³•ä¸Šæ˜¯å¦æœ‰@Beanæ³¨è§£ï¼Œå¦‚æœæœ‰ä¼šå¯¹ç”¨äºæ’åºçš„orderå±æ€§è¿›è¡Œè®¾ç½®ã€‚</p>
<pre><code class="java">    public static boolean checkConfigurationClassCandidate(
            BeanDefinition beanDef, MetadataReaderFactory metadataReaderFactory) {

        String className = beanDef.getBeanClassName();
        if (className == null || beanDef.getFactoryMethodName() != null) {
            return false;
        }

        AnnotationMetadata metadata;
        if (beanDef instanceof AnnotatedBeanDefinition &amp;&amp;
                className.equals(((AnnotatedBeanDefinition) beanDef).getMetadata().getClassName())) {
            // Can reuse the pre-parsed metadata from the given BeanDefinition...
            metadata = ((AnnotatedBeanDefinition) beanDef).getMetadata();
        }
        else if (beanDef instanceof AbstractBeanDefinition &amp;&amp; ((AbstractBeanDefinition) beanDef).hasBeanClass()) {
            // Check already loaded Class if present...
            // since we possibly can&#39;t even load the class file for this Class.
            Class&lt;?&gt; beanClass = ((AbstractBeanDefinition) beanDef).getBeanClass();
            metadata = new StandardAnnotationMetadata(beanClass, true);
        }
        else {
            try {
                MetadataReader metadataReader = metadataReaderFactory.getMetadataReader(className);
                metadata = metadataReader.getAnnotationMetadata();
            }
            catch (IOException ex) {
                if (logger.isDebugEnabled()) {
                    logger.debug(&quot;Could not find class file for introspecting configuration annotations: &quot; +
                            className, ex);
                }
                return false;
            }
        }

        //åˆ¤æ–­æ˜¯å¦æœ‰@Componentã€@ComponentScanã€@Importã€@ImportResourceã€@Configurationæ³¨è§£
        if (isFullConfigurationCandidate(metadata)) {
            beanDef.setAttribute(CONFIGURATION_CLASS_ATTRIBUTE, CONFIGURATION_CLASS_FULL);
        }
        //åˆ¤æ–­æ˜¯å¦æœ‰@Componentæ³¨è§£ï¼Œæˆ–è€…ç±»ä¸Šé¢æ²¡æ³¨è§£ï¼ˆxmlé…ç½®å®ä¾‹åŒ–ï¼‰æ–¹æ³•ä¸Šé¢æœ‰@Beanæ³¨è§£
        else if (isLiteConfigurationCandidate(metadata)) {
            beanDef.setAttribute(CONFIGURATION_CLASS_ATTRIBUTE, CONFIGURATION_CLASS_LITE);
        }
        else {
            return false;
        }

        // It&#39;s a full or lite configuration candidate... Let&#39;s determine the order value, if any.
    //è®¾ç½®orderå±æ€§
        Integer order = getOrder(metadata);
        if (order != null) {
            beanDef.setAttribute(ORDER_ATTRIBUTE, order);
        }

        return true;
    }</code></pre>
<h5 id="parse-æ–¹æ³•"><a href="#parse-æ–¹æ³•" class="headerlink" title="parse()æ–¹æ³•"></a>parse()æ–¹æ³•</h5><p>parse()æ–¹æ³•æœ€ç»ˆä¼šè°ƒç”¨doProcessConfigurationClass()æ–¹æ³•å¯¹æ³¨è§£è¿›è¡Œå¤„ç†ã€‚æ­¤å¤„åˆ†æçš„ä¸ºcomponentScanParserä¸­çš„doProcessConfigurationClass()æ–¹æ³•ï¼Œè¯¥æ–¹æ³•ä¼šä½¿ç”¨parse()æ–¹æ³•è§£ææŸäº›æœ‰ç‰¹å®šæ³¨è§£çš„ç±»ï¼Œç„¶åå¯¹@Importæ³¨è§£è¿›è¡Œå¤„ç†ï¼Œæœ€åè°ƒç”¨scanner.doScan()æ–¹æ³•å®ŒæˆåŒ…æ‰«æã€‚@Importæ³¨è§£ç”¨äºå¼•ç”¨ä¸€ä¸ªç±»ï¼Œè¯¥ç±»ä¼šäº¤ç”±springåˆå§‹åŒ–åŠç®¡ç†ï¼Œå¸¸ç”¨äºå¼•å…¥æ‰«æè·¯å¾„ä¹‹å¤–çš„ç±»ã€‚</p>
<pre><code class="java">    protected final SourceClass doProcessConfigurationClass(ConfigurationClass configClass, SourceClass sourceClass)
            throws IOException {

        if (configClass.getMetadata().isAnnotated(Component.class.getName())) {
            // Recursively process any member (nested) classes first
            processMemberClasses(configClass, sourceClass);
        }

        // Process any @PropertySource annotations
        for (AnnotationAttributes propertySource : AnnotationConfigUtils.attributesForRepeatable(
                sourceClass.getMetadata(), PropertySources.class,
                org.springframework.context.annotation.PropertySource.class)) {
            if (this.environment instanceof ConfigurableEnvironment) {
                processPropertySource(propertySource);
            }
            else {
                logger.info(&quot;Ignoring @PropertySource annotation on [&quot; + sourceClass.getMetadata().getClassName() +
                        &quot;]. Reason: Environment must implement ConfigurableEnvironment&quot;);
            }
        }

        // Process any @ComponentScan annotations
        Set&lt;AnnotationAttributes&gt; componentScans = AnnotationConfigUtils.attributesForRepeatable(
                sourceClass.getMetadata(), ComponentScans.class, ComponentScan.class);
        if (!componentScans.isEmpty() &amp;&amp;
                !this.conditionEvaluator.shouldSkip(sourceClass.getMetadata(), ConfigurationPhase.REGISTER_BEAN)) {
            for (AnnotationAttributes componentScan : componentScans) {
                // The config class is annotated with @ComponentScan -&gt; perform the scan immediately
        //é‡ç‚¹çœ‹è¿™ä¸ªæ–¹æ³•
                Set&lt;BeanDefinitionHolder&gt; scannedBeanDefinitions =
                        this.componentScanParser.parse(componentScan, sourceClass.getMetadata().getClassName());
                // Check the set of scanned definitions for any further config classes and parse recursively if needed
                for (BeanDefinitionHolder holder : scannedBeanDefinitions) {
                    BeanDefinition bdCand = holder.getBeanDefinition().getOriginatingBeanDefinition();
                    if (bdCand == null) {
                        bdCand = holder.getBeanDefinition();
                    }
          //å¯¹ç‰¹å®šæ³¨è§£è¿›è¡Œæ‰«æ
                    if (ConfigurationClassUtils.checkConfigurationClassCandidate(bdCand, this.metadataReaderFactory)) {
                        parse(bdCand.getBeanClassName(), holder.getBeanName());
                    }
                }
            }
        }

    //ç”¨äºå¤„ç†@importæ³¨è§£
        // Process any @Import annotations
        processImports(configClass, sourceClass, getImports(sourceClass), true);

        // Process any @ImportResource annotations
        AnnotationAttributes importResource =
                AnnotationConfigUtils.attributesFor(sourceClass.getMetadata(), ImportResource.class);
        if (importResource != null) {
            String[] resources = importResource.getStringArray(&quot;locations&quot;);
            Class&lt;? extends BeanDefinitionReader&gt; readerClass = importResource.getClass(&quot;reader&quot;);
            for (String resource : resources) {
                String resolvedResource = this.environment.resolveRequiredPlaceholders(resource);
                configClass.addImportedResource(resolvedResource, readerClass);
            }
        }

        // Process individual @Bean methods
        Set&lt;MethodMetadata&gt; beanMethods = retrieveBeanMethodMetadata(sourceClass);
        for (MethodMetadata methodMetadata : beanMethods) {
            configClass.addBeanMethod(new BeanMethod(methodMetadata, configClass));
        }

        // Process default methods on interfaces
        processInterfaces(configClass, sourceClass);

        // Process superclass, if any
        if (sourceClass.getMetadata().hasSuperClass()) {
            String superclass = sourceClass.getMetadata().getSuperClassName();
            if (superclass != null &amp;&amp; !superclass.startsWith(&quot;java&quot;) &amp;&amp;
                    !this.knownSuperclasses.containsKey(superclass)) {
                this.knownSuperclasses.put(superclass, configClass);
                // Superclass found, return its annotation metadata and recurse
                return sourceClass.getSuperClass();
            }
        }

        // No superclass -&gt; processing is complete
        return null;
  }</code></pre>
<h5 id="loadBeanDefinitions"><a href="#loadBeanDefinitions" class="headerlink" title="loadBeanDefinitions()"></a>loadBeanDefinitions()</h5><p>loadBeanDefinitionsæœ€ç»ˆä¼šè°ƒç”¨loadBeanDefinitionsForConfigurationClass()æ–¹æ³•å®Œæˆå¯¹@Beanï¼Œ@Importï¼Œ@ImportSourceæ³¨è§£çš„å¤„ç†ã€‚@ImportSourcesæ³¨è§£ä¼šå¼•å…¥ä¸€ä¸ªxmlæ–‡ä»¶ï¼ŒloadBeanDefinitionsFromImportedResources()æ–¹æ³•ä¼šè°ƒç”¨loadBeanDefinitions()æ–¹æ³•è§£æxmlæ–‡ä»¶ï¼Œè¿™ä¸ªæ–¹æ³•åœ¨springä»¥xmlæ–‡ä»¶çš„æ–¹å¼å¯åŠ¨æ—¶è°ƒç”¨çš„ç›¸åŒã€‚</p>
<pre><code class="java">    private void loadBeanDefinitionsForConfigurationClass(
            ConfigurationClass configClass, TrackedConditionEvaluator trackedConditionEvaluator) {

        if (trackedConditionEvaluator.shouldSkip(configClass)) {
            String beanName = configClass.getBeanName();
            if (StringUtils.hasLength(beanName) &amp;&amp; this.registry.containsBeanDefinition(beanName)) {
                this.registry.removeBeanDefinition(beanName);
            }
            this.importRegistry.removeImportingClass(configClass.getMetadata().getClassName());
            return;
        }

        if (configClass.isImported()) {
            registerBeanDefinitionForImportedConfigurationClass(configClass);
        }
        for (BeanMethod beanMethod : configClass.getBeanMethods()) {
            //@Beanæ ‡ç­¾çš„å¤„ç†
            loadBeanDefinitionsForBeanMethod(beanMethod);
        }
        //@ImportSourcesæ³¨è§£å¤„ç†
        loadBeanDefinitionsFromImportedResources(configClass.getImportedResources());
        //@Importæ³¨è§£å¤„ç†
        loadBeanDefinitionsFromRegistrars(configClass.getImportBeanDefinitionRegistrars());
    }</code></pre>

            </div>
            <hr>
            <div>
              <p>
                
                  <span>
                <i class="iconfont icon-inbox"></i>
                    
                      <a class="hover-with-bg" href="/blog/categories/Spring%E6%BA%90%E7%A0%81%E8%A7%A3%E6%9E%90/">Springæºç è§£æ</a>
                      &nbsp;
                    
                  </span>&nbsp;&nbsp;
                
                
                  <span>
                <i class="iconfont icon-tag"></i>
                    
                      <a class="hover-with-bg" href="/blog/tags/%E6%BA%90%E7%A0%81%E8%A7%A3%E6%9E%90/">æºç è§£æ</a>
                    
                      <a class="hover-with-bg" href="/blog/tags/spring/">spring</a>
                    
                  </span>
                
              </p>
              
                <p class="note note-warning">æœ¬åšå®¢æ‰€æœ‰æ–‡ç« é™¤ç‰¹åˆ«å£°æ˜å¤–ï¼Œå‡é‡‡ç”¨ <a href="https://zh.wikipedia.org/wiki/Wikipedia:CC_BY-SA_3.0%E5%8D%8F%E8%AE%AE%E6%96%87%E6%9C%AC" target="_blank" rel="nofollow noopener noopener">CC BY-SA 3.0åè®®</a> ã€‚è½¬è½½è¯·æ³¨æ˜å‡ºå¤„ï¼</p>
              
              
                <div class="post-prevnext row">
                  <div class="post-prev col-6">
                    
                    
                      <a href="/blog/2020/04/19/spring%E7%9A%84aop%E6%BA%90%E7%A0%81%E8%A7%A3%E6%9E%90/">
                        <i class="fa fa-chevron-left"></i>
                        <span class="hidden-mobile">springçš„aopæºç è§£æ</span>
                        <span class="visible-mobile">ä¸Šä¸€ç¯‡</span>
                      </a>
                    
                  </div>
                  <div class="post-next col-6">
                    
                    
                      <a href="/blog/2020/04/15/spring%E5%AE%9E%E4%BE%8B%E5%8C%96bean%E7%9A%84%E8%BF%87%E7%A8%8B/">
                        <span class="hidden-mobile">springå®ä¾‹åŒ–beançš„è¿‡ç¨‹</span>
                        <span class="visible-mobile">ä¸‹ä¸€ç¯‡</span>
                        <i class="fa fa-chevron-right"></i>
                      </a>
                    
                  </div>
                </div>
              
            </div>

              
                <!-- Comments -->
                <div class="comments" id="comments">
                  
                  

                </div>
              
          </div>
        </div>
      </div>
    </div>
    
      <div class="d-none d-lg-block col-lg-2 toc-container" id="toc-ctn">
        <div id="toc-start"></div>
<div id="toc">
  <p class="h5"><i class="far fa-list-alt"></i>&nbsp;ç›®å½•</p>
  <div id="tocbot"></div>
</div>

      </div>
    
  </div>
</div>

<!-- Custom -->


    
  </main>

  
    <a class="z-depth-1" id="scroll-top-button" href="#" role="button">
      <i class="fa fa-chevron-up scroll-top-arrow" aria-hidden="true"></i>
    </a>
  

  
    <div class="modal fade" id="modalSearch" tabindex="-1" role="dialog" aria-labelledby="ModalLabel"
     aria-hidden="true">
  <div class="modal-dialog modal-dialog-scrollable modal-lg" role="document">
    <div class="modal-content">
      <div class="modal-header text-center">
        <h4 class="modal-title w-100 font-weight-bold">æœç´¢</h4>
        <button type="button" id="local-search-close" class="close" data-dismiss="modal" aria-label="Close">
          <span aria-hidden="true">&times;</span>
        </button>
      </div>
      <div class="modal-body mx-3">
        <div class="md-form mb-5">
          <input type="text" id="local-search-input" class="form-control validate">
          <label data-error="x" data-success="v"
                 for="local-search-input">å…³é”®è¯</label>
        </div>
        <div class="list-group" id="local-search-result"></div>
      </div>
    </div>
  </div>
</div>
  

  

  

  <footer class="mt-5">
  <div class="text-center py-3">
    <div>
      <a href="https://hexo.io" target="_blank" rel="nofollow noopener"><b>Hexo</b></a>
      <i class="iconfont icon-love"></i>
      <a href="https://github.com/fluid-dev/hexo-theme-fluid" target="_blank" rel="nofollow noopener"> <b>Fluid</b></a>
    </div>
    
  <div>
    
      <!-- ä¸è’œå­ç»Ÿè®¡PV -->
      
      <span id="busuanzi_container_site_pv" style="display: none">
      æ€»è®¿é—®é‡ <span id="busuanzi_value_site_pv"></span> æ¬¡
    </span>
    
    
      <!-- ä¸è’œå­ç»Ÿè®¡UV -->
      
      <span id="busuanzi_container_site_uv" style="display: none">
      æ€»è®¿å®¢æ•° <span id="busuanzi_value_site_uv"></span> äºº
    </span>
    
  </div>


    

    
  </div>
</footer>

<!-- SCRIPTS -->
<script  src="https://cdn.staticfile.org/jquery/3.4.1/jquery.min.js" ></script>
<script  src="https://cdn.staticfile.org/popper.js/1.16.1/umd/popper.min.js" ></script>
<script  src="https://cdn.staticfile.org/twitter-bootstrap/4.4.1/js/bootstrap.min.js" ></script>
<script  src="https://cdn.staticfile.org/mdbootstrap/4.13.0/js/mdb.min.js" ></script>
<script  src="/blog/js/main.js" ></script>


  <script  src="/blog/js/lazyload.js" ></script>



  
  <script  src="https://cdn.staticfile.org/tocbot/4.10.0/tocbot.min.js" ></script>
  <script>
    $(document).ready(function () {
      var navHeight = $('#navbar').height();
      var toc = $('#toc');
      var boardCtn = $('#board-ctn');
      var boardTop = boardCtn.offset().top;
      var tocLimMax = 2 * boardTop + boardCtn.height();

      $(window).scroll(function () {
        var tocLimMin = $('#toc-start').offset().top - navHeight;
        var scroH = document.body.scrollTop + document.documentElement.scrollTop;

        if (tocLimMin <= scroH && scroH <= tocLimMax) {
          toc.css({
            'display': 'block',
            'position': 'fixed',
            'top': navHeight,
          });
        } else if (scroH <= tocLimMin) {
          toc.css({
            'position': '',
            'top': '',
          });
        } else if (scroH > tocLimMax) {
          toc.css('display', 'none');
        }
      });
      tocbot.init({
        tocSelector: '#tocbot',
        contentSelector: '.post-content',
        headingSelector: 'h1,h2,h3,h4,h5,h6',
        linkClass: 'tocbot-link',
        activeLinkClass: 'tocbot-active-link',
        listClass: 'tocbot-list',
        isCollapsedClass: 'tocbot-is-collapsed',
        collapsibleClass: 'tocbot-is-collapsible',
        scrollSmooth: true,
        headingsOffset: -boardTop
      });
      if ($('.toc-list-item').length > 0) {
        $('#toc > p').css('visibility', 'visible');
      }
      var offset = boardCtn.css('margin-right')
      $('#toc-ctn').css({
        'right': offset
      })
    });
  </script>





  <script defer src="https://cdn.staticfile.org/clipboard.js/2.0.6/clipboard.min.js" ></script>
  <script  src="/blog/js/clipboard-use.js" ></script>



  <script defer src="https://cdn.staticfile.org/smoothscroll/1.4.10/SmoothScroll.min.js" ></script>



  <script defer src="https://busuanzi.ibruce.info/busuanzi/2.3/busuanzi.pure.mini.js" ></script>




<!-- Plugins -->


  

  

  

  

  

  



  <script  src="https://cdn.staticfile.org/prettify/188.0.0/prettify.min.js" ></script>
  <script>
    $(document).ready(function () {
      $('pre').addClass('prettyprint  linenums');
      prettyPrint();
    })
  </script>



  <script  src="https://cdn.staticfile.org/typed.js/2.0.11/typed.min.js" ></script>
  <script>
    var typed = new Typed('#subtitle', {
      strings: [
        '  ',
        "springåŸºäºæ³¨è§£çš„å¯åŠ¨æ–¹å¼è§£æå’ŒBeançš„ä½œç”¨åŸŸ&nbsp;",
      ],
      cursorChar: "_",
      typeSpeed: 70,
      loop: false,
    });
    typed.stop();
    $(document).ready(function () {
      $(".typed-cursor").addClass("h2");
      typed.start();
    });
  </script>



  <script  src="https://cdn.staticfile.org/anchor-js/4.2.2/anchor.min.js" ></script>
  <script>
    anchors.options = {
      placement: "right",
      visible: "hover",
      
    };
    var el = "h1,h2,h3,h4,h5,h6".split(",");
    var res = [];
    for (item of el) {
      res.push(".markdown-body > " + item)
    }
    anchors.add(res.join(", "))
  </script>



  <script  src="/blog/js/local-search.js" ></script>
  <script>
    var path = "/blog/local-search.xml";
    var inputArea = document.querySelector("#local-search-input");
    inputArea.onclick = function () {
      getSearchFile(path);
      this.onclick = null
    }
  </script>



  <script defer src="https://cdn.staticfile.org/fancybox/3.5.7/jquery.fancybox.min.js" ></script>
  <script>
    $("#post img:not(.no-zoom img, img[no-zoom])").each(
      function () {
        var element = document.createElement("a");
        $(element).attr("data-fancybox", "images");
        $(element).attr("href", $(this).attr("src"));
        $(this).wrap(element);
      }
    );
  </script>





  
  
    <script type="text/javascript">
      //å®šä¹‰è·å–è¯è¯­ä¸‹æ ‡
      var a_idx = 0;
      jQuery(document).ready(function ($) {
        //ç‚¹å‡»bodyæ—¶è§¦å‘äº‹ä»¶
        $("body").click(function (e) {
          //éœ€è¦æ˜¾ç¤ºçš„è¯è¯­
          var a = new Array("å¯Œå¼º", "æ°‘ä¸»", "æ–‡æ˜", "å’Œè°", "è‡ªç”±", "å¹³ç­‰", "å…¬æ­£", "æ³•æ²»", "çˆ±å›½", "æ•¬ä¸š", "è¯šä¿¡", "å‹å–„");
          //è®¾ç½®è¯è¯­ç»™spanæ ‡ç­¾
          var $i = $("<span/>").text(a[a_idx]);
          //ä¸‹æ ‡ç­‰äºåŸæ¥ä¸‹æ ‡+1  ä½™ è¯è¯­æ€»æ•°
          a_idx = (a_idx + 1) % a.length;
          //è·å–é¼ æ ‡æŒ‡é’ˆçš„ä½ç½®ï¼Œåˆ†åˆ«ç›¸å¯¹äºæ–‡æ¡£çš„å·¦å’Œå³è¾¹ç¼˜ã€‚
          //è·å–xå’Œyçš„æŒ‡é’ˆåæ ‡
          var x = e.pageX, y = e.pageY;
          //åœ¨é¼ æ ‡çš„æŒ‡é’ˆçš„ä½ç½®ç»™$iå®šä¹‰çš„spanæ ‡ç­¾æ·»åŠ cssæ ·å¼
          $i.css({
            "z-index": 999,
            "top": y - 20,
            "left": x,
            "position": "absolute",
            "font-weight": "bold",
            "color": rand_color()
          });
          // éšæœºé¢œè‰²
          function rand_color() {
            return "rgb(" + ~~(255 * Math.random()) + "," + ~~(255 * Math.random()) + "," + ~~(255 * Math.random()) + ")"
          }
          //åœ¨bodyæ·»åŠ è¿™ä¸ªæ ‡ç­¾
          $("body").append($i);
          //animate() æ–¹æ³•æ‰§è¡Œ CSS å±æ€§é›†çš„è‡ªå®šä¹‰åŠ¨ç”»ã€‚
          //è¯¥æ–¹æ³•é€šè¿‡CSSæ ·å¼å°†å…ƒç´ ä»ä¸€ä¸ªçŠ¶æ€æ”¹å˜ä¸ºå¦ä¸€ä¸ªçŠ¶æ€ã€‚CSSå±æ€§å€¼æ˜¯é€æ¸æ”¹å˜çš„ï¼Œè¿™æ ·å°±å¯ä»¥åˆ›å»ºåŠ¨ç”»æ•ˆæœã€‚
          //è¯¦æƒ…è¯·çœ‹http://www.w3school.com.cn/jquery/effect_animate.asp
          $i.animate({
            //å°†åŸæ¥çš„ä½ç½®å‘ä¸Šç§»åŠ¨180
            "top": y - 180,
            "opacity": 0
            //1500åŠ¨ç”»çš„é€Ÿåº¦
          }, 1500, function () {
            //æ—¶é—´åˆ°äº†è‡ªåŠ¨åˆ é™¤
            $i.remove();
          });
        });
      })
      ;
    </script>
  








</body>
</html>
