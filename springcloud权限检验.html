<!DOCTYPE html>
<html lang="zh-CN">





<head>
  <meta charset="UTF-8">
  <link rel="apple-touch-icon" sizes="76x76" href="/img/apple-touch-icon.png">
  <link rel="icon" type="image/png" href="/img/favicon.png">
  <meta name="viewport"
        content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no, shrink-to-fit=no">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  
  <meta name="theme-color" content="#2f4154">
  <meta name="description" content="">
  <meta name="author" content="">
  <meta name="keywords" content="">
  <title>springcloudæƒé™æ£€éªŒ - ğŸğŸŠ&#39;s blog</title>

  <link  rel="stylesheet" href="https://cdn.staticfile.org/font-awesome/5.12.1/css/all.min.css" />
<link  rel="stylesheet" href="https://cdn.staticfile.org/twitter-bootstrap/4.4.1/css/bootstrap.min.css" />
<link  rel="stylesheet" href="https://cdn.staticfile.org/mdbootstrap/4.13.0/css/mdb.min.css" />
<link  rel="stylesheet" href="https://cdn.staticfile.org/github-markdown-css/3.0.1/github-markdown.min.css" />

<link rel="stylesheet" href="//at.alicdn.com/t/font_1067060_qzomjdt8bmp.css">



  <link  rel="stylesheet" href="/lib/prettify/tomorrow-night-eighties.min.css" />

<link  rel="stylesheet" href="/css/main.css" />


  <link defer rel="stylesheet" href="https://cdn.staticfile.org/fancybox/3.5.7/jquery.fancybox.min.css" />


<!-- è‡ªå®šä¹‰æ ·å¼ä¿æŒåœ¨æœ€åº•éƒ¨ -->


<meta name="generator" content="Hexo 4.2.1"></head>


<body>
  <header style="height: 70vh;">
    <nav id="navbar" class="navbar fixed-top  navbar-expand-lg navbar-dark scrolling-navbar">
  <div class="container">
    <a class="navbar-brand"
       href="/">&nbsp;<strong>ğŸğŸŠ's blog</strong>&nbsp;</a>

    <button id="navbar-toggler-btn" class="navbar-toggler" type="button" data-toggle="collapse"
            data-target="#navbarSupportedContent"
            aria-controls="navbarSupportedContent" aria-expanded="false" aria-label="Toggle navigation">
      <div class="animated-icon"><span></span><span></span><span></span></div>
    </button>

    <!-- Collapsible content -->
    <div class="collapse navbar-collapse" id="navbarSupportedContent">
      <ul class="navbar-nav ml-auto text-center">
        
          
          
          
          
          <li class="nav-item">
            <a class="nav-link" href="/">é¦–é¡µ</a>
          </li>
        
          
          
          
          
          <li class="nav-item">
            <a class="nav-link" href="/archives/">å½’æ¡£</a>
          </li>
        
          
          
          
          
          <li class="nav-item">
            <a class="nav-link" href="/categories/">åˆ†ç±»</a>
          </li>
        
          
          
          
          
          <li class="nav-item">
            <a class="nav-link" href="/tags/">æ ‡ç­¾</a>
          </li>
        
          
          
          
          
          <li class="nav-item">
            <a class="nav-link" href="/about">å…³äº</a>
          </li>
        
        
          <li class="nav-item" id="search-btn">
            <a class="nav-link" data-toggle="modal" data-target="#modalSearch">&nbsp;&nbsp;<i
                class="iconfont icon-search"></i>&nbsp;&nbsp;</a>
          </li>
        
      </ul>
    </div>
  </div>
</nav>

    <div class="view intro-2" id="background" parallax=true
         style="background: url('/img/default.png') no-repeat center center;
           background-size: cover;">
      <div class="full-bg-img">
        <div class="mask rgba-black-light flex-center">
          <div class="container text-center white-text fadeInUp">
            <span class="h2" id="subtitle">
              
            </span>

            
          </div>

          
        </div>
      </div>
    </div>
  </header>

  <main>
    
      <div class="container nopadding-md">
        <div class="py-5 z-depth-3" id="board"
          >
          
          <div class="container">
            <div class="row">
              <div class="col-12 col-md-10 m-auto">
                

<div class="page-content">
  <h2 id="å¾®æœåŠ¡ç³»ç»Ÿçš„æƒé™æ ¡éªŒ"><a href="#å¾®æœåŠ¡ç³»ç»Ÿçš„æƒé™æ ¡éªŒ" class="headerlink" title="å¾®æœåŠ¡ç³»ç»Ÿçš„æƒé™æ ¡éªŒ"></a>å¾®æœåŠ¡ç³»ç»Ÿçš„æƒé™æ ¡éªŒ</h2>

<p>åœ¨è¿›è¡Œè¯·æ±‚å‰éœ€è¦å…ˆä»è®¤è¯æœåŠ¡å™¨è·å–åˆ°tokenä¿¡æ¯ï¼Œè¯·æ±‚zuulæœåŠ¡å™¨ã€‚ç†è®ºä¸ŠzuulæœåŠ¡å™¨æ˜¯ä¸éœ€è¦è¿›è¡Œæƒé™æ ¡éªŒçš„ï¼Œå› ä¸ºzuulæœåŠ¡å™¨æ²¡æœ‰æ¥å£ï¼Œä¸éœ€è¦ä»zuulè°ƒç”¨ä¸šåŠ¡æ¥å£ï¼Œzuulåªåšç®€å•çš„è·¯ç”±å·¥ä½œã€‚ä¸‹æ¸¸ç³»ç»Ÿåœ¨è·å–åˆ°tokenåï¼Œåœ¨è¿‡æ»¤å™¨ä¸­æŠŠtokenå‘åˆ°è®¤è¯æœåŠ¡å™¨æ ¡éªŒè¯¥tokenæ˜¯å¦æœ‰æ•ˆï¼Œå¦‚æœè®¤è¯æœåŠ¡å™¨æ ¡éªŒé€šè¿‡å°±ä¼šå°†tokenç›¸å…³çš„éªŒè¯ä¿¡æ¯ä¼ å›ç»™ä¸‹æ¸¸ç³»ç»Ÿï¼Œä¸‹æ¸¸ç³»ç»Ÿæ ¹æ®è¿™ä¸ªè¿”å›ç»“æœå°±å¯ä»¥è·å–åˆ°tokenå…·æœ‰çš„æƒé™ã€‚ä½†æ˜¯åœ¨æ ¡éªŒtokençš„è¿‡ç¨‹ï¼Œæ¶‰åŠåˆ°ä¸‹æ¸¸ç³»ç»Ÿå’Œè®¤è¯æœåŠ¡å™¨çš„äº¤äº’ï¼Œè¿™ä¼šå¯¹è¯·æ±‚æ—¶é—´äº§ç”Ÿå½±å“ã€‚è¿˜æœ‰ç§æ–¹æ¡ˆå°±æ˜¯åœ¨zuulä¸­è¿›è¡Œtokenè®¤è¯ï¼Œæ ¡éªŒæ˜¯å¦æœ‰æ¥å£è°ƒç”¨æƒé™ï¼Œåœ¨ä¸‹æ¸¸ç³»ç»Ÿè®¾ç½®è®¿é—®ç™½åå•åªå…è®¸zuulæœåŠ¡å™¨è®¿é—®ï¼Œä½†è¿™ç§æ–¹æ¡ˆä¹Ÿæœ‰ç¼ºé™·ï¼Œå¦‚æœå†…ç½‘ç¯å¢ƒæ”»ç ´ï¼Œèµ„æºæœåŠ¡å™¨ä¸Šæ²¡æœ‰ä»»ä½•è®¤è¯åŠŸèƒ½æ˜¯ååˆ†å±é™©çš„ã€‚</p>
<h2 id="OAuth2è·å–tokençš„æ–¹å¼"><a href="#OAuth2è·å–tokençš„æ–¹å¼" class="headerlink" title="OAuth2è·å–tokençš„æ–¹å¼"></a>OAuth2è·å–tokençš„æ–¹å¼</h2><ul>
<li>å®¢æˆ·ç«¯æ¨¡å¼ï¼šä¸€èˆ¬ç”¨åœ¨æ— éœ€ç”¨æˆ·ç™»å½•çš„ç³»ç»Ÿåšæ¥å£çš„å®‰å…¨æ ¡éªŒï¼Œå› ä¸ºtokenåªéœ€è¦è·Ÿå®¢æˆ·ç«¯ç»‘å®šï¼Œæ§åˆ¶ç²’åº¦ä¸å¤Ÿç»†ã€‚</li>
<li>å¯†ç æ¨¡å¼ï¼štokenæ˜¯è·Ÿç”¨æˆ·ç»‘å®šçš„ï¼Œå¯ä»¥æ ¹æ®ä¸åŒç”¨æˆ·çš„è§’è‰²å’Œæƒé™æ¥æ§åˆ¶ä¸åŒç”¨æˆ·çš„è®¿é—®æƒé™ï¼Œç›¸å¯¹æ¥è¯´æ§åˆ¶ç²’åº¦æ›´ç»†</li>
<li>æˆæƒç æ¨¡å¼ï¼šæˆæƒç æ¨¡å¼æ›´å®‰å…¨ï¼Œå› ä¸ºå‰é¢çš„å¯†ç æ¨¡å¼å¯èƒ½ä¼šå­˜åœ¨å¯†ç æ³„éœ²åï¼Œåˆ«äººæ‹¿åˆ°å¯†ç ä¹Ÿå¯ä»¥ç…§æ ·çš„ç”³è¯·åˆ°tokenæ¥è¿›è¡Œæ¥å£è®¿é—®ï¼Œè€Œæˆæƒç æ¨¡å¼ç”¨æˆ·æä¾›ç”¨æˆ·åå’Œå¯†ç è·å–åï¼Œè¿˜éœ€è¦æœ‰ä¸€ä¸ªå›è°ƒè¿‡ç¨‹ï¼Œè¿™ä¸ªå›è°ƒä½ å¯ä»¥æƒ³è±¡æˆæ˜¯ç”¨æˆ·çš„æ‰‹æœºæˆ–è€…é‚®ç®±çš„å›è°ƒï¼Œåªæœ‰ç”¨æˆ·æœ¬äººèƒ½æ”¶åˆ°è¿™ä¸ªcodeï¼Œå³ä½¿ç”¨æˆ·åå¯†ç è¢«ç›—ä¹Ÿä¸ä¼šå½±å“æ•´ä¸ªç³»ç»Ÿçš„å®‰å…¨ã€‚</li>
</ul>
<h2 id="è·å–tokençš„è¿‡ç¨‹"><a href="#è·å–tokençš„è¿‡ç¨‹" class="headerlink" title="è·å–tokençš„è¿‡ç¨‹"></a>è·å–tokençš„è¿‡ç¨‹</h2><p>tokenæ˜¯é€šè¿‡ä¸€ä¸ªå•ç‹¬çš„è®¤è¯æœåŠ¡å™¨æ¥é¢å‘çš„ï¼Œåªæœ‰å…·å¤‡æŸç§èµ„è´¨è®¤è¯ï¼ŒæœåŠ¡å™¨æ‰ä¼šæŠŠtokenç»™ç”³è¯·è€…ã€‚</p>
<ol>
<li>å¹³å°è®¤è¯ç”³è¯·ï¼šå¹³å°è®¤è¯ç”³è¯·å¾€å¾€æ˜¯ä¸€ä¸ªæ¯”è¾ƒç¹ççš„è¿‡ç¨‹ï¼Œéœ€è¦ç”³è¯·æ–¹æä¾›æ¯”è¾ƒå®Œæ•´çš„è®¤è¯ç”³è¯·ææ–™ï¼Œæ¯”å¦‚å…¬å¸èµ„è´¨ï¼Œè¥ä¸šæ‰§ç…§ç­‰ç­‰ä¿¡æ¯ï¼Œæäº¤ç”³è¯·åè®¤è¯æ–¹å®¡æ ¸é€šè¿‡åï¼Œè¯¥å¹³å°æ‰ä¼šå…è®¸ç”³è¯·tokenã€‚å®Œæˆç”³è¯·åä¸€èˆ¬ä¼šè¿”å›ç”³è¯·æ–¹idè·Ÿsecretã€‚</li>
<li>è·å–tokenåœ¨oauth2ä¸­å…±æœ‰å››ç§æ¨¡å¼ï¼Œè¿™é‡Œä»‹ç»å…¶ä¸­çš„ä¸‰ç§<ul>
<li>å®¢æˆ·ç«¯æ¨¡å¼ï¼šå°†ç¬¬ä¸€æ­¥ä¸­ç”³è¯·çš„idè·Ÿsecretå†åŠ ä¸Šgrant_typeï¼ˆæˆæƒæ–¹å¼ï¼‰ä¼ é€’ç»™è®¤è¯æœåŠ¡å™¨ï¼Œè®¤è¯æœåŠ¡å™¨æ ¡éªŒåè¿”å›tokenã€‚</li>
<li></li>
</ul>
</li>
</ol>
<ul>
<li>æˆæƒç æ¨¡å¼ï¼šç”¨äºå®¢æˆ·ç«¯å’ŒæœåŠ¡ç«¯åº”ç”¨ä¹‹å‰æˆæƒ</li>
<li>å¯†ç æ¨¡å¼ï¼šåº”ç”¨ç›´æ¥éƒ½æ˜¯ä¿¡ä»»çš„ï¼Œç”¨æˆ·å‘å®¢æˆ·ç«¯æä¾›è‡ªå·±çš„ç”¨æˆ·åå’Œå¯†ç ã€‚å®¢æˆ·ç«¯ä½¿ç”¨è¿™äº›ä¿¡æ¯ï¼Œå‘æœåŠ¡æä¾›æ–¹ç´¢è¦æˆæƒã€‚è¿™è¿™ç§æ¨¡å¼ä¸­ï¼Œç”¨æˆ·å¿…é¡»æŠŠè‡ªå·±çš„å¯†ç ç»™å®¢æˆ·ç«¯ï¼Œä½†æ˜¯å®¢æˆ·ç«¯ä¸å¾—ä¸å­˜å‚¨å¯†ç ã€‚</li>
<li>å®¢æˆ·ç«¯æ¨¡å¼ï¼šå¸¸ç”¨çš„éªŒè¯æ–¹å¼ã€‚å®¢æˆ·ç«¯ä»¥è‡ªå·±çš„åä¹‰å‘æœåŠ¡æä¾›å•†è¿›è¡Œè®¤è¯ï¼Œå®¢æˆ·ç«¯å¹¶ä¸å±äºOAuthæ¡†æ¶æ‰€è¦è§£å†³çš„é—®é¢˜ï¼Œåœ¨è¿™ç§æ¨¡å¼ä¸­ï¼Œç”¨æˆ·ç›´æ¥å‘å®¢æˆ·ç«¯æ³¨å†Œï¼Œå®¢æˆ·ç«¯ä»¥è‡ªå·±çš„åä¹‰è¦æ±‚æœåŠ¡æä¾›å•†æä¾›æœåŠ¡ï¼Œå…¶å®ä¸å­˜åœ¨æˆæƒé—®é¢˜ã€‚</li>
</ul>
<h2 id="å®¢æˆ·ç«¯æ¨¡å¼è®¤è¯æœåŠ¡å™¨çš„æ­å»º"><a href="#å®¢æˆ·ç«¯æ¨¡å¼è®¤è¯æœåŠ¡å™¨çš„æ­å»º" class="headerlink" title="å®¢æˆ·ç«¯æ¨¡å¼è®¤è¯æœåŠ¡å™¨çš„æ­å»º"></a>å®¢æˆ·ç«¯æ¨¡å¼è®¤è¯æœåŠ¡å™¨çš„æ­å»º</h2><p>pom</p>
<pre><code class="xml">&lt;?xml version=&quot;1.0&quot; encoding=&quot;UTF-8&quot;?&gt;

&lt;project xmlns=&quot;http://maven.apache.org/POM/4.0.0&quot; xmlns:xsi=&quot;http://www.w3.org/2001/XMLSchema-instance&quot;
         xsi:schemaLocation=&quot;http://maven.apache.org/POM/4.0.0 http://maven.apache.org/xsd/maven-4.0.0.xsd&quot;&gt;
    &lt;modelVersion&gt;4.0.0&lt;/modelVersion&gt;

    &lt;parent&gt;
        &lt;groupId&gt;org.springframework.boot&lt;/groupId&gt;
        &lt;artifactId&gt;spring-boot-starter-parent&lt;/artifactId&gt;
        &lt;version&gt;2.2.6.RELEASE&lt;/version&gt;
    &lt;/parent&gt;

    &lt;groupId&gt;pers.zgc&lt;/groupId&gt;
    &lt;artifactId&gt;micro-security&lt;/artifactId&gt;
    &lt;version&gt;1.0-SNAPSHOT&lt;/version&gt;

    &lt;name&gt;micro-security&lt;/name&gt;
    &lt;!-- FIXME change it to the project&#39;s website --&gt;
    &lt;url&gt;http://www.example.com&lt;/url&gt;

    &lt;properties&gt;
        &lt;project.build.sourceEncoding&gt;UTF-8&lt;/project.build.sourceEncoding&gt;
        &lt;maven.compiler.source&gt;1.8&lt;/maven.compiler.source&gt;
        &lt;maven.compiler.target&gt;1.8&lt;/maven.compiler.target&gt;
        &lt;spring-cloud.version&gt;Hoxton.SR3&lt;/spring-cloud.version&gt;
    &lt;/properties&gt;

    &lt;dependencies&gt;
        &lt;dependency&gt;
            &lt;groupId&gt;org.springframework.boot&lt;/groupId&gt;
            &lt;artifactId&gt;spring-boot-starter-web&lt;/artifactId&gt;
        &lt;/dependency&gt;
        &lt;dependency&gt;
            &lt;groupId&gt;org.springframework.cloud&lt;/groupId&gt;
            &lt;artifactId&gt;spring-cloud-starter-oauth2&lt;/artifactId&gt;
        &lt;/dependency&gt;
        &lt;dependency&gt;
            &lt;groupId&gt;org.springframework.cloud&lt;/groupId&gt;
            &lt;artifactId&gt;spring-cloud-starter-security&lt;/artifactId&gt;
        &lt;/dependency&gt;
        &lt;dependency&gt;
            &lt;groupId&gt;org.springframework.security&lt;/groupId&gt;
            &lt;artifactId&gt;spring-security-data&lt;/artifactId&gt;
        &lt;/dependency&gt;
        &lt;dependency&gt;
            &lt;groupId&gt;org.springframework.cloud&lt;/groupId&gt;
            &lt;artifactId&gt;spring-cloud-starter-netflix-eureka-client&lt;/artifactId&gt;
        &lt;/dependency&gt;
        &lt;dependency&gt;
            &lt;groupId&gt;org.springframework.boot&lt;/groupId&gt;
            &lt;artifactId&gt;spring-boot-starter-data-redis&lt;/artifactId&gt;
            &lt;!-- 1.5çš„ç‰ˆæœ¬é»˜è®¤é‡‡ç”¨çš„è¿æ¥æ± æŠ€æœ¯æ˜¯jedis  2.0ä»¥ä¸Šç‰ˆæœ¬é»˜è®¤è¿æ¥æ± æ˜¯lettuce, åœ¨è¿™é‡Œé‡‡ç”¨jedisï¼Œæ‰€ä»¥éœ€è¦æ’é™¤lettuceçš„jar --&gt;
            &lt;exclusions&gt;
                &lt;exclusion&gt;
                    &lt;groupId&gt;redis.clients&lt;/groupId&gt;
                    &lt;artifactId&gt;jedis&lt;/artifactId&gt;
                &lt;/exclusion&gt;
                &lt;exclusion&gt;
                    &lt;groupId&gt;io.lettuce&lt;/groupId&gt;
                    &lt;artifactId&gt;lettuce-core&lt;/artifactId&gt;
                &lt;/exclusion&gt;
            &lt;/exclusions&gt;
        &lt;/dependency&gt;
        &lt;dependency&gt;
            &lt;groupId&gt;redis.clients&lt;/groupId&gt;
            &lt;artifactId&gt;jedis&lt;/artifactId&gt;
            &lt;version&gt;3.1.0&lt;/version&gt;
        &lt;/dependency&gt;
        &lt;dependency&gt;
            &lt;groupId&gt;mysql&lt;/groupId&gt;
            &lt;artifactId&gt;mysql-connector-java&lt;/artifactId&gt;
        &lt;/dependency&gt;
    &lt;/dependencies&gt;

    &lt;dependencyManagement&gt;
        &lt;dependencies&gt;
            &lt;dependency&gt;
                &lt;groupId&gt;org.springframework.cloud&lt;/groupId&gt;
                &lt;artifactId&gt;spring-cloud-dependencies&lt;/artifactId&gt;
                &lt;version&gt;${spring-cloud.version}&lt;/version&gt;
                &lt;type&gt;pom&lt;/type&gt;
                &lt;scope&gt;import&lt;/scope&gt;
            &lt;/dependency&gt;
        &lt;/dependencies&gt;
    &lt;/dependencyManagement&gt;

    &lt;build&gt;
        &lt;pluginManagement&gt;&lt;!-- lock down plugins versions to avoid using Maven defaults (may be moved to parent pom) --&gt;
            &lt;plugins&gt;
                &lt;!-- clean lifecycle, see https://maven.apache.org/ref/current/maven-core/lifecycles.html#clean_Lifecycle --&gt;
                &lt;plugin&gt;
                    &lt;artifactId&gt;maven-clean-plugin&lt;/artifactId&gt;
                    &lt;version&gt;3.1.0&lt;/version&gt;
                &lt;/plugin&gt;
                &lt;!-- default lifecycle, jar packaging: see https://maven.apache.org/ref/current/maven-core/default-bindings.html#Plugin_bindings_for_jar_packaging --&gt;
                &lt;plugin&gt;
                    &lt;artifactId&gt;maven-resources-plugin&lt;/artifactId&gt;
                    &lt;version&gt;3.0.2&lt;/version&gt;
                &lt;/plugin&gt;
                &lt;plugin&gt;
                    &lt;artifactId&gt;maven-compiler-plugin&lt;/artifactId&gt;
                    &lt;version&gt;3.8.0&lt;/version&gt;
                &lt;/plugin&gt;
                &lt;plugin&gt;
                    &lt;artifactId&gt;maven-surefire-plugin&lt;/artifactId&gt;
                    &lt;version&gt;2.22.1&lt;/version&gt;
                &lt;/plugin&gt;
                &lt;plugin&gt;
                    &lt;artifactId&gt;maven-jar-plugin&lt;/artifactId&gt;
                    &lt;version&gt;3.0.2&lt;/version&gt;
                &lt;/plugin&gt;
                &lt;plugin&gt;
                    &lt;artifactId&gt;maven-install-plugin&lt;/artifactId&gt;
                    &lt;version&gt;2.5.2&lt;/version&gt;
                &lt;/plugin&gt;
                &lt;plugin&gt;
                    &lt;artifactId&gt;maven-deploy-plugin&lt;/artifactId&gt;
                    &lt;version&gt;2.8.2&lt;/version&gt;
                &lt;/plugin&gt;
                &lt;!-- site lifecycle, see https://maven.apache.org/ref/current/maven-core/lifecycles.html#site_Lifecycle --&gt;
                &lt;plugin&gt;
                    &lt;artifactId&gt;maven-site-plugin&lt;/artifactId&gt;
                    &lt;version&gt;3.7.1&lt;/version&gt;
                &lt;/plugin&gt;
                &lt;plugin&gt;
                    &lt;artifactId&gt;maven-project-info-reports-plugin&lt;/artifactId&gt;
                    &lt;version&gt;3.0.0&lt;/version&gt;
                &lt;/plugin&gt;
            &lt;/plugins&gt;
        &lt;/pluginManagement&gt;
    &lt;/build&gt;
&lt;/project&gt;
</code></pre>
<p>é…ç½®ä¿¡æ¯</p>
<pre><code class="properties">spring.application.name=micro-security
server.port=3030
eureka.client.serviceUrl.defaultZone=http://admin:admin@localhost:8763/eureka/

#spring.data.mongodb.uri=mongodb://192.168.67.139:27017/micro_security

#security.oauth2.resource.filter-order=3

spring.datasource.driver-class-name=com.mysql.jdbc.Driver
spring.datasource.url=jdbc:mysql://localhost:3306/consult?serverTimezone=UTC
spring.datasource.username=root
spring.datasource.password=zhao19971107A

spring.jpa.hibernate.ddl-auto:update
spring.jpa.show-sql:true

#sqlæ—¥å¿—
logging.level.com.xiangxue.jack.dao=debug

# Redisæ•°æ®åº“ç´¢å¼•
spring.redis.database=0
# RedisæœåŠ¡å™¨åœ°å€
spring.redis.host=localhost
# RedisæœåŠ¡å™¨è¿æ¥ç«¯å£
spring.redis.port=6379
# RedisæœåŠ¡å™¨è¿æ¥å¯†ç ï¼ˆé»˜è®¤ä¸ºç©ºï¼‰
spring.redis.password=
# è¿æ¥æ± æœ€å¤§è¿æ¥æ•°
spring.redis.jedis.pool.max-active=8
# è¿æ¥æ± æœ€å¤§é˜»å¡ç­‰å¾…æ—¶é—´
spring.redis.jedis.pool.max-wait=-1
# è¿æ¥æ± ä¸­çš„æœ€å¤§ç©ºé—²è¿æ¥
spring.redis.jedis.pool.max-idle=8
# è¿æ¥æ± ä¸­çš„æœ€å°ç©ºé—²è¿æ¥
spring.redis.jedis.pool.min-idle=0
# è¿æ¥è¶…æ—¶æ—¶é—´ï¼ˆæ¯«ç§’ï¼‰
spring.redis.timeout=0

logging.level.org.springframework.security=debug</code></pre>
<p>å¯åŠ¨ç±»</p>
<pre><code class="java">@SpringBootApplication
@EnableResourceServer
public class MicroSecurityApplication {
    public static void main(String[] args) {
        SpringApplication.run(MicroSecurityApplication.class, args);
    }
}</code></pre>
<p>é…ç½®ç±»</p>
<pre><code class="java">@Configuration
@EnableAuthorizationServer
public class AuthorizationServerConfig extends AuthorizationServerConfigurerAdapter {

    @Autowired
    private AuthenticationManager authenticationManager;

    @Autowired
    private RedisConnectionFactory connectionFactory;

    @Autowired
    private UserDetailsService userDetailsService;

    @Bean
    public TokenStore tokenStore() {
        return new MyRedisTokenStore(connectionFactory);
    }

    /**
     * AuthorizationServerEndpointsConfigurerï¼šç”¨æ¥é…ç½®æˆæƒï¼ˆauthorizationï¼‰ä»¥åŠä»¤ç‰Œï¼ˆtokenï¼‰çš„è®¿é—®ç«¯ç‚¹å’Œä»¤ç‰ŒæœåŠ¡(token services)ã€‚
     */
    @Override
    public void configure(AuthorizationServerEndpointsConfigurer endpoints) throws Exception {
        endpoints
                .authenticationManager(authenticationManager)
                //è‹¥æ— ï¼Œrefresh_tokenä¼šæœ‰UserDetailsService is requiredé”™è¯¯
                .userDetailsService(userDetailsService)
                .tokenStore(tokenStore()).
                allowedTokenEndpointRequestMethods(HttpMethod.GET, HttpMethod.POST);
    }

    /**
     * AuthorizationServerSecurityConfigurer ç”¨æ¥é…ç½®ä»¤ç‰Œç«¯ç‚¹(Token Endpoint)çš„å®‰å…¨çº¦æŸ
     */
    @Override
    public void configure(AuthorizationServerSecurityConfigurer security) throws Exception {
        // å…è®¸è¡¨å•è®¤è¯
        security.allowFormAuthenticationForClients().tokenKeyAccess(&quot;permitAll()&quot;)
                .checkTokenAccess(&quot;isAuthenticated()&quot;);
    }

    /**
     * ClientDetailsServiceConfigurerï¼šç”¨æ¥é…ç½®å®¢æˆ·ç«¯è¯¦æƒ…æœåŠ¡ï¼ˆClientDetailsServiceï¼‰ï¼Œå®¢æˆ·ç«¯è¯¦æƒ…ä¿¡æ¯åœ¨è¿™é‡Œè¿›è¡Œåˆå§‹åŒ–ï¼Œä½ èƒ½å¤ŸæŠŠå®¢æˆ·ç«¯è¯¦æƒ…ä¿¡æ¯å†™æ­»åœ¨è¿™é‡Œæˆ–è€…æ˜¯é€šè¿‡æ•°æ®åº“æ¥å­˜å‚¨è°ƒå–è¯¦æƒ…ä¿¡æ¯
     * 1.æˆæƒç æ¨¡å¼ï¼ˆauthorization codeï¼‰
     * 2.ç®€åŒ–æ¨¡å¼ï¼ˆimplicitï¼‰
     * 3.å¯†ç æ¨¡å¼ï¼ˆresource owner password credentialsï¼‰
     * 4.å®¢æˆ·ç«¯æ¨¡å¼ï¼ˆclient credentialsï¼‰
     */
    @Override
    public void configure(ClientDetailsServiceConfigurer clients) throws Exception {
        String finalSecret = &quot;{bcrypt}&quot; + new BCryptPasswordEncoder().encode(&quot;123456&quot;);

        clients.
//                jdbc(dataSource).
        inMemory().
                withClient(&quot;micro-web&quot;)
                .resourceIds(&quot;micro-web&quot;)
                .authorizedGrantTypes(&quot;client_credentials&quot;, &quot;refresh_token&quot;)
                .scopes(&quot;all&quot;, &quot;read&quot;, &quot;write&quot;, &quot;aa&quot;)
                .authorities(&quot;client_credentials&quot;)
                .secret(finalSecret)
                .accessTokenValiditySeconds(1200)
                .refreshTokenValiditySeconds(50000)
                .and()
                .withClient(&quot;micro-zuul&quot;)
                .resourceIds(&quot;micro-zuul&quot;)
                .authorizedGrantTypes(&quot;password&quot;, &quot;refresh_token&quot;)
                .scopes(&quot;server&quot;)
                .authorities(&quot;password&quot;)
                .secret(finalSecret)
                .accessTokenValiditySeconds(1200)
                .refreshTokenValiditySeconds(50000);
    }
}</code></pre>
<pre><code class="java">@Configuration
@EnableWebSecurity
public class SecurityConfiguration extends WebSecurityConfigurerAdapter {

    @Bean
    @Override
    protected UserDetailsService userDetailsService() {
        BCryptPasswordEncoder bCryptPasswordEncoder = new BCryptPasswordEncoder();

        String finalPassword = &quot;{bcrypt}&quot; + bCryptPasswordEncoder.encode(&quot;123456&quot;);
        InMemoryUserDetailsManager manager = new InMemoryUserDetailsManager();
        manager.createUser(User.withUsername(&quot;jack&quot;).password(finalPassword).authorities(&quot;USER&quot;).build());
        manager.createUser(User.withUsername(&quot;admin&quot;).password(finalPassword).authorities(&quot;USER&quot;).build());

        return manager;
    }

    /*@Override
    protected void configure(AuthenticationManagerBuilder auth) throws Exception {
        auth.userDetailsService(userDetailsService()).passwordEncoder(new BCryptPasswordEncoder());;
    }*/

    @Bean
    @Override
    public AuthenticationManager authenticationManagerBean() throws Exception {
        AuthenticationManager manager = super.authenticationManagerBean();
        return manager;
    }

    @Override
    protected void configure(HttpSecurity http) throws Exception {
        http.csrf().disable();
//        http.requestMatchers().anyRequest()
//                .and()
//                .authorizeRequests()
//                .antMatchers(&quot;/oauth/**&quot;).permitAll();

        http.authorizeRequests()
                .antMatchers(&quot;/oauth/**&quot;,&quot;/actuator/**&quot;).permitAll()
                .and()
                .httpBasic().disable();
    }
}</code></pre>
<p>è·å–token</p>


<h2 id="å¯†ç æ¨¡å¼è®¤è¯æœåŠ¡å™¨çš„æ­å»º"><a href="#å¯†ç æ¨¡å¼è®¤è¯æœåŠ¡å™¨çš„æ­å»º" class="headerlink" title="å¯†ç æ¨¡å¼è®¤è¯æœåŠ¡å™¨çš„æ­å»º"></a>å¯†ç æ¨¡å¼è®¤è¯æœåŠ¡å™¨çš„æ­å»º</h2><h2 id="JWTï¼ˆJson-Web-Tokenï¼‰æ¨¡å¼æˆæƒ"><a href="#JWTï¼ˆJson-Web-Tokenï¼‰æ¨¡å¼æˆæƒ" class="headerlink" title="JWTï¼ˆJson Web Tokenï¼‰æ¨¡å¼æˆæƒ"></a>JWTï¼ˆJson Web Tokenï¼‰æ¨¡å¼æˆæƒ</h2>
</div>

              </div>
            </div>
          </div>
        </div>
      </div>
    
  </main>

  
    <a class="z-depth-1" id="scroll-top-button" href="#" role="button">
      <i class="fa fa-chevron-up scroll-top-arrow" aria-hidden="true"></i>
    </a>
  

  
    <div class="modal fade" id="modalSearch" tabindex="-1" role="dialog" aria-labelledby="ModalLabel"
     aria-hidden="true">
  <div class="modal-dialog modal-dialog-scrollable modal-lg" role="document">
    <div class="modal-content">
      <div class="modal-header text-center">
        <h4 class="modal-title w-100 font-weight-bold">æœç´¢</h4>
        <button type="button" id="local-search-close" class="close" data-dismiss="modal" aria-label="Close">
          <span aria-hidden="true">&times;</span>
        </button>
      </div>
      <div class="modal-body mx-3">
        <div class="md-form mb-5">
          <input type="text" id="local-search-input" class="form-control validate">
          <label data-error="x" data-success="v"
                 for="local-search-input">å…³é”®è¯</label>
        </div>
        <div class="list-group" id="local-search-result"></div>
      </div>
    </div>
  </div>
</div>
  

  

  

  <footer class="mt-5">
  <div class="text-center py-3">
    <div>
      <a href="https://hexo.io" target="_blank" rel="nofollow noopener"><b>Hexo</b></a>
      <i class="iconfont icon-love"></i>
      <a href="https://github.com/fluid-dev/hexo-theme-fluid" target="_blank" rel="nofollow noopener"> <b>Fluid</b></a>
    </div>
    
  <div>
    
      <!-- ä¸è’œå­ç»Ÿè®¡PV -->
      
      <span id="busuanzi_container_site_pv" style="display: none">
      æ€»è®¿é—®é‡ <span id="busuanzi_value_site_pv"></span> æ¬¡
    </span>
    
    
      <!-- ä¸è’œå­ç»Ÿè®¡UV -->
      
      <span id="busuanzi_container_site_uv" style="display: none">
      æ€»è®¿å®¢æ•° <span id="busuanzi_value_site_uv"></span> äºº
    </span>
    
  </div>


    

    
  </div>
</footer>

<!-- SCRIPTS -->
<script  src="https://cdn.staticfile.org/jquery/3.4.1/jquery.min.js" ></script>
<script  src="https://cdn.staticfile.org/popper.js/1.16.1/umd/popper.min.js" ></script>
<script  src="https://cdn.staticfile.org/twitter-bootstrap/4.4.1/js/bootstrap.min.js" ></script>
<script  src="https://cdn.staticfile.org/mdbootstrap/4.13.0/js/mdb.min.js" ></script>
<script  src="/js/main.js" ></script>


  <script  src="/js/lazyload.js" ></script>





  <script defer src="https://cdn.staticfile.org/clipboard.js/2.0.6/clipboard.min.js" ></script>
  <script  src="/js/clipboard-use.js" ></script>



  <script defer src="https://cdn.staticfile.org/smoothscroll/1.4.10/SmoothScroll.min.js" ></script>



  <script defer src="https://busuanzi.ibruce.info/busuanzi/2.3/busuanzi.pure.mini.js" ></script>




<!-- Plugins -->


  

  

  

  

  

  



  <script  src="https://cdn.staticfile.org/prettify/188.0.0/prettify.min.js" ></script>
  <script>
    $(document).ready(function () {
      $('pre').addClass('prettyprint  linenums');
      prettyPrint();
    })
  </script>



  <script  src="https://cdn.staticfile.org/typed.js/2.0.11/typed.min.js" ></script>
  <script>
    var typed = new Typed('#subtitle', {
      strings: [
        '  ',
        "springcloudæƒé™æ£€éªŒ&nbsp;",
      ],
      cursorChar: "_",
      typeSpeed: 70,
      loop: false,
    });
    typed.stop();
    $(document).ready(function () {
      $(".typed-cursor").addClass("h2");
      typed.start();
    });
  </script>



  <script  src="https://cdn.staticfile.org/anchor-js/4.2.2/anchor.min.js" ></script>
  <script>
    anchors.options = {
      placement: "right",
      visible: "hover",
      
    };
    var el = "h1,h2,h3,h4,h5,h6".split(",");
    var res = [];
    for (item of el) {
      res.push(".markdown-body > " + item)
    }
    anchors.add(res.join(", "))
  </script>



  <script  src="/js/local-search.js" ></script>
  <script>
    var path = "/local-search.xml";
    var inputArea = document.querySelector("#local-search-input");
    inputArea.onclick = function () {
      getSearchFile(path);
      this.onclick = null
    }
  </script>



  <script defer src="https://cdn.staticfile.org/fancybox/3.5.7/jquery.fancybox.min.js" ></script>
  <script>
    $("#post img:not(.no-zoom img, img[no-zoom])").each(
      function () {
        var element = document.createElement("a");
        $(element).attr("data-fancybox", "images");
        $(element).attr("href", $(this).attr("src"));
        $(this).wrap(element);
      }
    );
  </script>





  
  
    <script type="text/javascript">
      //å®šä¹‰è·å–è¯è¯­ä¸‹æ ‡
      var a_idx = 0;
      jQuery(document).ready(function ($) {
        //ç‚¹å‡»bodyæ—¶è§¦å‘äº‹ä»¶
        $("body").click(function (e) {
          //éœ€è¦æ˜¾ç¤ºçš„è¯è¯­
          var a = new Array("å¯Œå¼º", "æ°‘ä¸»", "æ–‡æ˜", "å’Œè°", "è‡ªç”±", "å¹³ç­‰", "å…¬æ­£", "æ³•æ²»", "çˆ±å›½", "æ•¬ä¸š", "è¯šä¿¡", "å‹å–„");
          //è®¾ç½®è¯è¯­ç»™spanæ ‡ç­¾
          var $i = $("<span/>").text(a[a_idx]);
          //ä¸‹æ ‡ç­‰äºåŸæ¥ä¸‹æ ‡+1  ä½™ è¯è¯­æ€»æ•°
          a_idx = (a_idx + 1) % a.length;
          //è·å–é¼ æ ‡æŒ‡é’ˆçš„ä½ç½®ï¼Œåˆ†åˆ«ç›¸å¯¹äºæ–‡æ¡£çš„å·¦å’Œå³è¾¹ç¼˜ã€‚
          //è·å–xå’Œyçš„æŒ‡é’ˆåæ ‡
          var x = e.pageX, y = e.pageY;
          //åœ¨é¼ æ ‡çš„æŒ‡é’ˆçš„ä½ç½®ç»™$iå®šä¹‰çš„spanæ ‡ç­¾æ·»åŠ cssæ ·å¼
          $i.css({
            "z-index": 999,
            "top": y - 20,
            "left": x,
            "position": "absolute",
            "font-weight": "bold",
            "color": rand_color()
          });
          // éšæœºé¢œè‰²
          function rand_color() {
            return "rgb(" + ~~(255 * Math.random()) + "," + ~~(255 * Math.random()) + "," + ~~(255 * Math.random()) + ")"
          }
          //åœ¨bodyæ·»åŠ è¿™ä¸ªæ ‡ç­¾
          $("body").append($i);
          //animate() æ–¹æ³•æ‰§è¡Œ CSS å±æ€§é›†çš„è‡ªå®šä¹‰åŠ¨ç”»ã€‚
          //è¯¥æ–¹æ³•é€šè¿‡CSSæ ·å¼å°†å…ƒç´ ä»ä¸€ä¸ªçŠ¶æ€æ”¹å˜ä¸ºå¦ä¸€ä¸ªçŠ¶æ€ã€‚CSSå±æ€§å€¼æ˜¯é€æ¸æ”¹å˜çš„ï¼Œè¿™æ ·å°±å¯ä»¥åˆ›å»ºåŠ¨ç”»æ•ˆæœã€‚
          //è¯¦æƒ…è¯·çœ‹http://www.w3school.com.cn/jquery/effect_animate.asp
          $i.animate({
            //å°†åŸæ¥çš„ä½ç½®å‘ä¸Šç§»åŠ¨180
            "top": y - 180,
            "opacity": 0
            //1500åŠ¨ç”»çš„é€Ÿåº¦
          }, 1500, function () {
            //æ—¶é—´åˆ°äº†è‡ªåŠ¨åˆ é™¤
            $i.remove();
          });
        });
      })
      ;
    </script>
  








</body>
</html>
